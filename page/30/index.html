<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="o1eiNMhypkcaTCNHyHeoaEJM-2wqU4uSpp7XfdfQglI">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"keleven.me","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="千变万化的是世界">
<meta property="og:type" content="website">
<meta property="og:title" content="Keleven.Me">
<meta property="og:url" content="http://keleven.me/page/30/index.html">
<meta property="og:site_name" content="Keleven.Me">
<meta property="og:description" content="千变万化的是世界">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="K11">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://keleven.me/page/30/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/30/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Keleven.Me</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111519029-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-111519029-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Keleven.Me</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="K11"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">K11</p>
  <div class="site-description" itemprop="description">千变万化的是世界</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">303</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/k11me" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;k11me" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:k11@keleven.me" title="E-Mail → mailto:k11@keleven.me" rel="noopener me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.instagram.com/_y.o_o.y_/" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;_y.o_o.y_&#x2F;" rel="noopener me" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/17/1db12a3d2de1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Keleven.Me">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/17/1db12a3d2de1/" class="post-title-link" itemprop="url">laravel 学习指南 第五章 第一节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-17 00:00:00" itemprop="dateCreated datePublished" datetime="2016-07-17T00:00:00+08:00">2016-07-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/17/1db12a3d2de1/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/17/1db12a3d2de1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-基本功能"><a href="#5-基本功能" class="headerlink" title="5 基本功能"></a>5 基本功能</h2><h2 id="5-1-路由"><a href="#5-1-路由" class="headerlink" title="5.1 路由"></a>5.1 路由</h2><h3 id="5-1-1-基本路由"><a href="#5-1-1-基本路由" class="headerlink" title="5.1.1 基本路由"></a>5.1.1 基本路由</h3><p>laravel所有的路由都可以定义在<code>App/Http/routes.php</code>文件，它会被<code>App/Providers/RouteServiceProvider</code>类载入。</p>
<p>下方是一个最基本的<code>get</code>与<code>post</code>。<code>get</code>接收URL，<code>post</code>为一个闭包。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;foo&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::post(<span class="string">&#x27;foo&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>默认情况下，<code>routes.php</code>文件包含单个路由和一个套用<code>web</code>中间件的路由组。</p>
<p>这个中间件路由组提供了<code>session</code>状态以及<code>CSRF</code>保护。</p>
<p>一般情况下，会将全部路由放置在这个路由组。</p>
<h4 id="5-1-1-1-有效的路由方法"><a href="#5-1-1-1-有效的路由方法" class="headerlink" title="5.1.1.1 有效的路由方法"></a>5.1.1.1 有效的路由方法</h4><p>注册路由来响应任何HTTP请求：</p>
<p>下方是HTTP请求方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::post(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::put(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::patch(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::delete(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::options(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br></pre></td></tr></table></figure>
<p>有时候还需要注册路由响应多个HTTP请求，这时可以使用<code>match</code>方法来实现。甚至可以使用<code>any</code>方法注册一个路由来响应所有HTTP请求：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Route::match([<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;post&#x27;</span>], <span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::any(<span class="string">&#x27;foo&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当路由过多时，使用<code>控制器</code>是个好方法。</p>
</blockquote>
<hr>
<h3 id="5-1-2-路由参数"><a href="#5-1-2-路由参数" class="headerlink" title="5.1.2 路由参数"></a>5.1.2 路由参数</h3><h4 id="5-1-2-1-基础路由参数"><a href="#5-1-2-1-基础路由参数" class="headerlink" title="5.1.2.1 基础路由参数"></a>5.1.2.1 基础路由参数</h4><p>有时可能需要在路由中捕获URL片段。比如，要从URL中捕获用户ID，需要通过下方代码定义路由参数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;User &#x27;</span>.<span class="variable">$id</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>可以按照需要在路由中定义多个路由参数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;posts/&#123;post&#125;/comments/&#123;comment&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$postId</span>, <span class="variable">$commentId</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>路由参数总是通过<code>&#123; &#125;</code>进行包裹，这些参数在路由被执行时会被传递到路由的闭包。</p>
<p><em>注意：路由参数不能包含<code>-</code>,要使用<code>_</code>替换。</em></p>
<h4 id="5-1-2-2-选择性路由参数"><a href="#5-1-2-2-选择性路由参数" class="headerlink" title="5.1.2.2 选择性路由参数"></a>5.1.2.2 选择性路由参数</h4><p>有时候可能需要指定可选的路由参数，这可以通过在参数后加<code>?</code>标记来实现，这种情况下需要指定变量的默认值：</p>
<p>下方代码先设定<code>name可以为空</code>，再设定默认<code>name为John</code>。 </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;name?&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$name</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;user/&#123;name?&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$name</span> = <span class="string">&#x27;John&#x27;</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h4 id="5-1-2-3-正则约束"><a href="#5-1-2-3-正则约束" class="headerlink" title="5.1.2.3 正则约束"></a>5.1.2.3 正则约束</h4><p>路由设置中可以使用<code>where</code>方法来约束路由参数。<code>where</code>方法接收参数名和一个正则表达式来定义参数如何被约束：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;name&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;)-&gt;where(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;[A-Za-z]+&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;)-&gt;where(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;[0-9]+&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;/&#123;name&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span>, <span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;)-&gt;where([<span class="string">&#x27;id&#x27;</span> =&gt; <span class="string">&#x27;[0-9]+&#x27;</span>, <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;[a-z]+&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="5-1-2-4-全局约束"><a href="#5-1-2-4-全局约束" class="headerlink" title="5.1.2.4 全局约束"></a>5.1.2.4 全局约束</h4><p>如果想要全局约束，可以使用<code>pattern</code>方法。在<code>RouteServiceProvider</code>类的<code>boot</code>方式中定义约束：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义路由模型绑定，模式过滤器等</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  \Illuminate\Routing\Router  $router</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@translator</span>  http://laravelacademy.org</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params">Router <span class="variable">$router</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$router</span>-&gt;pattern(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;[0-9]+&#x27;</span>);</span><br><span class="line">    <span class="built_in">parent</span>::boot(<span class="variable">$router</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一旦模式被定义，将会自动应用到所有包含参数名的路由中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 只有当 &#123;id&#125; 是数字时才会被调用</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上方例子中限定<code>id</code>只能是数字。</p>
<hr>
<h3 id="5-1-3-命令路由"><a href="#5-1-3-命令路由" class="headerlink" title="5.1.3 命令路由"></a>5.1.3 命令路由</h3><p>命令路由为生成URL或重新定向提供方便。在定义路由是使用<code>as</code>指定路由名称：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/profile&#x27;</span>, [<span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;profile&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>此外，还可以为控制器动作指定路由名称：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/profile&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;uses&#x27;</span> =&gt; <span class="string">&#x27;UserController@showProfile&#x27;</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p>还有另一种，路由命名的方法，比如使用<code>name</code>方式来实现：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/profile&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">&#125;)-&gt;name(<span class="string">&#x27;profile&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/422303771/web/master/ubuntu/laravel/img/laravel_1.png"></p>
<h4 id="5-1-3-1-路由群组-amp-命名路由"><a href="#5-1-3-1-路由群组-amp-命名路由" class="headerlink" title="5.1.3.1 路由群组 &amp; 命名路由"></a>5.1.3.1 路由群组 &amp; 命名路由</h4><p>如果你在使用路由群组，可以通过在路由群组的属性数组中指定<code>as</code>关键字来为群组的路由设置一个共用的路由名前缀：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;admin::&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;dashboard&#x27;</span>, [<span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;dashboard&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 路由被命名为 &quot;admin::dashboard&quot;</span></span><br><span class="line">    &#125;]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/422303771/web/master/ubuntu/laravel/img/laravel_2.png"></p>
<h4 id="5-1-3-2-为命名路由生成URL"><a href="#5-1-3-2-为命名路由生成URL" class="headerlink" title="5.1.3.2 为命名路由生成URL"></a>5.1.3.2 为命名路由生成URL</h4><p>如果为给定路由进行了命名，就可以通过全局<code>route</code>函数为该命名路由生成对应URL，或者重新定向：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$url</span> = route(<span class="string">&#x27;profile&#x27;</span>);		<span class="comment">//产生URL</span></span><br><span class="line"><span class="variable">$redirect</span> = redirect()-&gt;route(<span class="string">&#x27;profile&#x27;</span>);		<span class="comment">//重新定向</span></span><br></pre></td></tr></table></figure>
<p>如果命名路由定义了参数，可以将该参数作为第二个参数穿传递给<code>route</code>函数。路由参数会自动插入URL中。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;/profile&#x27;</span>, [<span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;profile&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">     <span class="comment">//</span></span><br><span class="line">&#125;]);</span><br><span class="line"><span class="variable">$url</span> = route(<span class="string">&#x27;profile&#x27;</span>, [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">1</span>]);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-1-4-路由群组"><a href="#5-1-4-路由群组" class="headerlink" title="5.1.4 路由群组"></a>5.1.4 路由群组</h3><p>路由组允许共享路由属性，比如中间件与命名空间等。这样利用路由群组套用这些属性到多个路由，而不需要在每个路由都设定一次。</p>
<p>共享属性被要求为数组格式。共享属性作为第一个参数被传递给<code>Route::group</code>方法。</p>
<h4 id="5-1-4-1-中间件"><a href="#5-1-4-1-中间件" class="headerlink" title="5.1.4.1 中间件"></a>5.1.4.1 中间件</h4><p>要给路由组中所有路由分配中间件，可以在群组属性中使用<code>middleware</code>。中间件将会按照数组中定义的顺序依次执行：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;middleware&#x27;</span> =&gt; <span class="string">&#x27;auth&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 使用 Auth 中间件</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Route::get(<span class="string">&#x27;user/profile&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 使用 Auth 中间件</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5-1-4-2-命名空间"><a href="#5-1-4-2-命名空间" class="headerlink" title="5.1.4.2 命名空间"></a>5.1.4.2 命名空间</h4><p>另一个例子，指定相同的PHP命名空间下多个控制器，可以在分组属性数组中使用<code>namespace</code>来指定群组中所有控制器的公共命名空间：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;namespace&#x27;</span> =&gt; <span class="string">&#x27;Admin&#x27;</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 控制器在 &quot;App\Http\Controllers\Admin&quot; 命名空间下</span></span><br><span class="line"></span><br><span class="line">    Route::group([<span class="string">&#x27;namespace&#x27;</span> =&gt; <span class="string">&#x27;User&#x27;</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 控制器在 &quot;App\Http\Controllers\Admin\User&quot; 命名空间下</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>默认情况下，<code>RouteServiceProvider</code>会在命名空间群组内导入<code>routes.php</code>文件，让你不用指定完整<code>App/Http/Controllers</code>命令空间，就能注册控制器。所有，只需要指定在<code>App/Http/Controllers</code>之后的命名。</p>
<h4 id="5-1-4-3-子域名路由"><a href="#5-1-4-3-子域名路由" class="headerlink" title="5.1.4.3 子域名路由"></a>5.1.4.3 子域名路由</h4><p>子域名可以像URL一样被分配给路由参数，从而允许捕获子域名的部分用于路由或者控制器，子域名可以通过群组属性中的<code>domani</code>来指定：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;domain&#x27;</span> =&gt; <span class="string">&#x27;&#123;account&#125;.myapp.com&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$account</span>, <span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>注意：其中的{account}可以随意修改的。{id}也是可以随意更改的。</em></p>
<h4 id="5-1-4-4-路由前缀"><a href="#5-1-4-4-路由前缀" class="headerlink" title="5.1.4.4 路由前缀"></a>5.1.4.4 路由前缀</h4><p><code>prefix</code>群组属性，用来为群组中每个路由添加一个给定URL前缀。</p>
<p>例如，你可以为所有路由URL添加<code>admin</code>前缀：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;admin&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;users&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 匹配 &quot;/admin/users&quot; URL</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>还可以使用<code>prefix</code>参数为路由组指定公共路由参数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;accounts/&#123;account_id&#125;&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;detail&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$account_id</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 匹配 accounts/&#123;account_id&#125;/detail URL</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-1-5-CSRF保护"><a href="#5-1-5-CSRF保护" class="headerlink" title="5.1.5 CSRF保护"></a>5.1.5 CSRF保护</h3><h4 id="5-1-5-1-简介"><a href="#5-1-5-1-简介" class="headerlink" title="5.1.5.1 简介"></a>5.1.5.1 简介</h4><p>CSRF指跨网站请求伪造。跨网站请求伪伪造是一种恶意攻击，透过经身份验证的使用者身份执行未经授权的命令。</p>
<p>laravel会自动产生一个CSRF令牌给每个被应用管理的有效的用户，该令牌用于验证授权用户和发起请求者是否为同一个人。</p>
<p>想要生成包含CSRF令牌的隐藏输入字段，可以使用<code>csrf_field</code>函数来实现：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> csrf_field(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>csrf_field</code>函数会生成如下HTML：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;?php echo csrf_token(); ?&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当然推荐使用<code>Blade</code>引擎模板提供的方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;!! csrf_field() !!&#125;</span><br></pre></td></tr></table></figure>
<p>不需要自己编写代码去验证POST、PUT或者DELETE请求的CSRF令牌，因为Laravel自带的HTTP中间件<code>VerfyCsrfToken</code>会完成这些工作。</p>
<p>只要将请求中的输入<code>token</code>和Session中存储的<code>token</code>作对比来进行验证。</p>
<h3 id="5-1-5-2-不受-CSRF-保护的-URIs"><a href="#5-1-5-2-不受-CSRF-保护的-URIs" class="headerlink" title="5.1.5.2 不受 CSRF 保护的 URIs"></a>5.1.5.2 不受 CSRF 保护的 URIs</h3><p>有时需要从CSRF保护中排除一些URL。比如，如果使用<code>Stripe</code>来处理支付并用到他们的webhook系统，这时就需要从laravel的CSRF保护中排除webhook处理路由。</p>
<p>要实现这一目的，需要在<code>VerifyCsrfToken</code>中间件中将要排除的URL添加到<code>$except</code>属性：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Http</span>\<span class="title">Middleware</span>\<span class="title">VerifyCsrfToken</span> <span class="title">as</span> <span class="title">BaseVerifier</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VerifyCsrfToken</span> <span class="keyword">extends</span> <span class="title">BaseVerifier</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *从CSRF验证中排除的URL</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$except</span> = [</span><br><span class="line">        <span class="string">&#x27;stripe/*&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-1-5-3-X-CSRF-Token"><a href="#5-1-5-3-X-CSRF-Token" class="headerlink" title="5.1.5.3 X-CSRF-Token"></a>5.1.5.3 X-CSRF-Token</h4><p>除了检查当前POST参数的CDSRF令牌外，在laravel的<code>VerifyCsrfToken</code>中介层也会确认请求头部中的<code>X-CSRF-Token</code>。</p>
<p>例如，可以将其存储在meta标签中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;csrf-token&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&#123;&#123; csrf_token() &#125;&#125;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一旦建立了<code>meta</code>标签，就可以使用jQuery之类的函数库，将<code>令牌</code>加入到所有请求头部。</p>
<p>这为基于AJAX的应用提供了简单、方便的方式来避免CSRF攻击。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.ajaxSetup(&#123;</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;X-CSRF-TOKEN&#x27;</span>: $(<span class="string">&#x27;meta[name=&quot;csrf-token&quot;]&#x27;</span>).attr(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5-1-5-4-X-XSRF-Token"><a href="#5-1-5-4-X-XSRF-Token" class="headerlink" title="5.1.5.4 X-XSRF-Token"></a>5.1.5.4 X-XSRF-Token</h4><p>laravel还会将CSRF令牌保存到名为<code>XSRF-TOKEN</code>的Cookie中，可以使用该Cookie值来设置<code>X-XSRF-TOKEN</code>请求头。</p>
<p>一些javascript框架，比如Angular，会为你自动进行设置，基本上不太需要手动设置这个值。</p>
<hr>
<h3 id="5-1-6-路由模型绑定"><a href="#5-1-6-路由模型绑定" class="headerlink" title="5.1.6 路由模型绑定"></a>5.1.6 路由模型绑定</h3><p>laravel路由模型绑定提供了一个方便的方式来注入类至路由中。</p>
<p>例如，可以将匹配到<code>ID</code>的整个User类注入到路由中，而不是直接注入用户ID。</p>
<h4 id="5-1-6-1-隐式绑定"><a href="#5-1-6-1-隐式绑定" class="headerlink" title="5.1.6.1 隐式绑定"></a>5.1.6.1 隐式绑定</h4><p>laravel会自动解析定义在路由或控制器动作（变量名匹配路由片段）中的Eloquent模型类型声明，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;api/users/&#123;user&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">App\User <span class="variable">$user</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$user</span>-&gt;email;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这个例子中，路由URL的<code>user</code>符合<code>$user</code>实例的ELoquent模型，所以laravel会自动注入与请求URL的ID对应的模型实例。</p>
<p>如果找不到对应的模型实例，会自动生成HTTP404响应。</p>
<ul>
<li><p><strong>自定义键名</strong></p>
<p>  如果想要隐式模型绑定，使用数据表的其他字段，可以重写Eloquent模型类的<code>getRouteKeyName</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Get the route key for the model.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getRouteKeyName</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;slug&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  现在就可以使用<code>slug</code>作为键值了，可以用来<code>模糊关键字</code>。</p>
</li>
</ul>
<h4 id="5-1-6-2-显式绑定"><a href="#5-1-6-2-显式绑定" class="headerlink" title="5.1.6.2 显式绑定"></a>5.1.6.2 显式绑定</h4><p>要注册显式绑定，需要使用路由的<code>model</code>方法来为给定参数指定绑定类。</p>
<p>必须在<code>RouteServiceProvider::boot</code>方法中定义模型绑定。</p>
<ul>
<li><p><strong>绑定参数到模型</strong></p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params">Router <span class="variable">$router</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">parent</span>::boot(<span class="variable">$router</span>);</span><br><span class="line">    <span class="variable">$router</span>-&gt;model(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;App\User&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  接下来，定义一个包含<code>user</code>参数的路由：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$router</span>-&gt;get(<span class="string">&#x27;profile/&#123;user&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">App\User <span class="variable">$user</span></span>) </span>&#123;</span><br><span class="line">     <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>  由于已经绑定<code>&#123;user&#125;</code>参数到<code>App\User</code>模型，User实例会被注入到该路由。因此，如果请求URL是<code>profile/1</code>,就会注入一个用户ID为1的User实例。</p>
<p>  如果匹配的模型实例在数据库不存在，会自动生成并返回HTTP404响应。</p>
</li>
<li><p><strong>自定义解析逻辑</strong>    </p>
<p>  如果想要使用自定义的解析逻辑需要使用<code>Route::bind</code>方法，传递到<code>bind</code>方法的闭关会获取到URL请求的参数中的值，并返回你想要在该路由中注入的类实例：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$router</span>-&gt;bind(<span class="string">&#x27;user&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> App\User::where(<span class="string">&#x27;name&#x27;</span>, <span class="variable">$value</span>)-&gt;first();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>自定义”Not Found”</strong></p>
<p>  如果想要指定自己的<code>Not Found</code>行为，将封装该行为的闭包作为第三个参数传递给<code>model</code>方法</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$router</span>-&gt;model(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;App\User&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NotFoundHttpException;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="5-1-7-表单方法伪造"><a href="#5-1-7-表单方法伪造" class="headerlink" title="5.1.7 表单方法伪造"></a>5.1.7 表单方法伪造</h3><p>HTML表单不支持PUT、PATCH或者DELETE请求方法。当使用这些路由时，需要添加一个隐藏的<code>_method</code>字段到表单中，其值被用作该表单的HTTP请求方法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/foo/bar&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; csrf_token() &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>还可以使用辅助函数<code>method_field</code>来实现这一目的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> method_field(<span class="string">&#x27;PUT&#x27;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>当然，也支持Blade模板引擎：</p>
<pre><code>&#123;method——field(&#39;PUT&#39;)&#125;  
</code></pre>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/15/e5c478c6dbb1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Keleven.Me">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/15/e5c478c6dbb1/" class="post-title-link" itemprop="url">laravel 学习指南 第四章</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-15 02:00:00" itemprop="dateCreated datePublished" datetime="2016-07-15T02:00:00+08:00">2016-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/15/e5c478c6dbb1/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/15/e5c478c6dbb1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="4-快速入门进阶版"><a href="#4-快速入门进阶版" class="headerlink" title="4 快速入门进阶版"></a>4 快速入门进阶版</h2><h3 id="4-1-安装"><a href="#4-1-安装" class="headerlink" title="4.1. 安装"></a>4.1. 安装</h3><h4 id="4-1-1-使用composer"><a href="#4-1-1-使用composer" class="headerlink" title="4.1.1 使用composer"></a>4.1.1 使用composer</h4><pre><code>$ composer create-project laravel/laravel quickstart --prefer-dist
</code></pre>
<h4 id="4-1-2-使用git克隆完整包"><a href="#4-1-2-使用git克隆完整包" class="headerlink" title="4.1.2 使用git克隆完整包"></a>4.1.2 使用git克隆完整包</h4><pre><code>$ git clone https://github.com/laravel/quickstart-intermediate quickstart
$ cd quickstart
$ composer install
$ php artisan migrate
</code></pre>
<h3 id="4-2-准备数据库"><a href="#4-2-准备数据库" class="headerlink" title="4.2 准备数据库"></a>4.2 准备数据库</h3><h4 id="4-2-1-数据迁移"><a href="#4-2-1-数据迁移" class="headerlink" title="4.2.1  数据迁移"></a>4.2.1  数据迁移</h4><p>需要用到users表与tasks表。</p>
<p>users表的已经在<code>database/migratiions</code>目录下。</p>
<p>tasks表，需要使用命令创建一个：</p>
<pre><code>$ php artisan make:migration create_tasks_table --create=tasks
</code></pre>
<p>在生成的文件中加入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$table</span>-&gt;integer(<span class="string">&#x27;user_id&#x27;</span>)-&gt;index();</span><br><span class="line"><span class="variable">$table</span>-&gt;string(<span class="string">&#x27;name&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>-&gt;index()</code>标识增加索引。<code>user_id</code>用于建立<code>tasks</code>表与<code>user</code>表之间的关联。</p>
<p>使用下方命令导入数据库</p>
<pre><code>$ php artisan migrate
</code></pre>
<h4 id="4-2-2-Eloquent模型"><a href="#4-2-2-Eloquent模型" class="headerlink" title="4.2.2 Eloquent模型"></a>4.2.2 Eloquent模型</h4><p>user模型</p>
<p>laravel中自带了<code>user</code>模块。</p>
<p>Task模型</p>
<p>使用下方命令创建<code>task</code>模型。</p>
<pre><code>$ php artisan make:model Task
</code></pre>
<p>在<code>Task</code>模型中,声明<code>name</code>属性支持<code>批量赋值</code>。</p>
<p>批量赋值：将一个数组发送到模型类用于创建新模型实例是使用。</p>
<p>laravel有两种<code>批量赋值</code>属性，一种是<code>$fillable</code>可以通过批量赋值进行赋值。另一种是<code>$guarded</code>在批量赋值时会被过滤掉。</p>
<p>添加到<code>app/Task.php</code></p>
<pre><code>protected $fillable = [&#39;name&#39;];
</code></pre>
<h4 id="4-2-3-Eloquent关联关系"><a href="#4-2-3-Eloquent关联关系" class="headerlink" title="4.2.3 Eloquent关联关系"></a>4.2.3 Eloquent关联关系</h4><p>tasks关联关系</p>
<p>在<code>user</code>模型中定义<code>tasks</code>关联关系。这里使用一对多关系，laravel的<code>ELoquent</code>中提供了<code>hasMany</code>方法。</p>
<p>在<code>app/user.php</code>文件中添加：</p>
<pre><code>use App\Task;

public function tasks()
&#123;
    return $this-&gt;hasMany(Task::class);
&#125;
</code></pre>
<p>user关联关系</p>
<p>要定义与<code>hasMany</code>相对的关联关系，需要在子模型中定义一个关联方法去调用<code>belongsTo</code>方法:</p>
<p>添加到<code>app/Task.php</code></p>
<pre><code>use App\User;

public function user()
&#123;
    return $this-&gt;belongsTo(User::class);
&#125;
</code></pre>
<h3 id="4-3-路由"><a href="#4-3-路由" class="headerlink" title="4.3 路由"></a>4.3 路由</h3><p>在<code>routes.php</code>中可以使用闭包定义所有的业务逻辑。实际上，大部分应用都会使用控制器来组织路由。</p>
<h4 id="4-3-1-显示视图"><a href="#4-3-1-显示视图" class="headerlink" title="4.3.1 显示视图"></a>4.3.1 显示视图</h4><p>使用<code>view</code>函数从路由中返回一个模板：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;welcome&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="4-3-2-用户认证"><a href="#4-3-2-用户认证" class="headerlink" title="4.3.2 用户认证"></a>4.3.2 用户认证</h4><p>web中用户认证工作是非常乏味的，laravel提供一个<code>auth</code>组件让他变得轻松。</p>
<p>可以直接使用Artisan指令做完成<code>auth</code>的创建。</p>
<pre><code>$ php artisan make:auth --views
</code></pre>
<p>随后只需要将<code>auth</code>添加到路由列表。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route::auth();</span><br></pre></td></tr></table></figure>
<h4 id="4-3-3-任务控制器"><a href="#4-3-3-任务控制器" class="headerlink" title="4.3.3 任务控制器"></a>4.3.3 任务控制器</h4><p>接下来建立<code>TaskController</code>控制器，来处理任务。默认情况下控制器放置在<code>app/Http/controllers</code>目录下。使用下方命令创建：</p>
<pre><code>$ php artisan make:controller TaskController
</code></pre>
<p>现在添加一些对应控制器的路由，在<code>app/Http/routes.php</code>中添加：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/tasks&#x27;</span>, <span class="string">&#x27;TaskController@index&#x27;</span>);</span><br><span class="line">Route::post(<span class="string">&#x27;/task&#x27;</span>, <span class="string">&#x27;TaskController@store&#x27;</span>);</span><br><span class="line">Route::delete(<span class="string">&#x27;/task/&#123;task&#125;&#x27;</span>, <span class="string">&#x27;TaskController@destroy&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><strong>设置所有任务路由需要登录才能访问</strong></p>
<p>我们希望用户必须登陆到系统才能创建新任务。所以需要限制访问用户，为登陆用户。</p>
<p>laravel使用中间件来处理这种限制。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;middleware(<span class="string">&#x27;auth&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-创建布局与视图"><a href="#4-4-创建布局与视图" class="headerlink" title="4.4 创建布局与视图"></a>4.4 创建布局与视图</h3><p>布局方案与之前的版本相同。</p>
<p><img src="https://raw.githubusercontent.com/422303771/web/master/ubuntu/laravel/img/basic-overview.png"></p>
<h4 id="4-4-1-定义布局"><a href="#4-4-1-定义布局" class="headerlink" title="4.4.1 定义布局"></a>4.4.1 定义布局</h4><p>共用模板在<code>resources/views/layouts/app.blade.php</code>。</p>
<p><code>@yield(&#39;content&#39;)</code>为使用blade模板要插入的功能模块。</p>
<h4 id="4-4-2-定义子视图"><a href="#4-4-2-定义子视图" class="headerlink" title="4.4.2 定义子视图"></a>4.4.2 定义子视图</h4><p>随后定义<code>resources/views/tasks/index.blade.php</code>。它会对应<code>TaskController</code>控制器的<code>index</code>方法。</p>
<p>随后在<code>TaskController</code>控制其中添加<code>index</code>方法的返回视图。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;tasks.index&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-5-添加任务"><a href="#4-5-添加任务" class="headerlink" title="4.5 添加任务"></a>4.5 添加任务</h3><h4 id="4-5-1-验证表单输入"><a href="#4-5-1-验证表单输入" class="headerlink" title="4.5.1 验证表单输入"></a>4.5.1 验证表单输入</h4><p>编写<code>TaskController@store</code>路由对应的处理方法，处理一个表单请求并创建一个新任务。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;validate(<span class="variable">$request</span>, [</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;required|max:255&#x27;</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create The Task...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在控制器中，可以直接使用<code>ValidatesRequests</code>类中的<code>validate</code>方法。</p>
<p>而不用手动判断验证失败后的重定向，如果验证失败，用户会自动被重定向到来源页面，而错误信息也会存放到一次性<code>Session</code>中。</p>
<p><strong>$errors</strong></p>
<p>使用<code>@include(&#39;common.errors&#39;)</code>来渲染表单验证错误信息。</p>
<p>文件位置<code>resources/views/common/errors.blade.php</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@if (count($errors) &gt; 0)</span><br><span class="line">    <span class="comment">&lt;!-- Form Error List --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;alert alert-danger&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">strong</span>&gt;</span>Whoops! Something went wrong!<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        @foreach ($errors-&gt;all() as $error)</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; $error &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        @endforeach</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">@endif</span><br></pre></td></tr></table></figure>
<h4 id="4-5-2-创建任务"><a href="#4-5-2-创建任务" class="headerlink" title="4.5.2 创建任务"></a>4.5.2 创建任务</h4><p>验证完成后，要新建一个任务。当任务新建完成，页面会跳转到<code>/tasks</code>。</p>
<p>laravel的关联提供了<code>save</code>方法，该方法接收一个关联模型实例，并且会在保存的数据库之前自动设置外键值到关联模型上。</p>
<p>这里<code>save</code>方法会自动将当前用户的，用户ID赋予给定的<code>user_id</code>属性。通过<code>$request-&gt;user()</code>获取当前用户实例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$request</span>-&gt;user()-&gt;tasks()-&gt;create([</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span> =&gt; <span class="variable">$request</span>-&gt;name,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> redirect(<span class="string">&#x27;/tasks&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="4-6-显示己存在的任务"><a href="#4-6-显示己存在的任务" class="headerlink" title="4.6 显示己存在的任务"></a>4.6 显示己存在的任务</h3><p>现在需要编辑<code>TaskController@index</code>传递所有已存在任务到视图。<code>view</code>函数接收一个数组作为第二个参数，数组中的每个值都会在视图中作为变数。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$tasks</span> = Task::where(<span class="string">&#x27;user_id&#x27;</span>, <span class="variable">$request</span>-&gt;user()-&gt;id)-&gt;get();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;tasks.index&#x27;</span>, [</span><br><span class="line">        <span class="string">&#x27;tasks&#x27;</span> =&gt; <span class="variable">$tasks</span>,</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-6-1-依赖注入"><a href="#4-6-1-依赖注入" class="headerlink" title="4.6.1 依赖注入"></a>4.6.1 依赖注入</h4><p>laravel的服务容器是整个框架中最重要的特性。</p>
<p><strong>创建Repository</strong></p>
<p>正如之前说的，我们要定义一个<code>TaskRepository</code>来处理所有对<code>Task</code>模式的数据访问，随着应用的增长，需要在应用中共享一些Eloquent查询时，就变得特别有用。</p>
<p>创建<code>app/Repositories</code>目录并在其中创建一个<code>TaskRepository</code>类。记住，laravel项目的<code>app</code>文件夹下的所有目录都是使用PSR-4自动加载标准，所以可以随意创建需要的目录:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Task</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskRepository</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get all of the tasks for a given user.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> User $user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Collection</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">forUser</span>(<span class="params">User <span class="variable">$user</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Task::where(<span class="string">&#x27;user_id&#x27;</span>, <span class="variable">$user</span>-&gt;id)</span><br><span class="line">            -&gt;orderBy(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;asc&#x27;</span>)</span><br><span class="line">            -&gt;get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注入Repository</strong></p>
<p>Repository创建好之后，通过在<code>TaskController</code>的构造函数以类型提示的方式注入该Repository,然后就可以在index方法中使用。</p>
<p>由于laravel使用容器来解析所有控制器，所以依赖会被自动注入到控制器：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Task</span>;<span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Repositories</span>\<span class="title">TaskRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The task repository instance.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> TaskRepository</span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$tasks</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new controller instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> TaskRepository $tasks </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">TaskRepository <span class="variable">$tasks</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;middleware(<span class="string">&#x27;auth&#x27;</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;tasks = <span class="variable">$tasks</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Display a list of all of the user&#x27;s task.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">&#x27;tasks.index&#x27;</span>, [</span><br><span class="line">            <span class="string">&#x27;tasks&#x27;</span> =&gt; <span class="keyword">$this</span>-&gt;tasks-&gt;forUser(<span class="variable">$request</span>-&gt;user()),</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-6-2-显示任务"><a href="#4-6-2-显示任务" class="headerlink" title="4.6.2 显示任务"></a>4.6.2 显示任务</h4><p>在<code>tasks/index.blade.php</code>中以表格形式显示所有任务。Blade中使用<code>@foreach</code>处理循环数据。</p>
<h3 id="4-7-删除任务"><a href="#4-7-删除任务" class="headerlink" title="4.7 删除任务"></a>4.7 删除任务</h3><h4 id="4-7-1-添加删除按钮"><a href="#4-7-1-添加删除按钮" class="headerlink" title="4.7.1 添加删除按钮"></a>4.7.1 添加删除按钮</h4><p>当一个<code>DELETE /task</code>请求被发送到应用，它会触发<code>TaskController@destroy</code>方法：</p>
<p>在表单中同样要使用方法欺骗。</p>
<h4 id="4-7-2-路由模型绑定"><a href="#4-7-2-路由模型绑定" class="headerlink" title="4.7.2 路由模型绑定"></a>4.7.2 路由模型绑定</h4><p>定义<code>TaskController</code>的<code>destroy</code>方法。但是首先，重新查看路由的定义以及控制器方法。</p>
<h4 id="4-7-3-用户授权"><a href="#4-7-3-用户授权" class="headerlink" title="4.7.3 用户授权"></a>4.7.3 用户授权</h4><p>现在要将<code>Task</code>实例注入到<code>destroy</code>方法。然而为了保证当前登录用户是给定任务的用。</p>
<p>例如：一些恶意请求可能尝试通过传统随机任务ID到<code>/tasks/&#123;task&#125;</code>链接删除另一个用户的任务。</p>
<p>所有需要使用laravel的授权功能来确保，当前登录用户拥有操作<code>Task</code>实例的权限。</p>
<p><strong>创建Policy</strong></p>
<p>laravel使用策略来将授权组织到单个类中，通常，每个策略都对应一个模型。</p>
<p>因此，使用Artisan命令创建一个<code>TaskPolicy</code>,生成的文件位于<code>app/Policies/TaskPolicy.php</code>:</p>
<pre><code>$ php artisan make:policy TaskPolicy
</code></pre>
<p>随后将<code>destroy</code>方法添加到策略中，该方法会获取一个<code>user</code>实例和<code>task</code>实例，检查<code>用户ID</code>和任务的<code>user_id</code>是否相同。</p>
<p>实际上，所有的策略方法都会返回<code>true</code>或<code>false</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Policies</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Task</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Auth</span>\<span class="title">Access</span>\<span class="title">HandlesAuthorization</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskPolicy</span></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">HandlesAuthorization</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Determine if the given user can delete the given task.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> User $user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Task $task</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span>(<span class="params">User <span class="variable">$user</span>, Task <span class="variable">$task</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$user</span>-&gt;id === <span class="variable">$task</span>-&gt;user_id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，需要关联<code>Task</code>模型和<code>TaskPolicy</code>，通过在<code>app/Providers/AuthServiceProvider.php</code>的<code>policies</code>属性添加注册实现。</p>
<p>注册后会告知Laravel无论何时尝试授权到<code>Task</code>实例时，该使用哪个策略类进行判断：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$policies</span> = [</span><br><span class="line">    <span class="string">&#x27;App\Task&#x27;</span> =&gt; <span class="string">&#x27;App\Policies\TaskPolicy&#x27;</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p><strong>授权动作</strong></p>
<p>编写好策略后，在<code>destroy</code>方法中使用它。所有的laravel控制器都可以调用<code>authorize</code>方法，该方法由<code>AuthorizesRequest</code>提供：</p>
<p><code>app/Controllers/TaskController.php</code>文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span>(<span class="params">Request <span class="variable">$request</span>, Task <span class="variable">$task</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;authorize(<span class="string">&#x27;destroy&#x27;</span>, <span class="variable">$task</span>);</span><br><span class="line">    <span class="comment">// Delete The Task...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="4-7-4-删除任务"><a href="#4-7-4-删除任务" class="headerlink" title="4.7.4 删除任务"></a>4.7.4 删除任务</h4><p>最后在<code>destroy</code>方法中实际删除任务。使用Eloquent的<code>delete</code>方法从数据库中删除给定的模型实例。</p>
<p>删除后返回<code>/tasks</code>连接：</p>
<p><code>app/Controllers/TaskController.php</code>文件中完整的<code>TaskController@destroy</code>方法。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span>(<span class="params">Request <span class="variable">$request</span>, Task <span class="variable">$task</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;authorize(<span class="string">&#x27;destroy&#x27;</span>, <span class="variable">$task</span>);</span><br><span class="line">    <span class="variable">$task</span>-&gt;delete();</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/tasks&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/15/ba9e3cb46214/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Keleven.Me">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/15/ba9e3cb46214/" class="post-title-link" itemprop="url">laravel 学习指南 第三章</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-15 01:00:00" itemprop="dateCreated datePublished" datetime="2016-07-15T01:00:00+08:00">2016-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/15/ba9e3cb46214/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/15/ba9e3cb46214/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="3-跟随快速入门"><a href="#3-跟随快速入门" class="headerlink" title="3. 跟随快速入门"></a>3. 跟随快速入门</h2><p><a target="_blank" rel="noopener" href="https://laravel.com/docs/5.2/quickstart">官方地址</a></p>
<p><a target="_blank" rel="noopener" href="http://laravelacademy.org/post/3291.html">中文版地址</a></p>
<p><a target="_blank" rel="noopener" href="https://laravel.tw/docs/5.2/quickstart">台湾版地址</a></p>
<p>开始前先创建一个新的数据库，并添加到.<code>env</code>文件中。</p>
<h3 id="3-1-创建quickstart项目"><a href="#3-1-创建quickstart项目" class="headerlink" title="3.1 创建quickstart项目"></a>3.1 创建quickstart项目</h3><h4 id="3-1-1-使用composer"><a href="#3-1-1-使用composer" class="headerlink" title="3.1.1 使用composer"></a>3.1.1 使用composer</h4><pre><code>$ composer create-project laravel/laravel quickstart --prefer-dist
</code></pre>
<h4 id="3-1-2-克隆整个快速入门文档"><a href="#3-1-2-克隆整个快速入门文档" class="headerlink" title="3.1.2 克隆整个快速入门文档"></a>3.1.2 克隆整个快速入门文档</h4><pre><code>$ git clone https://github.com/laravel/quickstart-basic quickstart
$ cd quickstart
$ composer install
$ php artisan migrate
</code></pre>
<h3 id="3-2-准备数据库"><a href="#3-2-准备数据库" class="headerlink" title="3.2 准备数据库"></a>3.2 准备数据库</h3><p>laravel有一种简单的定义与修改数据表的方法。</p>
<p>现在使用<code>make:migration</code>生成<code>tasks</code>新的数据表：</p>
<pre><code>$ php artisan make:migration create_tasks_table --create=tasks
</code></pre>
<p><code>make:migration</code>自动添加了<code>id</code>与<code>时间戳</code>。</p>
<p>手动增加一个条码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$table</span>-&gt;string(<span class="string">&#x27;name&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>随后使用下方命令将<code>tasks</code>写入数据表。</p>
<pre><code>$ php artisan migrate
</code></pre>
<p><em>注意：如果数据库中以及存在<code>tasks</code>数据表，会报错。</em></p>
<h3 id="3-3-Eloquent-ORM模型"><a href="#3-3-Eloquent-ORM模型" class="headerlink" title="3.3 Eloquent ORM模型"></a>3.3 Eloquent ORM模型</h3><p>laravel 使用默认ORM是Eloquent，[ORM：物件关联对应]，每一个Eloquent模型都有一个对应的数据表。</p>
<p>所有创建<code>tasks</code>对应的<code>Task</code>模型，使用<code>Artisan</code>命令来生成模型。</p>
<pre><code>$ php artisan make:model Task
</code></pre>
<p>模型在<code>app</code>目录下，默认情况下，模型类是空的。不需要说明Eloquent模型要对应哪张数据表，它会假设数据表是模型的复数形态。</p>
<p>这里<code>Task</code>对应的是<code>tasks</code>。</p>
<h3 id="3-4-路由"><a href="#3-4-路由" class="headerlink" title="3.4 路由"></a>3.4 路由</h3><h4 id="3-4-1-建置路由"><a href="#3-4-1-建置路由" class="headerlink" title="3.4.1 建置路由"></a>3.4.1 建置路由</h4><p>默认情况下，所有的路由都定义在<code>app/Http/routes.php</code></p>
<p>这个需要至少三个路由：显示所有任务的路由，添加新任务的路由，以及删除己存在任务的路由。</p>
<p>下面再<code>app/Http/routse.php</code>中创建这三个路由。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Task</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Display All Tasks</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Add A New Task</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Route::post(<span class="string">&#x27;/task&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Delete An Existing Task</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Route::delete(<span class="string">&#x27;/task/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br></pre></td></tr></table></figure>

<h4 id="3-4-2-显示视图"><a href="#3-4-2-显示视图" class="headerlink" title="3.4.2 显示视图"></a>3.4.2 显示视图</h4><p>laravel的全部，HTML模板都存放在<code>resources/view</code>目录下，使用<code>view</code>函数从路由中返回一个模板。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;tasks&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>现在要在创建一个对应的视图模板<code>resources/views/tasks.blade.php</code>作为<code>View</code>对象。</p>
<h3 id="3-5-创建布局-amp-视图"><a href="#3-5-创建布局-amp-视图" class="headerlink" title="3.5 创建布局&amp;视图"></a>3.5 创建布局&amp;视图</h3><p>下图中使用了<code>Bootstrap CSS</code>样式</p>
<p><img src="https://raw.githubusercontent.com/422303771/web/master/ubuntu/laravel/img/basic-overview.png"></p>
<h4 id="3-5-1-定义布局"><a href="#3-5-1-定义布局" class="headerlink" title="3.5.1 定义布局"></a>3.5.1 定义布局</h4><p><strong>几乎所有的web应用都在不同的页面中共享同一个布局。</strong></p>
<p>例如，这个应用在视图顶部的导航条，这个导航条在每个页面都会出现。</p>
<p>laravel通过在每个页面中使用Blade布局让共享这些公共特性变得简单。</p>
<p>在<code>resources/views/layouts/app.blade.php</code>中定义一个新布局，<code>.blade.php</code>表明使用Blade模板引擎来渲染视图。</p>
<p>也可以使用PHP原生模板然而，Blade提供的标签语法可以编写简洁的模板。</p>
<p><code>app.blade.php</code>的内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// resources/views/layouts/app.blade.php</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Laravel Quickstart - Basic<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- CSS And JavaScript --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar navbar-default&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- Navbar Contents --&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        @yield(&#x27;content&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>布局中的<code>@yield(&#39;content&#39;)</code>部分，是一个Blade指令，用于指定继承布局的子页面，在这里可以注入自己的内容。</p>
<h4 id="3-5-2-定义子视图"><a href="#3-5-2-定义子视图" class="headerlink" title="3.5.2 定义子视图"></a>3.5.2 定义子视图</h4><p>现在定义<code>resources/views/tasks.blade.php</code>视图。<code>Bootstrap CSS</code>的样本文件可以到<a target="_blank" rel="noopener" href="https://github.com/laravel/quickstart-basic">github</a>下载</p>
<p><code>tasks.blade.php</code>内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">//resources/views/tasks.blade.php</span><br><span class="line"></span><br><span class="line">@extends(&#x27;layouts.app&#x27;)</span><br><span class="line"></span><br><span class="line">@section(&#x27;content&#x27;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap Boilerplate... --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-body&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Display Validation Errors --&gt;</span></span><br><span class="line">        @include(&#x27;common.errors&#x27;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- New Task Form --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/task&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-horizontal&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123; csrf_field() &#125;&#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- Task Name --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;task&quot;</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-3 control-label&quot;</span>&gt;</span>Task<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">id</span>=<span class="string">&quot;task-name&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- Add Task Button --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-offset-3 col-sm-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-plus&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Add Task</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- <span class="doctag">TODO:</span> Current Tasks --&gt;</span></span><br><span class="line">@endsection</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<p>使用<code>@extends</code>告诉Blade要使用在<code>resources/views/layouts/app.blade.php</code>的布局。</p>
<p>在<code>@section(&#39;content&#39;)</code>与<code>@endsection</code>之间的内容会被注入到<code>app.blade.php</code>的<code>@yield(&#39;contents&#39;)</code>位置。</p>
<p><code> @include(&#39;common.errors&#39;)</code>指令将会加载<code>resources/views/common/errors.blade.php</code>中的内容，目前还没有定义。</p>
<p>现在可以设置路由：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;tasks&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="3-6-添加任务"><a href="#3-6-添加任务" class="headerlink" title="3.6 添加任务"></a>3.6 添加任务</h3><h4 id="3-6-1-验证"><a href="#3-6-1-验证" class="headerlink" title="3.6.1 验证"></a>3.6.1 验证</h4><p>验证表单，在<code>POST /task</code>路由中编写代码，处理表单请求，我们需要验证表单输入，然后才能创建一个新任务。</p>
<p>对这个表单而言，将<code>name</code>字段设置为必填项，而长度不超过255个字符。如果表单验证失败，将会跳转到前一个页面，并将错误信息存入一次性的<code>Session</code>中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">&#x27;/task&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$validator</span> = Validator::make(<span class="variable">$request</span>-&gt;all(), [</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;required|max:255&#x27;</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$validator</span>-&gt;fails()) &#123;</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">            -&gt;withInput()</span><br><span class="line">            -&gt;withErrors(<span class="variable">$validator</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create The Task...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>$errors</strong></p>
<p><code>-&gt;withErrors($validator)</code>将验证错误信息存放在一次性的session中，以便视图通过<code>$errors</code>访问。</p>
<p><code>errors.blade.php</code>文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// resources/views/common/errors.blade.php</span></span><br><span class="line"></span><br><span class="line">@<span class="keyword">if</span> (count(<span class="variable">$errors</span>) &gt; <span class="number">0</span>)</span><br><span class="line">    &lt;!-- Form <span class="built_in">Error</span> <span class="keyword">List</span> --&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">alert</span> <span class="title">alert</span>-<span class="title">danger</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">strong</span>&gt;<span class="title">Whoops</span>! <span class="title">Something</span> <span class="title">went</span> <span class="title">wrong</span>!&lt;/<span class="title">strong</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        &lt;<span class="title">br</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        &lt;<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">            @<span class="title">foreach</span> ($<span class="title">errors</span>-&gt;<span class="title">all</span>() <span class="title">as</span> $<span class="title">error</span>)</span></span><br><span class="line"><span class="class">                &lt;<span class="title">li</span>&gt;</span>&#123;&#123; <span class="variable">$error</span> &#125;&#125;&lt;/li&gt;</span><br><span class="line">            @<span class="keyword">endforeach</span></span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<p><code>errors</code>变量可用于每个laravel的视图中。如果没有验证错误信息存在，那么他就是一个空的<code>ViewErroeBag</code>实例。</p>
<h4 id="3-6-2-创建任务"><a href="#3-6-2-创建任务" class="headerlink" title="3.6.2 创建任务"></a>3.6.2 创建任务</h4><p>接下来开始创建一个新任务。一旦新任务创建成功，页面会跳转到<code>/</code>。要创建任务，可以有<code>Eloquent</code>模式提供的<code>save</code>方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">&#x27;/task&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$validator</span> = Validator::make(<span class="variable">$request</span>-&gt;all(), [</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;required|max:255&#x27;</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$validator</span>-&gt;fails()) &#123;</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">            -&gt;withInput()</span><br><span class="line">            -&gt;withErrors(<span class="variable">$validator</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$task</span> = <span class="keyword">new</span> Task;</span><br><span class="line">    <span class="variable">$task</span>-&gt;name = <span class="variable">$request</span>-&gt;name;</span><br><span class="line">    <span class="variable">$task</span>-&gt;save();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="3-6-3-显示己存在的任务"><a href="#3-6-3-显示己存在的任务" class="headerlink" title="3.6.3 显示己存在的任务"></a>3.6.3 显示己存在的任务</h4><p>添加代码到视图来显示所有任务列表。</p>
<p>需要编辑/路由传递所有已存在任务到视图，view函数接收一个数组作为第二个参数，我们可以将数据通过该数组传递到视图中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$tasks</span> = Task::orderBy(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;asc&#x27;</span>)-&gt;get();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;tasks&#x27;</span>, [</span><br><span class="line">        <span class="string">&#x27;tasks&#x27;</span> =&gt; <span class="variable">$tasks</span></span><br><span class="line">    ]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>数据被传递到视图后，我们可以在<code>tasks.blade.php</code>中以表格形式显示所有任务。Blade中使用<code>@foreach</code>处理循环数据：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">extends</span>(<span class="string">&#x27;layouts.app&#x27;</span>)</span><br><span class="line"></span><br><span class="line">@section(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">    &lt;!-- Create Task Form... --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Current Tasks --&gt;</span><br><span class="line">    @<span class="keyword">if</span> (count(<span class="variable">$tasks</span>) &gt; <span class="number">0</span>)</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">panel</span> <span class="title">panel</span>-<span class="title">default</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">panel</span>-<span class="title">heading</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                <span class="title">Current</span> <span class="title">Tasks</span></span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">panel</span>-<span class="title">body</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">table</span> <span class="title">class</span>=&quot;<span class="title">table</span> <span class="title">table</span>-<span class="title">striped</span> <span class="title">task</span>-<span class="title">table</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                    &lt;!-- <span class="title">Table</span> <span class="title">Headings</span> --&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">thead</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">th</span>&gt;<span class="title">Task</span>&lt;/<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">th</span>&gt;&amp;<span class="title">nbsp</span>;&lt;/<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">thead</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                    &lt;!-- <span class="title">Table</span> <span class="title">Body</span> --&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">tbody</span>&gt;</span></span><br><span class="line"><span class="class">                    @<span class="title">foreach</span> ($<span class="title">tasks</span> <span class="title">as</span> $<span class="title">task</span>)</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">                            &lt;!-- <span class="title">Task</span> <span class="title">Name</span> --&gt;</span></span><br><span class="line"><span class="class">                            &lt;<span class="title">td</span> <span class="title">class</span>=&quot;<span class="title">table</span>-<span class="title">text</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">div</span>&gt;</span>&#123;&#123; <span class="variable">$task</span>-&gt;name &#125;&#125;&lt;/div&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line"></span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;!-- TODO: Delete Button --&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                        &lt;/tr&gt;</span><br><span class="line">                    @<span class="keyword">endforeach</span></span><br><span class="line">                    &lt;/tbody&gt;</span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    @<span class="keyword">endif</span></span><br><span class="line">@endsection</span><br></pre></td></tr></table></figure>

<h3 id="3-7-删除任务"><a href="#3-7-删除任务" class="headerlink" title="3.7 删除任务"></a>3.7 删除任务</h3><h4 id="3-7-1-添加删除按钮"><a href="#3-7-1-添加删除按钮" class="headerlink" title="3.7.1 添加删除按钮"></a>3.7.1 添加删除按钮</h4><p>我们在<code>tasks.blade.php</code>视图中留了一个“TODO”注释用于放置删除按钮。当删除按钮被点击时，<code>DELETE /task</code>请求被发送到应用后台：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Task Name --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;table-text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; $task-&gt;name &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Delete Button --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/task/&#123;&#123; $task-&gt;id &#125;&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123; csrf_field() &#125;&#125;</span><br><span class="line">            &#123;&#123; method_field(&#x27;DELETE&#x27;) &#125;&#125;</span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>Delete Task<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>方法伪造</strong></p>
<p>尽管我们使用的路由是<code>Route::delete</code>，但我们在删除按钮表单中使用的请求方法为<code>POST</code>，HTML表单只支持<code>GET</code>和<code>POST</code>两种请求方式，因此我们需要使用某种方式来伪造DELETE请求。</p>
<p>我们可以在表单中通过输出<code>method_field(&#39;DELETE&#39;)</code>来伪造<code>DELETE</code>请求，该函数生成一个隐藏的表单输入框，然后Laravel识别出该输入并使用其值覆盖实际的HTTP请求方法。生成的输入框如下：</p>
<input type="hidden" name="_method" value="DELETE">

<h4 id="3-7-2-删除任务"><a href="#3-7-2-删除任务" class="headerlink" title="3.7.2 删除任务"></a>3.7.2 删除任务</h4><p>最后，让我们添加业务逻辑到路由中执行删除操作，我们可以使用<code>Eloquent</code>提供的<code>findOrFail</code>方法从数据库通过ID获取模型实例，如果不存在则抛出404异常。获取到模型后，我们使用模型的<code>delete</code>方法删除该模型在数据库中对应的记录。记录被删除后，跳转到<code>/</code>页面:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::delete(<span class="string">&#x27;/task/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    Task::findOrFail(<span class="variable">$id</span>)-&gt;delete();</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/15/06783c1f2748/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Keleven.Me">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/15/06783c1f2748/" class="post-title-link" itemprop="url">laravel 学习指南 第一章 & 第二章</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-15 00:00:00" itemprop="dateCreated datePublished" datetime="2016-07-15T00:00:00+08:00">2016-07-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/15/06783c1f2748/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/15/06783c1f2748/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h1 id="laravel-5-学习指南"><a href="#laravel-5-学习指南" class="headerlink" title="laravel 5 学习指南"></a>laravel 5 学习指南</h1><h2 id="1-部署Laravel-Homestead"><a href="#1-部署Laravel-Homestead" class="headerlink" title="1.部署Laravel Homestead"></a>1.部署Laravel Homestead</h2><h3 id="1-1-必要软件安装"><a href="#1-1-必要软件安装" class="headerlink" title="1.1. 必要软件安装"></a>1.1. 必要软件安装</h3><table>
<thead>
<tr>
<th align="center">软件</th>
<th align="center">下载地址</th>
</tr>
</thead>
<tbody><tr>
<td align="center">vagrant</td>
<td align="center"><a target="_blank" rel="noopener" href="https://www.vagrantup.com/">地址</a></td>
</tr>
<tr>
<td align="center">virtualbox</td>
<td align="center"><a target="_blank" rel="noopener" href="https://www.virtualbox.org/">地址</a></td>
</tr>
<tr>
<td align="center">git</td>
<td align="center"><a target="_blank" rel="noopener" href="https://git-scm.com/">地址</a></td>
</tr>
</tbody></table>
<p>composer 在虚拟机中有提供，但为了能正常安装laravel需要自备<strong>梯子</strong></p>
<p>Laravel 官方指南<a target="_blank" rel="noopener" href="https://laravel.com/docs/5.2/homestead">地址</a></p>
<h3 id="1-2-下载Laravel-Homestead虚拟机文件"><a href="#1-2-下载Laravel-Homestead虚拟机文件" class="headerlink" title="1.2.下载Laravel Homestead虚拟机文件"></a>1.2.下载Laravel Homestead虚拟机文件</h3><p>Git Bash中输入命令</p>
<pre><code>$ vagrant box add laravel/homestead        //安装Laravel Homestead
</code></pre>
<p>随后会要求选择使用的虚拟机。virtualbox为1 ，Vmware 为2 。</p>
<p><em>注意：如果使用VMware需要购买vagrant的插件。</em></p>
<p>确认后，开始下载。</p>
<p><em>注意：需要梯子</em></p>
<h3 id="1-3-安装Laravel-Homestead"><a href="#1-3-安装Laravel-Homestead" class="headerlink" title="1.3. 安装Laravel Homestead"></a>1.3. 安装Laravel Homestead</h3><p>下载完成后，需要使用git，克隆Laravel Homestead的安装设置文件。</p>
<p>切换到想要建立项目的目录，使用克隆命令。</p>
<pre><code>$ git clone https://github.com/laravel/homestead.git Homestead
</code></pre>
<h3 id="1-4-设置Laravel-Homestead"><a href="#1-4-设置Laravel-Homestead" class="headerlink" title="1.4. 设置Laravel Homestead"></a>1.4. 设置Laravel Homestead</h3><p>首先需要有SSH密钥，如果没有使用下方命令创建</p>
<pre><code>$ ssh-keygen
</code></pre>
<p>克隆完整后，载入Laravel Homestead设置文件。</p>
<pre><code>$ bash init.sh   //载入 Laravel Homestead 设置文件
</code></pre>
<p>之后设置文件映射，</p>
<p><code>C:\Windows\System32\drivers\etc\hosts</code>  负责DNS的文件</p>
<p><code>C:\Users\Keleven\.homestead\Homestead.yaml</code>   负责Laravel Homestead设置的文件</p>
<p>在<code>Homestead.yaml</code>修改</p>
<pre><code>ip: &quot;192.168.20.10&quot;        //映射的ip地址
memory: 2048            //虚拟机内存大小
cpus: 1                    //虚拟机CUP数量
provider: virtualbox    //虚拟机供应商

authorize: ~/.ssh/id_rsa.pub   //SSH 公钥地址

keys:                            
    - ~/.ssh/id_rsa                //SSH 私钥地址

folders:                            //项目的主文件夹
    - map: J:\laravel\web  # pc          //PC端 文件地址
      to: /home/vagrant/webCode  #vbox    //Vbox端 地址 

sites:
    - map: web.app                               //网站名称
      to: /home/vagrant/webCode/web/public       //laravel 入口
    - map: back.app                                 //网站名称
      to: /home/vagrant/webCode/back/public      //laravel 入口
databases:                                       // web数据库名称
    - webdb
</code></pre>
<p>在<code>hosts</code>中添加</p>
<pre><code>192.168.20.10 web.app
192.168.20.10 back.app
</code></pre>
<p><em>注意：IP：地址用没有使用的IP段</em></p>
<h3 id="1-5-运行Laravel-Homestead"><a href="#1-5-运行Laravel-Homestead" class="headerlink" title="1.5.运行Laravel Homestead"></a>1.5.运行Laravel Homestead</h3><p>在克隆的的Homestead目录下。启动虚拟机。</p>
<p><strong>不要再Vbox中启动，不要再Vbox中启动，不要再Vbox中启动。</strong></p>
<pre><code>$ vagrant up 
</code></pre>
<p>加载完成会就可以使用了，使用下方命令与虚拟机建立SSH链接。</p>
<pre><code>$ vagrant ssh
</code></pre>
<p>进去虚拟机的第一件事，解除Composer的xdebug模式，否则严重影响下载包的速度。</p>
<p>解除方法：</p>
<p>找到<code>/etc/php/7.0/mods-available/</code>下的<code>xdebug.ini</code>打开后加注释。</p>
<pre><code>$ sudo nano /etc/php/7.0/mods-available/xdebug.ini  // 使用nano编辑xdebug.ini文件
</code></pre>
<p>在<code>zend_extension=xdebug.so</code>前方加<code>;</code></p>
<p>对<code>sudo nano /etc/php/5.6/mods-available/</code>下的<code>xdebug.ini</code>进行同样操作。</p>
<pre><code>sudo nano /etc/php/5.6/mods-available/xdebug.ini
</code></pre>
<h3 id="1-6-安装laravel到目录"><a href="#1-6-安装laravel到目录" class="headerlink" title="1.6.安装laravel到目录"></a>1.6.安装laravel到目录</h3><p>安装目录在<code>Homestead.yaml</code>设置过，本地目录与虚拟机的目录是共享的。</p>
<p>即安装完成后，可以直接修改本地目录中的文件。</p>
<p>使用Git Bash进入项目目录。使用<code>composer</code>安装<code>laravel</code></p>
<pre><code>$ composer create-project --prefer-dist laravel/laravel [blog]
</code></pre>
<p>[blog]可以是任意的项目名称。</p>
<p><em>注意：项目名称要与<code>Homestead.yaml</code>中设置对应</em></p>
<p>安装完成后，在浏览器中输入web.app，就可以看到laravel在正常运行了。</p>
<h3 id="1-7-关机"><a href="#1-7-关机" class="headerlink" title="1.7. 关机"></a>1.7. 关机</h3><p>先使用<code>exit</code>推出SSH链接。</p>
<p>在关闭虚拟机:</p>
<pre><code>$ vagrant halt
</code></pre>
<hr>
<h2 id="2-正常安装Laravel"><a href="#2-正常安装Laravel" class="headerlink" title="2. 正常安装Laravel"></a>2. 正常安装Laravel</h2><p>在ubuntu desktop环境下安装。</p>
<h2 id="安装nginx-php7-mysql-redis"><a href="#安装nginx-php7-mysql-redis" class="headerlink" title="安装nginx + php7 + mysql + redis"></a>安装nginx + php7 + mysql + redis</h2><hr>
<h3 id="2-1-安装nginx"><a href="#2-1-安装nginx" class="headerlink" title="2.1 安装nginx"></a>2.1 安装nginx</h3><pre><code>$ sudo apt-get update
$ sudo apt-get install nginx
</code></pre>
<p>显示防护墙列表</p>
<pre><code>$ sudo ufw app list
</code></pre>
<p>结果如下</p>
<pre><code>可用应用程序：
  CUPS
  Nginx Full
  Nginx HTTP
  Nginx HTTPS
</code></pre>
<ul>
<li>Nginx Full: This profile opens both port 80 (normal, unencrypted web traffic) and port 443 (TLS/SSL encrypted traffic)</li>
<li>Nginx HTTP: This profile opens only port 80 (normal, unencrypted web traffic)</li>
<li>Nginx HTTPS: This profile opens only port 443 (TLS/SSL encrypted traffic)</li>
</ul>
<p>设置防火墙规则</p>
<pre><code>$ sudo ufw allow &#39;Nginx Full&#39;
</code></pre>
<p>查看防火墙状态</p>
<pre><code>$ sudo ufw status
</code></pre>
<p>网站目录在<code>var/www/html</code></p>
<p>根据情况修改<code>/etc/nginx/nginx.conf</code>中的<code>keepalive_timeout</code>值。</p>
<hr>
<h3 id="2-2-安装php7-0-fpm"><a href="#2-2-安装php7-0-fpm" class="headerlink" title="2.2 安装php7.0-fpm"></a>2.2 安装php7.0-fpm</h3><p><a target="_blank" rel="noopener" href="https://www.howtoforge.com/tutorial/installing-nginx-with-php7-fpm-and-mysql-on-ubuntu-16.04-lts-lemp/">参考地址</a></p>
<pre><code>$ sudo apt-get install php7.0-fpm
</code></pre>
<p>现在还不能访问<code>.php</code>文件，要进行如下设置：</p>
<pre><code>$ sudo nano /etc/nginx/sites-available/default
</code></pre>
<ul>
<li><p><code>server_name _ </code>服务器名，可以不填。</p>
</li>
<li><p><code>root /var/www/html</code> 网站目录地址。可以手动修改。</p>
<p>  增加<code>index.php</code></p>
</li>
<li><p><code>location ~ \.php$</code>php支持，需要解除注释。</p>
<p>  <code>fastcgi_pass 127.0.0.1:9000;</code>与 <code>fastcgi_pass unix:/run/php/php7.0-fpm.sock;</code>选一个否则冲突。</p>
</li>
</ul>
<p>之后重新读取<code>nginx</code>设置，</p>
<pre><code>$ sudo service nginx reload
</code></pre>
<p>修改<code>/etc/php/7.0/fpm/php.ini</code></p>
<pre><code>$ sudo nano /etc/php/7.0/fpm/php.ini
</code></pre>
<p>设置<code> cgi.fix_pathinfo=1</code></p>
<p>重启<code>php7.0-fpm</code>服务</p>
<pre><code>$ sudo service php7.0-fpm reload
</code></pre>
<p>网站目录下建立任意<code>.php</code>文件测试。</p>
<p>文件内容如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>随后输入<code>127.0.0.1/[文件名].php</code></p>
<p>通过命令定位php7.0的其他包：</p>
<pre><code>$ sudo apt-cache search php7.0
</code></pre>
<p>选择安装的如下：</p>
<pre><code>$ sudo apt-get install php7.0-cli php7.0-common php7.0 php7.0-mysql php7.0-curl php7.0-gd php7.0-bz2 php7.0-mcrypt php7.0-zip php7.0-mbstring php7.0-xml
</code></pre>
<p><em>其他让php7.0使用TCP连接</em></p>
<p>修改文件<code>/etc/php/7.0/fpm/pool.d/www.conf</code>与<code>/etc/nginx/sites-available/default</code></p>
<p><code>/etc/php/7.0/fpm/pool.d/www.conf</code>文件</p>
<pre><code>;listen = /var/run/php5-fpm.sock       //注释掉
listen = 127.0.0.1:9000                    // 增加
</code></pre>
<p><code>/etc/nginx/sites-available/default</code>文件</p>
<pre><code>[...]
        location ~ \.php$ &#123;
 include snippets/fastcgi-php.conf;

 # With php7.0-cgi alone:
 fastcgi_pass 127.0.0.1:9000;
 # With php7.0-fpm:
 # fastcgi_pass unix:/run/php/php7.0-fpm.sock;
 &#125;
[...]
</code></pre>
<p>重新读取<code>nginx</code></p>
<pre><code>service nginx reload
</code></pre>
<hr>
<h3 id="2-3-安装MySql"><a href="#2-3-安装MySql" class="headerlink" title="2.3 安装MySql"></a>2.3 安装MySql</h3><pre><code>$ sudo apt-get install mysql-server-5.7 php7.0-mysql
</code></pre>
<hr>
<h3 id="2-4-安装composer"><a href="#2-4-安装composer" class="headerlink" title="2.4 安装composer"></a>2.4 安装composer</h3><p><a target="_blank" rel="noopener" href="https://getcomposer.org/download/">下载地址</a></p>
<p>随后会得到一个<code>composer.phar</code>文件，可以直接放入任意目录，终端输入<code>composer</code>使用。</p>
<p>当然为了方便可以设置为全局可以用。</p>
<pre><code>$ sudo mv composer.phar /usr/local/bin/composer
$ sudo chmod +x /usr/local/bin/composer
</code></pre>
<hr>
<h3 id="2-5-安装laravel-5"><a href="#2-5-安装laravel-5" class="headerlink" title="2.5 安装laravel 5"></a>2.5 安装laravel 5</h3><p><a target="_blank" rel="noopener" href="https://laravel.com/docs/5.2">文档地址</a></p>
<h4 id="2-5-1-方法1"><a href="#2-5-1-方法1" class="headerlink" title="2.5.1 方法1"></a>2.5.1 方法1</h4><pre><code>$ composer create-project --prefer-dist laravel/laravel [blog]
</code></pre>
<p>[blog]可以为项目名</p>
<h4 id="2-5-2-方法2"><a href="#2-5-2-方法2" class="headerlink" title="2.5.2 方法2"></a>2.5.2 方法2</h4><p>需要使用<code>bash</code>。<code>zsh</code>测试无效</p>
<pre><code>$ composer global require &quot;laravel/installer&quot;

$ export PATH=&quot;~/.config/composer/vendor/bin:$PATH&quot;
</code></pre>
<p>进入想要创建项目的目录</p>
<pre><code>$ laravel new [blog]
</code></pre>
<p>[blog]可以为项目名</p>
<p><em>注意：需要梯子！需要梯子！需要梯子！</em></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/13/d4db3ba9f29f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Keleven.Me">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/13/d4db3ba9f29f/" class="post-title-link" itemprop="url">2016年7月13日</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-13 23:30:45" itemprop="dateCreated datePublished" datetime="2016-07-13T23:30:45+08:00">2016-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Living/" itemprop="url" rel="index"><span itemprop="name">Living</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/13/d4db3ba9f29f/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/13/d4db3ba9f29f/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="日期：2016年7月13日"><a href="#日期：2016年7月13日" class="headerlink" title="日期：2016年7月13日"></a>日期：2016年7月13日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><ol>
<li><p>mysql禁止了root用户登录，所以新建一个高权限用户吧！<a target="_blank" rel="noopener" href="http://jvdc.me/get-phpmyadmin-working-on-ubuntu-16-04-nginx-1-10-php-7-mariadb-10/">参考地址</a></p>
</li>
<li><p>学习laravel快速入门</p>
</li>
</ol>
<h3 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p>[1/2] 2. 定制玩家天赋</p>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>laravel 学习</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>学习数据结构</li>
</ol>
</li>
<li><p><input checked="" disabled="" type="checkbox"> </p>
<ol start="5">
<li>设置jekyll分页以及disqus模块</li>
</ol>
</li>
</ul>
<h3 id="明日计划"><a href="#明日计划" class="headerlink" title="明日计划"></a>明日计划</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="2">
<li>定制玩家天赋</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>laravel 学习</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>学习数据结构</li>
</ol>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/13/c7d69e97b93f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Keleven.Me">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/13/c7d69e97b93f/" class="post-title-link" itemprop="url">vim 学习指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-13 18:30:45" itemprop="dateCreated datePublished" datetime="2016-07-13T18:30:45+08:00">2016-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ubuntu/" itemprop="url" rel="index"><span itemprop="name">ubuntu</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/13/c7d69e97b93f/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/13/c7d69e97b93f/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="vim-使用指南"><a href="#vim-使用指南" class="headerlink" title="vim 使用指南"></a>vim 使用指南</h1><h2 id="1-vim-插件管理器"><a href="#1-vim-插件管理器" class="headerlink" title="1.vim 插件管理器"></a>1.vim 插件管理器</h2><h3 id="1-1-Vundle-git仓库"><a href="#1-1-Vundle-git仓库" class="headerlink" title="1.1 Vundle git仓库"></a>1.1 Vundle <a target="_blank" rel="noopener" href="https://github.com/VundleVim/Vundle.vim">git仓库</a></h3><p>安装文档有中文指南。</p>
<h3 id="1-2-第一步"><a href="#1-2-第一步" class="headerlink" title="1.2 第一步"></a>1.2 第一步</h3><pre><code>$ git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim
</code></pre>
<h3 id="1-3-第二步"><a href="#1-3-第二步" class="headerlink" title="1.3 第二步"></a>1.3 第二步</h3><p>对<code>.vimrc</code>文件进行设置。</p>
<p><code>begin()</code>和<code>end()</code>之间的为可以添加的插件。</p>
<p>插件添加支持多种格式。</p>
<pre><code>set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()

Plugin &#39;VundleVim/Vundle.vim&#39;
Plugin &#39;tpope/vim-fugitive&#39;
Plugin &#39;L9&#39;
Plugin &#39;wincent/command-t&#39;
Plugin &#39;godlygeek/tabular&#39;
Plugin &#39;plasticboy/vim-markdown&#39;
Plugin &#39;suan/vim-instant-markdown&#39;

call vundle#end()            
filetype plugin indent on
</code></pre>
<h3 id="1-4-第三步"><a href="#1-4-第三步" class="headerlink" title="1.4 第三步"></a>1.4 第三步</h3><p>在vim中输入<code>:PluginInstall</code>来安装插件。</p>
<hr>
<h2 id="2-vim-常用插件指南"><a href="#2-vim-常用插件指南" class="headerlink" title="2.vim 常用插件指南"></a>2.vim 常用插件指南</h2><h3 id="2-1-Command-t"><a href="#2-1-Command-t" class="headerlink" title="2.1 Command-t"></a>2.1 Command-t</h3><p>插件<a target="_blank" rel="noopener" href="https://github.com/wincent/command-t">地址</a></p>
<p>插件需要安装<code>ruby</code>，安装完成后，进入目录<code>~/.vim/bundle/command-t/ruby/command-t</code></p>
<p>执行下方命令：</p>
<pre><code>ruby extconf.rb
make
</code></pre>
<p>之后进入Vim，输入命令<code>:CommandT</code>查看效果。</p>
<p>如果提示vim不支持<code>ruby</code>，则安装<code>vim-nox</code></p>
<pre><code>$ sudo apt-get install vim-nox
</code></pre>
<p>下图，为正常运行图</p>
<p><img src="https://raw.githubusercontent.com/wincent/command-t/media/command-t.gif"></p>
<p><strong>简要使用说明</strong></p>
<p><code>tab</code>为选择切换到文件选择。方向键用了选择文件。<code>enter</code>确认选择。</p>
<hr>
<h3 id="2-2-vim中编写markdown与预览"><a href="#2-2-vim中编写markdown与预览" class="headerlink" title="2.2 vim中编写markdown与预览"></a>2.2 vim中编写markdown与预览</h3><p>需要安装的插件有三个。</p>
<pre><code>Plugin &#39;godlygeek/tabular&#39;
Plugin &#39;plasticboy/vim-markdown&#39;
Plugin &#39;suan/vim-instant-markdown&#39;
</code></pre>
<p>其中<code>vim-instant-markdown</code>需要安装<code>nodejs</code>、<code>npm</code>、<code>xdg-utils</code>、<code>nodejs-legacy</code>。</p>
<p>安装<code>instant-markdown-d</code></p>
<pre><code>$ sudo npm -g install instant-markdown-d
</code></pre>
<p>其他需要组件：</p>
<pre><code>$ sudo apt-get install nodejs
$ sudo apt-get install npm
$ sudo apt-get install xdg-utils
$ sudo apt-get install nodejs-legacy
</code></pre>
<p>实现的效果为<code>浏览器预览</code>与<code>markdown语法高亮</code></p>
<p>安装完成后效果如下图：</p>
<p><img src="https://dl.dropboxusercontent.com/u/28956267/instant-markdown-demo.gif"></p>
<hr>
<h3 id="2-3-nerdTree"><a href="#2-3-nerdTree" class="headerlink" title="2.3 nerdTree"></a>2.3 nerdTree</h3><p>参考<a target="_blank" rel="noopener" href="https://github.com/scrooloose/nerdtree">地址</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/Xuyuanp/nerdtree-git-plugin">nerdtree-git-plugin</a> git语法提示</p>
<p><a target="_blank" rel="noopener" href="https://github.com/jistr/vim-nerdtree-tabs">vim-nerdtree-tabs</a> NERDTree tag控制</p>
<pre><code>Plugin &#39;scrooloose/nerdTree&#39;
Plugin &#39;Xuyuanp/nerdtree-git-plugin&#39;
Plugin &#39;jistr/vim-nerdtree-tabs&#39;
</code></pre>
<p><code>vim</code>中输入<code>PluginInstall</code>，输入<code>NERDTree</code>检查是否运行</p>
<p>在<code>.vimrc</code>中添加设置</p>
<pre><code>&quot; NERDTRee config NERDTree 设置

autocmd vimenter * NERDTree  “ 当指定文件时，自动随VIM启动。

&quot;未指定文件时，加载NERDTree

autocmd StdinReadPre * let s:std_in=1
autocmd VimEnter * if argc() == 0 &amp;&amp; !exists(&quot;s:std_in&quot;) | NERDTree | endif

&quot;隐藏与显示快捷键[Ctrl+n]

map &lt;C-n&gt; :NERDTreeToggle&lt;CR&gt;

&quot;左侧只有一个窗口时，随Vim一起关闭

autocmd bufenter * if (winnr(&quot;$&quot;) == 1 &amp;&amp; exists(&quot;b:NERDTree&quot;) &amp;&amp; b:NERDTree.isTabTree()) | q | endif
</code></pre>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/12/572a7c4c0c84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Keleven.Me">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/12/572a7c4c0c84/" class="post-title-link" itemprop="url">2016年7月12日</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-12 23:30:45" itemprop="dateCreated datePublished" datetime="2016-07-12T23:30:45+08:00">2016-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/12/572a7c4c0c84/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/12/572a7c4c0c84/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="日期：2016年7月12日"><a href="#日期：2016年7月12日" class="headerlink" title="日期：2016年7月12日"></a>日期：2016年7月12日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><p>在ubuntu中安装<code>gulp</code>与<code>sass</code>。</p>
<p>安装nginx+php7.0+mysql。</p>
<h3 id="明日计划"><a href="#明日计划" class="headerlink" title="明日计划"></a>明日计划</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="2">
<li>定制玩家天赋</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>laravel 学习</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>学习数据结构</li>
</ol>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/12/3243f213ce74/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Keleven.Me">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/12/3243f213ce74/" class="post-title-link" itemprop="url">gulp 学习指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-12 23:30:45" itemprop="dateCreated datePublished" datetime="2016-07-12T23:30:45+08:00">2016-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ubuntu/" itemprop="url" rel="index"><span itemprop="name">ubuntu</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/12/3243f213ce74/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/12/3243f213ce74/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="about-gulp"><a href="#about-gulp" class="headerlink" title="about gulp"></a>about gulp</h1><h2 id="安装node"><a href="#安装node" class="headerlink" title="安装node"></a>安装node</h2><pre><code>sudo apt install nodejs
</code></pre>
<h2 id="安装-nodejs-legacy"><a href="#安装-nodejs-legacy" class="headerlink" title="安装 nodejs-legacy"></a>安装 nodejs-legacy</h2><pre><code>sudo apt install nodejs-legacy
</code></pre>
<h2 id="安装npm"><a href="#安装npm" class="headerlink" title="安装npm"></a>安装npm</h2><pre><code>sudo apt install npm
</code></pre>
<h2 id="安装gulp"><a href="#安装gulp" class="headerlink" title="安装gulp"></a>安装gulp</h2><pre><code>sudo npm install -g gulp
</code></pre>
<h2 id="查看node-版本"><a href="#查看node-版本" class="headerlink" title="查看node 版本"></a>查看node 版本</h2><pre><code>node -v
</code></pre>
<h2 id="查看npm-版本"><a href="#查看npm-版本" class="headerlink" title="查看npm 版本"></a>查看npm 版本</h2><pre><code>npm -v
</code></pre>
<h2 id="查看gulp-版本"><a href="#查看gulp-版本" class="headerlink" title="查看gulp 版本"></a>查看gulp 版本</h2><pre><code>gulp -v
</code></pre>
<p>测试gulp时，需要<code>package.json</code>与<code>gulpfile.js</code>文件</p>
<h2 id="安装gulp-sass"><a href="#安装gulp-sass" class="headerlink" title="安装gulp-sass"></a>安装gulp-sass</h2><pre><code>npm install gulp-sass
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/12/23c89f0bf146/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Keleven.Me">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/12/23c89f0bf146/" class="post-title-link" itemprop="url">jekyll 学习指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-12 23:30:45" itemprop="dateCreated datePublished" datetime="2016-07-12T23:30:45+08:00">2016-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ubuntu/" itemprop="url" rel="index"><span itemprop="name">ubuntu</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/12/23c89f0bf146/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/12/23c89f0bf146/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-jekyll"><a href="#1-jekyll" class="headerlink" title="1.jekyll"></a>1.jekyll</h2><p><a target="_blank" rel="noopener" href="https://jekyllrb.com/">jekyll官方地址</a></p>
<p><a target="_blank" rel="noopener" href="http://jekyllcn.com/">jekyll中文</a></p>
<h3 id="1-1安装jekyll必要组件"><a href="#1-1安装jekyll必要组件" class="headerlink" title="1.1安装jekyll必要组件"></a>1.1安装jekyll必要组件</h3><p>下文是在ubuntu上安装与设置</p>
<pre><code>$ sudo apt-get install ruby ruby-dev make gcc nodejs
</code></pre>
<h3 id="1-2安装jekyll"><a href="#1-2安装jekyll" class="headerlink" title="1.2安装jekyll"></a>1.2安装jekyll</h3><pre><code>$ sudo gem install jekyll
</code></pre>
<p>之后查看jekyll版本</p>
<pre><code>$ jekyll -v
</code></pre>
<h3 id="1-3jekyll使用"><a href="#1-3jekyll使用" class="headerlink" title="1.3jekyll使用"></a>1.3jekyll使用</h3><p>首先要设置<code>_config.yml</code>文件</p>
<p>随后build为site。</p>
<pre><code>$ jekyll build
</code></pre>
<p>build后网站文件在<code>_site</code></p>
<p>使用<code>jekyll server</code>运行测试。</p>
<pre><code>$ jekyll server
</code></pre>
<p>浏览器输入<code>localhost:4000</code>可以查看网站运行情况。</p>
<p><code>_post</code>文件下位文章列表，可以将文章放入后build。</p>
<p><em>注意：文件的头部要使用下方格式</em></p>
<pre><code>---
layout: post
title: Blogging Like a Hacker
---
</code></pre>
<h2 id="2-kramdown-语法说明"><a href="#2-kramdown-语法说明" class="headerlink" title="2. kramdown 语法说明"></a>2. kramdown 语法说明</h2><h3 id="2-1-TOC连接-文章目录"><a href="#2-1-TOC连接-文章目录" class="headerlink" title="2.1 TOC连接[文章目录]"></a>2.1 TOC连接[文章目录]</h3><pre><code>* TOC
&#123;：toc&#125;
</code></pre>
<p>生成目录带自动锚点</p>
<h3 id="2-2-删除线"><a href="#2-2-删除线" class="headerlink" title="2.2 删除线"></a>2.2 删除线</h3><pre><code>~~删除线~~
</code></pre>
<h3 id="2-3-数学公式"><a href="#2-3-数学公式" class="headerlink" title="2.3 数学公式"></a>2.3 数学公式</h3><p>需要增加<code>js</code>用于公式解析</p>
<pre><code>&lt;script src=&quot;https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
</code></pre>
<h2 id="3-disqus"><a href="#3-disqus" class="headerlink" title="3. disqus"></a>3. disqus</h2><p>添加<code>disqus</code>代码到<code>_layouts/post.html</code></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/12/1b289a08a4b0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Keleven.Me">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/12/1b289a08a4b0/" class="post-title-link" itemprop="url">zsh指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-12 23:30:45" itemprop="dateCreated datePublished" datetime="2016-07-12T23:30:45+08:00">2016-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/ubuntu/" itemprop="url" rel="index"><span itemprop="name">ubuntu</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/12/1b289a08a4b0/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/12/1b289a08a4b0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="zsh-plugin"><a href="#zsh-plugin" class="headerlink" title="zsh plugin"></a>zsh plugin</h1><h3 id="zsh-tmux"><a href="#zsh-tmux" class="headerlink" title="zsh tmux"></a>zsh tmux</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ta</td>
<td align="left">tmux attach -t</td>
</tr>
<tr>
<td align="left">ts</td>
<td align="left">tmux new-session -s</td>
</tr>
<tr>
<td align="left">tl</td>
<td align="left">tmux list-sessions</td>
</tr>
<tr>
<td align="left">tksv</td>
<td align="left">tmux kill-server</td>
</tr>
<tr>
<td align="left">tkss</td>
<td align="left">tmux kill-session -t</td>
</tr>
</tbody></table>
<h3 id="zsh-git"><a href="#zsh-git" class="headerlink" title="zsh git"></a>zsh git</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">g</td>
<td align="left">git</td>
</tr>
<tr>
<td align="left">ga</td>
<td align="left">git add</td>
</tr>
<tr>
<td align="left">gaa</td>
<td align="left">git add –add</td>
</tr>
<tr>
<td align="left">gapa</td>
<td align="left">git add –patsh</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gb</td>
<td align="left">git branch</td>
</tr>
<tr>
<td align="left">gba</td>
<td align="left">git branch -a</td>
</tr>
<tr>
<td align="left">gbnm</td>
<td align="left">git branch –no-merged</td>
</tr>
<tr>
<td align="left">gbr</td>
<td align="left">git branch –remote</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gc</td>
<td align="left">git commit -v</td>
</tr>
<tr>
<td align="left">gca</td>
<td align="left">git commit -v -a</td>
</tr>
<tr>
<td align="left">gcam</td>
<td align="left">git commit -a -m</td>
</tr>
<tr>
<td align="left">gcmsg</td>
<td align="left">git commit -m</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gco</td>
<td align="left">git checkout</td>
</tr>
<tr>
<td align="left">gcm</td>
<td align="left">git checkout master</td>
</tr>
<tr>
<td align="left">gcb</td>
<td align="left">git checkout -b</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gcl</td>
<td align="left">git clone –recursive</td>
</tr>
<tr>
<td align="left">gcf</td>
<td align="left">git config –list</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gd</td>
<td align="left">git diff</td>
</tr>
<tr>
<td align="left">gf</td>
<td align="left">git fetch</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gl</td>
<td align="left">git pull</td>
</tr>
<tr>
<td align="left">gm</td>
<td align="left">git merge</td>
</tr>
<tr>
<td align="left">gmom</td>
<td align="left">git merge origin/master</td>
</tr>
<tr>
<td align="left">gp</td>
<td align="left">git push</td>
</tr>
<tr>
<td align="left">gpd</td>
<td align="left">git push –dry-run</td>
</tr>
<tr>
<td align="left">gpoat</td>
<td align="left">git push origin –all &amp;&amp; git push origin –tags</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gr</td>
<td align="left">git remote</td>
</tr>
<tr>
<td align="left">gra</td>
<td align="left">git remote add</td>
</tr>
<tr>
<td align="left">grmv</td>
<td align="left">git remote rename</td>
</tr>
<tr>
<td align="left">grrm</td>
<td align="left">git remote remove</td>
</tr>
<tr>
<td align="left">grv</td>
<td align="left">git remote -v</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">grb</td>
<td align="left">git rebase</td>
</tr>
<tr>
<td align="left">grbm</td>
<td align="left">git rebase master</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">grh</td>
<td align="left">git reset HEAD</td>
</tr>
<tr>
<td align="left">grhh</td>
<td align="left">git reset HEAD –hard</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gsb</td>
<td align="left">git status -sb</td>
</tr>
<tr>
<td align="left">gss</td>
<td align="left">git status -s</td>
</tr>
<tr>
<td align="left">gst</td>
<td align="left">git status</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gts</td>
<td align="left">git tag -s</td>
</tr>
<tr>
<td align="left">gtv</td>
<td align="left">git tag</td>
</tr>
</tbody></table>
<h3 id="zsh-laravel"><a href="#zsh-laravel" class="headerlink" title="zsh laravel"></a>zsh laravel</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">la5</td>
<td align="left">php artisan</td>
</tr>
<tr>
<td align="left">la5cache</td>
<td align="left">php artisan cache:clear</td>
</tr>
<tr>
<td align="left">la5routes</td>
<td align="left">php artisan route:list</td>
</tr>
<tr>
<td align="left">la5vendor</td>
<td align="left">php artisan vendor:publish</td>
</tr>
</tbody></table>
<h3 id="zsh-ubuntu"><a href="#zsh-ubuntu" class="headerlink" title="zsh ubuntu"></a>zsh ubuntu</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ag</td>
<td align="left">sudo apt-get</td>
</tr>
<tr>
<td align="left">aga</td>
<td align="left">sudo apt-get autoclean</td>
</tr>
<tr>
<td align="left">agar</td>
<td align="left">sudo apt-get autoremove</td>
</tr>
<tr>
<td align="left">agb</td>
<td align="left">sudo apt-get build-dep</td>
</tr>
<tr>
<td align="left">agc</td>
<td align="left">sudo apt-get clean</td>
</tr>
<tr>
<td align="left">agd</td>
<td align="left">sudo apt-get dselect-upgrade</td>
</tr>
<tr>
<td align="left">agi</td>
<td align="left">sudo apt-get install</td>
</tr>
<tr>
<td align="left">agp</td>
<td align="left">sudo apt-get purge</td>
</tr>
<tr>
<td align="left">agr</td>
<td align="left">sudo apt-get remove</td>
</tr>
<tr>
<td align="left">agu</td>
<td align="left">sudo apt-get update</td>
</tr>
<tr>
<td align="left">agud</td>
<td align="left">sudo apt-get update &amp;&amp; sudo apt-get dist-upgrade</td>
</tr>
<tr>
<td align="left">agug</td>
<td align="left">sudo apt-get upgrade</td>
</tr>
<tr>
<td align="left">aguu</td>
<td align="left">sudo apt-get update &amp;&amp; sudo apt-get upgrade</td>
</tr>
</tbody></table>
<h3 id="zsh-npm"><a href="#zsh-npm" class="headerlink" title="zsh npm"></a>zsh npm</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">npmg</td>
<td align="left">npm i -g</td>
</tr>
<tr>
<td align="left">npmS</td>
<td align="left">npm i -S</td>
</tr>
<tr>
<td align="left">npmD</td>
<td align="left">npm i -D</td>
</tr>
<tr>
<td align="left">npmO</td>
<td align="left">npm outdated</td>
</tr>
</tbody></table>
<h3 id="zsh-ruby"><a href="#zsh-ruby" class="headerlink" title="zsh ruby"></a>zsh ruby</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">sgem</td>
<td align="left">sudo gem</td>
</tr>
</tbody></table>
<h3 id="zsh-bundler"><a href="#zsh-bundler" class="headerlink" title="zsh bundler"></a>zsh bundler</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">be</td>
<td align="left">bundle exec</td>
</tr>
<tr>
<td align="left">bl</td>
<td align="left">bundle list</td>
</tr>
<tr>
<td align="left">bp</td>
<td align="left">bundle package</td>
</tr>
<tr>
<td align="left">bo</td>
<td align="left">bundle open</td>
</tr>
<tr>
<td align="left">bout</td>
<td align="left">bundle outdated</td>
</tr>
<tr>
<td align="left">bu</td>
<td align="left">bundle update</td>
</tr>
<tr>
<td align="left">bi</td>
<td align="left">bundle install</td>
</tr>
<tr>
<td align="left">bcn</td>
<td align="left">bundle clean</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="Previous page" aria-label="Previous page" href="/page/29/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><span class="page-number current">30</span><a class="page-number" href="/page/31/">31</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/31/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2016 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">K11</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Word count total">252k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">3:50</span>
  </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.1/dist/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@10.5.0/dist/mermaid.min.js","integrity":"sha256-K7oJiQlDulzl24ZUFOywuYme1JqBBvQzK6m8qHjt9Gk="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"keleven","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
