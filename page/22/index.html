<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="o1eiNMhypkcaTCNHyHeoaEJM-2wqU4uSpp7XfdfQglI">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"keleven.me","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="千变万化的是世界">
<meta property="og:type" content="website">
<meta property="og:title" content="Keleven.Me">
<meta property="og:url" content="http://keleven.me/page/22/index.html">
<meta property="og:site_name" content="Keleven.Me">
<meta property="og:description" content="千变万化的是世界">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="K11">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://keleven.me/page/22/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/22/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Keleven.Me</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111519029-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-111519029-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Keleven.Me</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="K11"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">K11</p>
  <div class="site-description" itemprop="description">千变万化的是世界</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">238</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/k11me" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;k11me" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:k11@keleven.me" title="E-Mail → mailto:k11@keleven.me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.instagram.com/_y.o_o.y_/" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;_y.o_o.y_&#x2F;" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/7e5f24379817/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/7e5f24379817/" class="post-title-link" itemprop="url">laravel 学习指南 第七章 第三节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 12:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T12:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/7e5f24379817/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/7e5f24379817/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="7-3-迁移"><a href="#7-3-迁移" class="headerlink" title="7.3 迁移"></a>7.3 迁移</h2><h3 id="7-3-1-简介"><a href="#7-3-1-简介" class="headerlink" title="7.3.1 简介"></a>7.3.1 简介</h3><p>迁移就像数据库的版本控制，允许团队简单轻松的编辑并共享应用的数据库表结构，迁移通常搭配 Laravel 结构构建器，可以很容易地构建应用的数据库表结构。</p>
<p>Laravel的<code>Schema门面</code>提供了与数据库系统无关的创建和操纵表的支持，在 Laravel 所支持的所有数据库系统中提供一致的、优雅的、平滑的API。</p>
<hr>
<h3 id="7-3-2-生成迁移"><a href="#7-3-2-生成迁移" class="headerlink" title="7.3.2 生成迁移"></a>7.3.2 生成迁移</h3><p>使用 <code>Artisan</code> 命令<code>make:migration</code>来创建一个新的迁移：</p>
<pre><code>php artisan make:migration create_users_table
</code></pre>
<p>新的迁移位于<code>database/migrations</code>目录下，每个迁移文件名都包含时间戳从而允许 Laravel 判断其顺序。</p>
<p><code>--table</code>和<code>--create</code>选项可以用于指定表名以及该迁移是否要创建一个新的数据表。这些选项只需要简单放在上述迁移命令后面并指定表名：</p>
<pre><code>php artisan make:migration add_votes_to_users_table --table=users
php artisan make:migration create_users_table --create=users
</code></pre>
<p>如果你想要指定生成迁移的自定义输出路径，在执行<code>make:migration</code>命令时可以使用<code>--path</code>选项，提供的路径应该是相对于应用根目录的。</p>
<hr>
<h3 id="7-3-3-迁移结构"><a href="#7-3-3-迁移结构" class="headerlink" title="7.3.3 迁移结构"></a>7.3.3 迁移结构</h3><p>迁移类包含了两个方法：<code>up</code>和<code>down</code>。</p>
<p><code>up</code>方法用于新增表，列或者索引到数据库，而<code>down</code>方法就是<code>up</code>方法的反操作，和<code>up</code>里的操作相反。</p>
<p>在这两个方法中你都要用到 Laravel 的表结构构建器来创建和修改表.</p>
<p>例如:让我们先看看创建<code>flights</code>表的简单示例：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Schema</span>\<span class="title">Blueprint</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Migrations</span>\<span class="title">Migration</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateFlightsTable</span> <span class="keyword">extends</span> <span class="title">Migration</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 运行迁移</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Schema::create(<span class="string">&#x27;flights&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Blueprint <span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">            <span class="variable">$table</span>-&gt;string(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">            <span class="variable">$table</span>-&gt;string(<span class="string">&#x27;airline&#x27;</span>);</span><br><span class="line">            <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 撤销迁移</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">down</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Schema::drop(<span class="string">&#x27;flights&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-3-4-运行迁移"><a href="#7-3-4-运行迁移" class="headerlink" title="7.3.4 运行迁移"></a>7.3.4 运行迁移</h3><p>要运行应用中所有未执行的迁移，可以使用 Artisan 命令的<code>migrate</code>方法。</p>
<p>如果你正在使用Homestead虚拟机，应该在你的虚拟机中运行如下这条命令：</p>
<pre><code>php artisan migrate
</code></pre>
<p>如果再运行时遇到“class not found”的错误提示，尝试运行<code>composer dump-autoload</code>命令然后重新运行迁移命令。</p>
<ul>
<li><p><strong>在生产环境中强制运行迁移</strong></p>
<p>  有些迁移操作是毁灭性的，这意味着它们可能造成数据的丢失，为了避免在生产环境数据库中运行这些命令，你将会在运行这些命令之前被提示并确认。想要强制运行这些命令而不被提示，可以使用<code>--force</code>：</p>
<pre><code>  php artisan migrate --force
</code></pre>
</li>
</ul>
<h4 id="7-3-4-1-回滚迁移"><a href="#7-3-4-1-回滚迁移" class="headerlink" title="7.3.4.1 回滚迁移"></a>7.3.4.1 回滚迁移</h4><p>想要回滚最新的一次迁移<code>操作</code>，可以使用<code>rollback</code>命令，注意这将会回滚最后一批运行的迁移，可能包含多个迁移文件：</p>
<pre><code>php artisan migrate:rollback
</code></pre>
<p><code>migrate:reset</code>命令将会回滚所有的应用迁移：</p>
<pre><code>php artisan migrate:reset
</code></pre>
<ul>
<li><strong>在单个命令中回滚/迁移</strong>  <code>migrate:refresh</code>命令将会先回滚所有数据库迁移，然后运行<code>migrate</code>命令。这个命令可以有效的重建整个数据库：<pre><code>  php artisan migrate:refresh
  php artisan migrate:refresh --seed
</code></pre>
</li>
</ul>
<hr>
<h3 id="7-3-5-编写迁移"><a href="#7-3-5-编写迁移" class="headerlink" title="7.3.5 编写迁移"></a>7.3.5 编写迁移</h3><h4 id="7-3-5-1-创建表"><a href="#7-3-5-1-创建表" class="headerlink" title="7.3.5.1 创建表"></a>7.3.5.1 创建表</h4><p>使用<code>Schema门面</code>上的<code>create</code>方法来创建新的数据表。<code>create</code>方法接收两个参数，第一个是表名，第二个是获取用于定义新表的<code>Blueprint</code>对象的闭包：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(<span class="string">&#x27;users&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当然，创建新表的时候，可以使用表结构构建器中的任意列方法来定义数据表的列。</p>
<ul>
<li><p><strong>检查表/列是否存在</strong></p>
<p>  你可以轻松地使用 <code>hasTable</code> 和 <code>hasColumn</code> 方法检查表或列是否存在：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Schema::hasTable(<span class="string">&#x27;users&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Schema::hasColumn(<span class="string">&#x27;users&#x27;</span>, <span class="string">&#x27;email&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li><p><strong>连接&amp;存储引擎</strong></p>
<p>  如果你想要在一个数据库连接上执行表结构操作，该数据库连接并不是默认数据库连接，使用<code>connection</code>方法：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Schema::connection(&#x27;foo&#x27;)-&gt;create(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;increments(&#x27;id&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>  要设置表的存储引擎，在表结构构建器上设置<code>engine</code>属性：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Schema::create(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;engine = &#x27;InnoDB&#x27;;</span><br><span class="line">    $table-&gt;increments(&#x27;id&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="7-3-5-2-重命名-删除表"><a href="#7-3-5-2-重命名-删除表" class="headerlink" title="7.3.5.2 重命名/删除表"></a>7.3.5.2 重命名/删除表</h4><p>要重命名一个已存在的数据表，使用<code>rename</code>方法：</p>
<pre><code>Schema::rename($from, $to);
</code></pre>
<p>要删除一个已存在的数据表，可以使用<code>drop</code>或<code>dropIfExists</code>方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Schema::drop(&#x27;users&#x27;);</span><br><span class="line">Schema::dropIfExists(&#x27;users&#x27;);</span><br></pre></td></tr></table></figure>

<h4 id="7-3-5-3-创建列"><a href="#7-3-5-3-创建列" class="headerlink" title="7.3.5.3 创建列"></a>7.3.5.3 创建列</h4><p>要更新一个已存在的表，使用<code>Schema门面</code>上的<code>table</code>方法，和<code>create</code>方法一样，<code>table</code>方法接收两个参数：表名和获取用于添加列到表的<code>Blueprint</code>实例的闭包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;string(&#x27;email&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>可用的列类型</strong></li>
</ul>
<p>当然，表结构构建器包含一系列你可以用来构建表的列类型：</p>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$table-&gt;bigIncrements(‘id’);</td>
<td align="left">自增ID，类型为bigint</td>
</tr>
<tr>
<td align="left">$table-&gt;bigInteger(‘votes’);</td>
<td align="left">等同于数据库中的BIGINT类型</td>
</tr>
<tr>
<td align="left">$table-&gt;binary(‘data’);</td>
<td align="left">等同于数据库中的BLOB类型</td>
</tr>
<tr>
<td align="left">$table-&gt;boolean(‘confirmed’);</td>
<td align="left">等同于数据库中的BOOLEAN类型</td>
</tr>
<tr>
<td align="left">$table-&gt;char(‘name’, 4);</td>
<td align="left">等同于数据库中的CHAR类型</td>
</tr>
<tr>
<td align="left">$table-&gt;date(‘created_at’);</td>
<td align="left">等同于数据库中的DATE类型</td>
</tr>
<tr>
<td align="left">$table-&gt;dateTime(‘created_at’);</td>
<td align="left">等同于数据库中的DATETIME类型</td>
</tr>
<tr>
<td align="left">$table-&gt;decimal(‘amount’, 5, 2);</td>
<td align="left">等同于数据库中的DECIMAL类型，带一个精度和范围</td>
</tr>
<tr>
<td align="left">$table-&gt;double(‘column’, 15, 8);</td>
<td align="left">等同于数据库中的DOUBLE类型，带精度, 总共15位数字，小数点后8位.</td>
</tr>
<tr>
<td align="left">$table-&gt;enum(‘choices’, [‘foo’, ‘bar’]);</td>
<td align="left">等同于数据库中的 ENUM类型</td>
</tr>
<tr>
<td align="left">$table-&gt;float(‘amount’);</td>
<td align="left">等同于数据库中的 FLOAT 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;increments(‘id’);</td>
<td align="left">数据库主键自增ID</td>
</tr>
<tr>
<td align="left">$table-&gt;integer(‘votes’);</td>
<td align="left">等同于数据库中的 INTEGER 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;json(‘options’);</td>
<td align="left">等同于数据库中的 JSON 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;jsonb(‘options’);</td>
<td align="left">等同于数据库中的 JSONB 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;longText(‘description’);</td>
<td align="left">等同于数据库中的 LONGTEXT 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;mediumInteger(‘numbers’);</td>
<td align="left">等同于数据库中的 MEDIUMINT类型</td>
</tr>
<tr>
<td align="left">$table-&gt;mediumText(‘description’);</td>
<td align="left">等同于数据库中的 MEDIUMTEXT类型</td>
</tr>
<tr>
<td align="left">$table-&gt;morphs(‘taggable’);</td>
<td align="left">添加一个 INTEGER类型的 <code>taggable_id</code> 列和一个 STRING类型的 <code>taggable_type</code>列</td>
</tr>
<tr>
<td align="left">$table-&gt;nullableTimestamps();</td>
<td align="left">和 <code>timestamps()</code>一样但允许 NULL值.</td>
</tr>
<tr>
<td align="left">$table-&gt;rememberToken();</td>
<td align="left">添加一个 <code>remember_token</code> 列： VARCHAR(100) NULL.</td>
</tr>
<tr>
<td align="left">$table-&gt;smallInteger(‘votes’);</td>
<td align="left">等同于数据库中的 SMALLINT 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;softDeletes();</td>
<td align="left">新增一个 deleted_at 列 用于软删除.</td>
</tr>
<tr>
<td align="left">$table-&gt;string(‘email’);</td>
<td align="left">等同于数据库中的 VARCHAR 列  .</td>
</tr>
<tr>
<td align="left">$table-&gt;string(‘name’, 100);</td>
<td align="left">等同于数据库中的 VARCHAR，带一个长度</td>
</tr>
<tr>
<td align="left">$table-&gt;text(‘description’);</td>
<td align="left">等同于数据库中的 TEXT 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;time(‘sunrise’);</td>
<td align="left">等同于数据库中的 TIME类型</td>
</tr>
<tr>
<td align="left">$table-&gt;tinyInteger(‘numbers’);</td>
<td align="left">等同于数据库中的 TINYINT 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;timestamp(‘added_on’);</td>
<td align="left">等同于数据库中的 TIMESTAMP 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;timestamps();</td>
<td align="left">添加 <code>created_at</code> 和 <code>updated_at</code>列.</td>
</tr>
<tr>
<td align="left">$table-&gt;uuid(‘id’);</td>
<td align="left">等同于数据库的UUID</td>
</tr>
</tbody></table>
<h4 id="7-3-5-4-列修改器"><a href="#7-3-5-4-列修改器" class="headerlink" title="7.3.5.4 列修改器"></a>7.3.5.4 列修改器</h4><p>除了上面列出的列类型之外，在添加列的时候还可以使用一些其它列“修改器”。</p>
<p>例如:要使列默认为<code>null</code>，可以使用<code>nullable</code>方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;string(&#x27;email&#x27;)-&gt;nullable();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>下面是所有可用的列修改器列表，该列表不包含索引修改器：</p>
<table>
<thead>
<tr>
<th align="left">修改器</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-&gt;first()</td>
<td align="left">将该列置为表中第一个列 (仅适用于MySQL)</td>
</tr>
<tr>
<td align="left">-&gt;after(‘column’)</td>
<td align="left">将该列置于另一个列之后 (仅适用于MySQL)</td>
</tr>
<tr>
<td align="left">-&gt;nullable()</td>
<td align="left">允许该列的值为NULL</td>
</tr>
<tr>
<td align="left">-&gt;default($value)</td>
<td align="left">指定列的默认值</td>
</tr>
<tr>
<td align="left">-&gt;unsigned()</td>
<td align="left">设置 <code>integer</code> 列为 <code>UNSIGNED</code></td>
</tr>
</tbody></table>
<h4 id="7-3-5-5-修改列"><a href="#7-3-5-5-修改列" class="headerlink" title="7.3.5.5 修改列"></a>7.3.5.5 修改列</h4><ul>
<li><p><strong>先决条件</strong></p>
<p>  在修改列之前，确保已经将<code>doctrine/dbal</code>依赖添加到<code>composer.json</code>文件，Doctrine DBAL 库用于判断列的当前状态并在需要时创建SQL查询来对列进行指定的调整。</p>
</li>
<li><p><strong>更新列属性</strong></p>
<p>  <code>change</code>方法允许你修改已存在的列为新的类型，或者修改列的属性。例如，你可能想要增加 string 类型列的尺寸，让我们将<code>name</code>列的尺寸从 25 增加到 50：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;string(&#x27;name&#x27;, 50)-&gt;change();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>  我们还可以修改该列允许 NULL 值：</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;string(&#x27;name&#x27;, 50)-&gt;nullable()-&gt;change();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>重命名列</strong></p>
</li>
</ul>
<p>要重命名一个列，可以使用表结构构建器上的<code>renameColumn</code>方法，在重命名一个列之前，确保<code>doctrine/dbal</code>依赖已经添加到<code>composer.json</code>文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;renameColumn(&#x27;from&#x27;, &#x27;to&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>注意：暂不支持 enum类型的列的重命名。</em></p>
<h4 id="7-3-5-6-删除列"><a href="#7-3-5-6-删除列" class="headerlink" title="7.3.5.6 删除列"></a>7.3.5.6 删除列</h4><p>要删除一个列，使用表结构构建器上的<code>dropColumn</code>方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;dropColumn(&#x27;votes&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>你可以传递列名数组到<code>dropColumn</code>方法从表中删除多个列：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;dropColumn([&#x27;votes&#x27;, &#x27;avatar&#x27;, &#x27;location&#x27;]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><em>注意：在从SQLite数据库删除列之前，需要添加<code>doctrine/dbal</code>依赖到<code>composer.json</code>文件并在终端中运行<code>composer update命</code>令来安装该库。此外，SQLite数据库暂不支持在单个迁移中删除或修改多个列。</em></p>
<h4 id="7-3-5-7-创建索引"><a href="#7-3-5-7-创建索引" class="headerlink" title="7.3.5.7 创建索引"></a>7.3.5.7 创建索引</h4><p>表结构构建器支持多种类型的索引，首先，让我们看一个指定列值为唯一索引的例子。要创建索引，可以使用<code>unique</code>方法：</p>
<pre><code>$table-&gt;string(&#39;email&#39;)-&gt;unique();
</code></pre>
<p>此外，你可以在定义列之后创建索引，例如：</p>
<pre><code>$table-&gt;unique(&#39;email&#39;);
</code></pre>
<p>你甚至可以传递列名数组到索引方法来创建组合索引：</p>
<pre><code>$table-&gt;index([&#39;account_id&#39;, &#39;created_at&#39;]);
</code></pre>
<p>Laravel 会自动生成合理的索引名称，但是你可以传递第二个参数到该方法用于指定索引名称：</p>
<pre><code>$table-&gt;index(&#39;email&#39;, &#39;my_index_name&#39;);
</code></pre>
<ul>
<li><p><strong>可用索引类型</strong></p>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$table-&gt;primary(‘id’);</td>
<td align="left">添加主键索引</td>
</tr>
<tr>
<td align="left">$table-&gt;primary([‘first’, ‘last’]);</td>
<td align="left">添加混合索引</td>
</tr>
<tr>
<td align="left">$table-&gt;unique(‘email’);</td>
<td align="left">添加唯一索引</td>
</tr>
<tr>
<td align="left">$table-&gt;unique(‘state’, ‘my_index_name’);</td>
<td align="left">指定自定义索引名称</td>
</tr>
<tr>
<td align="left">$table-&gt;index(‘state’);</td>
<td align="left">添加普通索引</td>
</tr>
</tbody></table>
</li>
</ul>
<h4 id="7-3-5-8-删除索引"><a href="#7-3-5-8-删除索引" class="headerlink" title="7.3.5.8 删除索引"></a>7.3.5.8 删除索引</h4><p>要删除索引，必须指定索引名。默认情况下，Laravel 自动分配适当的名称给索引——简单连接表名、列名和索引类型。下面是一些例子：</p>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$table-&gt;dropPrimary(‘users_id_primary’);</td>
<td align="left">从 “users”表中删除主键索引</td>
</tr>
<tr>
<td align="left">$table-&gt;dropUnique(‘users_email_unique’);</td>
<td align="left">从 “users”表中删除唯一索引</td>
</tr>
<tr>
<td align="left">$table-&gt;dropIndex(‘geo_state_index’);</td>
<td align="left">从 “geo”表中删除普通索引</td>
</tr>
</tbody></table>
<h4 id="7-3-5-9-外键约束"><a href="#7-3-5-9-外键约束" class="headerlink" title="7.3.5.9 外键约束"></a>7.3.5.9 外键约束</h4><p>Laravel 还提供了创建外键约束的支持，用于在数据库层面强制引用完整性。例如，我们在<code>posts</code>表中定义了一个引用<code>users</code>表的<code>id</code>列的<code>user_id</code>列：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Schema::table(&#x27;posts&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;integer(&#x27;user_id&#x27;)-&gt;unsigned();</span><br><span class="line">    $table-&gt;foreign(&#x27;user_id&#x27;)-&gt;references(&#x27;id&#x27;)-&gt;on(&#x27;users&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>你还可以为约束的<code>on delete</code>和<code>on update</code>属性指定期望的动作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$table-&gt;foreign(&#x27;user_id&#x27;)</span><br><span class="line">      -&gt;references(&#x27;id&#x27;)-&gt;on(&#x27;users&#x27;)</span><br><span class="line">      -&gt;onDelete(&#x27;cascade&#x27;);</span><br></pre></td></tr></table></figure>

<p>要删除一个外键，可以使用<code>dropForeign</code>方法。外键约束和索引使用同样的命名规则——连接表名、外键名然后加上<code>_foreign</code>后缀：</p>
<pre><code>$table-&gt;dropForeign(&#39;posts_user_id_foreign&#39;);
</code></pre>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/f1816657eb28/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/f1816657eb28/" class="post-title-link" itemprop="url">laravel 学习指南 第七章 第二节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 11:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T11:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/f1816657eb28/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/f1816657eb28/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="7-2-查询构建器"><a href="#7-2-查询构建器" class="headerlink" title="7.2 查询构建器"></a>7.2 查询构建器</h2><h3 id="7-2-1-简介"><a href="#7-2-1-简介" class="headerlink" title="7.2.1 简介"></a>7.2.1 简介</h3><p><code>数据库查询构建器</code>提供了一个方便的、平滑的接口来创建和运行<code>数据库查询</code>。<code>查询构建器</code>可以用于执行应用中大部分数据库操作，并且能够在支持的所有数据库系统上工作。</p>
<p><em>注意：Laravel 查询构建器使用<code> PDO 参数</code>绑定来避免 SQL 注入攻击，不再需要过滤传递到绑定的字符串。</em></p>
<hr>
<h3 id="7-2-2-获取结果集"><a href="#7-2-2-获取结果集" class="headerlink" title="7.2.2 获取结果集"></a>7.2.2 获取结果集</h3><h4 id="7-2-2-1-从一张表中取出所有行"><a href="#7-2-2-1-从一张表中取出所有行" class="headerlink" title="7.2.2.1 从一张表中取出所有行"></a>7.2.2.1 从一张表中取出所有行</h4><p>在查询之前，使用<code>DB门面</code>的<code>table</code>方法，<code>table</code>方法为给定表返回一个查询构建器，允许你在查询上链接更多约束条件并最终返回查询结果。在本例中，我们使用<code>get</code>方法获取表中所有记录：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">DB</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示用户列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;get();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">&#x27;user.index&#x27;</span>, [<span class="string">&#x27;users&#x27;</span> =&gt; <span class="variable">$users</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和原生查询一样，get方法返回结果集的数组，其中每一个结果都是PHP对象的StdClass实例。你可以像访问对象的属性一样访问列的值：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$user</span>-&gt;name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-2-2-2-从一张表中获取一行-一列"><a href="#7-2-2-2-从一张表中获取一行-一列" class="headerlink" title="7.2.2.2 从一张表中获取一行/一列"></a>7.2.2.2 从一张表中获取一行/一列</h4><p>如果你只是想要从数据表中获取一行数据，可以使用<code>first</code>方法，该方法将会返回单个<code>StdClass</code>对象：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$user</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;where(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;John&#x27;</span>)-&gt;first();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$user</span>-&gt;name;</span><br></pre></td></tr></table></figure>
<p>如果你不需要完整的一行，可以使用value方法从结果中获取单个值，该方法会直接返回指定列的值：</p>
<pre><code>$email = DB::table(&#39;users&#39;)-&gt;where(&#39;name&#39;, &#39;John&#39;)-&gt;value(&#39;email&#39;);
</code></pre>
<h4 id="7-2-2-3-从一张表中获取组块结果集"><a href="#7-2-2-3-从一张表中获取组块结果集" class="headerlink" title="7.2.2.3 从一张表中获取组块结果集"></a>7.2.2.3 从一张表中获取组块结果集</h4><p>如果你需要处理成千上百条数据库记录，可以考虑使用<code>chunk</code>方法，该方法一次获取结果集的一小块，然后填充每一小块数据到要处理的闭包，该方法在编写处理大量数据库记录的 <code>Artisan 命令</code>的时候非常有用。</p>
<p>例如：我们可以将处理全部 <code>users</code> 表数据，处理成一次处理 100 条记录的小组块：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;chunk(<span class="number">100</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$users</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>你可以通过从闭包函数中返回false来中止组块的运行：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;chunk(<span class="number">100</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$users</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 处理结果集...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="7-2-2-4-获取数据列值列表"><a href="#7-2-2-4-获取数据列值列表" class="headerlink" title="7.2.2.4 获取数据列值列表"></a>7.2.2.4 获取数据列值列表</h4><h4 id="7-2-2-5-聚合函数"><a href="#7-2-2-5-聚合函数" class="headerlink" title="7.2.2.5 聚合函数"></a>7.2.2.5 聚合函数</h4><p>队列构建器还提供了很多聚合方法，比如<code>count</code>, <code>max</code>, <code>min</code>, <code>avg</code>, 和 <code>sum</code>，你可以在构造查询之后调用这些方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;count();</span><br><span class="line"><span class="variable">$price</span> = DB::table(<span class="string">&#x27;orders&#x27;</span>)-&gt;max(<span class="string">&#x27;price&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>当然，你可以联合其它查询子句和聚合函数来构建查询：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$price</span> = DB::table(<span class="string">&#x27;orders&#x27;</span>)</span><br><span class="line">                -&gt;where(<span class="string">&#x27;finalized&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">                -&gt;avg(<span class="string">&#x27;price&#x27;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-2-3-查询（Select）"><a href="#7-2-3-查询（Select）" class="headerlink" title="7.2.3 查询（Select）"></a>7.2.3 查询（Select）</h3><h4 id="7-2-3-1-指定查询子句"><a href="#7-2-3-1-指定查询子句" class="headerlink" title="7.2.3.1 指定查询子句"></a>7.2.3.1 指定查询子句</h4><p>当然，我们并不总是想要获取数据表的所有列，使用<code>select</code>方法，你可以为查询指定自定义的<code>select</code>子句：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;select(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;email as user_email&#x27;</span>)-&gt;get();</span><br></pre></td></tr></table></figure>

<p><code>distinct</code>方法允许你强制查询返回不重复的结果集：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;distinct()-&gt;get();</span><br></pre></td></tr></table></figure>
<p>如果你已经有了一个查询构建器实例并且希望添加一个查询列到已存在的<code>select</code>子句，可以使用<code>addSelect</code>方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$query</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;select(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="variable">$users</span> = <span class="variable">$query</span>-&gt;addSelect(<span class="string">&#x27;age&#x27;</span>)-&gt;get();</span><br></pre></td></tr></table></figure>
<h4 id="7-2-3-2-原生表达式"><a href="#7-2-3-2-原生表达式" class="headerlink" title="7.2.3.2 原生表达式"></a>7.2.3.2 原生表达式</h4><p>有时候你希望在查询中使用原生表达式，这些表达式将会以字符串的形式注入到查询中，所以要格外小心避免被 SQL 注入。想要创建一个原生表达式，可以使用<code>DB::raw</code>方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                     -&gt;select(DB::raw(<span class="string">&#x27;count(*) as user_count, status&#x27;</span>))</span><br><span class="line">                     -&gt;where(<span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;&lt;&gt;&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">                     -&gt;groupBy(<span class="string">&#x27;status&#x27;</span>)</span><br><span class="line">                     -&gt;get();</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-2-4-连接（Join）"><a href="#7-2-4-连接（Join）" class="headerlink" title="7.2.4 连接（Join）"></a>7.2.4 连接（Join）</h3><h4 id="7-2-4-1-内连接（等值连接）"><a href="#7-2-4-1-内连接（等值连接）" class="headerlink" title="7.2.4.1 内连接（等值连接）"></a>7.2.4.1 内连接（等值连接）</h4><p>查询构建器还可以用于编写基本的SQL“内连接”，你可以使用查询构建器实例上的<code>join</code>方法，传递给<code>join</code>方法的第一次参数是你需要连接到的表名，剩余的其它参数则是为连接指定的列约束，当然，正如你所看到的，你可以在单个查询中连接多张表：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;join(<span class="string">&#x27;contacts&#x27;</span>, <span class="string">&#x27;users.id&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;contacts.user_id&#x27;</span>)</span><br><span class="line">            -&gt;join(<span class="string">&#x27;orders&#x27;</span>, <span class="string">&#x27;users.id&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;orders.user_id&#x27;</span>)</span><br><span class="line">            -&gt;select(<span class="string">&#x27;users.*&#x27;</span>, <span class="string">&#x27;contacts.phone&#x27;</span>, <span class="string">&#x27;orders.price&#x27;</span>)</span><br><span class="line">            -&gt;get();</span><br></pre></td></tr></table></figure>

<h4 id="7-2-4-2-左连接"><a href="#7-2-4-2-左连接" class="headerlink" title="7.2.4.2 左连接"></a>7.2.4.2 左连接</h4><p>如果你是想要执行“左连接”而不是“内连接”，可以使用<code>leftJoin</code>方法。该方法和<code>join</code>方法的使用方法一样：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;leftJoin(<span class="string">&#x27;posts&#x27;</span>, <span class="string">&#x27;users.id&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;posts.user_id&#x27;</span>)</span><br><span class="line">            -&gt;get();</span><br></pre></td></tr></table></figure>

<h4 id="7-2-4-3-高级连接语句"><a href="#7-2-4-3-高级连接语句" class="headerlink" title="7.2.4.3 高级连接语句"></a>7.2.4.3 高级连接语句</h4><p>你还可以指定更多的高级连接子句，传递一个闭包到<code>join</code>方法作为该方法的第2个参数，该闭包将会返回允许你指定<code>join</code>子句约束的<code>JoinClause</code>对象：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">        -&gt;join(<span class="string">&#x27;contacts&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$join</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$join</span>-&gt;on(<span class="string">&#x27;users.id&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;contacts.user_id&#x27;</span>)-&gt;orOn(...);</span><br><span class="line">        &#125;)</span><br><span class="line">        -&gt;get();</span><br></pre></td></tr></table></figure>
<p>如果你想要在连接中使用“where”风格的子句，可以在查询中使用<code>where</code>和<code>orWhere</code>方法。这些方法将会将列和值进行比较而不是列和列进行比较：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">        -&gt;join(<span class="string">&#x27;contacts&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$join</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$join</span>-&gt;on(<span class="string">&#x27;users.id&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;contacts.user_id&#x27;</span>)</span><br><span class="line">                 -&gt;where(<span class="string">&#x27;contacts.user_id&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">5</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        -&gt;get();</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-2-5-联合（Union）"><a href="#7-2-5-联合（Union）" class="headerlink" title="7.2.5 联合（Union）"></a>7.2.5 联合（Union）</h3><p>查询构建器还提供了一条“联合”两个查询的快捷方式.</p>
<p>例如：你要创建一个独立的查询，然后使用<code>union</code>方法将其和第二个查询进行联合：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$first</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;whereNull(<span class="string">&#x27;first_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;whereNull(<span class="string">&#x27;last_name&#x27;</span>)</span><br><span class="line">            -&gt;union(<span class="variable">$first</span>)</span><br><span class="line">            -&gt;get();</span><br></pre></td></tr></table></figure>
<p><code>unionAll</code>方法也是有效的，并且和<code>union</code>有同样的使用方法。</p>
<hr>
<h3 id="7-2-6-Where子句"><a href="#7-2-6-Where子句" class="headerlink" title="7.2.6 Where子句"></a>7.2.6 Where子句</h3><h4 id="7-2-6-1-简单where子句"><a href="#7-2-6-1-简单where子句" class="headerlink" title="7.2.6.1 简单where子句"></a>7.2.6.1 简单where子句</h4><p>使用查询构建器上的<code>where</code>方法可以添加<code>where</code>子句到查询中，调用<code>where</code>最基本的方法需要三个参数，第一个参数是列名，第二个参数是一个数据库系统支持的任意操作符，第三个参数是该列要比较的值。</p>
<p>例如，下面是一个验证<code>votes</code>列的值是否等于100的查询：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;where(<span class="string">&#x27;votes&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="number">100</span>)-&gt;get();</span><br></pre></td></tr></table></figure>
<p>为了方便，如果你只是简单比较列值和给定数值是否相等，可以将数值直接作为<code>where</code>方法的第二个参数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;where(<span class="string">&#x27;votes&#x27;</span>, <span class="number">100</span>)-&gt;get();</span><br></pre></td></tr></table></figure>
<p>当然，你可以使用其它操作符来编写<code>where</code>子句：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                -&gt;where(<span class="string">&#x27;votes&#x27;</span>, <span class="string">&#x27;&gt;=&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">                -&gt;get();</span><br><span class="line"></span><br><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                -&gt;where(<span class="string">&#x27;votes&#x27;</span>, <span class="string">&#x27;&lt;&gt;&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">                -&gt;get();</span><br><span class="line"></span><br><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                -&gt;where(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;T%&#x27;</span>)</span><br><span class="line">                -&gt;get();</span><br></pre></td></tr></table></figure>


<h4 id="7-2-6-2-or"><a href="#7-2-6-2-or" class="headerlink" title="7.2.6.2 or"></a>7.2.6.2 or</h4><p>你可以通过方法链将多个<code>where</code>约束链接到一起，也可以添加<code>or</code>子句到查询，<code>orWhere</code>方法和<code>where</code>方法接收参数一样：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;where(<span class="string">&#x27;votes&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">                    -&gt;orWhere(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;John&#x27;</span>)</span><br><span class="line">                    -&gt;get();</span><br></pre></td></tr></table></figure>

<h4 id="7-2-6-3-更多Where子句"><a href="#7-2-6-3-更多Where子句" class="headerlink" title="7.2.6.3 更多Where子句"></a>7.2.6.3 更多Where子句</h4><ul>
<li><p><strong>whereBetween</strong></p>
<p>  <code>whereBetween</code>方法验证列值是否在给定值之间：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;whereBetween(<span class="string">&#x27;votes&#x27;</span>, [<span class="number">1</span>, <span class="number">100</span>])-&gt;get();</span><br></pre></td></tr></table></figure></li>
<li><p><strong>whereNotBetween</strong></p>
<p>  <code>whereNotBetween</code>方法验证列值不在给定值之间：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;whereNotBetween(<span class="string">&#x27;votes&#x27;</span>, [<span class="number">1</span>, <span class="number">100</span>])</span><br><span class="line">                    -&gt;get();</span><br></pre></td></tr></table></figure></li>
<li><p><strong>whereIn/whereNotIn</strong></p>
<p>  <code>whereIn</code>方法验证给定列的值是否在给定数组中：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;whereIn(<span class="string">&#x27;id&#x27;</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">                    -&gt;get();</span><br></pre></td></tr></table></figure>
<p>  <code>whereNotIn</code>方法验证给定列的值不在给定数组中：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;whereNotIn(<span class="string">&#x27;id&#x27;</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">                    -&gt;get();</span><br></pre></td></tr></table></figure></li>
<li><p><strong>whereNull/whereNotNull</strong></p>
<p>  <code>whereNull</code>方法验证给定列的值为NULL：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;whereNull(<span class="string">&#x27;updated_at&#x27;</span>)</span><br><span class="line">                    -&gt;get();</span><br></pre></td></tr></table></figure>
<p>  <code>whereNotNull</code>方法验证给定列的值不是NULL：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;whereNotNull(<span class="string">&#x27;updated_at&#x27;</span>)</span><br><span class="line">                    -&gt;get();</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="7-2-6-4-高级Where子句"><a href="#7-2-6-4-高级Where子句" class="headerlink" title="7.2.6.4 高级Where子句"></a>7.2.6.4 高级Where子句</h4><ul>
<li><p><strong>参数分组</strong></p>
<p>  有时候你需要创建更加高级的<code>where</code>子句,比如<code>where exists</code>或者嵌套的参数分组。Laravel查询构建器也可以处理这些。作为开始，让我们看一个在括号中进行分组约束的例子：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;where(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;John&#x27;</span>)</span><br><span class="line">            -&gt;orWhere(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">                <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;votes&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">                      -&gt;where(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;&lt;&gt;&#x27;</span>, <span class="string">&#x27;Admin&#x27;</span>);</span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;get();</span><br></pre></td></tr></table></figure>
<p>  正如你所看到的，传递闭包到<code>orWhere</code>方法构造查询构建器来开始一个约束分组，该闭包将会获取一个用于设置括号中包含的约束的查询构建器实例。上述语句等价于下面的SQL：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span> users where name = <span class="string">&#x27;John&#x27;</span> <span class="keyword">or</span> (votes &gt; <span class="number">100</span> <span class="keyword">and</span> title &lt;&gt; <span class="string">&#x27;Admin&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p><strong>exists语句</strong></p>
<p>  <code>whereExists</code>方法允许你编写<code>where exist</code>SQL子句，<code>whereExists</code>方法接收一个闭包参数，该闭包获取一个查询构建器实例从而允许你定义放置在<code>exists</code>子句中的查询：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;whereExists(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">                <span class="variable">$query</span>-&gt;select(DB::raw(<span class="number">1</span>))</span><br><span class="line">                      -&gt;from(<span class="string">&#x27;orders&#x27;</span>)</span><br><span class="line">                      -&gt;whereRaw(<span class="string">&#x27;orders.user_id = users.id&#x27;</span>);</span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;get();</span><br></pre></td></tr></table></figure>
<p>  上述查询等价于下面的SQL语句：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select * <span class="keyword">from</span> users</span><br><span class="line">where exists (</span><br><span class="line">    select <span class="number">1</span> <span class="keyword">from</span> orders where orders.user_id = users.id</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="7-2-7-排序、分组、限定"><a href="#7-2-7-排序、分组、限定" class="headerlink" title="7.2.7 排序、分组、限定"></a>7.2.7 排序、分组、限定</h3><h4 id="7-2-7-1-orderBy"><a href="#7-2-7-1-orderBy" class="headerlink" title="7.2.7.1 orderBy"></a>7.2.7.1 orderBy</h4><p><code>orderBy</code>方法允许你通过给定列对结果集进行排序，orderBy的第一个参数应该是你希望排序的列，第二个参数控制着排序的方向——<code>asc(正序)</code>或<code>desc(倒序)</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                -&gt;orderBy(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>)</span><br><span class="line">                -&gt;get();</span><br></pre></td></tr></table></figure>
<h4 id="7-2-7-2-groupBy-having-havingRaw"><a href="#7-2-7-2-groupBy-having-havingRaw" class="headerlink" title="7.2.7.2 groupBy / having / havingRaw"></a>7.2.7.2 groupBy / having / havingRaw</h4><p><code>groupBy</code>和<code>having</code>方法用于对结果集进行分组，<code>having</code>方法和<code>where</code>方法的用法类似：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                -&gt;groupBy(<span class="string">&#x27;account_id&#x27;</span>)</span><br><span class="line">                -&gt;having(<span class="string">&#x27;account_id&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">                -&gt;get();</span><br></pre></td></tr></table></figure>
<p><code>havingRaw</code>方法可以用于设置原生字符串作为<code>having</code>子句的值，例如，我们要找到所有售价大于<code>$2500</code>的部分：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;orders&#x27;</span>)</span><br><span class="line">                -&gt;select(<span class="string">&#x27;department&#x27;</span>, DB::raw(<span class="string">&#x27;SUM(price) as total_sales&#x27;</span>))</span><br><span class="line">                -&gt;groupBy(<span class="string">&#x27;department&#x27;</span>)</span><br><span class="line">                -&gt;havingRaw(<span class="string">&#x27;SUM(price) &gt; 2500&#x27;</span>)</span><br><span class="line">                -&gt;get();</span><br></pre></td></tr></table></figure>

<h4 id="7-2-7-3-skip-take"><a href="#7-2-7-3-skip-take" class="headerlink" title="7.2.7.3 skip / take"></a>7.2.7.3 skip / take</h4><p>想要限定查询返回的结果集的数目，或者在查询中跳过给定数目的结果，可以使用<code>skip</code>和<code>take</code>方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;skip(<span class="number">10</span>)-&gt;take(<span class="number">5</span>)-&gt;get();</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-2-8-插入（Insert）"><a href="#7-2-8-插入（Insert）" class="headerlink" title="7.2.8 插入（Insert）"></a>7.2.8 插入（Insert）</h3><p>查询构建器还提供了<code>insert</code>方法来插入记录到数据表。<code>insert</code>方法接收数组形式的列名和值进行插入操作：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;insert(</span><br><span class="line">    [<span class="string">&#x27;email&#x27;</span> =&gt; <span class="string">&#x27;john@example.com&#x27;</span>, <span class="string">&#x27;votes&#x27;</span> =&gt; <span class="number">0</span>]);</span><br></pre></td></tr></table></figure>
<p>你甚至可以一次性通过传入多个数组来插入多条记录，每个数组代表要插入数据表的记录：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;insert([</span><br><span class="line">    [<span class="string">&#x27;email&#x27;</span> =&gt; <span class="string">&#x27;taylor@example.com&#x27;</span>, <span class="string">&#x27;votes&#x27;</span> =&gt; <span class="number">0</span>],</span><br><span class="line">    [<span class="string">&#x27;email&#x27;</span> =&gt; <span class="string">&#x27;dayle@example.com&#x27;</span>, <span class="string">&#x27;votes&#x27;</span> =&gt; <span class="number">0</span>]</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h4 id="7-2-8-1-自增ID"><a href="#7-2-8-1-自增ID" class="headerlink" title="7.2.8.1 自增ID"></a>7.2.8.1 自增ID</h4><p>如果数据表有自增ID，使用<code>insertGetId</code>方法来插入记录将会返回ID值：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;insertGetId(</span><br><span class="line">    [<span class="string">&#x27;email&#x27;</span> =&gt; <span class="string">&#x27;john@example.com&#x27;</span>, <span class="string">&#x27;votes&#x27;</span> =&gt; <span class="number">0</span>]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><em>注意：当使用<code>PostgresSQL</code>时,<code>insertGetId</code>方法默认自增列被命名为<code>id</code>，如果你想要从其他<code>序列</code>获取<code>ID</code>，可以将序列名作为第二个参数传递到<code>insertGetId</code>方法。</em></p>
<hr>
<h3 id="7-2-9-更新（Update）"><a href="#7-2-9-更新（Update）" class="headerlink" title="7.2.9 更新（Update）"></a>7.2.9 更新（Update）</h3><p>当然，除了插入记录到数据库，查询构建器还可以通过使用<code>update</code>方法更新已有记录。<code>update</code>方法和<code>insert</code>方法一样，接收列和值的键值对数组包含要更新的列，你可以通过<code>where</code>子句来对<code>update</code>查询进行约束：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;where(<span class="string">&#x27;id&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">            -&gt;update([<span class="string">&#x27;votes&#x27;</span> =&gt; <span class="number">1</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="7-2-9-1-增加-减少"><a href="#7-2-9-1-增加-减少" class="headerlink" title="7.2.9.1 增加/减少"></a>7.2.9.1 增加/减少</h4><p>查询构建器还提供了方便增减给定列名数值的方法。相较于编写<code>update</code>语句，这是一条捷径，提供了更好的体验和测试接口。</p>
<p>这两个方法都至少接收一个参数：需要修改的列。第二个参数是可选的，用于控制列值增加/减少的数目。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;increment(<span class="string">&#x27;votes&#x27;</span>);</span><br><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;increment(<span class="string">&#x27;votes&#x27;</span>, <span class="number">5</span>);</span><br><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;decrement(<span class="string">&#x27;votes&#x27;</span>);</span><br><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;decrement(<span class="string">&#x27;votes&#x27;</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<p>在操作过程中你还可以指定额外的列进行更新：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DB::table(&#x27;users&#x27;)-&gt;increment(&#x27;votes&#x27;, 1, [&#x27;name&#x27; =&gt; &#x27;John&#x27;]);</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="7-2-10-删除（Delete）"><a href="#7-2-10-删除（Delete）" class="headerlink" title="7.2.10 删除（Delete）"></a>7.2.10 删除（Delete）</h3><p>当然，查询构建器还可以通过<code>delete</code>方法从表中删除记录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DB::table(&#x27;users&#x27;)-&gt;delete();</span><br></pre></td></tr></table></figure>
<p>在调用<code>delete</code>方法之前可以通过添加<code>where</code>子句对<code>delete</code>语句进行约束：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DB::table(&#x27;users&#x27;)-&gt;where(&#x27;votes&#x27;, &#x27;&lt;&#x27;, 100)-&gt;delete();</span><br></pre></td></tr></table></figure>
<p>如果你希望清除整张表，也就是删除所有列并将自增ID置为0，可以使用truncate方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DB::table(&#x27;users&#x27;)-&gt;truncate();</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-2-11-悲观锁"><a href="#7-2-11-悲观锁" class="headerlink" title="7.2.11 悲观锁"></a>7.2.11 悲观锁</h3><p>查询构建器还包含一些方法帮助你在<code>select</code>语句中实现<code>悲观锁</code>。可以在查询中使用<code>sharedLock</code>方法从而在运行语句时带一把<code>共享锁</code>。共享锁可以避免,被选择的行被修改直到事务提交：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DB::table(&#x27;users&#x27;)-&gt;where(&#x27;votes&#x27;, &#x27;&gt;&#x27;, 100)-&gt;sharedLock()-&gt;get();</span><br></pre></td></tr></table></figure>
<p>此外你还可以使用<code>lockForUpdate</code>方法。<code>for update</code>锁避免选择行被其它共享锁修改或删除：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DB::table(&#x27;users&#x27;)-&gt;where(&#x27;votes&#x27;, &#x27;&gt;&#x27;, 100)-&gt;lockForUpdate()-&gt;get();</span><br></pre></td></tr></table></figure>

<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/fb9d8bedfd30/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/fb9d8bedfd30/" class="post-title-link" itemprop="url">laravel 学习指南 第七章 第一节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 10:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T10:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/fb9d8bedfd30/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/fb9d8bedfd30/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="7-数据库"><a href="#7-数据库" class="headerlink" title="7 数据库"></a>7 数据库</h2><h2 id="7-1-起步"><a href="#7-1-起步" class="headerlink" title="7.1 起步"></a>7.1 起步</h2><h3 id="7-1-1-简介"><a href="#7-1-1-简介" class="headerlink" title="7.1.1 简介"></a>7.1.1 简介</h3><p>Laravel 让连接多种数据库以及对数据库进行查询变得非常简单，不论使用原生 SQL、还是查询构建器，还是 Eloquent ORM。目前，Laravel 支持四种类型的数据库系统：</p>
<ul>
<li>MySQL</li>
<li>Postgres</li>
<li>SQLite</li>
<li>SQL Server</li>
</ul>
<h4 id="7-1-1-1-配置"><a href="#7-1-1-1-配置" class="headerlink" title="7.1.1.1 配置"></a>7.1.1.1 配置</h4><p>Laravel 让连接数据库和运行查询都变得非常简单。应用的数据库配置位于<code>config/database.php</code>。在该文件中你可以定义所有的数据库连接，并指定哪个连接是默认连接。该文件中提供了所有支持数据库系统的配置示例。</p>
<p>默认情况下，Laravel 示例环境配置已经为 Laravel Homestead 做好了设置，当然，你也可以按照需要为本地的数据库修改该配置。</p>
<ul>
<li><strong>读/写连接</strong></li>
</ul>
<p>有时候你希望使用一个数据库连接做查询，另一个数据库连接做插入、更新和删除，Laravel 使得这件事情轻而易举，不管你用的是原生 SQL，还是查询构建器，还是 Eloquent ORM，合适的连接总是会被使用。</p>
<p>想要知道如何配置读/写连接，让我们看看下面这个例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;mysql&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;read&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;host&#x27;</span> =&gt; <span class="string">&#x27;192.168.1.1&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;write&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;host&#x27;</span> =&gt; <span class="string">&#x27;196.168.1.2&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;driver&#x27;</span>    =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;database&#x27;</span>  =&gt; <span class="string">&#x27;database&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>  =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;charset&#x27;</span>   =&gt; <span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;collation&#x27;</span> =&gt; <span class="string">&#x27;utf8_unicode_ci&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;prefix&#x27;</span>    =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p>注意我们在配置数组中新增了两个键：read和write，这两个键都对应一个包含单个键“host”的数组，读/写连接的其它数据库配置选项都共用 mysql 的主数组配置。</p>
<p>如果我们想要覆盖主数组中的配置，只需要将相应配置项放到<code>read</code>和<code>write</code>数组中即可。在本例中，<code>192.168.1.1</code>将被用作“读”连接，而<code>192.168.1.2</code>将被用作“写”连接。两个数据库连接的凭证（用户名/密码）、前缀、字符集以及其它配置将会共享<code>mysql</code>数组中的设置。</p>
<hr>
<h3 id="7-1-2-运行原生-SQL-查询"><a href="#7-1-2-运行原生-SQL-查询" class="headerlink" title="7.1.2 运行原生 SQL 查询"></a>7.1.2 运行原生 SQL 查询</h3><p>配置好数据库连接后，就可以使用<code>DB门</code>面来运行查询。<code>DB门面</code>为每种查询提供了相应方法：<code>select</code>, <code>update</code>, <code>insert</code>, <code>delete</code>, 和<code>statement</code>。</p>
<h4 id="7-1-2-1-运行-Select-查询"><a href="#7-1-2-1-运行-Select-查询" class="headerlink" title="7.1.2.1 运行 Select 查询"></a>7.1.2.1 运行 Select 查询</h4><p>运行一个最基本的查询，可以使用<code>DB门面</code>的<code>select</code>方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">DB</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示用户列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$users</span> = DB::select(<span class="string">&#x27;select * from users where active = ?&#x27;</span>, [<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">&#x27;user.index&#x27;</span>, [<span class="string">&#x27;users&#x27;</span> =&gt; <span class="variable">$users</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>传递给<code>select</code>方法的第一个参数是原生的<code>SQL</code>语句，第二个参数需要绑定到查询的参数绑定，通常，这些都是<code>where</code>字句约束中的值。参数绑定可以避免<code>SQL</code>注入攻击。</p>
<p><code>select</code>方法以数组的形式返回结果，数组中的每一个结果都是一个PHP <code>StdClass</code>对象，从而允许你像下面这样访问结果值：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$user</span>-&gt;name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-1-2-2-使用命名绑定"><a href="#7-1-2-2-使用命名绑定" class="headerlink" title="7.1.2.2 使用命名绑定"></a>7.1.2.2 使用命名绑定</h4><p>除了使用?占位符来代表参数绑定外，还可以使用命名绑定来执行查询:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$results</span> = DB::select(<span class="string">&#x27;select * from users where id = :id&#x27;</span>, [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">1</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="7-1-2-3-运行插入语句"><a href="#7-1-2-3-运行插入语句" class="headerlink" title="7.1.2.3 运行插入语句"></a>7.1.2.3 运行插入语句</h4><p>使用<code>DB门面</code>的<code>insert</code>方法执行插入语句。和<code>select</code>一样，改方法将原生SQL语句作为第一个参数，将绑定作为第二个参数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$results</span> = DB::insert(<span class="string">&#x27;insert into users (id, name) values (?, ?)&#x27;</span>, [<span class="number">1</span>, <span class="string">&#x27;Dayle&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="7-1-2-4-运行更新语句"><a href="#7-1-2-4-运行更新语句" class="headerlink" title="7.1.2.4 运行更新语句"></a>7.1.2.4 运行更新语句</h4><p><code>update</code>方法用于更新数据库中已存在的记录，该方法返回受更新语句影响的行数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$affected</span> = DB::update(<span class="string">&#x27;update users set votes = 100 where name = ?&#x27;</span>, [<span class="string">&#x27;John&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="7-1-2-5-运行删除语句"><a href="#7-1-2-5-运行删除语句" class="headerlink" title="7.1.2.5 运行删除语句"></a>7.1.2.5 运行删除语句</h4><p><code>delete</code>方法用于删除数据库中已存在的记录，和<code>update</code>一样，该语句返回被删除的行数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$deleted</span> = DB::delete(<span class="string">&#x27;delete from users&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="7-1-2-6-运行一个通用语句"><a href="#7-1-2-6-运行一个通用语句" class="headerlink" title="7.1.2.6 运行一个通用语句"></a>7.1.2.6 运行一个通用语句</h4><p>有些数据库语句不返回任何值，对于这种类型的操作，可以使用<code>DB门面</code>的<code>statement</code>方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DB::statement(<span class="string">&#x27;drop table users&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="7-1-2-7-监听查询事件"><a href="#7-1-2-7-监听查询事件" class="headerlink" title="7.1.2.7 监听查询事件"></a>7.1.2.7 监听查询事件</h4><p>如果你想要获取应用中每次 SQL 语句的执行，可以使用<code>listen</code>方法，该方法对查询日志和调试非常有用，你可以在服务提供者中注册查询监听器：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">DB</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动所有应用服务</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        DB::listen(<span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// $query-&gt;sql</span></span><br><span class="line">            <span class="comment">// $query-&gt;bindings</span></span><br><span class="line">            <span class="comment">// $query-&gt;time</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册服务提供者</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-1-3-数据库事务"><a href="#7-1-3-数据库事务" class="headerlink" title="7.1.3 数据库事务"></a>7.1.3 数据库事务</h3><p>想要在一个数据库事务中运行一连串操作，可以使用<code>DB门面</code>的<code>transaction</code>方法，如果事务闭包中抛出异常，事务将会自动回滚。</p>
<p>如果闭包执行成功，事务将会自动提交。使用<code>transaction</code>方法时不需要担心手动回滚或提交：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DB::transaction(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;update([<span class="string">&#x27;votes&#x27;</span> =&gt; <span class="number">1</span>]);</span><br><span class="line">    DB::table(<span class="string">&#x27;posts&#x27;</span>)-&gt;delete();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="7-1-3-1-手动使用事务"><a href="#7-1-3-1-手动使用事务" class="headerlink" title="7.1.3.1 手动使用事务"></a>7.1.3.1 手动使用事务</h4><p>如果你想要手动开始事务从而对回滚和提交有一个完整的控制，可以使用<code>DB门面</code>的<code>beginTransaction</code>方法：</p>
<pre><code>DB::beginTransaction();
</code></pre>
<p>你可以通过<code>rollBack</code>方法回滚事务：</p>
<pre><code>DB::rollBack();
</code></pre>
<p>最后，可以通过<code>commit</code>方法提交事务：</p>
<pre><code>DB::commit();
</code></pre>
<p><em>注意：使用<code>DB门面</code>的事务方法还可以用于控制查询构建器和 <code>Eloquent ORM</code> 的事务。</em></p>
<hr>
<h3 id="7-1-4-使用多个数据库连接"><a href="#7-1-4-使用多个数据库连接" class="headerlink" title="7.1.4 使用多个数据库连接"></a>7.1.4 使用多个数据库连接</h3><p>使用多个数据库连接的时候，可以使用<code>DB门面</code>的<code>connection</code>方法访问每个连接。传递给<code>connection</code>方法的连接名对应配置文件<code>config/database.php</code>中相应的连接：</p>
<pre><code>$users = DB::connection(&#39;foo&#39;)-&gt;select(...);
</code></pre>
<p>你还可以通过连接实例上的<code>getPdo</code>方法底层原生的 PDO 实例：</p>
<pre><code>$pdo = DB::connection()-&gt;getPdo();
</code></pre>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/93c105dd03b6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/93c105dd03b6/" class="post-title-link" itemprop="url">laravel 学习指南 第六章 第六节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 09:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T09:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/93c105dd03b6/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/93c105dd03b6/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-6-合约"><a href="#6-6-合约" class="headerlink" title="6.6 合约"></a>6.6 合约</h2><h3 id="6-6-1-简介"><a href="#6-6-1-简介" class="headerlink" title="6.6.1 简介"></a>6.6.1 简介</h3><p>Laravel的合约是一组由框架(framework)提供的核心服务接口。</p>
<p>例如：</p>
<p><code>Illuminate\Contracts\Queue\Queue</code>合约规定，列队工作需要的方法。</p>
<p><code>Illuminate\Contracts\Mail\Mailer</code>合约规定，发送电子邮件的方法。</p>
<p>每个合约都有框架提供的，相应的实现方法。</p>
<p>例如：</p>
<p>Laravel提供一个列队实现方法与各种驱动，和一个由<code>SwiftMailer</code>提供的邮件接收服务。</p>
<p>所有的Laravel合约都在各自的<code>github</code>仓库中更新。这为所有的合约，提供了一个快速参考点，以及一个单一的分离包，用于包开发。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts">Github参考点</a>。</p>
<h4 id="6-6-1-1-合约Vs-门面"><a href="#6-6-1-1-合约Vs-门面" class="headerlink" title="6.6.1.1 合约Vs.门面"></a>6.6.1.1 合约Vs.门面</h4><p>Laravel的门面提供一种简单的方法，利用Laravel服务无须输入和提示。这好于使用需要服务容器的合约方法。</p>
<p>但是，使用合约运行你定义依赖类。多余大多数应用，使用门面就好了。</p>
<p>但是，如果你真有的需要额外的松耦合，合约就可以提供，阅读下面的了解更多。</p>
<h3 id="6-6-2-为什么用合约？"><a href="#6-6-2-为什么用合约？" class="headerlink" title="6.6.2 为什么用合约？"></a>6.6.2 为什么用合约？</h3><p>关于合约你可能有几个问题要问。为什么全部使用接口？不使用接口会更复杂？</p>
<p>下方是使用接口的重要原因：<code>松耦合</code>与<code>简洁性</code></p>
<h4 id="6-6-2-1-松耦合"><a href="#6-6-2-1-松耦合" class="headerlink" title="6.6.2.1  松耦合"></a>6.6.2.1  松耦合</h4><p>首先，让我们来看一个使用紧耦合缓存实现方法的代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Orders</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The cache instance.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$cache</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new repository instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \SomePackage\Cache\Memcached  $cache</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">\SomePackage\Cache\Memcached <span class="variable">$cache</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;cache = <span class="variable">$cache</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve an Order by ID.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Order</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">find</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;cache-&gt;has(<span class="variable">$id</span>))    &#123;</span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这这个类中，代码是使用紧耦合，到给定的缓存实现方法。</p>
<p>因为是从一个包中取得缓存，所以这是一个紧耦合。</p>
<p>如果这个包的API发生了改变，我们的代码也要随之改变。</p>
<p>同样的，如果我们要使用其他技术(例如：redis)，取代正在使用的技术(Memcached),我们还是要修改代码。</p>
<p>我们的类不应该用这些设定，例如，谁为他们提供数据，它是如何提供的等等。</p>
<p>使用下方松耦合方法，不需要绑定注入，进而优化代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Orders</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Cache</span>\<span class="title">Repository</span> <span class="title">as</span> <span class="title">Cache</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The cache instance.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$cache</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new repository instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  Cache  $cache</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Cache <span class="variable">$cache</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;cache = <span class="variable">$cache</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在代码没有连接任何的服务提供者，甚至Laravel。由于合约包中没有实现方法也没有依赖关系，你可以很容易的替换合约，更换缓存技术，而无需修改代码。</p>
<h4 id="6-6-2-2-简洁性"><a href="#6-6-2-2-简洁性" class="headerlink" title="6.6.2.2 简洁性"></a>6.6.2.2 简洁性</h4><p>当所有的Laravel的服务，在简单接口中整洁的定义，就可以很容易的给定服务提供的功能。</p>
<p>合约服务为框架功能提了简洁的文档。</p>
<p>当你使用简单接口时，你的代码更容易理解和维护。</p>
<h3 id="6-6-3-合约参考"><a href="#6-6-3-合约参考" class="headerlink" title="6.6.3 合约参考"></a>6.6.3 合约参考</h3><table>
<thead>
<tr>
<th align="left">合约</th>
<th align="left">参考的门面</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Auth/Factory.php">Illuminate\Contracts\Auth\Factory</a></td>
<td align="left">Auth</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Auth/PasswordBroker.php">Illuminate\Contracts\Auth\PasswordBroker</a></td>
<td align="left">Password</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Bus/Dispatcher.php">Illuminate\Contracts\Bus\Dispatcher</a></td>
<td align="left">Bus</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Broadcasting/Broadcaster.php">Illuminate\Contracts\Broadcasting\Broadcaster</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Cache/Repository.php">Illuminate\Contracts\Cache\Repository</a></td>
<td align="left">Cache</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Cache/Factory.php">Illuminate\Contracts\Cache\Factory</a></td>
<td align="left">Cache::driver()</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Config/Repository.php">Illuminate\Contracts\Config\Repository</a></td>
<td align="left">Config</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Container/Container.php">Illuminate\Contracts\Container\Container</a></td>
<td align="left">App</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Cookie/Factory.php">Illuminate\Contracts\Cookie\Factory</a></td>
<td align="left">Cookie</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Cookie/QueueingFactory.php">Illuminate\Contracts\Cookie\QueueingFactory</a></td>
<td align="left">Cookie::queue()</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Encryption/Encrypter.php">Illuminate\Contracts\Encryption\Encrypter</a></td>
<td align="left">Crypt</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Events/Dispatcher.php">Illuminate\Contracts\Events\Dispatcher</a></td>
<td align="left">Event</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Filesystem/Cloud.php">Illuminate\Contracts\Filesystem\Cloud</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Filesystem/Factory.php">Illuminate\Contracts\Filesystem\Factory</a></td>
<td align="left">File</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Filesystem/Filesystem.php">Illuminate\Contracts\Filesystem\Filesystem</a></td>
<td align="left">File</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Foundation/Application.php">Illuminate\Contracts\Foundation\Application</a></td>
<td align="left">App</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Hashing/Hasher.php">Illuminate\Contracts\Hashing\Hasher</a></td>
<td align="left">Hash</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Logging/Log.php">Illuminate\Contracts\Logging\Log</a></td>
<td align="left">Log</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Mail/MailQueue.php">Illuminate\Contracts\Mail\MailQueue</a></td>
<td align="left">Mail::queue()</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Mail/Mailer.php">Illuminate\Contracts\Mail\Mailer</a></td>
<td align="left">Mail</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Queue/Factory.php">Illuminate\Contracts\Queue\Factory</a></td>
<td align="left">Queue::driver()</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Queue/Queue.php">Illuminate\Contracts\Queue\Queue</a></td>
<td align="left">Queue</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Redis/Database.php">Illuminate\Contracts\Redis\Database</a></td>
<td align="left">Redis</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Routing/Registrar.php">Illuminate\Contracts\Routing\Registrar</a></td>
<td align="left">Route</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Routing/ResponseFactory.php">Illuminate\Contracts\Routing\ResponseFactory</a></td>
<td align="left">Response</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Routing/UrlGenerator.php">Illuminate\Contracts\Routing\UrlGenerator</a></td>
<td align="left">URL</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Support/Arrayable.php">Illuminate\Contracts\Support\Arrayable</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Support/Jsonable.php">Illuminate\Contracts\Support\Jsonable</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Support/Renderable.php">Illuminate\Contracts\Support\Renderable</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Validation/Factory.php">Illuminate\Contracts\Validation\Factory</a></td>
<td align="left">Validator::make()</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/Validation/Validator.php">Illuminate\Contracts\Validation\Validator</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/View/Factory.php">Illuminate\Contracts\View\Factory</a></td>
<td align="left">View::make()</td>
</tr>
<tr>
<td align="left"><a target="_blank" rel="noopener" href="https://github.com/illuminate/contracts/blob/master/View/View.php">Illuminate\Contracts\View\View</a></td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="6-6-4-如何使用合约"><a href="#6-6-4-如何使用合约" class="headerlink" title="6.6.4 如何使用合约"></a>6.6.4 如何使用合约</h3><p>那么，如果使用一个合约的实现方法？这其实很简单。</p>
<p>许多类型的Laravel类，是通过服务容器解决的，包括控制器，事件监听，中间件，列队甚至是路由。</p>
<p>要使用合约，只需要进行类型提示，注册类的接口函数。</p>
<p>例如：下面的事件监听器：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Listeners</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Events</span>\<span class="title">NewUserRegistered</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Redis</span>\<span class="title">Database</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheUserInformation</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Redis database implementation.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$redis</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new event handler instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  Database  $redis</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Database <span class="variable">$redis</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;redis = <span class="variable">$redis</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Handle the event.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  NewUserRegistered  $event</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">NewUserRegistered <span class="variable">$event</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当事件监听器运行完成，服务容器将读取构造函数的类型提示，并注入相应的值。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/ac4f8e8c42ad/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/ac4f8e8c42ad/" class="post-title-link" itemprop="url">laravel 学习指南 第六章 第五节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 08:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T08:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/ac4f8e8c42ad/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/ac4f8e8c42ad/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-5-门面"><a href="#6-5-门面" class="headerlink" title="6.5 门面"></a>6.5 门面</h2><h3 id="6-5-1-简介"><a href="#6-5-1-简介" class="headerlink" title="6.5.1 简介"></a>6.5.1 简介</h3><p>Facades为应用在服务容器中的绑定类，提供一个<code>静态</code>接口。</p>
<p><code>Laravel</code>附带许多<code>facades</code>，你可以在不知道的情况下正在使用它们。</p>
<p><code>Laravel</code>的门面作为服务容器中底层类的<code>静态代理</code>，相比于传统静态方法，在维护时能够提供更加易于测试，简明的语法。</p>
<hr>
<h3 id="6-5-2-使用门面"><a href="#6-5-2-使用门面" class="headerlink" title="6.5.2 使用门面"></a>6.5.2 使用门面</h3><p>在Laravel应用的上下文中，门面是一个提供访问容器中对象的类。该机制原理由<code>Facade</code>类实现，Laravel自带的门面，以及创建的自定义门面，都会继承自<code>Illuminate\Support\Facades\Facade</code>基类。</p>
<p>门面类只需要实现一个方法：<code>getFacadeAccessor</code>。<code>getFacadeAccessor</code> 方法定义了从容器中解析什么，然后 <code>Facade</code> 基类使用魔术方法 <code>__callStatic()</code> 从你的门面中调用解析对象。</p>
<p>下面的例子中，将会调用Laravel的缓存系统，浏览代码后，也许你会觉得我们调用了<code>Cache</code>的静态方法<code>get</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Cache</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为指定用户显示属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showProfile</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$user</span> = Cache::get(<span class="string">&#x27;user:&#x27;</span>.<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">&#x27;profile&#x27;</span>, [<span class="string">&#x27;user&#x27;</span> =&gt; <span class="variable">$user</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意我们在顶部位置引入<code>Cache</code>门面。该门面作为代理访问底层<code>Illuminate\Contracts\Cache\Factory</code>接口的实现方法。我们对门面的所有调用都会被传递给Laravel缓存服务的底层实例。</p>
<p>如果我们查看<code>Illuminate\Support\Facades\Cache</code>类的源码，将会发现其中并没有静态方法<code>get</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cache</span> <span class="keyword">extends</span> <span class="title">Facade</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取组件注册名称</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFacadeAccessor</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;cache&#x27;</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Cache</code>门面继承<code>Facade</code>基类并定义了<code>getFacadeAccessor</code>方法，该方法的工作就是返回服务容器绑定类的别名，当用户引用<code>Cache</code>类的任何静态方法时，Laravel从服务容器中解析<code>Cache</code>绑定，然后在解析出的对象上调用所有请求方法(本例中是<code>get</code>)。</p>
<hr>
<h3 id="6-5-3-门面类列表"><a href="#6-5-3-门面类列表" class="headerlink" title="6.5.3 门面类列表"></a>6.5.3 门面类列表</h3><p>下面列出了每个门面及其对应的底层类，这对深入给定门面的API文档而言是个很有用的工具。服务容器绑定键也被包含进来：</p>
<table>
<thead>
<tr>
<th align="left">门面</th>
<th align="left">类</th>
<th align="left">服务器绑定别名</th>
</tr>
</thead>
<tbody><tr>
<td align="left">App</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Foundation/Application.html">Illuminate\Foundation\Application</a></td>
<td align="left">app</td>
</tr>
<tr>
<td align="left">Artisan</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Contracts/Console/Kernel.html">Illuminate\Console\Application</a></td>
<td align="left">artisan</td>
</tr>
<tr>
<td align="left">Auth</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Auth/AuthManager.html">Illuminate\Auth\AuthManager</a></td>
<td align="left">auth</td>
</tr>
<tr>
<td align="left">Blade</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/View/Compilers/BladeCompiler.html">Illuminate\View\Compilers\BladeCompiler</a></td>
<td align="left">blade.compiler</td>
</tr>
<tr>
<td align="left">Bus</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Contracts/Bus/Dispatcher.html">Illuminate\Contracts\Bus\Dispatcher</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Cache</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Cache/Repository.html">Illuminate\Cache\Repository</a></td>
<td align="left">cache</td>
</tr>
<tr>
<td align="left">Config</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Config/Repository.html">Illuminate\Config\Repository</a></td>
<td align="left">config</td>
</tr>
<tr>
<td align="left">Cookie</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Cookie/CookieJar.html">Illuminate\Cookie\CookieJar</a></td>
<td align="left">cookie</td>
</tr>
<tr>
<td align="left">Crypt</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Encryption/Encrypter.html">Illuminate\Encryption\Encrypter</a></td>
<td align="left">encrypter</td>
</tr>
<tr>
<td align="left">DB</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Database/DatabaseManager.html">Illuminate\Database\DatabaseManager</a></td>
<td align="left">db</td>
</tr>
<tr>
<td align="left">DB (Instance)</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Database/Connection.html">Illuminate\Database\Connection</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Event</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Events/Dispatcher.html">Illuminate\Events\Dispatcher</a></td>
<td align="left">events</td>
</tr>
<tr>
<td align="left">File</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Filesystem/Filesystem.html">Illuminate\Filesystem\Filesystem</a></td>
<td align="left">files</td>
</tr>
<tr>
<td align="left">Gate</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.1/Illuminate/Contracts/Auth/Access/Gate.html">Illuminate\Contracts\Auth\Access\Gate</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Hash</td>
<td align="left"><a target="_blank" rel="noopener" href="http://laravel.com/api/5.2/Illuminate/Contracts/Hashing/Hasher.html">Illuminate\Contracts\Hashing\Hasher</a></td>
<td align="left">hash</td>
</tr>
<tr>
<td align="left">Lang</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Translation/Translator.html">Illuminate\Translation\Translator</a></td>
<td align="left">translator</td>
</tr>
<tr>
<td align="left">Log</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Log/Writer.html">Illuminate\Log\Writer</a></td>
<td align="left">log</td>
</tr>
<tr>
<td align="left">Mail</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Mail/Mailer.html">Illuminate\Mail\Mailer</a></td>
<td align="left">mailer</td>
</tr>
<tr>
<td align="left">Password</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Auth/Passwords/PasswordBroker.html">Illuminate\Auth\Passwords\PasswordBroker</a></td>
<td align="left">auth.password</td>
</tr>
<tr>
<td align="left">Queue</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Queue/QueueManager.html">Illuminate\Queue\QueueManager</a></td>
<td align="left">queue</td>
</tr>
<tr>
<td align="left">Queue (Instance)</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Contracts/Queue/Queue.html">Illuminate\Contracts\Queue\Queue</a></td>
<td align="left">queue</td>
</tr>
<tr>
<td align="left">Queue (Base Class)</td>
<td align="left"><a target="_blank" rel="noopener" href="http://laravel.com/api/5.2/Illuminate/Queue/Queue.html">Illuminate\Queue\Queue</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Redirect</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Routing/Redirector.html">Illuminate\Routing\Redirector</a></td>
<td align="left">redirect</td>
</tr>
<tr>
<td align="left">Redis</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Redis/Database.html">Illuminate\Redis\Database</a></td>
<td align="left">redis</td>
</tr>
<tr>
<td align="left">Request</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Http/Request.html">Illuminate\Http\Request</a></td>
<td align="left">request</td>
</tr>
<tr>
<td align="left">Response</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Contracts/Routing/ResponseFactory.html">Illuminate\Contracts\Routing\ResponseFactory</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Route</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Routing/Router.html">Illuminate\Routing\Router</a></td>
<td align="left">router</td>
</tr>
<tr>
<td align="left">Schema</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Database/Schema/Blueprint.html">Illuminate\Database\Schema\Blueprint</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Session</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Session/SessionManager.html">Illuminate\Session\SessionManager</a></td>
<td align="left">session</td>
</tr>
<tr>
<td align="left">Session (Instance)</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Session/Store.html">Illuminate\Session\Store</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Storage</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Contracts/Filesystem/Factory.html">Illuminate\Contracts\Filesystem\Factory</a></td>
<td align="left">filesystem</td>
</tr>
<tr>
<td align="left">URL</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Routing/UrlGenerator.html">Illuminate\Routing\UrlGenerator</a></td>
<td align="left">url</td>
</tr>
<tr>
<td align="left">Validator</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Validation/Factory.html">Illuminate\Validation\Factory</a></td>
<td align="left">validator</td>
</tr>
<tr>
<td align="left">Validator (Instance)</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/Validation/Validator.html">Illuminate\Validation\Validator</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">View</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/View/Factory.html">Illuminate\View\Factory</a></td>
<td align="left">view</td>
</tr>
<tr>
<td align="left">View (Instance)</td>
<td align="left"><a target="_blank" rel="noopener" href="https://laravel.com/api/5.2/Illuminate/View/View.html">Illuminate\View\View</a></td>
<td align="left"></td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/744e42db9d2a/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/744e42db9d2a/" class="post-title-link" itemprop="url">laravel 学习指南 第六章 第四节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 07:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T07:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/744e42db9d2a/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/744e42db9d2a/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-4-服务容器"><a href="#6-4-服务容器" class="headerlink" title="6.4 服务容器"></a>6.4 服务容器</h2><h3 id="6-4-1-简介"><a href="#6-4-1-简介" class="headerlink" title="6.4.1 简介"></a>6.4.1 简介</h3><p>Laravel 服务容器是一个用于管理类依赖和执行依赖注入的强大工具。依赖注入听上去很花哨，其实质是通过构造函数或者某些情况下通过 <code>setter</code> 方法将类依赖注入到类中。</p>
<p>让我们看一个简单的例子：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Jobs</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Mail</span>\<span class="title">Mailer</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Bus</span>\<span class="title">SelfHandling</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PurchasePodcast</span> <span class="keyword">implements</span> <span class="title">SelfHandling</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * mailer 的實作。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$mailer</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 建立一個新實例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  Mailer  $mailer</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Mailer <span class="variable">$mailer</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mailer = <span class="variable">$mailer</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 購買 podcast。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个例子中，购买<code>podcast</code>时，<code>PurchasePodcast</code>任务会需要寄送<code>e-mails</code>。因此，将注入能寄送<code>e-mails</code>的服务。由于服务被注入，我们能容易地切换成其它实例。当测试应用程序时，我们能很容易的测试，或者建立假的实例。</p>
<p>深入了解laravel服务容器对构建大型laravel应用很重要，对于贡献代码到laravel核心也很有帮助(很少需要这样做。)</p>
<hr>
<h3 id="6-4-2-绑定"><a href="#6-4-2-绑定" class="headerlink" title="6.4.2 绑定"></a>6.4.2 绑定</h3><p>几乎所有的<code>服务容器</code>绑定都是在<code>服务提供者</code>中注册。所以下方所有的例子将示范在该情况中使用容器。不过，如果类别没有任何依赖，那么就没有将类绑定到容器的必要。并不是需要告诉容器如果构建这些物件，因为它会透PHP的<code>reflection</code>自动解析<code>对象</code>。</p>
<p>在一个服务提供者中，可以通过 <code>$this-&gt;app</code> 变量访问容器，然后使用 <code>bind</code>方法注册一个绑定，该方法需要两个参数，第一个参数是我们想要注册的类名或接口名称，第二个参数是返回类的实例的闭包：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">&#x27;HelpSpot\API&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelpSpot\API(<span class="variable">$app</span>[<span class="string">&#x27;HttpClient&#x27;</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>注意，我们接受容器本身作为解析器的一个参数，然后我们可以使用该容器，来解析我们正在构建的对象的子依赖。</p>
<ul>
<li><p><strong>绑定一个单例</strong></p>
<p>  <code>singleton</code> 方法绑定，一个只需要解析一次的类或接口到容器，然后接下来对容器的调用将会返回同一个实例：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;singleton(<span class="string">&#x27;FooBar&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FooBar(<span class="variable">$app</span>[<span class="string">&#x27;SomethingElse&#x27;</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>绑定实例</strong></p>
<p>  你还可以使用 <code>instance</code> 方法绑定一个已存在的对象实例到容器，随后对容器的调用将总是返回给定的实例：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$fooBar</span> = <span class="keyword">new</span> FooBar(<span class="keyword">new</span> SomethingElse);</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;instance(<span class="string">&#x27;FooBar&#x27;</span>, <span class="variable">$fooBar</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-4-2-1-绑定接口到实现方法"><a href="#6-4-2-1-绑定接口到实现方法" class="headerlink" title="6.4.2.1 绑定接口到实现方法"></a>6.4.2.1 绑定接口到实现方法</h4><p>服务容器的一个非常强大的特性是，其绑定接口到实现方法的能力。</p>
<p>我们假设有一个 <code>EventPusher</code> 接口及其 <code>RedisEventPusher</code> 实现方法，编写完该接口的 <code>RedisEventPusher</code> 实现方法后，就可以将其注册到服务容器：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">&#x27;App\Contracts\EventPusher&#x27;</span>, <span class="string">&#x27;App\Services\RedisEventPusher&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>这段代码告诉容器当一个类需要 <code>EventPusher</code> 的实现方法将会注入 <code>RedisEventPusher</code>，现在我们可以在构造器或者任何其它通过服务容器注入依赖的地方进行 <code>EventPusher</code> 接口的类型提示：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Contracts</span>\<span class="title">EventPusher</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建一个新的类实例</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  EventPusher  $pusher</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">EventPusher <span class="variable">$pusher</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;pusher = <span class="variable">$pusher</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-4-2-2-上下文绑定"><a href="#6-4-2-2-上下文绑定" class="headerlink" title="6.4.2.2 上下文绑定"></a>6.4.2.2 上下文绑定</h4><p>有时侯我们可能有两个类使用同一个接口，但我们希望在每个类中注入不同实现方法。</p>
<p>例如，当系统接到一个新的订单的时候，我们想要通过<code>PubNub</code>而不是 <code>Pusher</code> 发送一个事件。Laravel 定义了一个简单、平滑的方式来定义这种行为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;when(<span class="string">&#x27;App\Handlers\Commands\CreateOrderHandler&#x27;</span>)</span><br><span class="line">          -&gt;needs(<span class="string">&#x27;App\Contracts\EventPusher&#x27;</span>)</span><br><span class="line">          -&gt;give(<span class="string">&#x27;App\Services\PubNubEventPusher&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>你甚至还可以传递一个闭包到 <code>give</code> 方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;when(<span class="string">&#x27;App\Handlers\Commands\CreateOrderHandler&#x27;</span>)</span><br><span class="line">    -&gt;needs(<span class="string">&#x27;App\Contracts\EventPusher&#x27;</span>)</span><br><span class="line">    -&gt;give(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Resolve dependency...</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>绑定原始值</strong></p>
<p>  有时候你可能有一个获取若干注入类的类，但还需要一个注入的原始值，比如整型数据，你可以轻松使用上下文绑定来注入指定类所需要的任何值：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;when(<span class="string">&#x27;App\Handlers\Commands\CreateOrderHandler&#x27;</span>)</span><br><span class="line">    -&gt;needs(<span class="string">&#x27;$maxOrderCount&#x27;</span>)</span><br><span class="line">    -&gt;give(<span class="number">10</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-4-2-2-标签"><a href="#6-4-2-2-标签" class="headerlink" title="6.4.2.2 标签"></a>6.4.2.2 标签</h4><p>有些情况下，需要解析特定分类下的所有绑定。</p>
<p>例如：你正在构建一个报表规整器，要通过接收有多个不同<code>Report</code>接口数组实现，在注册完 <code>Report</code> 实现方法之后，可以通过<code>tag</code>方法给它们分配一个标签：</p>
<p>将<code>SpeedReport</code>与<code>MemoryReport</code>打上名为<code>reports</code>的标签。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">&#x27;SpeedReport&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line">	</span><br><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">&#x27;MemoryReport&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line">	</span><br><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;tag([<span class="string">&#x27;SpeedReport&#x27;</span>, <span class="string">&#x27;MemoryReport&#x27;</span>], <span class="string">&#x27;reports&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>这些服务被打上标签后，可以通过 <code>tagged</code> 方法来轻松解析它们：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">	<span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">&#x27;ReportAggregator&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ReportAggregator(<span class="variable">$app</span>-&gt;tagged(<span class="string">&#x27;reports&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="6-4-3-解析"><a href="#6-4-3-解析" class="headerlink" title="6.4.3 解析"></a>6.4.3 解析</h3><p>有很多方式可以从容器中解析对象，首先，你可以使用 <code>make</code> 方法，该方法接收你想要解析的类名或接口名作为参数：</p>
<pre><code>$fooBar = $this-&gt;app-&gt;make(&#39;FooBar&#39;);
</code></pre>
<p>其次，你可以以数组方式访问容器，因为其实现了 PHP 的 <code>ArrayAccess</code> 接口：</p>
<pre><code>$fooBar = $this-&gt;app[&#39;FooBar&#39;];
</code></pre>
<p>最后，也是最常用的，你可以简单的通过,在类的构造函数中,对依赖进行类型提示,来从容器中解析对象.包括控制器、事件监听器、队列任务、中间件等都是通过这种方式。在实践中，这是大多数对象从容器中解析的方式。</p>
<p>容器会自动为其解析类注入依赖.</p>
<p>例如：你可以在控制器的构造函数中为应用定义的仓库进行类型提示，该仓库会自动解析并注入该类。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Routing</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Users</span>\<span class="title">Repository</span> <span class="title">as</span> <span class="title">UserRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户仓库实例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$users</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个控制器实例</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  UserRepository  $users</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">UserRepository <span class="variable">$users</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;users = <span class="variable">$users</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过指定ID显示用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="6-4-4-容器事件"><a href="#6-4-4-容器事件" class="headerlink" title="6.4.4 容器事件"></a>6.4.4 容器事件</h3><p>服务容器在每一次解析对象时都会触发一个事件，可以使用 resolving 方法监听该事件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;resolving(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$object</span>, <span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 容器解析所有类型对象时调用</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;resolving(<span class="function"><span class="keyword">function</span> (<span class="params">FooBar <span class="variable">$fooBar</span>, <span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 容器解析“FooBar”对象时调用</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>正如你所看到的，被解析的对象将会传递给回调，从而允许你在对象被传递给消费者之前为其设置额外属性。</p>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/132ebfee2e44/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/132ebfee2e44/" class="post-title-link" itemprop="url">laravel 学习指南 第六章 第二节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 05:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T05:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/132ebfee2e44/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/132ebfee2e44/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-2-应用目录结构"><a href="#6-2-应用目录结构" class="headerlink" title="6.2 应用目录结构"></a>6.2 应用目录结构</h2><h3 id="6-2-1-简介"><a href="#6-2-1-简介" class="headerlink" title="6.2.1 简介"></a>6.2.1 简介</h3><p>Laravel 应用默认的目录结构试图为不管是大型应用还是小型应用提供一个好的起点，当然，你可以自己按照喜好重新组织应用目录结构，Laravel 对类在何处被加载没有任何限制——只要 Composer 可以自动载入它们即可。</p>
<hr>
<h3 id="6-2-2-根目录"><a href="#6-2-2-根目录" class="headerlink" title="6.2.2 根目录"></a>6.2.2 根目录</h3><p>新安装的 Laravel 应用包含许多文件夹：</p>
<table>
<thead>
<tr>
<th align="left">目录名称</th>
<th align="left">目录说</th>
</tr>
</thead>
<tbody><tr>
<td align="left">app</td>
<td align="left">目录包含了应用的核心代码</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">bootstrap</td>
<td align="left">目录包含了少许文件用于框架的启动和自动载入配置</td>
</tr>
<tr>
<td align="left">bootstrap/cache</td>
<td align="left">用于包含框架生成的启动文件以提高性能</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">config</td>
<td align="left">目录包含了应用所有的配置文件</td>
</tr>
<tr>
<td align="left">database</td>
<td align="left">目录包含了数据迁移及填充文件，如果你喜欢的话还可以将其作为 SQLite 数据库存放目录</td>
</tr>
<tr>
<td align="left">public</td>
<td align="left">目录包含了前端控制器和资源文件（图片、JavaScript、CSS等）</td>
</tr>
<tr>
<td align="left">resources</td>
<td align="left">目录包含了视图文件及原生资源文件（LESS、SASS、CoffeeScript），以及本地化文件</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">storage</td>
<td align="left">目录包含了编译过的Blade模板、基于文件的session、文件缓存，以及其它由框架生成的文件</td>
</tr>
<tr>
<td align="left">storage/app</td>
<td align="left">目录用于存放应用要使用的文件</td>
</tr>
<tr>
<td align="left">storage/framework</td>
<td align="left">目录用于存放框架生成的文件和缓存</td>
</tr>
<tr>
<td align="left">storage/logs</td>
<td align="left">目录包含应用的日志文件</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">tests</td>
<td align="left">目录包含自动化测试，其中已经提供了一个开箱即用的PHPUnit示例</td>
</tr>
<tr>
<td align="left">vendor</td>
<td align="left">目录包含Composer依赖</td>
</tr>
</tbody></table>
<hr>
<h3 id="6-2-3-App目录"><a href="#6-2-3-App目录" class="headerlink" title="6.2.3 App目录"></a>6.2.3 App目录</h3><p>默认情况下，在项目的<code>App</code>文件夹，并且被 Composer 通过 PSR-4自动载入标准 自动加载。可以通过Artisan命令<code>app:name</code>来修改该命名空间。</p>
<p><code>App</code>目录下有多个子目录。</p>
<p><code>Console</code>和<code>Http</code>目录提供了进入应用核心的API。</p>
<p>它们是两个向应用发布命令的方式。</p>
<p><code>Console</code>目录包含了所有的<code>Artisan</code>命令。 </p>
<p><code>Http</code>目录包含了控制器，中间件请求等等。</p>
<p><code>Jobs</code>目录是放置列队任务的地方，应用中的任务可以被队列化，也可以在当前请求生命周期内同步执行。</p>
<p><code>Events</code>目录是放置事件类的地方，事件可以同于通知应用其他部分给定的动作已经发生，并提供灵活的解耦的处理。</p>
<p><code>Listeners</code>目录包含事件的处理器类，处理器接收一个事件并提供对该事件发生后的响应逻辑。</p>
<p>例如，<code>UserRegstered</code>事件可以被<code>SendWelcomeEmail</code>监听器处理。</p>
<p><code>Exceptions</code>目录包含应用的异常处理器，同时还是处理应用抛出的异常的好地方。</p>
<p><em>注意：<code>app</code>目录中的很多类都可以通过Artisan命令生成，要查看所有命令，使用命令：<code>php artisan list make</code></em></p>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/8788d26396c1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/8788d26396c1/" class="post-title-link" itemprop="url">laravel 学习指南 第六章 第三节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 05:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T05:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/8788d26396c1/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/8788d26396c1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-3-服务提交者"><a href="#6-3-服务提交者" class="headerlink" title="6.3 服务提交者"></a>6.3 服务提交者</h2><h3 id="6-3-1-简介"><a href="#6-3-1-简介" class="headerlink" title="6.3.1 简介"></a>6.3.1 简介</h3><p>服务提供者是所有laravel应用启动的中心，你自己的应用以及所有Laravel的核心服务都是通过服务提供者启动。</p>
<p>但是，我们所谓的<code>启动</code>指的是什么？通常，这意味着注册事物，包括注册服务容器绑定，事件监听器，中间件甚至路由。服务提供者是应用配置的中心。</p>
<p>如果你打开Laravel自带的<code>config/app.php</code>文件，将会看到一个<code>providers</code>数组，这里就是应用所要加载的所有服务提供者类，当然，其中很多是延迟加载的，也就是说不是每次请求都会被加载，只有真的用到它们的时候才会加载。</p>
<p>本章里你将会学习如何编写自己的服务提供者并在Laravel应用中注册它们。</p>
<hr>
<h3 id="6-3-2-编写服务提供者"><a href="#6-3-2-编写服务提供者" class="headerlink" title="6.3.2 编写服务提供者"></a>6.3.2 编写服务提供者</h3><p>所以得服务提供者继承自<code>Illuminate\Support\ServiceProvider</code>类。继承该抽象类要求至少在服务提供者中定义一个方法：<code>register</code>。在<code>register</code>方法内，你唯一要做的事情就是绑事物到服务容器，不要尝试在其中注册任何时间监听器，路由或者任何其它功能。</p>
<p>通过Artisan命令<code>make:provider</code>可以简单生成一个新的提供者：</p>
<pre><code>php artisan make:provider RiakServiceProvider
</code></pre>
<p>文件被创建到<code>App/Providers/RiakServiceProvider.php</code></p>
<h4 id="6-3-2-1-register方法"><a href="#6-3-2-1-register方法" class="headerlink" title="6.3.2.1 register方法"></a>6.3.2.1 register方法</h4><p>正如前面所提到的，在<code>register</code>方法中只绑定事物到服务容器，而不要做其它事情，否则，一不小心就会用到一个尚未被加载的服务提供者提供的服务。</p>
<p>现在来看看一个基本的服务提供者是什么样：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Riak</span>\<span class="title">Connection</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RiakServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在容器中注册绑定.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;app-&gt;singleton(<span class="string">&#x27;Riak\Contracts\Connection&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Connection(config(<span class="string">&#x27;riak&#x27;</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编辑的文件为<code>App/Providers/RiakServiceProvider.php</code></p>
<p>这个服务提供者只定义了一个<code>register</code>方法，并在服务容器中使用此方法定义了一份<code>Riak/connection</code>的实例。如果不清楚它是如何运作的，查看下一章节<code>服务容器</code>。</p>
<h4 id="6-3-2-2-boot方法"><a href="#6-3-2-2-boot方法" class="headerlink" title="6.3.2.2 boot方法"></a>6.3.2.2 boot方法</h4><p>如果我们想要在服务提供者中注册视图composer该怎么做？这就要用到<code>boot</code>方法，该方法在所有服务提供者被注册以后才会被调用，这就是说我们可以在其中访问框架已注册的所有其他服务：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Perform post-registration booting of services.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        view()-&gt;composer(<span class="string">&#x27;view&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在容器中注册绑定.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>boot方法的依赖注入</strong></li>
</ul>
<p>我们可以在<code>boot</code>方法中类型提升依赖，服务容器会自动注册你需要的依赖：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Routing</span>\<span class="title">ResponseFactory</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params">ResponseFactory <span class="variable">$factory</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$factory</span>-&gt;macro(<span class="string">&#x27;caps&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="6-3-3-注册服务提供者"><a href="#6-3-3-注册服务提供者" class="headerlink" title="6.3.3 注册服务提供者"></a>6.3.3 注册服务提供者</h3><p>所有服务提供者都是通过配置文件<code>config/app.php</code>中进行注册，该文件包含了一个列出所有服务提供者名字的<code>providers</code>数组，默认情况下，其中列出了所有核心服务提供者，这些服务提供者启动Laravel核心组件，比如邮件、列队、缓存等等。</p>
<p>要注册你自己的服务提供者，只需要将其追加到该数组中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;providers&#x27;</span> =&gt; [</span><br><span class="line">     <span class="comment">// 其它服务提供者</span></span><br><span class="line">     App\Providers\AppServiceProvider::class,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="6-3-4-延迟加载服务提供者"><a href="#6-3-4-延迟加载服务提供者" class="headerlink" title="6.3.4 延迟加载服务提供者"></a>6.3.4 延迟加载服务提供者</h3><p>如果你的提供者仅仅只是在服务容器中注册绑定，你可以选择在延迟加载该绑，定直到注册绑定真的需要时再加载，延迟加载这样的一个提供者将会提升应用的性能，因为它不会在每次请求时都从文件系统加载。</p>
<p>想要延迟加载一个提供者，设置defer属性为true并定义一个provides方法，该方法返回该提供者注册的服务容器绑定：</p>
<p>想要延迟加载一个提供者，设置<code>defer</code>属性为<code>true</code>并定义一个<code>provides</code>方法，该方法返回该提供者注册的服务容器绑定：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Riak</span>\<span class="title">Connection</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RiakServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 服务提供者加是否延迟加载.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$defer</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册服务提供者</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;app-&gt;singleton(<span class="string">&#x27;Riak\Contracts\Connection&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Connection(<span class="variable">$app</span>[<span class="string">&#x27;config&#x27;</span>][<span class="string">&#x27;riak&#x27;</span>]);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取由提供者提供的服务.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">provides</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;Riak\Contracts\Connection&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Laravel编译并保存所有延迟服务者提供的服务以及服务提供者的类名。</p>
<p>然后，只有当你尝试解析其中某个服务时Laravel才会加载其服务提交者。</p>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/661ec6791c3e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/661ec6791c3e/" class="post-title-link" itemprop="url">laravel 学习指南 第六章 第一节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 04:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T04:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/661ec6791c3e/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/661ec6791c3e/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-laravel框架"><a href="#6-laravel框架" class="headerlink" title="6 laravel框架"></a>6 laravel框架</h2><h2 id="6-1-一次请求的生命周期"><a href="#6-1-一次请求的生命周期" class="headerlink" title="6.1 一次请求的生命周期"></a>6.1 一次请求的生命周期</h2><h3 id="6-1-1-简介"><a href="#6-1-1-简介" class="headerlink" title="6.1.1 简介"></a>6.1.1 简介</h3><p>当我们使用现实世界中的任何工具时，如果理解了该工具的工作原理，那么用起来就会得心应手，应用开发也是如此。当你理解了开发工具如何工作，用起来就会更加游刃有余。</p>
<p>本文档的目标就是从一个更好、更高层面向你阐述 Laravel 框架的工作原理。通过对框架更全面的了解，一切都不再那么神秘，你将会更加自信的构建应用。</p>
<p>如果你不能马上理解所有这些条款，不要失去信心！先试着掌握一些基本的东西，你的知识将会随着对本文档的探索而不断提高。</p>
<hr>
<h3 id="6-1-2-生命周期预览"><a href="#6-1-2-生命周期预览" class="headerlink" title="6.1.2 生命周期预览"></a>6.1.2 生命周期预览</h3><h4 id="6-1-2-1-第一件事"><a href="#6-1-2-1-第一件事" class="headerlink" title="6.1.2.1 第一件事"></a>6.1.2.1 第一件事</h4><p>Laravel应用的所有请求入口都是<code>public/index.php</code>文件，所有请求都会被web服务器(Apache/Nginx)导向这个文件。<code>index.php</code>文件包含的代码并不多，但是，是加载框架其他部分的起点。</p>
<p><code>index.php</code>文件载入Composer生成的自动加载设置，然后从<code>bootstrap/app.php</code>脚本获取Laravel应用实例，Laravel的第一个动作就是创建服务容器实例。</p>
<h4 id="6-1-2-2-HTTP-Console内核"><a href="#6-1-2-2-HTTP-Console内核" class="headerlink" title="6.1.2.2 HTTP/Console内核"></a>6.1.2.2 HTTP/Console内核</h4><p>接下来，请求被发送到 HTTP 内核或 Console 内核，这取决于进入应用的请求类型。这两个内核是所有请求都要经过的中央处理器，现在，就让我们聚焦在位于 <code>app/Http/Kernel.php</code> 的 HTTP 内核。</p>
<p>HTTP 内核继承自 <code>Illuminate\Foundation\Http\Kernel</code> 类，该类定义了一个 <code>bootstrappers</code> 数组，这个数组中的类在请求被执行前运行，这些 <code>bootstrappers</code> 配置了错误处理、日志、检测应用环境以及其它在请求被处理前需要执行的任务。</p>
<p>HTTP 内核还定义了一系列所有请求在处理前需要经过的 HTTP 中间件，这些中间件处理 HTTP 会话的读写、判断应用是否处于维护模式、验证 CSRF 令牌等等。</p>
<p>HTTP 内核的标志性方法 handle 处理的逻辑相当简单：获取一个 Request，返回一个 Response，把该内核想象作一个代表整个应用的大黑盒子，输入 HTTP 请求，返回 HTTP 响应。</p>
<ul>
<li><p><strong>服务提供者</strong></p>
<p>  内核启动过程中最重要的动作之一就是为应用载入服务提供者，应用的所有服务提供者都被配置在 <code>config/app.php</code> 配置文件的  <code>providers</code> 数组中。首先，所有提供者的 <code>register</code> 方法被调用，然后，所有提供者被注册之后，<code>boot</code> 方法被调用。</p>
<p>  服务提供者负责启动框架的所有各种各样的组件，比如数据库、队列、验证器，以及路由组件等，正是因为他们启动并配置了框架提供的所有特性，服务提供者是整个 Laravel 启动过程中最重要的部分。</p>
</li>
<li><p><strong>分发请求</strong></p>
<p>  一旦应用被启动并且所有的服务提供者被注册，Request 将会被交给路由器进行分发，路由器将会分发请求到路由或控制器，同时运行所有路由指定的中间件。</p>
</li>
</ul>
<hr>
<h3 id="6-1-3-聚集服务提交者"><a href="#6-1-3-聚集服务提交者" class="headerlink" title="6.1.3 聚集服务提交者"></a>6.1.3 聚集服务提交者</h3><p>服务提供者是启动 Laravel 应用中最关键的部分，应用实例被创建后，服务提供者被注册，请求被交给启动后的应用进行处理，整个过程就是这么简单！</p>
<p>对 Laravel 应用如何通过服务提供者构建和启动有一个牢固的掌握非常有价值，当然，应用默认的服务提供者存放在 <code>app/Providers</code> 目录下。</p>
<p>默认情况下，<code>AppServiceProvider</code> 是空的，这里是添加自定义启动和服务容器绑定的最佳位置，当然，对大型应用，你可能希望创建多个服务提供者，每一个都有着更加细粒度的启动。</p>
<h3 id="阅读感言"><a href="#阅读感言" class="headerlink" title="阅读感言"></a>阅读感言</h3><p>上面说了那么多，实际上可以理解为下方的简单流程。</p>
<ol>
<li><p><code>public/index.php</code>laravel访问的起点。创建服务容器。</p>
</li>
<li><p>请求进入内核(HTTP或Console)。</p>
</li>
<li><p>HTTP内核启动，laravel最重要的应用——服务提供者。</p>
</li>
<li><p>服务提供者启动各种各样的组件。</p>
</li>
<li><p>当所有的服务提供者被注册，路由开始工作。</p>
</li>
</ol>
<p>默认服务提供者存放在<code>app/Providers</code>。</p>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/afa67e043e16/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/afa67e043e16/" class="post-title-link" itemprop="url">laravel 学习指南 第五章 第七节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 03:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T03:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/afa67e043e16/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/afa67e043e16/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-7-Blade-模板"><a href="#5-7-Blade-模板" class="headerlink" title="5.7 Blade 模板"></a>5.7 Blade 模板</h2><h3 id="5-7-1-简介"><a href="#5-7-1-简介" class="headerlink" title="5.7.1 简介"></a>5.7.1 简介</h3><p>Blade 是 Laravel 提供的一个非常简单但很强大的模板引擎，不同于其他流行的PHP模板引擎，Blade在视图中并不约束你使用PHP原生代码。所有的Blade视图都会被编译成原生PHP代码并缓存起来直到被修改，这意味着对应用的性能而言Blade基本上是零开销。Blade视图文件使用<code>.blade.php</code>文件扩展并存放在<code>resources/views</code>目录下。</p>
<hr>
<h3 id="5-7-2-模板继承"><a href="#5-7-2-模板继承" class="headerlink" title="5.7.2 模板继承"></a>5.7.2 模板继承</h3><h4 id="5-7-2-1-定义页面布局"><a href="#5-7-2-1-定义页面布局" class="headerlink" title="5.7.2.1 定义页面布局"></a>5.7.2.1 定义页面布局</h4><p>使用Blade的两个最大的优点是模板继承和切片，开始之前先看一个例子。</p>
<p>首先，检测一个主页面布局，由于大多数web应用在不同页面中使用同一个布局，可以很方便的将这个布局定义为一个单独的Blade页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 存放在 resources/views/layouts/master.blade.php --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>App Name - @yield(&#x27;title&#x27;)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        @section(&#x27;sidebar&#x27;)</span><br><span class="line">            This is the master sidebar.</span><br><span class="line">        @show</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">            @yield(&#x27;content&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>正如所看到的，该文件包含典型的HTML标记，然而，注意<code>@section</code>和<code>@yield</code>指令，前者正如其名字所暗示的，定义了一个内容的片段，而后者用于显示给定片段的内容。</p>
<p>现在我们已经为应用定义了一个布局，接下来让我们定义继承该布局的子页面。</p>
<h4 id="5-7-2-2-扩展页面布局"><a href="#5-7-2-2-扩展页面布局" class="headerlink" title="5.7.2.2 扩展页面布局"></a>5.7.2.2 扩展页面布局</h4><p>定义子页面的时候，可以使用Blade的<code>@extends</code>指令来指定子页面所继承的布局，继承一个Blade布局的视图将会使用<code>@section</code>指令注入内容到布局的片段中，记住，如上面例子所示，这些片段的内容将会显示在布局中使用<code>@yield</code>的地方：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 存放在 resources/views/child.blade.php --&gt;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">extends</span>(<span class="string">&#x27;layouts.master&#x27;</span>)</span><br><span class="line"></span><br><span class="line">@section(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;Page Title&#x27;</span>)</span><br><span class="line"></span><br><span class="line">@section(<span class="string">&#x27;sidebar&#x27;</span>)</span><br><span class="line">    @<span class="built_in">parent</span></span><br><span class="line"></span><br><span class="line">    &lt;p&gt;This is appended to the master sidebar.&lt;/p&gt;</span><br><span class="line">@endsection</span><br><span class="line"></span><br><span class="line">@section(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">    &lt;p&gt;This is my body content.&lt;/p&gt;</span><br><span class="line">@endsection</span><br></pre></td></tr></table></figure>
<p>在本例中，<code>sidebar</code>片段使用<code>@parent</code>指令来追加内容到布局中<code>sidebar</code>,<code>@parent</code>指令在视图渲染时将会被布局中的内容替换。</p>
<p>当然，和原始PHP视图一样，Blade视图可以通过<code>view</code>方法直接从路由中返回：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;blade&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> view(<span class="string">&#x27;child&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-7-3-数据显示"><a href="#5-7-3-数据显示" class="headerlink" title="5.7.3 数据显示"></a>5.7.3 数据显示</h3><p>可以通过两个花括号包裹变量来显示传递到视图的数据，比如，如果给出如下路由：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;greeting&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;welcome&#x27;</span>, [<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Samantha&#x27;</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>那么可以通过如下方式显示<code>name</code>变量的内容:</p>
<pre><code>Hello, &#123;&#123; $name &#125;&#125;.
</code></pre>
<p>当然，不限制显示到视图中的变量内容，你还可以输出任何PHP函数，实际上，可以将任何PHP代码放到Blade模板语句中：</p>
<pre><code>The current UNIX timestamp is &#123;&#123; time() &#125;&#125;.
</code></pre>
<p>*注意：Blade的<code>&#123;&#123;&#125;&#125;`语句已经经过PHP的`htmlentities`函数处理以避免XSS攻击。*

#### 5.7.3.1 Blade & JavaScript 框架

由于很多Javascript框架也是用花括号表示，要显示在浏览器中的表达式，可以使用`@`告诉Blade渲染引擎该表达式应该保持原生格式不作改动。例如：

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Laravel<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Hello, @&#123;&#123; name &#125;&#125;.</span><br></pre></td></tr></table></figure>
这里`@`符合会被Blade移除。而且，Blade引擎会保留`&#123;&#123;name&#125;&#125;</code>表单式，如此一来可让其它Javascript框架使用。</p>
<h4 id="5-7-3-2-输出存在的数据"><a href="#5-7-3-2-输出存在的数据" class="headerlink" title="5.7.3.2 输出存在的数据"></a>5.7.3.2 输出存在的数据</h4><p>有时候想要输出一个变量，但是不确定该变量是否被设置，我们可以通过如下PHP代码：</p>
<pre><code>&#123;&#123; isset($name) ? $name : 'Default' &#125;&#125;
</code></pre>
<p>处理上方的方法，Blade还提供了更简单的方式：</p>
<pre><code>&#123;&#123; $name or 'Default' &#125;&#125;
</code></pre>
<p>在这里，如果<code>$name</code>变量存在，将会显示，否则将显示<code>Default</code></p>
<h4 id="5-7-3-3-显示原生数据"><a href="#5-7-3-3-显示原生数据" class="headerlink" title="5.7.3.3 显示原生数据"></a>5.7.3.3 显示原生数据</h4><p>默认情况下，Blade的<code>&#123;&#123; &#125;&#125;</code>语法已经通过PHP的<code>htmlentities</code>函数处理以避免XSS攻击，如果不想要数据被处理，可以使用如下语法：</p>
<pre><code>Hello, &#123;!! $name !!&#125;.
</code></pre>
<p><em>注意：对于用户输入的内容要当心，要使用双花括号以避免直接输出HTML代码。</em></p>
<hr>
<h3 id="5-7-4-流程控制"><a href="#5-7-4-流程控制" class="headerlink" title="5.7.4 流程控制"></a>5.7.4 流程控制</h3><p>除了模板继承和数据显示之外，Blade还为常用的PHP流程提供了便利操作，比如条件语句和循环，这些快捷操作提供了一个干净，简单的方式来处理PHP的流程控制，同时保持和PHP相应语句相似。</p>
<h4 id="5-7-4-1-If-语句"><a href="#5-7-4-1-If-语句" class="headerlink" title="5.7.4.1 If 语句"></a>5.7.4.1 If 语句</h4><p>可以使用<code>@if</code>,<code>@elseif</code>,<code>@else</code>,<code>@endif</code>,来构造if语句，这些指令函数和PHP的相同：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">if</span> (count(<span class="variable">$records</span>) === <span class="number">1</span>)</span><br><span class="line">    I have one record!</span><br><span class="line">@<span class="keyword">elseif</span> (count(<span class="variable">$records</span>) &gt; <span class="number">1</span>)</span><br><span class="line">    I have multiple records!</span><br><span class="line">@<span class="keyword">else</span></span><br><span class="line">    I don<span class="string">&#x27;t have any records!</span></span><br><span class="line"><span class="string">@endif</span></span><br></pre></td></tr></table></figure>

<p>为了方便，Blade还提供了<code>@unless</code>指令：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@unless (Auth::check())</span><br><span class="line">    You are not signed in.</span><br><span class="line">@endunless</span><br></pre></td></tr></table></figure>

<h4 id="5-7-4-2-循环"><a href="#5-7-4-2-循环" class="headerlink" title="5.7.4.2 循环"></a>5.7.4.2 循环</h4><p>除了条件语句，Blade还提供了简单指令处理PHP支持的循环结构，同样，这些指令函数和PHP一样：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">10</span>; <span class="variable">$i</span>++)</span><br><span class="line">    The current value is &#123;&#123; <span class="variable">$i</span> &#125;&#125;</span><br><span class="line">@<span class="keyword">endfor</span></span><br><span class="line"></span><br><span class="line">@<span class="keyword">foreach</span> (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>)</span><br><span class="line">    &lt;p&gt;This is user &#123;&#123; <span class="variable">$user</span>-&gt;id &#125;&#125;&lt;/p&gt;</span><br><span class="line">@<span class="keyword">endforeach</span></span><br><span class="line"></span><br><span class="line">@forelse (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>)</span><br><span class="line">    &lt;li&gt;&#123;&#123; <span class="variable">$user</span>-&gt;name &#125;&#125;&lt;/li&gt;</span><br><span class="line">    @<span class="keyword">empty</span></span><br><span class="line">    &lt;p&gt;No users&lt;/p&gt;</span><br><span class="line">@endforelse</span><br><span class="line"></span><br><span class="line">@<span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &lt;p&gt;I<span class="string">&#x27;m looping forever.&lt;/p&gt;</span></span><br><span class="line"><span class="string">@endwhile</span></span><br></pre></td></tr></table></figure>

<h4 id="5-7-4-3-包含子视图"><a href="#5-7-4-3-包含子视图" class="headerlink" title="5.7.4.3 包含子视图"></a>5.7.4.3 包含子视图</h4><p>Blade的<code>@include</code>指令允许你很简单的在一个视图中包含另一个Blade视图，所有父级视图中变量在被包含的子视图中依然有效：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    @include(&#x27;shared.errors&#x27;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Form Contents --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>尽管被包含的视图继承所有父视图中的数据，还可以传递额外参数到被包含的视图：</p>
<pre><code>@include(&#39;view.name&#39;, [&#39;some&#39; =&gt; &#39;data&#39;])
</code></pre>
<p><em>注意：不要再Blade视图中使用<code>__DIR__</code>和<code>__FIFL__</code>常量，因为他们会指向缓存视图的路径。</em></p>
<h4 id="5-7-4-4-为集合渲染视图"><a href="#5-7-4-4-为集合渲染视图" class="headerlink" title="5.7.4.4 为集合渲染视图"></a>5.7.4.4 为集合渲染视图</h4><p>使用Blade的<code>@each</code>指令将循环或引入 压缩成一行：</p>
<pre><code>@each(&#39;view.name&#39;, $jobs, &#39;job&#39;)
</code></pre>
<p>第一个参数为：对数组或集合的每个元素渲染的局部视图。</p>
<p>第二个参数为：要迭代的数组或集合。</p>
<p>第三个参数为：迭代时被分配到视图中的变数名称。</p>
<p>举例来说:如果迭代一个<code>jobs</code>数组，通常希望在局部视图中透过<code>job</code>变数存取每一个job。</p>
<p>传递第四个参数至<code>@each</code>指令。此参数为：当给定的数组为空时，将会被渲染的视图。</p>
<pre><code>@each(&#39;view.name&#39;, $jobs, &#39;job&#39;, &#39;view.empty&#39;)
</code></pre>
<h4 id="5-7-4-5-注释"><a href="#5-7-4-5-注释" class="headerlink" title="5.7.4.5 注释"></a>5.7.4.5 注释</h4><p>Blade还允许在视图中定义注释，然而，不同于HTML注释，Blade注释并不会包含到HTML中被返回：</p>
<pre><code>&#123;&#123;-- This comment will not be present in the rendered HTML --&#125;&#125;
</code></pre>
<hr>
<h3 id="5-7-5-服务注入"><a href="#5-7-5-服务注入" class="headerlink" title="5.7.5 服务注入"></a>5.7.5 服务注入</h3><p><code>@inject</code>指令可以用于从服务容器中获取服务，传递给<code>@inject</code>的第一个参数是服务将要被放置的变量名，第二个参数是要解析的服务类名或接口名：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@inject(<span class="string">&#x27;metrics&#x27;</span>, <span class="string">&#x27;App\Services\MetricsService&#x27;</span>)</span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line">    Monthly Revenue: &#123;&#123; <span class="variable">$metrics</span>-&gt;monthlyRevenue() &#125;&#125;.</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-7-6-扩展-Blade"><a href="#5-7-6-扩展-Blade" class="headerlink" title="5.7.6 扩展 Blade"></a>5.7.6 扩展 Blade</h3><p>Blade还允许你自定义指令，可以使用<code>directive</code>方法来注册一个指令。当Blade编辑器遇到该指令，将会传入参数并调用提供的回调。</p>
<p>下面的例子创建了一个<code>@datetime($var)</code>指令,格式化给定的<code>$var</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Blade</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Perform post-registration booting of services.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Blade::directive(<span class="string">&#x27;datetime&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$expression</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&lt;?php echo with<span class="subst">&#123;$expression&#125;</span>-&gt;format(&#x27;m/d/Y H:i&#x27;); ?&gt;&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在容器中注册绑定.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>laravel 辅助函数<code>with</code>被用在该指令中，<code>with</code>方法返回给定的对象或值，允许方法链。最终该指令生成的PHP代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> with(<span class="variable">$var</span>)-&gt;format(<span class="string">&#x27;m/d/Y H:i&#x27;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/21/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><span class="page-number current">22</span><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/23/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2016 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">K11</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">233k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">3:32</span>
  </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.13.2/dist/mermaid.min.js","integrity":"sha256-UIQPVkGifpwMvDH5yGgORJ9sSTDq38zz6BGU6dNaKhM="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>



  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"keleven","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
