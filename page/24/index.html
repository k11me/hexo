<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="o1eiNMhypkcaTCNHyHeoaEJM-2wqU4uSpp7XfdfQglI">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"keleven.me","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="千变万化的是世界">
<meta property="og:type" content="website">
<meta property="og:title" content="Keleven.Me">
<meta property="og:url" content="http://keleven.me/page/24/index.html">
<meta property="og:site_name" content="Keleven.Me">
<meta property="og:description" content="千变万化的是世界">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="K11">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://keleven.me/page/24/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"page/24/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Keleven.Me</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111519029-1"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"UA-111519029-1","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Keleven.Me</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="K11"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">K11</p>
  <div class="site-description" itemprop="description">千变万化的是世界</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">252</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/k11me" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;k11me" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:k11@keleven.me" title="E-Mail → mailto:k11@keleven.me"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.instagram.com/_y.o_o.y_/" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;_y.o_o.y_&#x2F;" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/132ebfee2e44/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/132ebfee2e44/" class="post-title-link" itemprop="url">laravel 学习指南 第六章 第二节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 05:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T05:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/132ebfee2e44/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/132ebfee2e44/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-2-应用目录结构"><a href="#6-2-应用目录结构" class="headerlink" title="6.2 应用目录结构"></a>6.2 应用目录结构</h2><h3 id="6-2-1-简介"><a href="#6-2-1-简介" class="headerlink" title="6.2.1 简介"></a>6.2.1 简介</h3><p>Laravel 应用默认的目录结构试图为不管是大型应用还是小型应用提供一个好的起点，当然，你可以自己按照喜好重新组织应用目录结构，Laravel 对类在何处被加载没有任何限制——只要 Composer 可以自动载入它们即可。</p>
<hr>
<h3 id="6-2-2-根目录"><a href="#6-2-2-根目录" class="headerlink" title="6.2.2 根目录"></a>6.2.2 根目录</h3><p>新安装的 Laravel 应用包含许多文件夹：</p>
<table>
<thead>
<tr>
<th align="left">目录名称</th>
<th align="left">目录说</th>
</tr>
</thead>
<tbody><tr>
<td align="left">app</td>
<td align="left">目录包含了应用的核心代码</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">bootstrap</td>
<td align="left">目录包含了少许文件用于框架的启动和自动载入配置</td>
</tr>
<tr>
<td align="left">bootstrap/cache</td>
<td align="left">用于包含框架生成的启动文件以提高性能</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">config</td>
<td align="left">目录包含了应用所有的配置文件</td>
</tr>
<tr>
<td align="left">database</td>
<td align="left">目录包含了数据迁移及填充文件，如果你喜欢的话还可以将其作为 SQLite 数据库存放目录</td>
</tr>
<tr>
<td align="left">public</td>
<td align="left">目录包含了前端控制器和资源文件（图片、JavaScript、CSS等）</td>
</tr>
<tr>
<td align="left">resources</td>
<td align="left">目录包含了视图文件及原生资源文件（LESS、SASS、CoffeeScript），以及本地化文件</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">storage</td>
<td align="left">目录包含了编译过的Blade模板、基于文件的session、文件缓存，以及其它由框架生成的文件</td>
</tr>
<tr>
<td align="left">storage/app</td>
<td align="left">目录用于存放应用要使用的文件</td>
</tr>
<tr>
<td align="left">storage/framework</td>
<td align="left">目录用于存放框架生成的文件和缓存</td>
</tr>
<tr>
<td align="left">storage/logs</td>
<td align="left">目录包含应用的日志文件</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">tests</td>
<td align="left">目录包含自动化测试，其中已经提供了一个开箱即用的PHPUnit示例</td>
</tr>
<tr>
<td align="left">vendor</td>
<td align="left">目录包含Composer依赖</td>
</tr>
</tbody></table>
<hr>
<h3 id="6-2-3-App目录"><a href="#6-2-3-App目录" class="headerlink" title="6.2.3 App目录"></a>6.2.3 App目录</h3><p>默认情况下，在项目的<code>App</code>文件夹，并且被 Composer 通过 PSR-4自动载入标准 自动加载。可以通过Artisan命令<code>app:name</code>来修改该命名空间。</p>
<p><code>App</code>目录下有多个子目录。</p>
<p><code>Console</code>和<code>Http</code>目录提供了进入应用核心的API。</p>
<p>它们是两个向应用发布命令的方式。</p>
<p><code>Console</code>目录包含了所有的<code>Artisan</code>命令。 </p>
<p><code>Http</code>目录包含了控制器，中间件请求等等。</p>
<p><code>Jobs</code>目录是放置列队任务的地方，应用中的任务可以被队列化，也可以在当前请求生命周期内同步执行。</p>
<p><code>Events</code>目录是放置事件类的地方，事件可以同于通知应用其他部分给定的动作已经发生，并提供灵活的解耦的处理。</p>
<p><code>Listeners</code>目录包含事件的处理器类，处理器接收一个事件并提供对该事件发生后的响应逻辑。</p>
<p>例如，<code>UserRegstered</code>事件可以被<code>SendWelcomeEmail</code>监听器处理。</p>
<p><code>Exceptions</code>目录包含应用的异常处理器，同时还是处理应用抛出的异常的好地方。</p>
<p><em>注意：<code>app</code>目录中的很多类都可以通过Artisan命令生成，要查看所有命令，使用命令：<code>php artisan list make</code></em></p>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/8788d26396c1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/8788d26396c1/" class="post-title-link" itemprop="url">laravel 学习指南 第六章 第三节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 05:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T05:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/8788d26396c1/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/8788d26396c1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-3-服务提交者"><a href="#6-3-服务提交者" class="headerlink" title="6.3 服务提交者"></a>6.3 服务提交者</h2><h3 id="6-3-1-简介"><a href="#6-3-1-简介" class="headerlink" title="6.3.1 简介"></a>6.3.1 简介</h3><p>服务提供者是所有laravel应用启动的中心，你自己的应用以及所有Laravel的核心服务都是通过服务提供者启动。</p>
<p>但是，我们所谓的<code>启动</code>指的是什么？通常，这意味着注册事物，包括注册服务容器绑定，事件监听器，中间件甚至路由。服务提供者是应用配置的中心。</p>
<p>如果你打开Laravel自带的<code>config/app.php</code>文件，将会看到一个<code>providers</code>数组，这里就是应用所要加载的所有服务提供者类，当然，其中很多是延迟加载的，也就是说不是每次请求都会被加载，只有真的用到它们的时候才会加载。</p>
<p>本章里你将会学习如何编写自己的服务提供者并在Laravel应用中注册它们。</p>
<hr>
<h3 id="6-3-2-编写服务提供者"><a href="#6-3-2-编写服务提供者" class="headerlink" title="6.3.2 编写服务提供者"></a>6.3.2 编写服务提供者</h3><p>所以得服务提供者继承自<code>Illuminate\Support\ServiceProvider</code>类。继承该抽象类要求至少在服务提供者中定义一个方法：<code>register</code>。在<code>register</code>方法内，你唯一要做的事情就是绑事物到服务容器，不要尝试在其中注册任何时间监听器，路由或者任何其它功能。</p>
<p>通过Artisan命令<code>make:provider</code>可以简单生成一个新的提供者：</p>
<pre><code>php artisan make:provider RiakServiceProvider
</code></pre>
<p>文件被创建到<code>App/Providers/RiakServiceProvider.php</code></p>
<h4 id="6-3-2-1-register方法"><a href="#6-3-2-1-register方法" class="headerlink" title="6.3.2.1 register方法"></a>6.3.2.1 register方法</h4><p>正如前面所提到的，在<code>register</code>方法中只绑定事物到服务容器，而不要做其它事情，否则，一不小心就会用到一个尚未被加载的服务提供者提供的服务。</p>
<p>现在来看看一个基本的服务提供者是什么样：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Riak</span>\<span class="title">Connection</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RiakServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在容器中注册绑定.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;app-&gt;singleton(<span class="string">&#x27;Riak\Contracts\Connection&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Connection(config(<span class="string">&#x27;riak&#x27;</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编辑的文件为<code>App/Providers/RiakServiceProvider.php</code></p>
<p>这个服务提供者只定义了一个<code>register</code>方法，并在服务容器中使用此方法定义了一份<code>Riak/connection</code>的实例。如果不清楚它是如何运作的，查看下一章节<code>服务容器</code>。</p>
<h4 id="6-3-2-2-boot方法"><a href="#6-3-2-2-boot方法" class="headerlink" title="6.3.2.2 boot方法"></a>6.3.2.2 boot方法</h4><p>如果我们想要在服务提供者中注册视图composer该怎么做？这就要用到<code>boot</code>方法，该方法在所有服务提供者被注册以后才会被调用，这就是说我们可以在其中访问框架已注册的所有其他服务：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Perform post-registration booting of services.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        view()-&gt;composer(<span class="string">&#x27;view&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在容器中注册绑定.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>boot方法的依赖注入</strong></li>
</ul>
<p>我们可以在<code>boot</code>方法中类型提升依赖，服务容器会自动注册你需要的依赖：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Routing</span>\<span class="title">ResponseFactory</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params">ResponseFactory <span class="variable">$factory</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$factory</span>-&gt;macro(<span class="string">&#x27;caps&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="6-3-3-注册服务提供者"><a href="#6-3-3-注册服务提供者" class="headerlink" title="6.3.3 注册服务提供者"></a>6.3.3 注册服务提供者</h3><p>所有服务提供者都是通过配置文件<code>config/app.php</code>中进行注册，该文件包含了一个列出所有服务提供者名字的<code>providers</code>数组，默认情况下，其中列出了所有核心服务提供者，这些服务提供者启动Laravel核心组件，比如邮件、列队、缓存等等。</p>
<p>要注册你自己的服务提供者，只需要将其追加到该数组中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;providers&#x27;</span> =&gt; [</span><br><span class="line">     <span class="comment">// 其它服务提供者</span></span><br><span class="line">     App\Providers\AppServiceProvider::class,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="6-3-4-延迟加载服务提供者"><a href="#6-3-4-延迟加载服务提供者" class="headerlink" title="6.3.4 延迟加载服务提供者"></a>6.3.4 延迟加载服务提供者</h3><p>如果你的提供者仅仅只是在服务容器中注册绑定，你可以选择在延迟加载该绑，定直到注册绑定真的需要时再加载，延迟加载这样的一个提供者将会提升应用的性能，因为它不会在每次请求时都从文件系统加载。</p>
<p>想要延迟加载一个提供者，设置defer属性为true并定义一个provides方法，该方法返回该提供者注册的服务容器绑定：</p>
<p>想要延迟加载一个提供者，设置<code>defer</code>属性为<code>true</code>并定义一个<code>provides</code>方法，该方法返回该提供者注册的服务容器绑定：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Riak</span>\<span class="title">Connection</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RiakServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 服务提供者加是否延迟加载.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$defer</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册服务提供者</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;app-&gt;singleton(<span class="string">&#x27;Riak\Contracts\Connection&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Connection(<span class="variable">$app</span>[<span class="string">&#x27;config&#x27;</span>][<span class="string">&#x27;riak&#x27;</span>]);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取由提供者提供的服务.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">provides</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;Riak\Contracts\Connection&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Laravel编译并保存所有延迟服务者提供的服务以及服务提供者的类名。</p>
<p>然后，只有当你尝试解析其中某个服务时Laravel才会加载其服务提交者。</p>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/661ec6791c3e/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/661ec6791c3e/" class="post-title-link" itemprop="url">laravel 学习指南 第六章 第一节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 04:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T04:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/661ec6791c3e/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/661ec6791c3e/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-laravel框架"><a href="#6-laravel框架" class="headerlink" title="6 laravel框架"></a>6 laravel框架</h2><h2 id="6-1-一次请求的生命周期"><a href="#6-1-一次请求的生命周期" class="headerlink" title="6.1 一次请求的生命周期"></a>6.1 一次请求的生命周期</h2><h3 id="6-1-1-简介"><a href="#6-1-1-简介" class="headerlink" title="6.1.1 简介"></a>6.1.1 简介</h3><p>当我们使用现实世界中的任何工具时，如果理解了该工具的工作原理，那么用起来就会得心应手，应用开发也是如此。当你理解了开发工具如何工作，用起来就会更加游刃有余。</p>
<p>本文档的目标就是从一个更好、更高层面向你阐述 Laravel 框架的工作原理。通过对框架更全面的了解，一切都不再那么神秘，你将会更加自信的构建应用。</p>
<p>如果你不能马上理解所有这些条款，不要失去信心！先试着掌握一些基本的东西，你的知识将会随着对本文档的探索而不断提高。</p>
<hr>
<h3 id="6-1-2-生命周期预览"><a href="#6-1-2-生命周期预览" class="headerlink" title="6.1.2 生命周期预览"></a>6.1.2 生命周期预览</h3><h4 id="6-1-2-1-第一件事"><a href="#6-1-2-1-第一件事" class="headerlink" title="6.1.2.1 第一件事"></a>6.1.2.1 第一件事</h4><p>Laravel应用的所有请求入口都是<code>public/index.php</code>文件，所有请求都会被web服务器(Apache/Nginx)导向这个文件。<code>index.php</code>文件包含的代码并不多，但是，是加载框架其他部分的起点。</p>
<p><code>index.php</code>文件载入Composer生成的自动加载设置，然后从<code>bootstrap/app.php</code>脚本获取Laravel应用实例，Laravel的第一个动作就是创建服务容器实例。</p>
<h4 id="6-1-2-2-HTTP-Console内核"><a href="#6-1-2-2-HTTP-Console内核" class="headerlink" title="6.1.2.2 HTTP/Console内核"></a>6.1.2.2 HTTP/Console内核</h4><p>接下来，请求被发送到 HTTP 内核或 Console 内核，这取决于进入应用的请求类型。这两个内核是所有请求都要经过的中央处理器，现在，就让我们聚焦在位于 <code>app/Http/Kernel.php</code> 的 HTTP 内核。</p>
<p>HTTP 内核继承自 <code>Illuminate\Foundation\Http\Kernel</code> 类，该类定义了一个 <code>bootstrappers</code> 数组，这个数组中的类在请求被执行前运行，这些 <code>bootstrappers</code> 配置了错误处理、日志、检测应用环境以及其它在请求被处理前需要执行的任务。</p>
<p>HTTP 内核还定义了一系列所有请求在处理前需要经过的 HTTP 中间件，这些中间件处理 HTTP 会话的读写、判断应用是否处于维护模式、验证 CSRF 令牌等等。</p>
<p>HTTP 内核的标志性方法 handle 处理的逻辑相当简单：获取一个 Request，返回一个 Response，把该内核想象作一个代表整个应用的大黑盒子，输入 HTTP 请求，返回 HTTP 响应。</p>
<ul>
<li><p><strong>服务提供者</strong></p>
<p>  内核启动过程中最重要的动作之一就是为应用载入服务提供者，应用的所有服务提供者都被配置在 <code>config/app.php</code> 配置文件的  <code>providers</code> 数组中。首先，所有提供者的 <code>register</code> 方法被调用，然后，所有提供者被注册之后，<code>boot</code> 方法被调用。</p>
<p>  服务提供者负责启动框架的所有各种各样的组件，比如数据库、队列、验证器，以及路由组件等，正是因为他们启动并配置了框架提供的所有特性，服务提供者是整个 Laravel 启动过程中最重要的部分。</p>
</li>
<li><p><strong>分发请求</strong></p>
<p>  一旦应用被启动并且所有的服务提供者被注册，Request 将会被交给路由器进行分发，路由器将会分发请求到路由或控制器，同时运行所有路由指定的中间件。</p>
</li>
</ul>
<hr>
<h3 id="6-1-3-聚集服务提交者"><a href="#6-1-3-聚集服务提交者" class="headerlink" title="6.1.3 聚集服务提交者"></a>6.1.3 聚集服务提交者</h3><p>服务提供者是启动 Laravel 应用中最关键的部分，应用实例被创建后，服务提供者被注册，请求被交给启动后的应用进行处理，整个过程就是这么简单！</p>
<p>对 Laravel 应用如何通过服务提供者构建和启动有一个牢固的掌握非常有价值，当然，应用默认的服务提供者存放在 <code>app/Providers</code> 目录下。</p>
<p>默认情况下，<code>AppServiceProvider</code> 是空的，这里是添加自定义启动和服务容器绑定的最佳位置，当然，对大型应用，你可能希望创建多个服务提供者，每一个都有着更加细粒度的启动。</p>
<h3 id="阅读感言"><a href="#阅读感言" class="headerlink" title="阅读感言"></a>阅读感言</h3><p>上面说了那么多，实际上可以理解为下方的简单流程。</p>
<ol>
<li><p><code>public/index.php</code>laravel访问的起点。创建服务容器。</p>
</li>
<li><p>请求进入内核(HTTP或Console)。</p>
</li>
<li><p>HTTP内核启动，laravel最重要的应用——服务提供者。</p>
</li>
<li><p>服务提供者启动各种各样的组件。</p>
</li>
<li><p>当所有的服务提供者被注册，路由开始工作。</p>
</li>
</ol>
<p>默认服务提供者存放在<code>app/Providers</code>。</p>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/afa67e043e16/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/afa67e043e16/" class="post-title-link" itemprop="url">laravel 学习指南 第五章 第七节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 03:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T03:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/afa67e043e16/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/afa67e043e16/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-7-Blade-模板"><a href="#5-7-Blade-模板" class="headerlink" title="5.7 Blade 模板"></a>5.7 Blade 模板</h2><h3 id="5-7-1-简介"><a href="#5-7-1-简介" class="headerlink" title="5.7.1 简介"></a>5.7.1 简介</h3><p>Blade 是 Laravel 提供的一个非常简单但很强大的模板引擎，不同于其他流行的PHP模板引擎，Blade在视图中并不约束你使用PHP原生代码。所有的Blade视图都会被编译成原生PHP代码并缓存起来直到被修改，这意味着对应用的性能而言Blade基本上是零开销。Blade视图文件使用<code>.blade.php</code>文件扩展并存放在<code>resources/views</code>目录下。</p>
<hr>
<h3 id="5-7-2-模板继承"><a href="#5-7-2-模板继承" class="headerlink" title="5.7.2 模板继承"></a>5.7.2 模板继承</h3><h4 id="5-7-2-1-定义页面布局"><a href="#5-7-2-1-定义页面布局" class="headerlink" title="5.7.2.1 定义页面布局"></a>5.7.2.1 定义页面布局</h4><p>使用Blade的两个最大的优点是模板继承和切片，开始之前先看一个例子。</p>
<p>首先，检测一个主页面布局，由于大多数web应用在不同页面中使用同一个布局，可以很方便的将这个布局定义为一个单独的Blade页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 存放在 resources/views/layouts/master.blade.php --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>App Name - @yield(&#x27;title&#x27;)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        @section(&#x27;sidebar&#x27;)</span><br><span class="line">            This is the master sidebar.</span><br><span class="line">        @show</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">            @yield(&#x27;content&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>正如所看到的，该文件包含典型的HTML标记，然而，注意<code>@section</code>和<code>@yield</code>指令，前者正如其名字所暗示的，定义了一个内容的片段，而后者用于显示给定片段的内容。</p>
<p>现在我们已经为应用定义了一个布局，接下来让我们定义继承该布局的子页面。</p>
<h4 id="5-7-2-2-扩展页面布局"><a href="#5-7-2-2-扩展页面布局" class="headerlink" title="5.7.2.2 扩展页面布局"></a>5.7.2.2 扩展页面布局</h4><p>定义子页面的时候，可以使用Blade的<code>@extends</code>指令来指定子页面所继承的布局，继承一个Blade布局的视图将会使用<code>@section</code>指令注入内容到布局的片段中，记住，如上面例子所示，这些片段的内容将会显示在布局中使用<code>@yield</code>的地方：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 存放在 resources/views/child.blade.php --&gt;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">extends</span>(<span class="string">&#x27;layouts.master&#x27;</span>)</span><br><span class="line"></span><br><span class="line">@section(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;Page Title&#x27;</span>)</span><br><span class="line"></span><br><span class="line">@section(<span class="string">&#x27;sidebar&#x27;</span>)</span><br><span class="line">    @<span class="built_in">parent</span></span><br><span class="line"></span><br><span class="line">    &lt;p&gt;This is appended to the master sidebar.&lt;/p&gt;</span><br><span class="line">@endsection</span><br><span class="line"></span><br><span class="line">@section(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">    &lt;p&gt;This is my body content.&lt;/p&gt;</span><br><span class="line">@endsection</span><br></pre></td></tr></table></figure>
<p>在本例中，<code>sidebar</code>片段使用<code>@parent</code>指令来追加内容到布局中<code>sidebar</code>,<code>@parent</code>指令在视图渲染时将会被布局中的内容替换。</p>
<p>当然，和原始PHP视图一样，Blade视图可以通过<code>view</code>方法直接从路由中返回：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;blade&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> view(<span class="string">&#x27;child&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-7-3-数据显示"><a href="#5-7-3-数据显示" class="headerlink" title="5.7.3 数据显示"></a>5.7.3 数据显示</h3><p>可以通过两个花括号包裹变量来显示传递到视图的数据，比如，如果给出如下路由：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;greeting&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;welcome&#x27;</span>, [<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Samantha&#x27;</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>那么可以通过如下方式显示<code>name</code>变量的内容:</p>
<pre><code>Hello, &#123;&#123; $name &#125;&#125;.
</code></pre>
<p>当然，不限制显示到视图中的变量内容，你还可以输出任何PHP函数，实际上，可以将任何PHP代码放到Blade模板语句中：</p>
<pre><code>The current UNIX timestamp is &#123;&#123; time() &#125;&#125;.
</code></pre>
<p>*注意：Blade的<code>&#123;&#123;&#125;&#125;`语句已经经过PHP的`htmlentities`函数处理以避免XSS攻击。*

#### 5.7.3.1 Blade & JavaScript 框架

由于很多Javascript框架也是用花括号表示，要显示在浏览器中的表达式，可以使用`@`告诉Blade渲染引擎该表达式应该保持原生格式不作改动。例如：

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Laravel<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Hello, @&#123;&#123; name &#125;&#125;.</span><br></pre></td></tr></table></figure>
这里`@`符合会被Blade移除。而且，Blade引擎会保留`&#123;&#123;name&#125;&#125;</code>表单式，如此一来可让其它Javascript框架使用。</p>
<h4 id="5-7-3-2-输出存在的数据"><a href="#5-7-3-2-输出存在的数据" class="headerlink" title="5.7.3.2 输出存在的数据"></a>5.7.3.2 输出存在的数据</h4><p>有时候想要输出一个变量，但是不确定该变量是否被设置，我们可以通过如下PHP代码：</p>
<pre><code>&#123;&#123; isset($name) ? $name : 'Default' &#125;&#125;
</code></pre>
<p>处理上方的方法，Blade还提供了更简单的方式：</p>
<pre><code>&#123;&#123; $name or 'Default' &#125;&#125;
</code></pre>
<p>在这里，如果<code>$name</code>变量存在，将会显示，否则将显示<code>Default</code></p>
<h4 id="5-7-3-3-显示原生数据"><a href="#5-7-3-3-显示原生数据" class="headerlink" title="5.7.3.3 显示原生数据"></a>5.7.3.3 显示原生数据</h4><p>默认情况下，Blade的<code>&#123;&#123; &#125;&#125;</code>语法已经通过PHP的<code>htmlentities</code>函数处理以避免XSS攻击，如果不想要数据被处理，可以使用如下语法：</p>
<pre><code>Hello, &#123;!! $name !!&#125;.
</code></pre>
<p><em>注意：对于用户输入的内容要当心，要使用双花括号以避免直接输出HTML代码。</em></p>
<hr>
<h3 id="5-7-4-流程控制"><a href="#5-7-4-流程控制" class="headerlink" title="5.7.4 流程控制"></a>5.7.4 流程控制</h3><p>除了模板继承和数据显示之外，Blade还为常用的PHP流程提供了便利操作，比如条件语句和循环，这些快捷操作提供了一个干净，简单的方式来处理PHP的流程控制，同时保持和PHP相应语句相似。</p>
<h4 id="5-7-4-1-If-语句"><a href="#5-7-4-1-If-语句" class="headerlink" title="5.7.4.1 If 语句"></a>5.7.4.1 If 语句</h4><p>可以使用<code>@if</code>,<code>@elseif</code>,<code>@else</code>,<code>@endif</code>,来构造if语句，这些指令函数和PHP的相同：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">if</span> (count(<span class="variable">$records</span>) === <span class="number">1</span>)</span><br><span class="line">    I have one record!</span><br><span class="line">@<span class="keyword">elseif</span> (count(<span class="variable">$records</span>) &gt; <span class="number">1</span>)</span><br><span class="line">    I have multiple records!</span><br><span class="line">@<span class="keyword">else</span></span><br><span class="line">    I don<span class="string">&#x27;t have any records!</span></span><br><span class="line"><span class="string">@endif</span></span><br></pre></td></tr></table></figure>

<p>为了方便，Blade还提供了<code>@unless</code>指令：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@unless (Auth::check())</span><br><span class="line">    You are not signed in.</span><br><span class="line">@endunless</span><br></pre></td></tr></table></figure>

<h4 id="5-7-4-2-循环"><a href="#5-7-4-2-循环" class="headerlink" title="5.7.4.2 循环"></a>5.7.4.2 循环</h4><p>除了条件语句，Blade还提供了简单指令处理PHP支持的循环结构，同样，这些指令函数和PHP一样：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">10</span>; <span class="variable">$i</span>++)</span><br><span class="line">    The current value is &#123;&#123; <span class="variable">$i</span> &#125;&#125;</span><br><span class="line">@<span class="keyword">endfor</span></span><br><span class="line"></span><br><span class="line">@<span class="keyword">foreach</span> (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>)</span><br><span class="line">    &lt;p&gt;This is user &#123;&#123; <span class="variable">$user</span>-&gt;id &#125;&#125;&lt;/p&gt;</span><br><span class="line">@<span class="keyword">endforeach</span></span><br><span class="line"></span><br><span class="line">@forelse (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>)</span><br><span class="line">    &lt;li&gt;&#123;&#123; <span class="variable">$user</span>-&gt;name &#125;&#125;&lt;/li&gt;</span><br><span class="line">    @<span class="keyword">empty</span></span><br><span class="line">    &lt;p&gt;No users&lt;/p&gt;</span><br><span class="line">@endforelse</span><br><span class="line"></span><br><span class="line">@<span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &lt;p&gt;I<span class="string">&#x27;m looping forever.&lt;/p&gt;</span></span><br><span class="line"><span class="string">@endwhile</span></span><br></pre></td></tr></table></figure>

<h4 id="5-7-4-3-包含子视图"><a href="#5-7-4-3-包含子视图" class="headerlink" title="5.7.4.3 包含子视图"></a>5.7.4.3 包含子视图</h4><p>Blade的<code>@include</code>指令允许你很简单的在一个视图中包含另一个Blade视图，所有父级视图中变量在被包含的子视图中依然有效：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    @include(&#x27;shared.errors&#x27;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Form Contents --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>尽管被包含的视图继承所有父视图中的数据，还可以传递额外参数到被包含的视图：</p>
<pre><code>@include(&#39;view.name&#39;, [&#39;some&#39; =&gt; &#39;data&#39;])
</code></pre>
<p><em>注意：不要再Blade视图中使用<code>__DIR__</code>和<code>__FIFL__</code>常量，因为他们会指向缓存视图的路径。</em></p>
<h4 id="5-7-4-4-为集合渲染视图"><a href="#5-7-4-4-为集合渲染视图" class="headerlink" title="5.7.4.4 为集合渲染视图"></a>5.7.4.4 为集合渲染视图</h4><p>使用Blade的<code>@each</code>指令将循环或引入 压缩成一行：</p>
<pre><code>@each(&#39;view.name&#39;, $jobs, &#39;job&#39;)
</code></pre>
<p>第一个参数为：对数组或集合的每个元素渲染的局部视图。</p>
<p>第二个参数为：要迭代的数组或集合。</p>
<p>第三个参数为：迭代时被分配到视图中的变数名称。</p>
<p>举例来说:如果迭代一个<code>jobs</code>数组，通常希望在局部视图中透过<code>job</code>变数存取每一个job。</p>
<p>传递第四个参数至<code>@each</code>指令。此参数为：当给定的数组为空时，将会被渲染的视图。</p>
<pre><code>@each(&#39;view.name&#39;, $jobs, &#39;job&#39;, &#39;view.empty&#39;)
</code></pre>
<h4 id="5-7-4-5-注释"><a href="#5-7-4-5-注释" class="headerlink" title="5.7.4.5 注释"></a>5.7.4.5 注释</h4><p>Blade还允许在视图中定义注释，然而，不同于HTML注释，Blade注释并不会包含到HTML中被返回：</p>
<pre><code>&#123;&#123;-- This comment will not be present in the rendered HTML --&#125;&#125;
</code></pre>
<hr>
<h3 id="5-7-5-服务注入"><a href="#5-7-5-服务注入" class="headerlink" title="5.7.5 服务注入"></a>5.7.5 服务注入</h3><p><code>@inject</code>指令可以用于从服务容器中获取服务，传递给<code>@inject</code>的第一个参数是服务将要被放置的变量名，第二个参数是要解析的服务类名或接口名：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@inject(<span class="string">&#x27;metrics&#x27;</span>, <span class="string">&#x27;App\Services\MetricsService&#x27;</span>)</span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line">    Monthly Revenue: &#123;&#123; <span class="variable">$metrics</span>-&gt;monthlyRevenue() &#125;&#125;.</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-7-6-扩展-Blade"><a href="#5-7-6-扩展-Blade" class="headerlink" title="5.7.6 扩展 Blade"></a>5.7.6 扩展 Blade</h3><p>Blade还允许你自定义指令，可以使用<code>directive</code>方法来注册一个指令。当Blade编辑器遇到该指令，将会传入参数并调用提供的回调。</p>
<p>下面的例子创建了一个<code>@datetime($var)</code>指令,格式化给定的<code>$var</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Blade</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Perform post-registration booting of services.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Blade::directive(<span class="string">&#x27;datetime&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$expression</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&lt;?php echo with<span class="subst">&#123;$expression&#125;</span>-&gt;format(&#x27;m/d/Y H:i&#x27;); ?&gt;&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在容器中注册绑定.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>laravel 辅助函数<code>with</code>被用在该指令中，<code>with</code>方法返回给定的对象或值，允许方法链。最终该指令生成的PHP代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> with(<span class="variable">$var</span>)-&gt;format(<span class="string">&#x27;m/d/Y H:i&#x27;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/e09a3c31d8b4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/e09a3c31d8b4/" class="post-title-link" itemprop="url">laravel 学习指南 第五章 第六节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 02:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T02:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/e09a3c31d8b4/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/e09a3c31d8b4/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-6-视图"><a href="#5-6-视图" class="headerlink" title="5.6 视图"></a>5.6 视图</h2><h3 id="5-6-1-基本使用"><a href="#5-6-1-基本使用" class="headerlink" title="5.6.1 基本使用"></a>5.6.1 基本使用</h3><p>视图包含的HTML代码并将控制器逻辑和表面逻辑进行分离。视图文件存放在<code>resources/views</code>目录。</p>
<p>下面是一个简单视图：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 该视图存放 resources/views/greeting.php --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &lt;?php echo $name; ?&gt;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>由于这个视图存放在<code>resources/views/greeting.php</code>,可以在全局的辅助函数<code>view</code>中这样返回它：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;greeting&#x27;</span>, [<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;James&#x27;</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>view</code>的第一个参是<code>resources/views</code>目录下相应的视图文件的名字，第二个参数是一个数组，该数组包含了在视图中的有效数据。</p>
<p>例子中，传递的是一个<code>name</code>变量，在视图中通过执行<code>echo</code>将其显示出来。</p>
<p>当然，视图还可以嵌套在<code>resources/views</code>的子目录中，用<code>.</code>来引用嵌套视图。</p>
<p>例如，视图存放路径是<code>resources/views/admin/profile.php</code>,那可以这样应用它：</p>
<pre><code>return view(&#39;admin.profile&#39;, $data);
</code></pre>
<h4 id="5-6-1-1-判断视图是否存在"><a href="#5-6-1-1-判断视图是否存在" class="headerlink" title="5.6.1.1 判断视图是否存在"></a>5.6.1.1 判断视图是否存在</h4><p>如果需要判断视图是否存在，可调用不带参数的<code>view</code>之后，使用<code>exists</code>方法，如果视图存在则返回<code>ture</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (view()-&gt;exists(<span class="string">&#x27;emails.customer&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用不带参数的<code>view</code>时，将会返回一个<code>Illuminate\Contracts\View\Factory</code>实例，从而调用该类上所有方法。</p>
<hr>
<h3 id="5-6-2-视图数据"><a href="#5-6-2-视图数据" class="headerlink" title="5.6.2 视图数据"></a>5.6.2 视图数据</h3><h4 id="5-6-2-1-传递数据到视图"><a href="#5-6-2-1-传递数据到视图" class="headerlink" title="5.6.2.1 传递数据到视图"></a>5.6.2.1 传递数据到视图</h4><p>在上述例子中可以看到，可以简单通过数组方式将数据传递到视图：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return view(&#x27;greetings&#x27;, [&#x27;name&#x27; =&gt; &#x27;Victoria&#x27;]);</span><br></pre></td></tr></table></figure>
<p>以这种方式传递数据，<code>$data</code>应该是一个键值对应该数组，在视图中，就可以使用响应的键来访问数组值。</p>
<p>例如<code>&lt;?php echo $key; ?&gt;</code>。还可以通过<code>with</code>方法添加独立的数据片段到视图：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$view</span> = view(<span class="string">&#x27;greeting&#x27;</span>)-&gt;with(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Victoria&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="5-6-2-2-在视图间共享数据"><a href="#5-6-2-2-在视图间共享数据" class="headerlink" title="5.6.2.2 在视图间共享数据"></a>5.6.2.2 在视图间共享数据</h4><p>有时候需要在所有视图之间共享数据片段，这时可以使用视图类的<code>share</code>方法，通常，需要在服务提供者的<code>boot</code>方法中调用<code>share</code>方法，你可以将其添加到<code>AppServiceProvider</code>或生成独立的服务提供者来存放它们：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动所有应用服务</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        view()-&gt;share(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册服务提供者</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-6-3-视图Composer"><a href="#5-6-3-视图Composer" class="headerlink" title="5.6.3 视图Composer"></a>5.6.3 视图Composer</h3><p>视图Composer就是在视图被渲染前，会呼叫的闭包或类别方法。</p>
<p>如果想在每次渲染都绑定一些数据，可以使用视图Composer将这种的程序逻辑放到同一个地方。</p>
<p>首先在服务提供者中注册视图Composer。</p>
<p>之后将使用<code>view</code>访问<code>Illuminate\Contracts\View\Factory </code>的底层实现。</p>
<p>laravel不会包含默认的视图Composer目录，可以随意设置路径。</p>
<p>例如，创建一个<code>App\Http\ViewComposers</code>目录：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComposerServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在容器中注册绑定.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> http://laravelacademy.org</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 使用基于类的composers...</span></span><br><span class="line">        view()-&gt;composer(</span><br><span class="line">            <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;App\Http\ViewComposers\ProfileComposer&#x27;</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用基于闭包的composers...</span></span><br><span class="line">        view()-&gt;composer(<span class="string">&#x27;dashboard&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$view</span></span>) </span>&#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册服务提供者.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果创建一个新的服务提供者包含视图Composer注册，需要添加该服务提供者到配置文件<code>config/app.php</code>的<code>providers</code>数组中。</p>
<p>现在我们已经注册了Composer，每次<code>profile</code>视图被渲染时都会执行<code>PrefileComposer@compose</code>,接下来定义Composer类：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">ViewComposers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">View</span>\<span class="title">View</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Users</span>\<span class="title">Repository</span> <span class="title">as</span> <span class="title">UserRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProfileComposer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户仓库实现.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> UserRepository</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$users</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个新的属性composer.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> UserRepository $users</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">UserRepository <span class="variable">$users</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Dependencies automatically resolved by service container...</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;users = <span class="variable">$users</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定数据到视图.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> View $view</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">View <span class="variable">$view</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$view</span>-&gt;with(<span class="string">&#x27;count&#x27;</span>, <span class="keyword">$this</span>-&gt;users-&gt;count());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>视图被渲染前，Composer类的composer方法被调用，同时<code>Illuminate\Contracts\View\View</code>被注入该方法，从而可以使用<code>with</code>方法来绑定数据到视图。</p>
<p><em>注意：所有视图Composer都通过服务容器被解析，所以可以在Composer类的构造函数中声明任何需要的依赖。</em></p>
<h4 id="5-6-3-1-添加-Composer-到多个视图"><a href="#5-6-3-1-添加-Composer-到多个视图" class="headerlink" title="5.6.3.1 添加 Composer 到多个视图"></a>5.6.3.1 添加 Composer 到多个视图</h4><p>可以传递视图数组作为<code>composer</code>方法的第一个参数，来一次将视图Composer添加到多个视图：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">view()-&gt;composer(</span><br><span class="line">    [<span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;dashboard&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;App\Http\ViewComposers\MyViewComposer&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><code>composer</code>方法接受<code>*</code>通配符，从而允许将一个Composer添加到所有视图:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">view()-&gt;composer(<span class="string">&#x27;*&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$view</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-6-4-视图创建器"><a href="#5-6-4-视图创建器" class="headerlink" title="5.6.4 视图创建器"></a>5.6.4 视图创建器</h3><p>视图创造器和视图Composer非常类似。不同在于，前者在视图实例化之后立即失效而不是等到视图即将渲染。</p>
<p>使用<code>create</code>方法可注册一个视图创建器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">view()-&gt;creator(&#x27;profile&#x27;, &#x27;App\Http\ViewCreators\ProfileCreator&#x27;);</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/78a7f2eb97d1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/78a7f2eb97d1/" class="post-title-link" itemprop="url">laravel 学习指南 第五章 第五节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 01:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T01:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/78a7f2eb97d1/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/78a7f2eb97d1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-5-响应"><a href="#5-5-响应" class="headerlink" title="5.5 响应"></a>5.5 响应</h2><h3 id="5-5-1-基本响应"><a href="#5-5-1-基本响应" class="headerlink" title="5.5.1 基本响应"></a>5.5.1 基本响应</h3><p>所有路由和控制器都会返回某种被发送到用户浏览器的响应，laravel提供多种不同的方式来返回响应，最基本的响应就是从路由或控制器返回一个简单的字符串：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>给定的字符串会被框架自动转化为HTTP响应。</p>
<h4 id="5-5-1-1-Response对象"><a href="#5-5-1-1-Response对象" class="headerlink" title="5.5.1.1 Response对象"></a>5.5.1.1 Response对象</h4><p>大多数路由和控制器动作都会返回一个完整的<code>Illuminate\Http\Response</code>实例或视图，返回一个完整的Response实例允许你自定义响应的HTTP状态码和头信息。Responses实例继承自<code>Symfony\Component\HttpFoundation\Response</code>类，该类提供了一系列方法用于创建HTTP响应：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Response</span>;</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;home&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> (<span class="keyword">new</span> Response(<span class="variable">$content</span>, <span class="variable">$status</span>))</span><br><span class="line">-&gt;header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="variable">$value</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>为了方便，还可以使用辅助函数<code>response</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;home&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response(<span class="variable">$content</span>, <span class="variable">$status</span>)</span><br><span class="line">        -&gt;header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="variable">$value</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>注意：要查看完整的Response方法列表，看可以查看<a target="_blank" rel="noopener" href="https://laravel.com/api/master/Illuminate/Http/Response.html">API文档</a>与<a target="_blank" rel="noopener" href="http://api.symfony.com/2.7/Symfony/Component/HttpFoundation/Response.html">Symfony API 文档</a></em></p>
<h4 id="5-5-1-2-添加响应头"><a href="#5-5-1-2-添加响应头" class="headerlink" title="5.5.1.2 添加响应头"></a>5.5.1.2 添加响应头</h4><p>大部分响应方法可以用方法链形式调用，从而使得可以建立平滑的响应。</p>
<p>例如，你可以在响应送出给使用者之前，使用<code>header</code>方法增加一系列的响应头到响应：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> response(<span class="variable">$content</span>)</span><br><span class="line">            -&gt;header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="variable">$type</span>)</span><br><span class="line">            -&gt;header(<span class="string">&#x27;X-Header-One&#x27;</span>, <span class="string">&#x27;Header Value&#x27;</span>)</span><br><span class="line">            -&gt;header(<span class="string">&#x27;X-Header-Two&#x27;</span>, <span class="string">&#x27;Header Value&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>或者，可以使用<code>withHeaders</code>方法指定要增加至回应的响应头数组：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> response(<span class="variable">$content</span>)</span><br><span class="line">    -&gt;withHeaders([</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span> =&gt; <span class="variable">$type</span>,</span><br><span class="line">        <span class="string">&#x27;X-Header-One&#x27;</span> =&gt; <span class="string">&#x27;Header Value&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;X-Header-Two&#x27;</span> =&gt; <span class="string">&#x27;Header Value&#x27;</span>,</span><br><span class="line">    ]);</span><br></pre></td></tr></table></figure>

<h4 id="5-5-1-3-添加Cookie到响应"><a href="#5-5-1-3-添加Cookie到响应" class="headerlink" title="5.5.1.3 添加Cookie到响应"></a>5.5.1.3 添加Cookie到响应</h4><p>透过响应实例的函数<code>cookie</code>可以轻松添加Cookie到响应：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> response(<span class="variable">$content</span>)-&gt;header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="variable">$type</span>)</span><br><span class="line">    -&gt;cookie(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;value&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><code>cookie</code>方法接收额外的可选参数，使你可以进一步自定cookies的属性：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-&gt;cookie(<span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$minutes</span>, <span class="variable">$path</span>, <span class="variable">$domain</span>, <span class="variable">$secure</span>, <span class="variable">$httpOnly</span>)</span><br></pre></td></tr></table></figure>
<p>默认情况下，laravel框架生成的Cookie经过了加密和签名，以免在客户端被纂改。</p>
<p>如果想要让特定的Cookie子集在生成时取消加密，可以使用中间件<code>App\Http\Middleware\EncryptCookies</code>的<code>$except</code>属性来排除这些Cookie：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 不需要被加密的cookies名称</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$except</span> = [</span><br><span class="line">    <span class="string">&#x27;cookie_name&#x27;</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-5-2-其他响应类型"><a href="#5-5-2-其他响应类型" class="headerlink" title="5.5.2 其他响应类型"></a>5.5.2 其他响应类型</h3><p>辅助函数<code>response</code>可以很方便地用来生成其他类型的响应实例，当无参数调用<code>response</code>时会返回<code>Illuminate\Contracts\Routing\ResponseFactory</code>的一个实现类实例契约，该契约提供了一些有用的方法来生成响应。</p>
<h4 id="5-5-2-1-视图"><a href="#5-5-2-1-视图" class="headerlink" title="5.5.2.1 视图"></a>5.5.2.1 视图</h4><p>如果需要控制响应状态和响应头，并还需要返回一个视图作为响应内容，可以使用<code>view</code>方法:</p>
<pre><code>return response()-&gt;view(&#39;hello&#39;, $data)-&gt;header(&#39;Content-Type&#39;, $type);
</code></pre>
<p>当然，如果不需要传递自定义的HTTP状态码和头信息，只需要简单使用全局函数<code>view</code>即可。</p>
<h4 id="5-5-2-2-JSON"><a href="#5-5-2-2-JSON" class="headerlink" title="5.5.2.2 JSON"></a>5.5.2.2 JSON</h4><p><code>json</code>方法会自动将<code>Content-Type</code>头设置为<code>application/json</code>,并使用PHP函数<code>json_encode</code>方法将给定数组转化为JSON：</p>
<pre><code>return response()-&gt;json([&#39;name&#39; =&gt; &#39;Abigail&#39;, &#39;state&#39; =&gt; &#39;CA&#39;]);
</code></pre>
<p>如果要创建一个JSONP响应，可以在<code>json</code>方法之后调用<code>setCallback</code>方法：</p>
<pre><code>return response()-&gt;json([&#39;name&#39; =&gt; &#39;Abigail&#39;, &#39;state&#39; =&gt; &#39;CA&#39;])
    -&gt;setCallback($request-&gt;input(&#39;callback&#39;));
</code></pre>
<h4 id="5-5-2-3-文件下载"><a href="#5-5-2-3-文件下载" class="headerlink" title="5.5.2.3 文件下载"></a>5.5.2.3 文件下载</h4><p><code>download</code>方法用于生成强制用户浏览器下载给定路由文件的响应。<code>download</code>文件接受文件名作为第二个参数，该参数决定用户下载文件的显示名称，可以将HTTP头信息作为第三个参数传递到该方法：</p>
<pre><code>return response()-&gt;download($pathToFile);
return response()-&gt;download($pathToFile, $name, $headers);
</code></pre>
<p><em>注意：管理文件下载的 Symfony HttpFoundation 类要求被下载文件有一个ASCII文件名。</em></p>
<hr>
<h3 id="5-5-3-重定向"><a href="#5-5-3-重定向" class="headerlink" title="5.5.3 重定向"></a>5.5.3 重定向</h3><p>重定向响应是<code>Illuminate\Http\RedirectResponse</code>类的实例，其中包含了必须的头信息将用户重定向到另一个 URL，有很多方式来生成 <code>RedirectResponse</code> 实例，最简单的方法就是使用全局辅助函数 <code>redirect</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;dashboard&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;home/dashboard&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>有时候想要将用户重定向到上一个请求的位置。</p>
<p>例如，表单提交后，验证不通过，就可以使用辅助函数<code>back</code>返回到前一个URL(使用该方法之前确保路由使用了<code>web</code>中间件组或都使用了<code>session </code>中间件)：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">&#x27;user/profile&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 验证请求...</span></span><br><span class="line">    <span class="keyword">return</span> back()-&gt;withInput();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5-5-3-1-重定向到命名路由"><a href="#5-5-3-1-重定向到命名路由" class="headerlink" title="5.5.3.1 重定向到命名路由"></a>5.5.3.1 重定向到命名路由</h4><p>如果调用不带参数的<code>redirect</code>方法，会返回一个<code>Illuminate\Routing\Redirector</code>实例，然后可以调用该实例上的任何方法。</p>
<p>例如:为了生成一个<code>RedirectResponse</code>到命令路由，可以使用<code>route</code>方法：</p>
<pre><code>return redirect()-&gt;route(&#39;login&#39;);
</code></pre>
<p>如果路由中有参数，可以将其作为第二个参数传递到<code>route</code>方法：</p>
<pre><code>// For a route with the following URI: profile/&#123;id&#125;
return redirect()-&gt;route(&#39;profile&#39;, [1]);
</code></pre>
<p>如果要重定向到带ID参数的路由(Eloquent 模型绑定),可以传递模型本身，ID会被自动解析出来：</p>
<pre><code>return redirect()-&gt;route(&#39;profile&#39;, [$user]);
</code></pre>
<h4 id="5-5-3-2-重定向到控制器动作"><a href="#5-5-3-2-重定向到控制器动作" class="headerlink" title="5.5.3.2 重定向到控制器动作"></a>5.5.3.2 重定向到控制器动作</h4><p>还可以生成重定向到控制器动作，只需传递控制器和动作名到<code>action</code>方法即可。记住，不需要指定控制器的完整命名。laravel的<code>RouteServiceProvider</code>会自动设置默认的控制器命名：</p>
<pre><code>return redirect()-&gt;action(&#39;HomeController@index&#39;);
</code></pre>
<p>当然，如果控制器路由要求参数，可以将参数作为第二个参数传递给<code>action</code>方法：</p>
<pre><code>return redirect()-&gt;action(&#39;UserController@profile&#39;, [1]);
</code></pre>
<h4 id="5-5-3-3-带一次性-Session-数据的重定向"><a href="#5-5-3-3-带一次性-Session-数据的重定向" class="headerlink" title="5.5.3.3 带一次性 Session 数据的重定向"></a>5.5.3.3 带一次性 Session 数据的重定向</h4><p>重定向到一个新的URL并将数据存储到一次性Session中通常是同时完成的，为了方便，可以创建一个<code>RedirectResponse</code>实例然后在同一方法上将数据存储到Session，这种方式在action之后存储状态信息特别方便：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::post(<span class="string">&#x27;user/profile&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 更新用户属性...</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;dashboard&#x27;</span>)-&gt;with(<span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;Profile updated!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当然，用户重定向到新页面之后，你可以从Session中取出并显示这些一次性信息。</p>
<p>例如，使用Blade语法实现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@if (session(&#x27;status&#x27;))</span><br><span class="line">    &lt;div class=&quot;alert alert-success&quot;&gt;</span><br><span class="line">        &#123;&#123; session(&#x27;status&#x27;) &#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">@endif</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-5-4-响应宏"><a href="#5-5-4-响应宏" class="headerlink" title="5.5.4 响应宏"></a>5.5.4 响应宏</h3><p>如果想要定义一个自定义的响应并且在多个路由和控制器中复用，可以使用<code>Illuminate\Contracts\Routing\ResponseFactory</code>类，或者<code>Response</code>函数中的<code>macro</code>方法。</p>
<p>例如：在某个服务提供者的boot方法中编写代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Response</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResponseMacroServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Perform post-registration booting of services.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Response::macro(<span class="string">&#x27;caps&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Response::make(strtoupper(<span class="variable">$value</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>macro</code>方法接收响应名称作为第一个参数，闭包函数作为第二个参数，<code>macro</code>的闭包在<code>ResponseFactory</code>类或<code>Response</code>函数中的<code>macro</code>方法时执行：</p>
<pre><code>return response()-&gt;caps(&#39;foo&#39;);
</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/26/a3ed63a923fe/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/26/a3ed63a923fe/" class="post-title-link" itemprop="url">laravel 学习指南 第五章 第四节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-26 00:00:00" itemprop="dateCreated datePublished" datetime="2016-07-26T00:00:00+08:00">2016-07-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/26/a3ed63a923fe/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/26/a3ed63a923fe/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h1 id="5-4-请求"><a href="#5-4-请求" class="headerlink" title="5.4 请求"></a>5.4 请求</h1><h3 id="5-4-1-获取请求"><a href="#5-4-1-获取请求" class="headerlink" title="5.4.1 获取请求"></a>5.4.1 获取请求</h3><p>通过依赖注入获取当前HTTP请求实例，应该在控制器的构造函数或方法中对<code>Illuminate\Http\Request</code>类进行类型提示，当前请求实例会被服务容器自动注入：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Routing</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存储新用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span>=<span class="variable">$request</span>-&gt;input(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果你的控制器方法还期望获取路由参数输入，只需要将路由参数置于其它依赖之后即可，例如，如果你的路由定义如下：</p>
<pre><code>Route::put(&#39;user/&#123;id&#125;&#39;,&#39;UserController@update&#39;);
</code></pre>
<p>依然可以对<code>Illuminate\Http\Request</code>进行类型提示并通过如下方式定义控制器方法来访问路由参数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Routing</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line">classUser Controller <span class="keyword">extends</span> Controller</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新指定用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">Request <span class="variable">$request</span>,<span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-4-1-1-基本请求信息"><a href="#5-4-1-1-基本请求信息" class="headerlink" title="5.4.1.1 基本请求信息"></a>5.4.1.1 基本请求信息</h4><p><code>Illuminate\Http\Request</code>实例提交了多个方法来检查应用的HTTP请求，laravel的<code>Illuminate\Http\Request</code>继承自<code>Symfony\Component\HttpFoundation\Request</code>类，下面演示了一些有用的方法：</p>
<ul>
<li><p><strong>获取请求URI</strong></p>
<p>  path方法将会返回请求的URI（返回的是域名之后的部分），如果进入的请求路径是<code>http://domain.com/foo/bar</code>,则<code>path</code>方法将会返回<code>foo/bar</code>:</p>
<pre><code>  $uri=$request-&gt;path();
</code></pre>
<p>  <code>is</code>方法允许你验证进入的请求是否与给定模式匹配。使用该方法可以使用<code>*</code>通用符：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$request</span>-&gt;is(<span class="string">&#x27;admin/*&#x27;</span>))&#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  想要获取完整的URL，而不仅仅是路径信息，可以使用请求实例中的<code>url</code>或<code>fullUrl</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$url</span>=<span class="variable">$request</span>-&gt;url();</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$request</span>-&gt;fullUrl();</span><br></pre></td></tr></table></figure></li>
<li><p><strong>获取请求方法</strong></p>
<p>  <code>method</code>方法将会返回请求的HTTP请求方式。你可以使用<code>isMethod</code>方法来验证HTTP请求方式是否匹配给定字符串：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$method</span>=<span class="variable">$request</span>-&gt;method();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$request</span>-&gt;isMethod(<span class="string">&#x27;post&#x27;</span>))&#123; </span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="5-4-1-2-PSR-7-请求"><a href="#5-4-1-2-PSR-7-请求" class="headerlink" title="5.4.1.2 PSR-7 请求"></a>5.4.1.2 PSR-7 请求</h4><p>PSR-7标准指定了HTTP信息接口，包括请求和响应。如果想要获取PSR-7请求实例，首先需要安装一些库，laravel使用<code>Symfony HTTP Message Bridge</code>组件，将原的laravel请求和响应转化为PSR-7兼容的请求：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">composer require symfony/psr-http-message-bridge</span><br><span class="line">composer require zendframework/zend-diactoros</span><br></pre></td></tr></table></figure>
<p>安装完这些库之后，只需要在路由或控制器中通过，对请求类型进行类型提示就可以获取RSR-7请求：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Message</span>\<span class="title">ServerRequestInterface</span>;</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ServerRequestInterface <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果从路由或控制器返回的是PSR-7响应实例，则其将会自动转化为laravel响应实例并显示出来。</p>
<hr>
<h3 id="5-4-2-获取输入信息"><a href="#5-4-2-获取输入信息" class="headerlink" title="5.4.2 获取输入信息"></a>5.4.2 获取输入信息</h3><ul>
<li><p><strong>获取特定输入值</strong></p>
<p>  通过<code>Illuminate\Http\Request </code>实例，使用简单的方法就可以取得所有的使用者输入资料。</p>
<p>  不需要担心发出请求时使用的HTTP动词，获取输入资料的方式都是相同的。</p>
<pre><code>  $name = $request-&gt;input(&#39;name&#39;);
</code></pre>
<p>  此外，可以使用<code>Illuminate\Http\Request </code>的动态属性存取使用者输入。</p>
<p>  例如，如果你的应用程序的表单含有一个<code>name</code>字段，可以使用下面的方式提交：</p>
<pre><code>  $name = $request-&gt;name;
</code></pre>
<p>  还可以传统一个默认值作为第二个参数给<code>input</code>方法，如果请求输入值在当前请求未出现时该值将会返回：</p>
<pre><code>  $name = $request-&gt;input(&#39;name&#39;, &#39;Sally&#39;);
</code></pre>
<p>  处理表单数组输入时，可以使用<code>.</code>来访问数组输入：</p>
<pre><code>  $input = $request-&gt;input(&#39;products.0.name&#39;);
  $names = $request-&gt;input(&#39;products.*.name&#39;);
</code></pre>
</li>
<li><p><strong>判断输入值是否出现</strong></p>
<p>  判断值是否在请求中出现，可以使用<code>has</code>方法，如果值出现且不为空，<code>has</code>方法返回<code>true</code>:</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ($request-&gt;has(&#x27;name&#x27;)) &#123;</span><br><span class="line">    //</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>获取所有输入数据</strong></p>
<p>  还可以通过<code>all</code>方法获取所有输入数据：</p>
<pre><code>  $input = $request-&gt;all();
</code></pre>
</li>
<li><p><strong>获取部分输入数据</strong></p>
<p>  如何需要取出输入数据的子集，可以使用<code>only</code>或<code>except</code>方法，这两个方法都接收一个数组或动态列表作为唯一参数:</p>
<pre><code>  $input = $request-&gt;only([&#39;username&#39;, &#39;password&#39;]);
  $input = $request-&gt;only(&#39;username&#39;, &#39;password&#39;);
  
  $input = $request-&gt;except([&#39;credit_card&#39;]);
  $input = $request-&gt;except(&#39;credit_card&#39;);
</code></pre>
</li>
</ul>
<h4 id="5-4-2-1-上一次请求输入"><a href="#5-4-2-1-上一次请求输入" class="headerlink" title="5.4.2.1 上一次请求输入"></a>5.4.2.1 上一次请求输入</h4><p>laravel 允许你在两次请求之间保存输入数据，这个特性在检测校验数据失败后需要重新填充表单数据时很有用。</p>
<p>但如果使用的是laravel内置的验证服务，则不需要手动使用这些方法，因为一些laravel内置的校验会自动调用它们。</p>
<ul>
<li><p><strong>将输入存储到一次性Session</strong></p>
<p>  <code>Illuminate\Http\Request</code>实例的<code>flash</code>方法会将当前输入存放到一次性<code>Session</code>中，下次使用者发出请求至应用程序时就可以使用它们：</p>
<pre><code>  $request-&gt;flash();
</code></pre>
<p>  还可以使用<code>flashOnly</code>和<code>flashExcept</code>方法将输入数据子集存储到Session中：</p>
<pre><code>  $request-&gt;flashOnly(&#39;username&#39;, &#39;email&#39;);
  $request-&gt;flashExcept(&#39;password&#39;);
</code></pre>
</li>
<li><p><strong>将输入存储到一次性Session然后重定向</strong></p>
<p>  可能常常需要使用Session中的数据，并重新定向到前一页。可以简单使用<code>withInput</code>方法来将输入数据链接到<code>redirect</code>后面:</p>
<pre><code>  return redirect(&#39;form&#39;)-&gt;withInput();
  return redirect(&#39;form&#39;)-&gt;withInput($request-&gt;except(&#39;password&#39;));
</code></pre>
</li>
<li><p><strong>获取上次输入数据</strong></p>
<p>  要从Session中取出上次请求的输入数据，可以使用Request实例的<code>old</code>方法。<code>old</code>方法提供了便利方式从Session中取出数据：</p>
<pre><code>  $username = $request-&gt;old(&#39;username&#39;);
</code></pre>
<p>  laravel还提供了一个全局的辅助函数<code>old</code>，如果在Blade模板中显示上次输入数据，使用辅助函数<code>old</code>更方便，如果给定参数没有对应输入，返回null：</p>
<pre><code>  &#123;&#123; old('username') &#125;&#125;
</code></pre>
</li>
</ul>
<h4 id="5-4-2-2-Cookies"><a href="#5-4-2-2-Cookies" class="headerlink" title="5.4.2.2 Cookies"></a>5.4.2.2 Cookies</h4><ul>
<li><p><strong>从请求中取出Cookies</strong></p>
<p>  laravel 框架创建的所有cookies都经过加密并使用一个认证码进行签名，这意味着如果客户端修改了它们则需要对其进行有效性验证。使用<code>Illuminate\Http\Request</code>类中的 <code>cookie</code>方法从请求中获取cookie的值：</p>
<pre><code>  $value = $request-&gt;cookie(&#39;name&#39;);
</code></pre>
</li>
</ul>
<ul>
<li><p><strong>新增Cookies到回应</strong></p>
<p>  laravel 提供一个全局辅助函数<code>cookie</code>作为一个简单工厂来生成新的<code>Symfony\Component\HttpFoundation\Cookie</code>实例，新增的<code>cookie</code>通过<code>withCookie</code>方法被附加到<code>Illuminate\Http\Response</code>实例：</p>
<pre><code>  $response = new Illuminate\Http\Response(&#39;Hello World&#39;);
  $response-&gt;withCookie(cookie(&#39;name&#39;, &#39;value&#39;, $minutes));
  return $response;
</code></pre>
<p>  想要创建一个长期有效的cookie，可以使用cookie工厂的<code>forever</code>方法：</p>
<pre><code>  $response-&gt;withCookie(cookie()-&gt;forever(&#39;name&#39;, &#39;value&#39;));
</code></pre>
</li>
</ul>
<h4 id="5-4-2-3-文件上传"><a href="#5-4-2-3-文件上传" class="headerlink" title="5.4.2.3 文件上传"></a>5.4.2.3 文件上传</h4><ul>
<li><p><strong>获取上传的文件</strong></p>
<p>  使用<code>Illuminate\Http\Request</code>实例的<code>file</code>方法来访问上传文件，该方法返回的对象是<code>Symfony\Component\HttpFoundation\File\UploadedFile</code>类的一个实例，该类继承自PHP标准库中，与文件交互的<code>SplFileInfo</code>类：</p>
<pre><code>  $file = $request-&gt;file(&#39;photo&#39;);
</code></pre>
<p>  可以使用<code>hasFile</code>方法，判断上传文件是否存在：</p>
<pre><code>  if ($request-&gt;hasFile(&#39;photo&#39;)) &#123;
      //
  &#125;
</code></pre>
</li>
<li><p><strong>验证文件是否上传成功</strong></p>
<p>  使用<code>isValid</code>方法判断文件在上传过程中是否出错：</p>
<pre><code>  if ($request-&gt;file(&#39;photo&#39;)-&gt;isValid())&#123;
      //
  &#125;
  
</code></pre>
</li>
<li><p><strong>保存上传的文件</strong></p>
<p>  如果要移动文件到新位置，必须使用<code>move</code>方法。该方法会将文件从暂存位置（根据机器PHP设定来确定）移动到指定的永久保存位置：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$request</span>-&gt;file(<span class="string">&#x27;photo&#x27;</span>)-&gt;move(<span class="variable">$destinationPath</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$request</span>-&gt;file(<span class="string">&#x27;photo&#x27;</span>)-&gt;move(<span class="variable">$destinationPath</span>, <span class="variable">$fileName</span>);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>其它文件方法</strong></p>
<p>  <code>UploadedFile</code>实例中有很多可用的方法。可以到<a target="_blank" rel="noopener" href="http://api.symfony.com/2.7/Symfony/Component/HttpFoundation/File/UploadedFile.html">该类的API</a>了解。</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/17/1fe554b80964/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/17/1fe554b80964/" class="post-title-link" itemprop="url">laravel 学习指南 第五章 第三节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-17 02:00:00" itemprop="dateCreated datePublished" datetime="2016-07-17T02:00:00+08:00">2016-07-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/17/1fe554b80964/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/17/1fe554b80964/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-3-控制器"><a href="#5-3-控制器" class="headerlink" title="5.3 控制器"></a>5.3 控制器</h2><h3 id="5-3-1-简介"><a href="#5-3-1-简介" class="headerlink" title="5.3.1 简介"></a>5.3.1 简介</h3><p>将所有的请求处理逻辑都放在单个<code>routes.php</code>中显示是不合理的，你也许还希望使用控制器类组织管理这些行为。</p>
<p>控制器可以将相关的HTTP请求封装到一个类中进行处理。</p>
<p>通常控制器存放在<code>app/Http/Controllers</code>目录中。</p>
<hr>
<h3 id="5-3-2-基本控制器"><a href="#5-3-2-基本控制器" class="headerlink" title="5.3.2 基本控制器"></a>5.3.2 基本控制器</h3><p>下面是一个基本控制器类的例子。所有的laravel控制器应该继承，laravel自带的控制器基类<code>Controller</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为指定用户显示详情</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showProfile</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">&#x27;user.profile&#x27;</span>, [<span class="string">&#x27;user&#x27;</span> =&gt; User::findOrFail(<span class="variable">$id</span>)]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以像这样定义指向控制器动作的路由：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="string">&#x27;UserController@showProfile&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>现在，如果一个请求匹配上面的路由URL，<code>UserController</code>的<code>showProfile</code>方法就会被执行。</p>
<p>当然，路由参数也会被传递给这个方法。</p>
<h4 id="5-3-2-1-控制器-amp-命名空间"><a href="#5-3-2-1-控制器-amp-命名空间" class="headerlink" title="5.3.2.1 控制器 &amp; 命名空间"></a>5.3.2.1 控制器 &amp; 命名空间</h4><p>在命名时，没有使用完整的控制器命名，而只定义了<code>App\Http\Controllers</code>之后的部分。</p>
<p>默认<code>RouteServiceProvider</code>会将一个路由群组载入<code>routes.php</code>文件，并且该路由群组指定了，群组中路由控制器所在的命名空间。</p>
<p>如果在<code>App\Http\Controllers</code>目录下选择使用PHP命名空间 或者 组织控制器，只需要使用相对于<code>App\Http\Controllers</code>命令空间的指定类名即可。因此，如果完整控制器类是<code>App\Http\Controllers\Photos\AdminController</code>,可以像这样注册路由：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;Photos\AdminController@method&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="5-3-2-2-命名控制器路由"><a href="#5-3-2-2-命名控制器路由" class="headerlink" title="5.3.2.2 命名控制器路由"></a>5.3.2.2 命名控制器路由</h4><p>和闭包路由一样，可以指定控制器路由的名称：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;foo&#x27;</span>, [<span class="string">&#x27;uses&#x27;</span> =&gt; <span class="string">&#x27;FooController@method&#x27;</span>, <span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;name&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<p>你可以使用辅助函数<code>route</code>来为己命名的控制器路由生成对应的URL：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$url</span> = route(<span class="string">&#x27;name&#x27;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-3-3-控制器中间件"><a href="#5-3-3-控制器中间件" class="headerlink" title="5.3.3 控制器中间件"></a>5.3.3 控制器中间件</h3><p>中间件可以分配给控制器路由：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;profile&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;middleware&#x27;</span> =&gt; <span class="string">&#x27;auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;uses&#x27;</span> =&gt; <span class="string">&#x27;UserController@showProfile&#x27;</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p>但是，将中间件放在控制器构造函数中更方便，在控制器的构建函数中使用<code>middleware</code>方法可以很轻松的分配中间件给控制器。</p>
<p>甚至可以限定中间件应用到控制器的指定方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实例化一个新的 UserController 实例</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;middleware(<span class="string">&#x27;auth&#x27;</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;middleware(<span class="string">&#x27;log&#x27;</span>, [<span class="string">&#x27;only&#x27;</span> =&gt; [<span class="string">&#x27;fooAction&#x27;</span>, <span class="string">&#x27;barAction&#x27;</span>]]);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;middleware(<span class="string">&#x27;subscribed&#x27;</span>, [<span class="string">&#x27;except&#x27;</span> =&gt; [<span class="string">&#x27;fooAction&#x27;</span>, <span class="string">&#x27;barAction&#x27;</span>]]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<hr>
<h3 id="5-3-4-RESTful-资源控制器"><a href="#5-3-4-RESTful-资源控制器" class="headerlink" title="5.3.4 RESTful 资源控制器"></a>5.3.4 RESTful 资源控制器</h3><p>laravel的资源控制器使得构建围绕资源的<code>RESTful</code>控制器变得毫无痛苦。</p>
<p>例如，想要在应用中创建一个控制器，用于处理关于图片存储的HTTP请求，使用Artisan命令<code>make:controller</code>，可以快速创建这样的控制器：</p>
<pre><code>php artisan make:controller PhotoController --resource
</code></pre>
<p>这个Artisan命令将会生成一个控制器文件<code>app/Http/Controllers/PhotoController.php</code>,这个控制器包含了每一个资源操作的方法。</p>
<p>接下来，可以为该控制器注册一个资源路由：</p>
<pre><code>Route::resource(&#39;photo&#39;, &#39;PhotoController&#39;);
</code></pre>
<p>这个理由声明包含了处理图片资源RESTful 动作的多个路由，相应地，Artisan 生成的控制器也已经为这些动作设置了对应的处理方法。</p>
<h4 id="5-3-4-1-资源控制器处理的动作"><a href="#5-3-4-1-资源控制器处理的动作" class="headerlink" title="5.3.4.1 资源控制器处理的动作"></a>5.3.4.1 资源控制器处理的动作</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">路径</th>
<th align="left">动作</th>
<th align="left">路由名称</th>
</tr>
</thead>
<tbody><tr>
<td align="left">GET</td>
<td align="left">/photo</td>
<td align="left">index</td>
<td align="left">photo.index</td>
</tr>
<tr>
<td align="left">GET</td>
<td align="left">/photo/create</td>
<td align="left">create</td>
<td align="left">photo.create</td>
</tr>
<tr>
<td align="left">POST</td>
<td align="left">/photo</td>
<td align="left">store</td>
<td align="left">photo.store</td>
</tr>
<tr>
<td align="left">GET</td>
<td align="left">/photo/{photo}</td>
<td align="left">show</td>
<td align="left">photo.show</td>
</tr>
<tr>
<td align="left">GET</td>
<td align="left">/photo/{photo}/edit</td>
<td align="left">edit</td>
<td align="left">photo.edit</td>
</tr>
<tr>
<td align="left">PUT/PATCH</td>
<td align="left">/photo/{photo}</td>
<td align="left">update</td>
<td align="left">photo.update</td>
</tr>
<tr>
<td align="left">DELETE</td>
<td align="left">/photo/{photo}</td>
<td align="left">destroy</td>
<td align="left">photo.destroy</td>
</tr>
</tbody></table>
<p><em>注意：HTTP表单不支持PUT、PATCH、DELETE请求，需要添加一个隐藏的<code>_method</code>文件来仿照这些动词。</em></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="5-3-4-2-只定义部分资源路由"><a href="#5-3-4-2-只定义部分资源路由" class="headerlink" title="5.3.4.2 只定义部分资源路由"></a>5.3.4.2 只定义部分资源路由</h4><p>声明资源路由时可以指定该路由处理的动作子集：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::resource(<span class="string">&#x27;photo&#x27;</span>, <span class="string">&#x27;PhotoController&#x27;</span>,</span><br><span class="line">[<span class="string">&#x27;only&#x27;</span> =&gt; [<span class="string">&#x27;index&#x27;</span>, <span class="string">&#x27;show&#x27;</span>]]);</span><br><span class="line"></span><br><span class="line">Route::resource(<span class="string">&#x27;photo&#x27;</span>, <span class="string">&#x27;PhotoController&#x27;</span>,</span><br><span class="line">[<span class="string">&#x27;except&#x27;</span> =&gt; [<span class="string">&#x27;create&#x27;</span>, <span class="string">&#x27;store&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;destroy&#x27;</span>]]);</span><br></pre></td></tr></table></figure>

<h4 id="5-3-4-3-命名资源路由"><a href="#5-3-4-3-命名资源路由" class="headerlink" title="5.3.4.3 命名资源路由"></a>5.3.4.3 命名资源路由</h4><p>默认情况下，所有资源控制器动作都有一个路由名称，然而，我们可以通过传入<code>names</code>数组来覆盖这些默认的名字：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Route::resource(<span class="string">&#x27;photo&#x27;</span>, <span class="string">&#x27;PhotoController&#x27;</span>,</span><br><span class="line">                [<span class="string">&#x27;names&#x27;</span> =&gt; [<span class="string">&#x27;create&#x27;</span> =&gt; <span class="string">&#x27;photo.build&#x27;</span>]]);</span><br></pre></td></tr></table></figure>

<h4 id="5-3-4-4-补充资源控制器"><a href="#5-3-4-4-补充资源控制器" class="headerlink" title="5.3.4.4 补充资源控制器"></a>5.3.4.4 补充资源控制器</h4><p>如果有必要在默认资源路由之外添加额外的路由到资源控制器，应该在调用<code>Route::resource</code>之前定义这些路由，否则，通过<code>resource</code>方法定义的路由可能无意中优于补充的额外路由：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;photos/popular&#x27;</span>, <span class="string">&#x27;PhotoController@method&#x27;</span>);</span><br><span class="line">Route::resource(<span class="string">&#x27;photos&#x27;</span>, <span class="string">&#x27;PhotoController&#x27;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-3-5-依赖注入-amp-控制器"><a href="#5-3-5-依赖注入-amp-控制器" class="headerlink" title="5.3.5 依赖注入 &amp; 控制器"></a>5.3.5 依赖注入 &amp; 控制器</h3><h4 id="5-3-5-1-构造函数注入"><a href="#5-3-5-1-构造函数注入" class="headerlink" title="5.3.5.1 构造函数注入"></a>5.3.5.1 构造函数注入</h4><p>laravel使用服务容器解析所有的Laravel控制器，因此，可以在控制器的构造函数中声明任何依赖，这些依赖会被自动解析并注入到控制器实例中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Routing</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Repositories</span>\<span class="title">UserRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The user repository instance.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$users</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建新的控制器实例</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> UserRepository $users</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">UserRepository <span class="variable">$users</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;users = <span class="variable">$users</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，还可以对任何的<code>laravel contact</code> 使用类别提示。若容器能解析它，就可以使用型别提示。</p>
<h4 id="5-3-5-2-方法注入"><a href="#5-3-5-2-方法注入" class="headerlink" title="5.3.5.2 方法注入"></a>5.3.5.2 方法注入</h4><p>除了构造函数注入外，还可以在控制器的动作方法中进行依赖的类型提示。</p>
<p>例如，可以对<code>Illuminate\Http\Request </code>实例，其中的一个方法使用类别提示：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 儲存一個新的使用者。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  Request  $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$request</span>-&gt;input(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果控制器方法期望输入路由参数，只需要将路由参数放到其他依赖之后，例如，如果你的路由定义如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Route::put(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="string">&#x27;UserController@update&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>你需要通过定义控制器方法如下所示来类型提示 <code>Illuminate\Http\Request</code> 并访问路由参数 <code>id</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Routing</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新指定用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@translator</span> http://laravelacademy.org</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">Request <span class="variable">$request</span>, <span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-3-6-路由缓存"><a href="#5-3-6-路由缓存" class="headerlink" title="5.3.6 路由缓存"></a>5.3.6 路由缓存</h3><p><strong>使用控制器路由的重要性</strong></p>
<p><em>注意：路由缓存不会作用于基于闭包的路由。要使用路由缓存，必须将闭包路由转化为控制器路由。</em></p>
<p>如果你的应用完全基于控制器路由，可以使用 Laravel 的路由缓存，使用路由缓存将会极大减少注册所有应用路由所花费的时间开销，在某些案例中，路由注册速度甚至能提高100倍！想要生成路由缓存，只需执行 Artisan 命令·<code>route:cache</code>:</p>
<pre><code>php artisan route:cache
</code></pre>
<p>就这么简单！你的缓存路由文件现在取代 <code>app/Http/routes.php</code> 文件被使用，记住，如果你添加新的路由需要重新生成路由缓存。因此，只有在项目部署阶段才需要运行 <code>route:cache</code> 命令。</p>
<p>想要移除缓存路由文件，使用 <code>route:clear</code> 命令即可：</p>
<pre><code>php artisan route:clear
</code></pre>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/17/348d503381f4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/17/348d503381f4/" class="post-title-link" itemprop="url">laravel 学习指南 第五章 第二节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-17 01:00:00" itemprop="dateCreated datePublished" datetime="2016-07-17T01:00:00+08:00">2016-07-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/17/348d503381f4/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/17/348d503381f4/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-2-中间件"><a href="#5-2-中间件" class="headerlink" title="5.2 中间件"></a>5.2 中间件</h2><h3 id="5-2-1-简介"><a href="#5-2-1-简介" class="headerlink" title="5.2.1 简介"></a>5.2.1 简介</h3><p>laravel中间件提供一个方便的机制来过滤进入web应用的HTTP请求。</p>
<p>例如，laravel内置一个中间件来验证用户是否经过授权，如果用户没有经过授权，中间件会将用户重定向到登陆页面，否则如果用户经过授权，中间件就会允许请求继续往前进行下一步操作。</p>
<p>当然，除了认证之外，中间件还可以用来处理更多任务。</p>
<p>例如：CORS中间件可以为离开站点的响应添加合适的头，日记中间件可以记录所有进入站点的请求。</p>
<p>laravel框架自带了一些中间件，包括维护模式、认证、CSRF等等。所有的中间件都位于<code>App/Http/Middleware</code>目录中。</p>
<hr>
<h3 id="5-2-2-定义中间件"><a href="#5-2-2-定义中间件" class="headerlink" title="5.2.2 定义中间件"></a>5.2.2 定义中间件</h3><p>可以使用Artisan命令<code>make:middleware</code>创建一个新的中间件</p>
<pre><code>php artisan make:middleware OldMiddleware
</code></pre>
<p>其中的<code>OldMiddleware</code>可以为任意名称。</p>
<p>命令会下<code>app/Http/Middleware</code>目录下创建一个新的中间件<code>OldMiddlware</code>,在这个中间件中，设定只允许<code>age</code>大于<code>200</code>的才能访问路由，否则，将用户重新定向到主页：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OldMiddleware</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回请求过滤器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Illuminate\Http\Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Closure $next</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$request</span>-&gt;input(<span class="string">&#x27;age&#x27;</span>) &lt;= <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;home&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果<code>age&lt;=200</code>,中间件会返回一个HTTP重定向到客户端；否则，请求会被传统下去。将请求往下传递可以通过调用回调函数<code>$next</code>并传入<code>$request</code>。</p>
<p>理解中间件最好的方式是将中间件看做HTTP请求，到达目标动作之前必须经过的<code>层</code>，每一层都会检查请求并且可以完全拒绝它。</p>
<h4 id="5-2-2-1-中间件之前-之后"><a href="#5-2-2-1-中间件之前-之后" class="headerlink" title="5.2.2.1 中间件之前/之后"></a>5.2.2.1 中间件之前/之后</h4><p>一个中间件，在请求前执行还是请求后执行取决于中间件本身。</p>
<p>比如，下方中间件会在请求处理前执行一些任务：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OldMiddleware</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回请求过滤器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Illuminate\Http\Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Closure $next</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$request</span>-&gt;input(<span class="string">&#x27;age&#x27;</span>) &lt;= <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;home&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下方中间件会在请求处理后执行任务：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AfterMiddleware</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$response</span> = <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行动作</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-2-3-注册中间件"><a href="#5-2-3-注册中间件" class="headerlink" title="5.2.3 注册中间件"></a>5.2.3 注册中间件</h3><h4 id="5-2-3-1-全局中间件"><a href="#5-2-3-1-全局中间件" class="headerlink" title="5.2.3.1 全局中间件"></a>5.2.3.1 全局中间件</h4><p>如果想要中间件放在每个HTTP请求期间被执行，只需要将相应的中间件类，设置到<code>app/Http/Kernel.php</code>的<code>$middleware</code>属性中。</p>
<h4 id="5-2-3-2-为路由指派中间件"><a href="#5-2-3-2-为路由指派中间件" class="headerlink" title="5.2.3.2 为路由指派中间件"></a>5.2.3.2 为路由指派中间件</h4><p>如果想要分配中间件到指定路由，先要在<code>app/Http/Kernel.php</code>文件中分配给中间件一个简写的<code>key</code>,默认情况下，该类的<code>$routeMiddleware</code>属性包含了laravel内置的入口中间件，添加自己的中间件只需要将其追加到后面并为其分配一个<code>key</code>:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在 App\Http\Kernel 里中</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$routeMiddleware</span> = [</span><br><span class="line">    <span class="string">&#x27;auth&#x27;</span> =&gt; \App\Http\Middleware\Authenticate::class,</span><br><span class="line">    <span class="string">&#x27;auth.basic&#x27;</span> =&gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,</span><br><span class="line">    <span class="string">&#x27;guest&#x27;</span> =&gt; \App\Http\Middleware\RedirectIfAuthenticated::class,</span><br><span class="line">    <span class="string">&#x27;throttle&#x27;</span> =&gt; \Illuminate\Routing\Middleware\ThrottleRequests::class,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>中间件在 HTTP Kernel 中被定义后，可以在路由选项数组中使用 <code>$middleware</code> 键来指定该中间件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;admin/profile&#x27;</span>, [<span class="string">&#x27;middleware&#x27;</span> =&gt; <span class="string">&#x27;auth&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用数组分配多个中间件到路由,使用数组方式排列:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, [<span class="string">&#x27;middleware&#x27;</span> =&gt; [<span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;second&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>处理使用数组外，还可以使用<code>middleware</code>方法链方式定义路由：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;)-&gt;middleware([<span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;second&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="5-2-3-3-中间件群组"><a href="#5-2-3-3-中间件群组" class="headerlink" title="5.2.3.3 中间件群组"></a>5.2.3.3 中间件群组</h4><p>有时你可能想将多个中间件组成单一的键，让它可以简单的指派给路由。</p>
<p>这可以通过使用HTTP的<code>$middlewareGroups</code>实现。</p>
<p>laravel自带了<code>web</code>与<code>api</code>两个中间件组，包含可以应用到webUI和API路由的通用中间件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 应用的路由中间件组</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$middlewareGroups</span> = [</span><br><span class="line">    <span class="string">&#x27;web&#x27;</span> =&gt; [</span><br><span class="line">        \App\Http\Middleware\EncryptCookies::class,</span><br><span class="line">        \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,</span><br><span class="line">        \Illuminate\Session\Middleware\StartSession::class,</span><br><span class="line">        \Illuminate\View\Middleware\ShareErrorsFromSession::class,</span><br><span class="line">        \App\Http\Middleware\VerifyCsrfToken::class,</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;api&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;throttle:60,1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;auth:api&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>中间件组可以被分配给路由和控制器动作，使用方法与单个中间件相同。</p>
<p><strong>注意：中间件组只是让指派多个中间件变得简单</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;middleware&#x27;</span> =&gt; [<span class="string">&#x27;web&#x27;</span>]], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-2-4-中间件参数"><a href="#5-2-4-中间件参数" class="headerlink" title="5.2.4 中间件参数"></a>5.2.4 中间件参数</h3><p>中间件还可以接收额外的自定义参数。</p>
<p>例如，应用要先检查使用者是否有权限，后执行特定的操作。</p>
<p>可以建立<code>RoleMiddleware</code>来接收使用者名称作为额外的参数。</p>
<p>额外的中间件参数会在<code>$next</code>参数之后传入中间件:</p>
<p><em>注意：下方代价中指<code> Closure $next</code>后</em></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoleMiddleware</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 运行请求过滤器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Illuminate\Http\Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Closure $next</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $role</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     * translator http://laravelacademy.org</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span>, <span class="variable">$role</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (! <span class="variable">$request</span>-&gt;user()-&gt;hasRole(<span class="variable">$role</span>)) &#123;</span><br><span class="line">            <span class="comment">// Redirect...</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>中间件参数可以在定义路由时通过<code>:</code>分隔中间件名和参数名来指定，多个中间件参数可以通过<code>,</code>分隔：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::put(<span class="string">&#x27;post/&#123;id&#125;&#x27;</span>, [<span class="string">&#x27;middleware&#x27;</span> =&gt; <span class="string">&#x27;role:editor&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-2-5-可终止的中间件"><a href="#5-2-5-可终止的中间件" class="headerlink" title="5.2.5 可终止的中间件"></a>5.2.5 可终止的中间件</h3><p>有时中间件需要在HTTP响应发送到浏览器后做一些工作。</p>
<p>例如，让<code>Session</code>中间件在响应发送到浏览器后，将Session中的数据写到存储器中。</p>
<p>为了实现这个，定义一个终止中间件，并在其中使用<code>terminable</code>方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Session</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StartSession</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">terminate</span>(<span class="params"><span class="variable">$request</span>, <span class="variable">$response</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Store the session data...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个<code>terminate</code>方法要接受<code>$request</code>和<code>$response</code>。一旦使用终止中间，应将其添加到<code>Http Kernel</code>作为全局变量使用。</p>
<p>当调用中间件中的<code>terminate</code>方法时，laravel将从服务器容器中取出这个中间件的新实例。</p>
<p>如果想在调用<code>handle</code>和<code>terminate</code>使用同一中间件实例，需要使用<code>container(容器)</code>的<code>singleton</code>方法将中间注入到容器。</p>
<p>这里<code>实例</code>可以理解为数据包。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://keleven.me/2016/07/17/1db12a3d2de1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="K11">
      <meta itemprop="description" content="千变万化的是世界">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Keleven.Me">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2016/07/17/1db12a3d2de1/" class="post-title-link" itemprop="url">laravel 学习指南 第五章 第一节</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2016-07-17 00:00:00" itemprop="dateCreated datePublished" datetime="2016-07-17T00:00:00+08:00">2016-07-17</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2022-01-01 21:55:11" itemprop="dateModified" datetime="2022-01-01T21:55:11+08:00">2022-01-01</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/laravel/" itemprop="url" rel="index"><span itemprop="name">laravel</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/2016/07/17/1db12a3d2de1/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/07/17/1db12a3d2de1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-基本功能"><a href="#5-基本功能" class="headerlink" title="5 基本功能"></a>5 基本功能</h2><h2 id="5-1-路由"><a href="#5-1-路由" class="headerlink" title="5.1 路由"></a>5.1 路由</h2><h3 id="5-1-1-基本路由"><a href="#5-1-1-基本路由" class="headerlink" title="5.1.1 基本路由"></a>5.1.1 基本路由</h3><p>laravel所有的路由都可以定义在<code>App/Http/routes.php</code>文件，它会被<code>App/Providers/RouteServiceProvider</code>类载入。</p>
<p>下方是一个最基本的<code>get</code>与<code>post</code>。<code>get</code>接收URL，<code>post</code>为一个闭包。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;foo&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::post(<span class="string">&#x27;foo&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>默认情况下，<code>routes.php</code>文件包含单个路由和一个套用<code>web</code>中间件的路由组。</p>
<p>这个中间件路由组提供了<code>session</code>状态以及<code>CSRF</code>保护。</p>
<p>一般情况下，会将全部路由放置在这个路由组。</p>
<h4 id="5-1-1-1-有效的路由方法"><a href="#5-1-1-1-有效的路由方法" class="headerlink" title="5.1.1.1 有效的路由方法"></a>5.1.1.1 有效的路由方法</h4><p>注册路由来响应任何HTTP请求：</p>
<p>下方是HTTP请求方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::post(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::put(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::patch(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::delete(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::options(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br></pre></td></tr></table></figure>
<p>有时候还需要注册路由响应多个HTTP请求，这时可以使用<code>match</code>方法来实现。甚至可以使用<code>any</code>方法注册一个路由来响应所有HTTP请求：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Route::match([<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;post&#x27;</span>], <span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::any(<span class="string">&#x27;foo&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当路由过多时，使用<code>控制器</code>是个好方法。</p>
</blockquote>
<hr>
<h3 id="5-1-2-路由参数"><a href="#5-1-2-路由参数" class="headerlink" title="5.1.2 路由参数"></a>5.1.2 路由参数</h3><h4 id="5-1-2-1-基础路由参数"><a href="#5-1-2-1-基础路由参数" class="headerlink" title="5.1.2.1 基础路由参数"></a>5.1.2.1 基础路由参数</h4><p>有时可能需要在路由中捕获URL片段。比如，要从URL中捕获用户ID，需要通过下方代码定义路由参数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;User &#x27;</span>.<span class="variable">$id</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>可以按照需要在路由中定义多个路由参数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;posts/&#123;post&#125;/comments/&#123;comment&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$postId</span>, <span class="variable">$commentId</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>路由参数总是通过<code>&#123; &#125;</code>进行包裹，这些参数在路由被执行时会被传递到路由的闭包。</p>
<p><em>注意：路由参数不能包含<code>-</code>,要使用<code>_</code>替换。</em></p>
<h4 id="5-1-2-2-选择性路由参数"><a href="#5-1-2-2-选择性路由参数" class="headerlink" title="5.1.2.2 选择性路由参数"></a>5.1.2.2 选择性路由参数</h4><p>有时候可能需要指定可选的路由参数，这可以通过在参数后加<code>?</code>标记来实现，这种情况下需要指定变量的默认值：</p>
<p>下方代码先设定<code>name可以为空</code>，再设定默认<code>name为John</code>。 </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;name?&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$name</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;user/&#123;name?&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$name</span> = <span class="string">&#x27;John&#x27;</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h4 id="5-1-2-3-正则约束"><a href="#5-1-2-3-正则约束" class="headerlink" title="5.1.2.3 正则约束"></a>5.1.2.3 正则约束</h4><p>路由设置中可以使用<code>where</code>方法来约束路由参数。<code>where</code>方法接收参数名和一个正则表达式来定义参数如何被约束：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;name&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;)-&gt;where(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;[A-Za-z]+&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;)-&gt;where(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;[0-9]+&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;/&#123;name&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span>, <span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;)-&gt;where([<span class="string">&#x27;id&#x27;</span> =&gt; <span class="string">&#x27;[0-9]+&#x27;</span>, <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;[a-z]+&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="5-1-2-4-全局约束"><a href="#5-1-2-4-全局约束" class="headerlink" title="5.1.2.4 全局约束"></a>5.1.2.4 全局约束</h4><p>如果想要全局约束，可以使用<code>pattern</code>方法。在<code>RouteServiceProvider</code>类的<code>boot</code>方式中定义约束：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义路由模型绑定，模式过滤器等</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  \Illuminate\Routing\Router  $router</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@translator</span>  http://laravelacademy.org</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params">Router <span class="variable">$router</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$router</span>-&gt;pattern(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;[0-9]+&#x27;</span>);</span><br><span class="line">    <span class="built_in">parent</span>::boot(<span class="variable">$router</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一旦模式被定义，将会自动应用到所有包含参数名的路由中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 只有当 &#123;id&#125; 是数字时才会被调用</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上方例子中限定<code>id</code>只能是数字。</p>
<hr>
<h3 id="5-1-3-命令路由"><a href="#5-1-3-命令路由" class="headerlink" title="5.1.3 命令路由"></a>5.1.3 命令路由</h3><p>命令路由为生成URL或重新定向提供方便。在定义路由是使用<code>as</code>指定路由名称：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/profile&#x27;</span>, [<span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;profile&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>此外，还可以为控制器动作指定路由名称：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/profile&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;uses&#x27;</span> =&gt; <span class="string">&#x27;UserController@showProfile&#x27;</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p>还有另一种，路由命名的方法，比如使用<code>name</code>方式来实现：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/profile&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">&#125;)-&gt;name(<span class="string">&#x27;profile&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/422303771/web/master/ubuntu/laravel/img/laravel_1.png"></p>
<h4 id="5-1-3-1-路由群组-amp-命名路由"><a href="#5-1-3-1-路由群组-amp-命名路由" class="headerlink" title="5.1.3.1 路由群组 &amp; 命名路由"></a>5.1.3.1 路由群组 &amp; 命名路由</h4><p>如果你在使用路由群组，可以通过在路由群组的属性数组中指定<code>as</code>关键字来为群组的路由设置一个共用的路由名前缀：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;admin::&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;dashboard&#x27;</span>, [<span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;dashboard&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 路由被命名为 &quot;admin::dashboard&quot;</span></span><br><span class="line">    &#125;]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/422303771/web/master/ubuntu/laravel/img/laravel_2.png"></p>
<h4 id="5-1-3-2-为命名路由生成URL"><a href="#5-1-3-2-为命名路由生成URL" class="headerlink" title="5.1.3.2 为命名路由生成URL"></a>5.1.3.2 为命名路由生成URL</h4><p>如果为给定路由进行了命名，就可以通过全局<code>route</code>函数为该命名路由生成对应URL，或者重新定向：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$url</span> = route(<span class="string">&#x27;profile&#x27;</span>);		<span class="comment">//产生URL</span></span><br><span class="line"><span class="variable">$redirect</span> = redirect()-&gt;route(<span class="string">&#x27;profile&#x27;</span>);		<span class="comment">//重新定向</span></span><br></pre></td></tr></table></figure>
<p>如果命名路由定义了参数，可以将该参数作为第二个参数穿传递给<code>route</code>函数。路由参数会自动插入URL中。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;/profile&#x27;</span>, [<span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;profile&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">     <span class="comment">//</span></span><br><span class="line">&#125;]);</span><br><span class="line"><span class="variable">$url</span> = route(<span class="string">&#x27;profile&#x27;</span>, [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">1</span>]);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-1-4-路由群组"><a href="#5-1-4-路由群组" class="headerlink" title="5.1.4 路由群组"></a>5.1.4 路由群组</h3><p>路由组允许共享路由属性，比如中间件与命名空间等。这样利用路由群组套用这些属性到多个路由，而不需要在每个路由都设定一次。</p>
<p>共享属性被要求为数组格式。共享属性作为第一个参数被传递给<code>Route::group</code>方法。</p>
<h4 id="5-1-4-1-中间件"><a href="#5-1-4-1-中间件" class="headerlink" title="5.1.4.1 中间件"></a>5.1.4.1 中间件</h4><p>要给路由组中所有路由分配中间件，可以在群组属性中使用<code>middleware</code>。中间件将会按照数组中定义的顺序依次执行：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;middleware&#x27;</span> =&gt; <span class="string">&#x27;auth&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 使用 Auth 中间件</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Route::get(<span class="string">&#x27;user/profile&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 使用 Auth 中间件</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5-1-4-2-命名空间"><a href="#5-1-4-2-命名空间" class="headerlink" title="5.1.4.2 命名空间"></a>5.1.4.2 命名空间</h4><p>另一个例子，指定相同的PHP命名空间下多个控制器，可以在分组属性数组中使用<code>namespace</code>来指定群组中所有控制器的公共命名空间：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;namespace&#x27;</span> =&gt; <span class="string">&#x27;Admin&#x27;</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 控制器在 &quot;App\Http\Controllers\Admin&quot; 命名空间下</span></span><br><span class="line"></span><br><span class="line">    Route::group([<span class="string">&#x27;namespace&#x27;</span> =&gt; <span class="string">&#x27;User&#x27;</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 控制器在 &quot;App\Http\Controllers\Admin\User&quot; 命名空间下</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>默认情况下，<code>RouteServiceProvider</code>会在命名空间群组内导入<code>routes.php</code>文件，让你不用指定完整<code>App/Http/Controllers</code>命令空间，就能注册控制器。所有，只需要指定在<code>App/Http/Controllers</code>之后的命名。</p>
<h4 id="5-1-4-3-子域名路由"><a href="#5-1-4-3-子域名路由" class="headerlink" title="5.1.4.3 子域名路由"></a>5.1.4.3 子域名路由</h4><p>子域名可以像URL一样被分配给路由参数，从而允许捕获子域名的部分用于路由或者控制器，子域名可以通过群组属性中的<code>domani</code>来指定：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;domain&#x27;</span> =&gt; <span class="string">&#x27;&#123;account&#125;.myapp.com&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$account</span>, <span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>注意：其中的{account}可以随意修改的。{id}也是可以随意更改的。</em></p>
<h4 id="5-1-4-4-路由前缀"><a href="#5-1-4-4-路由前缀" class="headerlink" title="5.1.4.4 路由前缀"></a>5.1.4.4 路由前缀</h4><p><code>prefix</code>群组属性，用来为群组中每个路由添加一个给定URL前缀。</p>
<p>例如，你可以为所有路由URL添加<code>admin</code>前缀：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;admin&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;users&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 匹配 &quot;/admin/users&quot; URL</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>还可以使用<code>prefix</code>参数为路由组指定公共路由参数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;accounts/&#123;account_id&#125;&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;detail&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$account_id</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 匹配 accounts/&#123;account_id&#125;/detail URL</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-1-5-CSRF保护"><a href="#5-1-5-CSRF保护" class="headerlink" title="5.1.5 CSRF保护"></a>5.1.5 CSRF保护</h3><h4 id="5-1-5-1-简介"><a href="#5-1-5-1-简介" class="headerlink" title="5.1.5.1 简介"></a>5.1.5.1 简介</h4><p>CSRF指跨网站请求伪造。跨网站请求伪伪造是一种恶意攻击，透过经身份验证的使用者身份执行未经授权的命令。</p>
<p>laravel会自动产生一个CSRF令牌给每个被应用管理的有效的用户，该令牌用于验证授权用户和发起请求者是否为同一个人。</p>
<p>想要生成包含CSRF令牌的隐藏输入字段，可以使用<code>csrf_field</code>函数来实现：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> csrf_field(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>csrf_field</code>函数会生成如下HTML：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;?php echo csrf_token(); ?&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当然推荐使用<code>Blade</code>引擎模板提供的方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;!! csrf_field() !!&#125;</span><br></pre></td></tr></table></figure>
<p>不需要自己编写代码去验证POST、PUT或者DELETE请求的CSRF令牌，因为Laravel自带的HTTP中间件<code>VerfyCsrfToken</code>会完成这些工作。</p>
<p>只要将请求中的输入<code>token</code>和Session中存储的<code>token</code>作对比来进行验证。</p>
<h3 id="5-1-5-2-不受-CSRF-保护的-URIs"><a href="#5-1-5-2-不受-CSRF-保护的-URIs" class="headerlink" title="5.1.5.2 不受 CSRF 保护的 URIs"></a>5.1.5.2 不受 CSRF 保护的 URIs</h3><p>有时需要从CSRF保护中排除一些URL。比如，如果使用<code>Stripe</code>来处理支付并用到他们的webhook系统，这时就需要从laravel的CSRF保护中排除webhook处理路由。</p>
<p>要实现这一目的，需要在<code>VerifyCsrfToken</code>中间件中将要排除的URL添加到<code>$except</code>属性：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Http</span>\<span class="title">Middleware</span>\<span class="title">VerifyCsrfToken</span> <span class="title">as</span> <span class="title">BaseVerifier</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VerifyCsrfToken</span> <span class="keyword">extends</span> <span class="title">BaseVerifier</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *从CSRF验证中排除的URL</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$except</span> = [</span><br><span class="line">        <span class="string">&#x27;stripe/*&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-1-5-3-X-CSRF-Token"><a href="#5-1-5-3-X-CSRF-Token" class="headerlink" title="5.1.5.3 X-CSRF-Token"></a>5.1.5.3 X-CSRF-Token</h4><p>除了检查当前POST参数的CDSRF令牌外，在laravel的<code>VerifyCsrfToken</code>中介层也会确认请求头部中的<code>X-CSRF-Token</code>。</p>
<p>例如，可以将其存储在meta标签中：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;csrf-token&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&#123;&#123; csrf_token() &#125;&#125;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一旦建立了<code>meta</code>标签，就可以使用jQuery之类的函数库，将<code>令牌</code>加入到所有请求头部。</p>
<p>这为基于AJAX的应用提供了简单、方便的方式来避免CSRF攻击。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.ajaxSetup(&#123;</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;X-CSRF-TOKEN&#x27;</span>: $(<span class="string">&#x27;meta[name=&quot;csrf-token&quot;]&#x27;</span>).attr(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5-1-5-4-X-XSRF-Token"><a href="#5-1-5-4-X-XSRF-Token" class="headerlink" title="5.1.5.4 X-XSRF-Token"></a>5.1.5.4 X-XSRF-Token</h4><p>laravel还会将CSRF令牌保存到名为<code>XSRF-TOKEN</code>的Cookie中，可以使用该Cookie值来设置<code>X-XSRF-TOKEN</code>请求头。</p>
<p>一些javascript框架，比如Angular，会为你自动进行设置，基本上不太需要手动设置这个值。</p>
<hr>
<h3 id="5-1-6-路由模型绑定"><a href="#5-1-6-路由模型绑定" class="headerlink" title="5.1.6 路由模型绑定"></a>5.1.6 路由模型绑定</h3><p>laravel路由模型绑定提供了一个方便的方式来注入类至路由中。</p>
<p>例如，可以将匹配到<code>ID</code>的整个User类注入到路由中，而不是直接注入用户ID。</p>
<h4 id="5-1-6-1-隐式绑定"><a href="#5-1-6-1-隐式绑定" class="headerlink" title="5.1.6.1 隐式绑定"></a>5.1.6.1 隐式绑定</h4><p>laravel会自动解析定义在路由或控制器动作（变量名匹配路由片段）中的Eloquent模型类型声明，例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;api/users/&#123;user&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">App\User <span class="variable">$user</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$user</span>-&gt;email;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这个例子中，路由URL的<code>user</code>符合<code>$user</code>实例的ELoquent模型，所以laravel会自动注入与请求URL的ID对应的模型实例。</p>
<p>如果找不到对应的模型实例，会自动生成HTTP404响应。</p>
<ul>
<li><p><strong>自定义键名</strong></p>
<p>  如果想要隐式模型绑定，使用数据表的其他字段，可以重写Eloquent模型类的<code>getRouteKeyName</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Get the route key for the model.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getRouteKeyName</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;slug&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  现在就可以使用<code>slug</code>作为键值了，可以用来<code>模糊关键字</code>。</p>
</li>
</ul>
<h4 id="5-1-6-2-显式绑定"><a href="#5-1-6-2-显式绑定" class="headerlink" title="5.1.6.2 显式绑定"></a>5.1.6.2 显式绑定</h4><p>要注册显式绑定，需要使用路由的<code>model</code>方法来为给定参数指定绑定类。</p>
<p>必须在<code>RouteServiceProvider::boot</code>方法中定义模型绑定。</p>
<ul>
<li><p><strong>绑定参数到模型</strong></p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params">Router <span class="variable">$router</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">parent</span>::boot(<span class="variable">$router</span>);</span><br><span class="line">    <span class="variable">$router</span>-&gt;model(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;App\User&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  接下来，定义一个包含<code>user</code>参数的路由：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$router</span>-&gt;get(<span class="string">&#x27;profile/&#123;user&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">App\User <span class="variable">$user</span></span>) </span>&#123;</span><br><span class="line">     <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>  由于已经绑定<code>&#123;user&#125;</code>参数到<code>App\User</code>模型，User实例会被注入到该路由。因此，如果请求URL是<code>profile/1</code>,就会注入一个用户ID为1的User实例。</p>
<p>  如果匹配的模型实例在数据库不存在，会自动生成并返回HTTP404响应。</p>
</li>
<li><p><strong>自定义解析逻辑</strong>    </p>
<p>  如果想要使用自定义的解析逻辑需要使用<code>Route::bind</code>方法，传递到<code>bind</code>方法的闭关会获取到URL请求的参数中的值，并返回你想要在该路由中注入的类实例：</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$router</span>-&gt;bind(<span class="string">&#x27;user&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> App\User::where(<span class="string">&#x27;name&#x27;</span>, <span class="variable">$value</span>)-&gt;first();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>自定义”Not Found”</strong></p>
<p>  如果想要指定自己的<code>Not Found</code>行为，将封装该行为的闭包作为第三个参数传递给<code>model</code>方法</p>
  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$router</span>-&gt;model(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;App\User&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NotFoundHttpException;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="5-1-7-表单方法伪造"><a href="#5-1-7-表单方法伪造" class="headerlink" title="5.1.7 表单方法伪造"></a>5.1.7 表单方法伪造</h3><p>HTML表单不支持PUT、PATCH或者DELETE请求方法。当使用这些路由时，需要添加一个隐藏的<code>_method</code>字段到表单中，其值被用作该表单的HTTP请求方法：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/foo/bar&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; csrf_token() &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>还可以使用辅助函数<code>method_field</code>来实现这一目的：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> method_field(<span class="string">&#x27;PUT&#x27;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>当然，也支持Blade模板引擎：</p>
<pre><code>&#123;method——field(&#39;PUT&#39;)&#125;  
</code></pre>
<hr>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/23/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><span class="page-number current">24</span><a class="page-number" href="/page/25/">25</a><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/25/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2016 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">K11</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="Symbols count total">235k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">3:34</span>
  </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.13.2/dist/mermaid.min.js","integrity":"sha256-UIQPVkGifpwMvDH5yGgORJ9sSTDq38zz6BGU6dNaKhM="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>



  




<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"keleven","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
