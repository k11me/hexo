<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>laravel 学习指南 第一章 &amp; 第二章</title>
    <url>/2016/07/15/06783c1f2748/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h1 id="laravel-5-学习指南"><a href="#laravel-5-学习指南" class="headerlink" title="laravel 5 学习指南"></a>laravel 5 学习指南</h1><h2 id="1-部署Laravel-Homestead"><a href="#1-部署Laravel-Homestead" class="headerlink" title="1.部署Laravel Homestead"></a>1.部署Laravel Homestead</h2><h3 id="1-1-必要软件安装"><a href="#1-1-必要软件安装" class="headerlink" title="1.1. 必要软件安装"></a>1.1. 必要软件安装</h3><table>
<thead>
<tr>
<th align="center">软件</th>
<th align="center">下载地址</th>
</tr>
</thead>
<tbody><tr>
<td align="center">vagrant</td>
<td align="center"><a href="https://www.vagrantup.com/">地址</a></td>
</tr>
<tr>
<td align="center">virtualbox</td>
<td align="center"><a href="https://www.virtualbox.org/">地址</a></td>
</tr>
<tr>
<td align="center">git</td>
<td align="center"><a href="https://git-scm.com/">地址</a></td>
</tr>
</tbody></table>
<p>composer 在虚拟机中有提供，但为了能正常安装laravel需要自备<strong>梯子</strong></p>
<p>Laravel 官方指南<a href="https://laravel.com/docs/5.2/homestead">地址</a></p>
<h3 id="1-2-下载Laravel-Homestead虚拟机文件"><a href="#1-2-下载Laravel-Homestead虚拟机文件" class="headerlink" title="1.2.下载Laravel Homestead虚拟机文件"></a>1.2.下载Laravel Homestead虚拟机文件</h3><p>Git Bash中输入命令</p>
<pre><code>$ vagrant box add laravel/homestead        //安装Laravel Homestead
</code></pre>
<p>随后会要求选择使用的虚拟机。virtualbox为1 ，Vmware 为2 。</p>
<p><em>注意：如果使用VMware需要购买vagrant的插件。</em></p>
<p>确认后，开始下载。</p>
<p><em>注意：需要梯子</em></p>
<h3 id="1-3-安装Laravel-Homestead"><a href="#1-3-安装Laravel-Homestead" class="headerlink" title="1.3. 安装Laravel Homestead"></a>1.3. 安装Laravel Homestead</h3><p>下载完成后，需要使用git，克隆Laravel Homestead的安装设置文件。</p>
<p>切换到想要建立项目的目录，使用克隆命令。</p>
<pre><code>$ git clone https://github.com/laravel/homestead.git Homestead
</code></pre>
<h3 id="1-4-设置Laravel-Homestead"><a href="#1-4-设置Laravel-Homestead" class="headerlink" title="1.4. 设置Laravel Homestead"></a>1.4. 设置Laravel Homestead</h3><p>首先需要有SSH密钥，如果没有使用下方命令创建</p>
<pre><code>$ ssh-keygen
</code></pre>
<p>克隆完整后，载入Laravel Homestead设置文件。</p>
<pre><code>$ bash init.sh   //载入 Laravel Homestead 设置文件
</code></pre>
<p>之后设置文件映射，</p>
<p><code>C:\Windows\System32\drivers\etc\hosts</code>  负责DNS的文件</p>
<p><code>C:\Users\Keleven\.homestead\Homestead.yaml</code>   负责Laravel Homestead设置的文件</p>
<p>在<code>Homestead.yaml</code>修改</p>
<pre><code>ip: &quot;192.168.20.10&quot;        //映射的ip地址
memory: 2048            //虚拟机内存大小
cpus: 1                    //虚拟机CUP数量
provider: virtualbox    //虚拟机供应商

authorize: ~/.ssh/id_rsa.pub   //SSH 公钥地址

keys:                            
    - ~/.ssh/id_rsa                //SSH 私钥地址

folders:                            //项目的主文件夹
    - map: J:\laravel\web  # pc          //PC端 文件地址
      to: /home/vagrant/webCode  #vbox    //Vbox端 地址 

sites:
    - map: web.app                               //网站名称
      to: /home/vagrant/webCode/web/public       //laravel 入口
    - map: back.app                                 //网站名称
      to: /home/vagrant/webCode/back/public      //laravel 入口
databases:                                       // web数据库名称
    - webdb
</code></pre>
<p>在<code>hosts</code>中添加</p>
<pre><code>192.168.20.10 web.app
192.168.20.10 back.app
</code></pre>
<p><em>注意：IP：地址用没有使用的IP段</em></p>
<h3 id="1-5-运行Laravel-Homestead"><a href="#1-5-运行Laravel-Homestead" class="headerlink" title="1.5.运行Laravel Homestead"></a>1.5.运行Laravel Homestead</h3><p>在克隆的的Homestead目录下。启动虚拟机。</p>
<p><strong>不要再Vbox中启动，不要再Vbox中启动，不要再Vbox中启动。</strong></p>
<pre><code>$ vagrant up 
</code></pre>
<p>加载完成会就可以使用了，使用下方命令与虚拟机建立SSH链接。</p>
<pre><code>$ vagrant ssh
</code></pre>
<p>进去虚拟机的第一件事，解除Composer的xdebug模式，否则严重影响下载包的速度。</p>
<p>解除方法：</p>
<p>找到<code>/etc/php/7.0/mods-available/</code>下的<code>xdebug.ini</code>打开后加注释。</p>
<pre><code>$ sudo nano /etc/php/7.0/mods-available/xdebug.ini  // 使用nano编辑xdebug.ini文件
</code></pre>
<p>在<code>zend_extension=xdebug.so</code>前方加<code>;</code></p>
<p>对<code>sudo nano /etc/php/5.6/mods-available/</code>下的<code>xdebug.ini</code>进行同样操作。</p>
<pre><code>sudo nano /etc/php/5.6/mods-available/xdebug.ini
</code></pre>
<h3 id="1-6-安装laravel到目录"><a href="#1-6-安装laravel到目录" class="headerlink" title="1.6.安装laravel到目录"></a>1.6.安装laravel到目录</h3><p>安装目录在<code>Homestead.yaml</code>设置过，本地目录与虚拟机的目录是共享的。</p>
<p>即安装完成后，可以直接修改本地目录中的文件。</p>
<p>使用Git Bash进入项目目录。使用<code>composer</code>安装<code>laravel</code></p>
<pre><code>$ composer create-project --prefer-dist laravel/laravel [blog]
</code></pre>
<p>[blog]可以是任意的项目名称。</p>
<p><em>注意：项目名称要与<code>Homestead.yaml</code>中设置对应</em></p>
<p>安装完成后，在浏览器中输入web.app，就可以看到laravel在正常运行了。</p>
<h3 id="1-7-关机"><a href="#1-7-关机" class="headerlink" title="1.7. 关机"></a>1.7. 关机</h3><p>先使用<code>exit</code>推出SSH链接。</p>
<p>在关闭虚拟机:</p>
<pre><code>$ vagrant halt
</code></pre>
<hr>
<h2 id="2-正常安装Laravel"><a href="#2-正常安装Laravel" class="headerlink" title="2. 正常安装Laravel"></a>2. 正常安装Laravel</h2><p>在ubuntu desktop环境下安装。</p>
<h2 id="安装nginx-php7-mysql-redis"><a href="#安装nginx-php7-mysql-redis" class="headerlink" title="安装nginx + php7 + mysql + redis"></a>安装nginx + php7 + mysql + redis</h2><hr>
<h3 id="2-1-安装nginx"><a href="#2-1-安装nginx" class="headerlink" title="2.1 安装nginx"></a>2.1 安装nginx</h3><pre><code>$ sudo apt-get update
$ sudo apt-get install nginx
</code></pre>
<p>显示防护墙列表</p>
<pre><code>$ sudo ufw app list
</code></pre>
<p>结果如下</p>
<pre><code>可用应用程序：
  CUPS
  Nginx Full
  Nginx HTTP
  Nginx HTTPS
</code></pre>
<ul>
<li>Nginx Full: This profile opens both port 80 (normal, unencrypted web traffic) and port 443 (TLS/SSL encrypted traffic)</li>
<li>Nginx HTTP: This profile opens only port 80 (normal, unencrypted web traffic)</li>
<li>Nginx HTTPS: This profile opens only port 443 (TLS/SSL encrypted traffic)</li>
</ul>
<p>设置防火墙规则</p>
<pre><code>$ sudo ufw allow &#39;Nginx Full&#39;
</code></pre>
<p>查看防火墙状态</p>
<pre><code>$ sudo ufw status
</code></pre>
<p>网站目录在<code>var/www/html</code></p>
<p>根据情况修改<code>/etc/nginx/nginx.conf</code>中的<code>keepalive_timeout</code>值。</p>
<hr>
<h3 id="2-2-安装php7-0-fpm"><a href="#2-2-安装php7-0-fpm" class="headerlink" title="2.2 安装php7.0-fpm"></a>2.2 安装php7.0-fpm</h3><p><a href="https://www.howtoforge.com/tutorial/installing-nginx-with-php7-fpm-and-mysql-on-ubuntu-16.04-lts-lemp/">参考地址</a></p>
<pre><code>$ sudo apt-get install php7.0-fpm
</code></pre>
<p>现在还不能访问<code>.php</code>文件，要进行如下设置：</p>
<pre><code>$ sudo nano /etc/nginx/sites-available/default
</code></pre>
<ul>
<li><p><code>server_name _ </code>服务器名，可以不填。</p>
</li>
<li><p><code>root /var/www/html</code> 网站目录地址。可以手动修改。</p>
<p>  增加<code>index.php</code></p>
</li>
<li><p><code>location ~ \.php$</code>php支持，需要解除注释。</p>
<p>  <code>fastcgi_pass 127.0.0.1:9000;</code>与 <code>fastcgi_pass unix:/run/php/php7.0-fpm.sock;</code>选一个否则冲突。</p>
</li>
</ul>
<p>之后重新读取<code>nginx</code>设置，</p>
<pre><code>$ sudo service nginx reload
</code></pre>
<p>修改<code>/etc/php/7.0/fpm/php.ini</code></p>
<pre><code>$ sudo nano /etc/php/7.0/fpm/php.ini
</code></pre>
<p>设置<code> cgi.fix_pathinfo=1</code></p>
<p>重启<code>php7.0-fpm</code>服务</p>
<pre><code>$ sudo service php7.0-fpm reload
</code></pre>
<p>网站目录下建立任意<code>.php</code>文件测试。</p>
<p>文件内容如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>随后输入<code>127.0.0.1/[文件名].php</code></p>
<p>通过命令定位php7.0的其他包：</p>
<pre><code>$ sudo apt-cache search php7.0
</code></pre>
<p>选择安装的如下：</p>
<pre><code>$ sudo apt-get install php7.0-cli php7.0-common php7.0 php7.0-mysql php7.0-curl php7.0-gd php7.0-bz2 php7.0-mcrypt php7.0-zip php7.0-mbstring php7.0-xml
</code></pre>
<p><em>其他让php7.0使用TCP连接</em></p>
<p>修改文件<code>/etc/php/7.0/fpm/pool.d/www.conf</code>与<code>/etc/nginx/sites-available/default</code></p>
<p><code>/etc/php/7.0/fpm/pool.d/www.conf</code>文件</p>
<pre><code>;listen = /var/run/php5-fpm.sock       //注释掉
listen = 127.0.0.1:9000                    // 增加
</code></pre>
<p><code>/etc/nginx/sites-available/default</code>文件</p>
<pre><code>[...]
        location ~ \.php$ &#123;
 include snippets/fastcgi-php.conf;

 # With php7.0-cgi alone:
 fastcgi_pass 127.0.0.1:9000;
 # With php7.0-fpm:
 # fastcgi_pass unix:/run/php/php7.0-fpm.sock;
 &#125;
[...]
</code></pre>
<p>重新读取<code>nginx</code></p>
<pre><code>service nginx reload
</code></pre>
<hr>
<h3 id="2-3-安装MySql"><a href="#2-3-安装MySql" class="headerlink" title="2.3 安装MySql"></a>2.3 安装MySql</h3><pre><code>$ sudo apt-get install mysql-server-5.7 php7.0-mysql
</code></pre>
<hr>
<h3 id="2-4-安装composer"><a href="#2-4-安装composer" class="headerlink" title="2.4 安装composer"></a>2.4 安装composer</h3><p><a href="https://getcomposer.org/download/">下载地址</a></p>
<p>随后会得到一个<code>composer.phar</code>文件，可以直接放入任意目录，终端输入<code>composer</code>使用。</p>
<p>当然为了方便可以设置为全局可以用。</p>
<pre><code>$ sudo mv composer.phar /usr/local/bin/composer
$ sudo chmod +x /usr/local/bin/composer
</code></pre>
<hr>
<h3 id="2-5-安装laravel-5"><a href="#2-5-安装laravel-5" class="headerlink" title="2.5 安装laravel 5"></a>2.5 安装laravel 5</h3><p><a href="https://laravel.com/docs/5.2">文档地址</a></p>
<h4 id="2-5-1-方法1"><a href="#2-5-1-方法1" class="headerlink" title="2.5.1 方法1"></a>2.5.1 方法1</h4><pre><code>$ composer create-project --prefer-dist laravel/laravel [blog]
</code></pre>
<p>[blog]可以为项目名</p>
<h4 id="2-5-2-方法2"><a href="#2-5-2-方法2" class="headerlink" title="2.5.2 方法2"></a>2.5.2 方法2</h4><p>需要使用<code>bash</code>。<code>zsh</code>测试无效</p>
<pre><code>$ composer global require &quot;laravel/installer&quot;

$ export PATH=&quot;~/.config/composer/vendor/bin:$PATH&quot;
</code></pre>
<p>进入想要创建项目的目录</p>
<pre><code>$ laravel new [blog]
</code></pre>
<p>[blog]可以为项目名</p>
<p><em>注意：需要梯子！需要梯子！需要梯子！</em></p>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第五章 第一节</title>
    <url>/2016/07/17/1db12a3d2de1/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-基本功能"><a href="#5-基本功能" class="headerlink" title="5 基本功能"></a>5 基本功能</h2><h2 id="5-1-路由"><a href="#5-1-路由" class="headerlink" title="5.1 路由"></a>5.1 路由</h2><h3 id="5-1-1-基本路由"><a href="#5-1-1-基本路由" class="headerlink" title="5.1.1 基本路由"></a>5.1.1 基本路由</h3><p>laravel所有的路由都可以定义在<code>App/Http/routes.php</code>文件，它会被<code>App/Providers/RouteServiceProvider</code>类载入。</p>
<p>下方是一个最基本的<code>get</code>与<code>post</code>。<code>get</code>接收URL，<code>post</code>为一个闭包。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;foo&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::post(<span class="string">&#x27;foo&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>默认情况下，<code>routes.php</code>文件包含单个路由和一个套用<code>web</code>中间件的路由组。</p>
<p>这个中间件路由组提供了<code>session</code>状态以及<code>CSRF</code>保护。</p>
<p>一般情况下，会将全部路由放置在这个路由组。</p>
<h4 id="5-1-1-1-有效的路由方法"><a href="#5-1-1-1-有效的路由方法" class="headerlink" title="5.1.1.1 有效的路由方法"></a>5.1.1.1 有效的路由方法</h4><p>注册路由来响应任何HTTP请求：</p>
<p>下方是HTTP请求方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::post(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::put(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::patch(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::delete(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br><span class="line">Route::options(<span class="variable">$uri</span>, <span class="variable">$callback</span>);</span><br></pre></td></tr></table></figure>
<p>有时候还需要注册路由响应多个HTTP请求，这时可以使用<code>match</code>方法来实现。甚至可以使用<code>any</code>方法注册一个路由来响应所有HTTP请求：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::match([<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;post&#x27;</span>], <span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::any(<span class="string">&#x27;foo&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>当路由过多时，使用<code>控制器</code>是个好方法。</p>
</blockquote>
<hr>
<h3 id="5-1-2-路由参数"><a href="#5-1-2-路由参数" class="headerlink" title="5.1.2 路由参数"></a>5.1.2 路由参数</h3><h4 id="5-1-2-1-基础路由参数"><a href="#5-1-2-1-基础路由参数" class="headerlink" title="5.1.2.1 基础路由参数"></a>5.1.2.1 基础路由参数</h4><p>有时可能需要在路由中捕获URL片段。比如，要从URL中捕获用户ID，需要通过下方代码定义路由参数：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;User &#x27;</span>.<span class="variable">$id</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>可以按照需要在路由中定义多个路由参数：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;posts/&#123;post&#125;/comments/&#123;comment&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$postId</span>, <span class="variable">$commentId</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>路由参数总是通过<code>&#123; &#125;</code>进行包裹，这些参数在路由被执行时会被传递到路由的闭包。</p>
<p><em>注意：路由参数不能包含<code>-</code>,要使用<code>_</code>替换。</em></p>
<h4 id="5-1-2-2-选择性路由参数"><a href="#5-1-2-2-选择性路由参数" class="headerlink" title="5.1.2.2 选择性路由参数"></a>5.1.2.2 选择性路由参数</h4><p>有时候可能需要指定可选的路由参数，这可以通过在参数后加<code>?</code>标记来实现，这种情况下需要指定变量的默认值：</p>
<p>下方代码先设定<code>name可以为空</code>，再设定默认<code>name为John</code>。 </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;name?&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$name</span> = <span class="literal">null</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;user/&#123;name?&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$name</span> = <span class="string">&#x27;John&#x27;</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<h4 id="5-1-2-3-正则约束"><a href="#5-1-2-3-正则约束" class="headerlink" title="5.1.2.3 正则约束"></a>5.1.2.3 正则约束</h4><p>路由设置中可以使用<code>where</code>方法来约束路由参数。<code>where</code>方法接收参数名和一个正则表达式来定义参数如何被约束：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;name&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;)-&gt;where(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;[A-Za-z]+&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;)-&gt;where(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;[0-9]+&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;/&#123;name&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span>, <span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;)-&gt;where([<span class="string">&#x27;id&#x27;</span> =&gt; <span class="string">&#x27;[0-9]+&#x27;</span>, <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;[a-z]+&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="5-1-2-4-全局约束"><a href="#5-1-2-4-全局约束" class="headerlink" title="5.1.2.4 全局约束"></a>5.1.2.4 全局约束</h4><p>如果想要全局约束，可以使用<code>pattern</code>方法。在<code>RouteServiceProvider</code>类的<code>boot</code>方式中定义约束：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义路由模型绑定，模式过滤器等</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  \Illuminate\Routing\Router  $router</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@translator</span>  http://laravelacademy.org</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params">Router <span class="variable">$router</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$router</span>-&gt;pattern(<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;[0-9]+&#x27;</span>);</span><br><span class="line">    <span class="built_in">parent</span>::boot(<span class="variable">$router</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一旦模式被定义，将会自动应用到所有包含参数名的路由中：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 只有当 &#123;id&#125; 是数字时才会被调用</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上方例子中限定<code>id</code>只能是数字。</p>
<hr>
<h3 id="5-1-3-命令路由"><a href="#5-1-3-命令路由" class="headerlink" title="5.1.3 命令路由"></a>5.1.3 命令路由</h3><p>命令路由为生成URL或重新定向提供方便。在定义路由是使用<code>as</code>指定路由名称：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/profile&#x27;</span>, [<span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;profile&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>此外，还可以为控制器动作指定路由名称：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/profile&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;uses&#x27;</span> =&gt; <span class="string">&#x27;UserController@showProfile&#x27;</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p>还有另一种，路由命名的方法，比如使用<code>name</code>方式来实现：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/profile&#x27;</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">&#125;)-&gt;name(<span class="string">&#x27;profile&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/422303771/web/master/ubuntu/laravel/img/laravel_1.png"></p>
<h4 id="5-1-3-1-路由群组-amp-命名路由"><a href="#5-1-3-1-路由群组-amp-命名路由" class="headerlink" title="5.1.3.1 路由群组 &amp; 命名路由"></a>5.1.3.1 路由群组 &amp; 命名路由</h4><p>如果你在使用路由群组，可以通过在路由群组的属性数组中指定<code>as</code>关键字来为群组的路由设置一个共用的路由名前缀：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;admin::&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;dashboard&#x27;</span>, [<span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;dashboard&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 路由被命名为 &quot;admin::dashboard&quot;</span></span><br><span class="line">    &#125;]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/422303771/web/master/ubuntu/laravel/img/laravel_2.png"></p>
<h4 id="5-1-3-2-为命名路由生成URL"><a href="#5-1-3-2-为命名路由生成URL" class="headerlink" title="5.1.3.2 为命名路由生成URL"></a>5.1.3.2 为命名路由生成URL</h4><p>如果为给定路由进行了命名，就可以通过全局<code>route</code>函数为该命名路由生成对应URL，或者重新定向：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$url</span> = route(<span class="string">&#x27;profile&#x27;</span>);		<span class="comment">//产生URL</span></span><br><span class="line"><span class="variable">$redirect</span> = redirect()-&gt;route(<span class="string">&#x27;profile&#x27;</span>);		<span class="comment">//重新定向</span></span><br></pre></td></tr></table></figure>
<p>如果命名路由定义了参数，可以将该参数作为第二个参数穿传递给<code>route</code>函数。路由参数会自动插入URL中。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;/profile&#x27;</span>, [<span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;profile&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">     <span class="comment">//</span></span><br><span class="line">&#125;]);</span><br><span class="line"><span class="variable">$url</span> = route(<span class="string">&#x27;profile&#x27;</span>, [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">1</span>]);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-1-4-路由群组"><a href="#5-1-4-路由群组" class="headerlink" title="5.1.4 路由群组"></a>5.1.4 路由群组</h3><p>路由组允许共享路由属性，比如中间件与命名空间等。这样利用路由群组套用这些属性到多个路由，而不需要在每个路由都设定一次。</p>
<p>共享属性被要求为数组格式。共享属性作为第一个参数被传递给<code>Route::group</code>方法。</p>
<h4 id="5-1-4-1-中间件"><a href="#5-1-4-1-中间件" class="headerlink" title="5.1.4.1 中间件"></a>5.1.4.1 中间件</h4><p>要给路由组中所有路由分配中间件，可以在群组属性中使用<code>middleware</code>。中间件将会按照数组中定义的顺序依次执行：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;middleware&#x27;</span> =&gt; <span class="string">&#x27;auth&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 使用 Auth 中间件</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    Route::get(<span class="string">&#x27;user/profile&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 使用 Auth 中间件</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5-1-4-2-命名空间"><a href="#5-1-4-2-命名空间" class="headerlink" title="5.1.4.2 命名空间"></a>5.1.4.2 命名空间</h4><p>另一个例子，指定相同的PHP命名空间下多个控制器，可以在分组属性数组中使用<code>namespace</code>来指定群组中所有控制器的公共命名空间：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;namespace&#x27;</span> =&gt; <span class="string">&#x27;Admin&#x27;</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 控制器在 &quot;App\Http\Controllers\Admin&quot; 命名空间下</span></span><br><span class="line"></span><br><span class="line">    Route::group([<span class="string">&#x27;namespace&#x27;</span> =&gt; <span class="string">&#x27;User&#x27;</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 控制器在 &quot;App\Http\Controllers\Admin\User&quot; 命名空间下</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>默认情况下，<code>RouteServiceProvider</code>会在命名空间群组内导入<code>routes.php</code>文件，让你不用指定完整<code>App/Http/Controllers</code>命令空间，就能注册控制器。所有，只需要指定在<code>App/Http/Controllers</code>之后的命名。</p>
<h4 id="5-1-4-3-子域名路由"><a href="#5-1-4-3-子域名路由" class="headerlink" title="5.1.4.3 子域名路由"></a>5.1.4.3 子域名路由</h4><p>子域名可以像URL一样被分配给路由参数，从而允许捕获子域名的部分用于路由或者控制器，子域名可以通过群组属性中的<code>domani</code>来指定：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;domain&#x27;</span> =&gt; <span class="string">&#x27;&#123;account&#125;.myapp.com&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$account</span>, <span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>注意：其中的{account}可以随意修改的。{id}也是可以随意更改的。</em></p>
<h4 id="5-1-4-4-路由前缀"><a href="#5-1-4-4-路由前缀" class="headerlink" title="5.1.4.4 路由前缀"></a>5.1.4.4 路由前缀</h4><p><code>prefix</code>群组属性，用来为群组中每个路由添加一个给定URL前缀。</p>
<p>例如，你可以为所有路由URL添加<code>admin</code>前缀：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;admin&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;users&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 匹配 &quot;/admin/users&quot; URL</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>还可以使用<code>prefix</code>参数为路由组指定公共路由参数：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;accounts/&#123;account_id&#125;&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    Route::get(<span class="string">&#x27;detail&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$account_id</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 匹配 accounts/&#123;account_id&#125;/detail URL</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-1-5-CSRF保护"><a href="#5-1-5-CSRF保护" class="headerlink" title="5.1.5 CSRF保护"></a>5.1.5 CSRF保护</h3><h4 id="5-1-5-1-简介"><a href="#5-1-5-1-简介" class="headerlink" title="5.1.5.1 简介"></a>5.1.5.1 简介</h4><p>CSRF指跨网站请求伪造。跨网站请求伪伪造是一种恶意攻击，透过经身份验证的使用者身份执行未经授权的命令。</p>
<p>laravel会自动产生一个CSRF令牌给每个被应用管理的有效的用户，该令牌用于验证授权用户和发起请求者是否为同一个人。</p>
<p>想要生成包含CSRF令牌的隐藏输入字段，可以使用<code>csrf_field</code>函数来实现：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> csrf_field(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>csrf_field</code>函数会生成如下HTML：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;?php echo csrf_token(); ?&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当然推荐使用<code>Blade</code>引擎模板提供的方式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;!! csrf_field() !!&#125;</span><br></pre></td></tr></table></figure>
<p>不需要自己编写代码去验证POST、PUT或者DELETE请求的CSRF令牌，因为Laravel自带的HTTP中间件<code>VerfyCsrfToken</code>会完成这些工作。</p>
<p>只要将请求中的输入<code>token</code>和Session中存储的<code>token</code>作对比来进行验证。</p>
<h3 id="5-1-5-2-不受-CSRF-保护的-URIs"><a href="#5-1-5-2-不受-CSRF-保护的-URIs" class="headerlink" title="5.1.5.2 不受 CSRF 保护的 URIs"></a>5.1.5.2 不受 CSRF 保护的 URIs</h3><p>有时需要从CSRF保护中排除一些URL。比如，如果使用<code>Stripe</code>来处理支付并用到他们的webhook系统，这时就需要从laravel的CSRF保护中排除webhook处理路由。</p>
<p>要实现这一目的，需要在<code>VerifyCsrfToken</code>中间件中将要排除的URL添加到<code>$except</code>属性：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Http</span>\<span class="title">Middleware</span>\<span class="title">VerifyCsrfToken</span> <span class="title">as</span> <span class="title">BaseVerifier</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VerifyCsrfToken</span> <span class="keyword">extends</span> <span class="title">BaseVerifier</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *从CSRF验证中排除的URL</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$except</span> = [</span><br><span class="line">        <span class="string">&#x27;stripe/*&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-1-5-3-X-CSRF-Token"><a href="#5-1-5-3-X-CSRF-Token" class="headerlink" title="5.1.5.3 X-CSRF-Token"></a>5.1.5.3 X-CSRF-Token</h4><p>除了检查当前POST参数的CDSRF令牌外，在laravel的<code>VerifyCsrfToken</code>中介层也会确认请求头部中的<code>X-CSRF-Token</code>。</p>
<p>例如，可以将其存储在meta标签中：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;csrf-token&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&#123;&#123; csrf_token() &#125;&#125;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>一旦建立了<code>meta</code>标签，就可以使用jQuery之类的函数库，将<code>令牌</code>加入到所有请求头部。</p>
<p>这为基于AJAX的应用提供了简单、方便的方式来避免CSRF攻击。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$.ajaxSetup(&#123;</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;X-CSRF-TOKEN&#x27;</span>: $(<span class="string">&#x27;meta[name=&quot;csrf-token&quot;]&#x27;</span>).attr(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5-1-5-4-X-XSRF-Token"><a href="#5-1-5-4-X-XSRF-Token" class="headerlink" title="5.1.5.4 X-XSRF-Token"></a>5.1.5.4 X-XSRF-Token</h4><p>laravel还会将CSRF令牌保存到名为<code>XSRF-TOKEN</code>的Cookie中，可以使用该Cookie值来设置<code>X-XSRF-TOKEN</code>请求头。</p>
<p>一些javascript框架，比如Angular，会为你自动进行设置，基本上不太需要手动设置这个值。</p>
<hr>
<h3 id="5-1-6-路由模型绑定"><a href="#5-1-6-路由模型绑定" class="headerlink" title="5.1.6 路由模型绑定"></a>5.1.6 路由模型绑定</h3><p>laravel路由模型绑定提供了一个方便的方式来注入类至路由中。</p>
<p>例如，可以将匹配到<code>ID</code>的整个User类注入到路由中，而不是直接注入用户ID。</p>
<h4 id="5-1-6-1-隐式绑定"><a href="#5-1-6-1-隐式绑定" class="headerlink" title="5.1.6.1 隐式绑定"></a>5.1.6.1 隐式绑定</h4><p>laravel会自动解析定义在路由或控制器动作（变量名匹配路由片段）中的Eloquent模型类型声明，例如：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;api/users/&#123;user&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">App\User <span class="variable">$user</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$user</span>-&gt;email;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这个例子中，路由URL的<code>user</code>符合<code>$user</code>实例的ELoquent模型，所以laravel会自动注入与请求URL的ID对应的模型实例。</p>
<p>如果找不到对应的模型实例，会自动生成HTTP404响应。</p>
<ul>
<li><p><strong>自定义键名</strong></p>
<p>  如果想要隐式模型绑定，使用数据表的其他字段，可以重写Eloquent模型类的<code>getRouteKeyName</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Get the route key for the model.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getRouteKeyName</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;slug&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  现在就可以使用<code>slug</code>作为键值了，可以用来<code>模糊关键字</code>。</p>
</li>
</ul>
<h4 id="5-1-6-2-显式绑定"><a href="#5-1-6-2-显式绑定" class="headerlink" title="5.1.6.2 显式绑定"></a>5.1.6.2 显式绑定</h4><p>要注册显式绑定，需要使用路由的<code>model</code>方法来为给定参数指定绑定类。</p>
<p>必须在<code>RouteServiceProvider::boot</code>方法中定义模型绑定。</p>
<ul>
<li><p><strong>绑定参数到模型</strong></p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params">Router <span class="variable">$router</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">parent</span>::boot(<span class="variable">$router</span>);</span><br><span class="line">    <span class="variable">$router</span>-&gt;model(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;App\User&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  接下来，定义一个包含<code>user</code>参数的路由：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$router</span>-&gt;get(<span class="string">&#x27;profile/&#123;user&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">App\User <span class="variable">$user</span></span>) </span>&#123;</span><br><span class="line">     <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>  由于已经绑定<code>&#123;user&#125;</code>参数到<code>App\User</code>模型，User实例会被注入到该路由。因此，如果请求URL是<code>profile/1</code>,就会注入一个用户ID为1的User实例。</p>
<p>  如果匹配的模型实例在数据库不存在，会自动生成并返回HTTP404响应。</p>
</li>
<li><p><strong>自定义解析逻辑</strong>    </p>
<p>  如果想要使用自定义的解析逻辑需要使用<code>Route::bind</code>方法，传递到<code>bind</code>方法的闭关会获取到URL请求的参数中的值，并返回你想要在该路由中注入的类实例：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$router</span>-&gt;bind(<span class="string">&#x27;user&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> App\User::where(<span class="string">&#x27;name&#x27;</span>, <span class="variable">$value</span>)-&gt;first();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>自定义”Not Found”</strong></p>
<p>  如果想要指定自己的<code>Not Found</code>行为，将封装该行为的闭包作为第三个参数传递给<code>model</code>方法</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$router</span>-&gt;model(<span class="string">&#x27;user&#x27;</span>, <span class="string">&#x27;App\User&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> NotFoundHttpException;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="5-1-7-表单方法伪造"><a href="#5-1-7-表单方法伪造" class="headerlink" title="5.1.7 表单方法伪造"></a>5.1.7 表单方法伪造</h3><p>HTML表单不支持PUT、PATCH或者DELETE请求方法。当使用这些路由时，需要添加一个隐藏的<code>_method</code>字段到表单中，其值被用作该表单的HTTP请求方法：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/foo/bar&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&#123;&#123; csrf_token() &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>还可以使用辅助函数<code>method_field</code>来实现这一目的：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> method_field(<span class="string">&#x27;PUT&#x27;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>当然，也支持Blade模板引擎：</p>
<pre><code>&#123;method——field(&#39;PUT&#39;)&#125;  
</code></pre>
<hr>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第四章</title>
    <url>/2016/07/15/e5c478c6dbb1/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="4-快速入门进阶版"><a href="#4-快速入门进阶版" class="headerlink" title="4 快速入门进阶版"></a>4 快速入门进阶版</h2><h3 id="4-1-安装"><a href="#4-1-安装" class="headerlink" title="4.1. 安装"></a>4.1. 安装</h3><h4 id="4-1-1-使用composer"><a href="#4-1-1-使用composer" class="headerlink" title="4.1.1 使用composer"></a>4.1.1 使用composer</h4><pre><code>$ composer create-project laravel/laravel quickstart --prefer-dist
</code></pre>
<h4 id="4-1-2-使用git克隆完整包"><a href="#4-1-2-使用git克隆完整包" class="headerlink" title="4.1.2 使用git克隆完整包"></a>4.1.2 使用git克隆完整包</h4><pre><code>$ git clone https://github.com/laravel/quickstart-intermediate quickstart
$ cd quickstart
$ composer install
$ php artisan migrate
</code></pre>
<h3 id="4-2-准备数据库"><a href="#4-2-准备数据库" class="headerlink" title="4.2 准备数据库"></a>4.2 准备数据库</h3><h4 id="4-2-1-数据迁移"><a href="#4-2-1-数据迁移" class="headerlink" title="4.2.1  数据迁移"></a>4.2.1  数据迁移</h4><p>需要用到users表与tasks表。</p>
<p>users表的已经在<code>database/migratiions</code>目录下。</p>
<p>tasks表，需要使用命令创建一个：</p>
<pre><code>$ php artisan make:migration create_tasks_table --create=tasks
</code></pre>
<p>在生成的文件中加入</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$table</span>-&gt;integer(<span class="string">&#x27;user_id&#x27;</span>)-&gt;index();</span><br><span class="line"><span class="variable">$table</span>-&gt;string(<span class="string">&#x27;name&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>-&gt;index()</code>标识增加索引。<code>user_id</code>用于建立<code>tasks</code>表与<code>user</code>表之间的关联。</p>
<p>使用下方命令导入数据库</p>
<pre><code>$ php artisan migrate
</code></pre>
<h4 id="4-2-2-Eloquent模型"><a href="#4-2-2-Eloquent模型" class="headerlink" title="4.2.2 Eloquent模型"></a>4.2.2 Eloquent模型</h4><p>user模型</p>
<p>laravel中自带了<code>user</code>模块。</p>
<p>Task模型</p>
<p>使用下方命令创建<code>task</code>模型。</p>
<pre><code>$ php artisan make:model Task
</code></pre>
<p>在<code>Task</code>模型中,声明<code>name</code>属性支持<code>批量赋值</code>。</p>
<p>批量赋值：将一个数组发送到模型类用于创建新模型实例是使用。</p>
<p>laravel有两种<code>批量赋值</code>属性，一种是<code>$fillable</code>可以通过批量赋值进行赋值。另一种是<code>$guarded</code>在批量赋值时会被过滤掉。</p>
<p>添加到<code>app/Task.php</code></p>
<pre><code>protected $fillable = [&#39;name&#39;];
</code></pre>
<h4 id="4-2-3-Eloquent关联关系"><a href="#4-2-3-Eloquent关联关系" class="headerlink" title="4.2.3 Eloquent关联关系"></a>4.2.3 Eloquent关联关系</h4><p>tasks关联关系</p>
<p>在<code>user</code>模型中定义<code>tasks</code>关联关系。这里使用一对多关系，laravel的<code>ELoquent</code>中提供了<code>hasMany</code>方法。</p>
<p>在<code>app/user.php</code>文件中添加：</p>
<pre><code>use App\Task;

public function tasks()
&#123;
    return $this-&gt;hasMany(Task::class);
&#125;
</code></pre>
<p>user关联关系</p>
<p>要定义与<code>hasMany</code>相对的关联关系，需要在子模型中定义一个关联方法去调用<code>belongsTo</code>方法:</p>
<p>添加到<code>app/Task.php</code></p>
<pre><code>use App\User;

public function user()
&#123;
    return $this-&gt;belongsTo(User::class);
&#125;
</code></pre>
<h3 id="4-3-路由"><a href="#4-3-路由" class="headerlink" title="4.3 路由"></a>4.3 路由</h3><p>在<code>routes.php</code>中可以使用闭包定义所有的业务逻辑。实际上，大部分应用都会使用控制器来组织路由。</p>
<h4 id="4-3-1-显示视图"><a href="#4-3-1-显示视图" class="headerlink" title="4.3.1 显示视图"></a>4.3.1 显示视图</h4><p>使用<code>view</code>函数从路由中返回一个模板：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;welcome&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="4-3-2-用户认证"><a href="#4-3-2-用户认证" class="headerlink" title="4.3.2 用户认证"></a>4.3.2 用户认证</h4><p>web中用户认证工作是非常乏味的，laravel提供一个<code>auth</code>组件让他变得轻松。</p>
<p>可以直接使用Artisan指令做完成<code>auth</code>的创建。</p>
<pre><code>$ php artisan make:auth --views
</code></pre>
<p>随后只需要将<code>auth</code>添加到路由列表。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::auth();</span><br></pre></td></tr></table></figure>
<h4 id="4-3-3-任务控制器"><a href="#4-3-3-任务控制器" class="headerlink" title="4.3.3 任务控制器"></a>4.3.3 任务控制器</h4><p>接下来建立<code>TaskController</code>控制器，来处理任务。默认情况下控制器放置在<code>app/Http/controllers</code>目录下。使用下方命令创建：</p>
<pre><code>$ php artisan make:controller TaskController
</code></pre>
<p>现在添加一些对应控制器的路由，在<code>app/Http/routes.php</code>中添加：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/tasks&#x27;</span>, <span class="string">&#x27;TaskController@index&#x27;</span>);</span><br><span class="line">Route::post(<span class="string">&#x27;/task&#x27;</span>, <span class="string">&#x27;TaskController@store&#x27;</span>);</span><br><span class="line">Route::delete(<span class="string">&#x27;/task/&#123;task&#125;&#x27;</span>, <span class="string">&#x27;TaskController@destroy&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><strong>设置所有任务路由需要登录才能访问</strong></p>
<p>我们希望用户必须登陆到系统才能创建新任务。所以需要限制访问用户，为登陆用户。</p>
<p>laravel使用中间件来处理这种限制。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;middleware(<span class="string">&#x27;auth&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-4-创建布局与视图"><a href="#4-4-创建布局与视图" class="headerlink" title="4.4 创建布局与视图"></a>4.4 创建布局与视图</h3><p>布局方案与之前的版本相同。</p>
<p><img src="https://raw.githubusercontent.com/422303771/web/master/ubuntu/laravel/img/basic-overview.png"></p>
<h4 id="4-4-1-定义布局"><a href="#4-4-1-定义布局" class="headerlink" title="4.4.1 定义布局"></a>4.4.1 定义布局</h4><p>共用模板在<code>resources/views/layouts/app.blade.php</code>。</p>
<p><code>@yield(&#39;content&#39;)</code>为使用blade模板要插入的功能模块。</p>
<h4 id="4-4-2-定义子视图"><a href="#4-4-2-定义子视图" class="headerlink" title="4.4.2 定义子视图"></a>4.4.2 定义子视图</h4><p>随后定义<code>resources/views/tasks/index.blade.php</code>。它会对应<code>TaskController</code>控制器的<code>index</code>方法。</p>
<p>随后在<code>TaskController</code>控制其中添加<code>index</code>方法的返回视图。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;tasks.index&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-5-添加任务"><a href="#4-5-添加任务" class="headerlink" title="4.5 添加任务"></a>4.5 添加任务</h3><h4 id="4-5-1-验证表单输入"><a href="#4-5-1-验证表单输入" class="headerlink" title="4.5.1 验证表单输入"></a>4.5.1 验证表单输入</h4><p>编写<code>TaskController@store</code>路由对应的处理方法，处理一个表单请求并创建一个新任务。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;validate(<span class="variable">$request</span>, [</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;required|max:255&#x27;</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create The Task...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在控制器中，可以直接使用<code>ValidatesRequests</code>类中的<code>validate</code>方法。</p>
<p>而不用手动判断验证失败后的重定向，如果验证失败，用户会自动被重定向到来源页面，而错误信息也会存放到一次性<code>Session</code>中。</p>
<p><strong>$errors</strong></p>
<p>使用<code>@include(&#39;common.errors&#39;)</code>来渲染表单验证错误信息。</p>
<p>文件位置<code>resources/views/common/errors.blade.php</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">@if (count($errors) &gt; 0)</span><br><span class="line">    <span class="comment">&lt;!-- Form Error List --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;alert alert-danger&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">strong</span>&gt;</span>Whoops! Something went wrong!<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        @foreach ($errors-&gt;all() as $error)</span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123; $error &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        @endforeach</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">@endif</span><br></pre></td></tr></table></figure>
<h4 id="4-5-2-创建任务"><a href="#4-5-2-创建任务" class="headerlink" title="4.5.2 创建任务"></a>4.5.2 创建任务</h4><p>验证完成后，要新建一个任务。当任务新建完成，页面会跳转到<code>/tasks</code>。</p>
<p>laravel的关联提供了<code>save</code>方法，该方法接收一个关联模型实例，并且会在保存的数据库之前自动设置外键值到关联模型上。</p>
<p>这里<code>save</code>方法会自动将当前用户的，用户ID赋予给定的<code>user_id</code>属性。通过<code>$request-&gt;user()</code>获取当前用户实例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$request</span>-&gt;user()-&gt;tasks()-&gt;create([</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span> =&gt; <span class="variable">$request</span>-&gt;name,</span><br><span class="line">]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> redirect(<span class="string">&#x27;/tasks&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="4-6-显示己存在的任务"><a href="#4-6-显示己存在的任务" class="headerlink" title="4.6 显示己存在的任务"></a>4.6 显示己存在的任务</h3><p>现在需要编辑<code>TaskController@index</code>传递所有已存在任务到视图。<code>view</code>函数接收一个数组作为第二个参数，数组中的每个值都会在视图中作为变数。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$tasks</span> = Task::where(<span class="string">&#x27;user_id&#x27;</span>, <span class="variable">$request</span>-&gt;user()-&gt;id)-&gt;get();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;tasks.index&#x27;</span>, [</span><br><span class="line">        <span class="string">&#x27;tasks&#x27;</span> =&gt; <span class="variable">$tasks</span>,</span><br><span class="line">    ]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-6-1-依赖注入"><a href="#4-6-1-依赖注入" class="headerlink" title="4.6.1 依赖注入"></a>4.6.1 依赖注入</h4><p>laravel的服务容器是整个框架中最重要的特性。</p>
<p><strong>创建Repository</strong></p>
<p>正如之前说的，我们要定义一个<code>TaskRepository</code>来处理所有对<code>Task</code>模式的数据访问，随着应用的增长，需要在应用中共享一些Eloquent查询时，就变得特别有用。</p>
<p>创建<code>app/Repositories</code>目录并在其中创建一个<code>TaskRepository</code>类。记住，laravel项目的<code>app</code>文件夹下的所有目录都是使用PSR-4自动加载标准，所以可以随意创建需要的目录:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Repositories</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Task</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskRepository</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get all of the tasks for a given user.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> User $user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Collection</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">forUser</span>(<span class="params">User <span class="variable">$user</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Task::where(<span class="string">&#x27;user_id&#x27;</span>, <span class="variable">$user</span>-&gt;id)</span><br><span class="line">            -&gt;orderBy(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;asc&#x27;</span>)</span><br><span class="line">            -&gt;get();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>注入Repository</strong></p>
<p>Repository创建好之后，通过在<code>TaskController</code>的构造函数以类型提示的方式注入该Repository,然后就可以在index方法中使用。</p>
<p>由于laravel使用容器来解析所有控制器，所以依赖会被自动注入到控制器：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Task</span>;<span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Requests</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Repositories</span>\<span class="title">TaskRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The task repository instance.</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> TaskRepository</span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$tasks</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new controller instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> TaskRepository $tasks </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">TaskRepository <span class="variable">$tasks</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;middleware(<span class="string">&#x27;auth&#x27;</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;tasks = <span class="variable">$tasks</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Display a list of all of the user&#x27;s task.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">&#x27;tasks.index&#x27;</span>, [</span><br><span class="line">            <span class="string">&#x27;tasks&#x27;</span> =&gt; <span class="keyword">$this</span>-&gt;tasks-&gt;forUser(<span class="variable">$request</span>-&gt;user()),</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-6-2-显示任务"><a href="#4-6-2-显示任务" class="headerlink" title="4.6.2 显示任务"></a>4.6.2 显示任务</h4><p>在<code>tasks/index.blade.php</code>中以表格形式显示所有任务。Blade中使用<code>@foreach</code>处理循环数据。</p>
<h3 id="4-7-删除任务"><a href="#4-7-删除任务" class="headerlink" title="4.7 删除任务"></a>4.7 删除任务</h3><h4 id="4-7-1-添加删除按钮"><a href="#4-7-1-添加删除按钮" class="headerlink" title="4.7.1 添加删除按钮"></a>4.7.1 添加删除按钮</h4><p>当一个<code>DELETE /task</code>请求被发送到应用，它会触发<code>TaskController@destroy</code>方法：</p>
<p>在表单中同样要使用方法欺骗。</p>
<h4 id="4-7-2-路由模型绑定"><a href="#4-7-2-路由模型绑定" class="headerlink" title="4.7.2 路由模型绑定"></a>4.7.2 路由模型绑定</h4><p>定义<code>TaskController</code>的<code>destroy</code>方法。但是首先，重新查看路由的定义以及控制器方法。</p>
<h4 id="4-7-3-用户授权"><a href="#4-7-3-用户授权" class="headerlink" title="4.7.3 用户授权"></a>4.7.3 用户授权</h4><p>现在要将<code>Task</code>实例注入到<code>destroy</code>方法。然而为了保证当前登录用户是给定任务的用。</p>
<p>例如：一些恶意请求可能尝试通过传统随机任务ID到<code>/tasks/&#123;task&#125;</code>链接删除另一个用户的任务。</p>
<p>所有需要使用laravel的授权功能来确保，当前登录用户拥有操作<code>Task</code>实例的权限。</p>
<p><strong>创建Policy</strong></p>
<p>laravel使用策略来将授权组织到单个类中，通常，每个策略都对应一个模型。</p>
<p>因此，使用Artisan命令创建一个<code>TaskPolicy</code>,生成的文件位于<code>app/Policies/TaskPolicy.php</code>:</p>
<pre><code>$ php artisan make:policy TaskPolicy
</code></pre>
<p>随后将<code>destroy</code>方法添加到策略中，该方法会获取一个<code>user</code>实例和<code>task</code>实例，检查<code>用户ID</code>和任务的<code>user_id</code>是否相同。</p>
<p>实际上，所有的策略方法都会返回<code>true</code>或<code>false</code>:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Policies</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Task</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Auth</span>\<span class="title">Access</span>\<span class="title">HandlesAuthorization</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskPolicy</span></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">HandlesAuthorization</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Determine if the given user can delete the given task.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> User $user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Task $task</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span>(<span class="params">User <span class="variable">$user</span>, Task <span class="variable">$task</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$user</span>-&gt;id === <span class="variable">$task</span>-&gt;user_id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，需要关联<code>Task</code>模型和<code>TaskPolicy</code>，通过在<code>app/Providers/AuthServiceProvider.php</code>的<code>policies</code>属性添加注册实现。</p>
<p>注册后会告知Laravel无论何时尝试授权到<code>Task</code>实例时，该使用哪个策略类进行判断：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$policies</span> = [</span><br><span class="line">    <span class="string">&#x27;App\Task&#x27;</span> =&gt; <span class="string">&#x27;App\Policies\TaskPolicy&#x27;</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p><strong>授权动作</strong></p>
<p>编写好策略后，在<code>destroy</code>方法中使用它。所有的laravel控制器都可以调用<code>authorize</code>方法，该方法由<code>AuthorizesRequest</code>提供：</p>
<p><code>app/Controllers/TaskController.php</code>文件。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span>(<span class="params">Request <span class="variable">$request</span>, Task <span class="variable">$task</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;authorize(<span class="string">&#x27;destroy&#x27;</span>, <span class="variable">$task</span>);</span><br><span class="line">    <span class="comment">// Delete The Task...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="4-7-4-删除任务"><a href="#4-7-4-删除任务" class="headerlink" title="4.7.4 删除任务"></a>4.7.4 删除任务</h4><p>最后在<code>destroy</code>方法中实际删除任务。使用Eloquent的<code>delete</code>方法从数据库中删除给定的模型实例。</p>
<p>删除后返回<code>/tasks</code>连接：</p>
<p><code>app/Controllers/TaskController.php</code>文件中完整的<code>TaskController@destroy</code>方法。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span>(<span class="params">Request <span class="variable">$request</span>, Task <span class="variable">$task</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;authorize(<span class="string">&#x27;destroy&#x27;</span>, <span class="variable">$task</span>);</span><br><span class="line">    <span class="variable">$task</span>-&gt;delete();</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/tasks&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第五章 第四节</title>
    <url>/2016/07/26/a3ed63a923fe/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h1 id="5-4-请求"><a href="#5-4-请求" class="headerlink" title="5.4 请求"></a>5.4 请求</h1><h3 id="5-4-1-获取请求"><a href="#5-4-1-获取请求" class="headerlink" title="5.4.1 获取请求"></a>5.4.1 获取请求</h3><p>通过依赖注入获取当前HTTP请求实例，应该在控制器的构造函数或方法中对<code>Illuminate\Http\Request</code>类进行类型提示，当前请求实例会被服务容器自动注入：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Routing</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 存储新用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span>=<span class="variable">$request</span>-&gt;input(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果你的控制器方法还期望获取路由参数输入，只需要将路由参数置于其它依赖之后即可，例如，如果你的路由定义如下：</p>
<pre><code>Route::put(&#39;user/&#123;id&#125;&#39;,&#39;UserController@update&#39;);
</code></pre>
<p>依然可以对<code>Illuminate\Http\Request</code>进行类型提示并通过如下方式定义控制器方法来访问路由参数：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Routing</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line">classUser Controller <span class="keyword">extends</span> Controller</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新指定用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">Request <span class="variable">$request</span>,<span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-4-1-1-基本请求信息"><a href="#5-4-1-1-基本请求信息" class="headerlink" title="5.4.1.1 基本请求信息"></a>5.4.1.1 基本请求信息</h4><p><code>Illuminate\Http\Request</code>实例提交了多个方法来检查应用的HTTP请求，laravel的<code>Illuminate\Http\Request</code>继承自<code>Symfony\Component\HttpFoundation\Request</code>类，下面演示了一些有用的方法：</p>
<ul>
<li><p><strong>获取请求URI</strong></p>
<p>  path方法将会返回请求的URI（返回的是域名之后的部分），如果进入的请求路径是<code>http://domain.com/foo/bar</code>,则<code>path</code>方法将会返回<code>foo/bar</code>:</p>
<pre><code>  $uri=$request-&gt;path();
</code></pre>
<p>  <code>is</code>方法允许你验证进入的请求是否与给定模式匹配。使用该方法可以使用<code>*</code>通用符：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$request</span>-&gt;is(<span class="string">&#x27;admin/*&#x27;</span>))&#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  想要获取完整的URL，而不仅仅是路径信息，可以使用请求实例中的<code>url</code>或<code>fullUrl</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$url</span>=<span class="variable">$request</span>-&gt;url();</span><br><span class="line"><span class="variable">$url</span> = <span class="variable">$request</span>-&gt;fullUrl();</span><br></pre></td></tr></table></figure></li>
<li><p><strong>获取请求方法</strong></p>
<p>  <code>method</code>方法将会返回请求的HTTP请求方式。你可以使用<code>isMethod</code>方法来验证HTTP请求方式是否匹配给定字符串：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$method</span>=<span class="variable">$request</span>-&gt;method();</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$request</span>-&gt;isMethod(<span class="string">&#x27;post&#x27;</span>))&#123; </span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="5-4-1-2-PSR-7-请求"><a href="#5-4-1-2-PSR-7-请求" class="headerlink" title="5.4.1.2 PSR-7 请求"></a>5.4.1.2 PSR-7 请求</h4><p>PSR-7标准指定了HTTP信息接口，包括请求和响应。如果想要获取PSR-7请求实例，首先需要安装一些库，laravel使用<code>Symfony HTTP Message Bridge</code>组件，将原的laravel请求和响应转化为PSR-7兼容的请求：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer require symfony/psr-http-message-bridge</span><br><span class="line">composer require zendframework/zend-diactoros</span><br></pre></td></tr></table></figure>
<p>安装完这些库之后，只需要在路由或控制器中通过，对请求类型进行类型提示就可以获取RSR-7请求：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Psr</span>\<span class="title">Http</span>\<span class="title">Message</span>\<span class="title">ServerRequestInterface</span>;</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">ServerRequestInterface <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>如果从路由或控制器返回的是PSR-7响应实例，则其将会自动转化为laravel响应实例并显示出来。</p>
<hr>
<h3 id="5-4-2-获取输入信息"><a href="#5-4-2-获取输入信息" class="headerlink" title="5.4.2 获取输入信息"></a>5.4.2 获取输入信息</h3><ul>
<li><p><strong>获取特定输入值</strong></p>
<p>  通过<code>Illuminate\Http\Request </code>实例，使用简单的方法就可以取得所有的使用者输入资料。</p>
<p>  不需要担心发出请求时使用的HTTP动词，获取输入资料的方式都是相同的。</p>
<pre><code>  $name = $request-&gt;input(&#39;name&#39;);
</code></pre>
<p>  此外，可以使用<code>Illuminate\Http\Request </code>的动态属性存取使用者输入。</p>
<p>  例如，如果你的应用程序的表单含有一个<code>name</code>字段，可以使用下面的方式提交：</p>
<pre><code>  $name = $request-&gt;name;
</code></pre>
<p>  还可以传统一个默认值作为第二个参数给<code>input</code>方法，如果请求输入值在当前请求未出现时该值将会返回：</p>
<pre><code>  $name = $request-&gt;input(&#39;name&#39;, &#39;Sally&#39;);
</code></pre>
<p>  处理表单数组输入时，可以使用<code>.</code>来访问数组输入：</p>
<pre><code>  $input = $request-&gt;input(&#39;products.0.name&#39;);
  $names = $request-&gt;input(&#39;products.*.name&#39;);
</code></pre>
</li>
<li><p><strong>判断输入值是否出现</strong></p>
<p>  判断值是否在请求中出现，可以使用<code>has</code>方法，如果值出现且不为空，<code>has</code>方法返回<code>true</code>:</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if ($request-&gt;has(&#x27;name&#x27;)) &#123;</span><br><span class="line">    //</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>获取所有输入数据</strong></p>
<p>  还可以通过<code>all</code>方法获取所有输入数据：</p>
<pre><code>  $input = $request-&gt;all();
</code></pre>
</li>
<li><p><strong>获取部分输入数据</strong></p>
<p>  如何需要取出输入数据的子集，可以使用<code>only</code>或<code>except</code>方法，这两个方法都接收一个数组或动态列表作为唯一参数:</p>
<pre><code>  $input = $request-&gt;only([&#39;username&#39;, &#39;password&#39;]);
  $input = $request-&gt;only(&#39;username&#39;, &#39;password&#39;);
  
  $input = $request-&gt;except([&#39;credit_card&#39;]);
  $input = $request-&gt;except(&#39;credit_card&#39;);
</code></pre>
</li>
</ul>
<h4 id="5-4-2-1-上一次请求输入"><a href="#5-4-2-1-上一次请求输入" class="headerlink" title="5.4.2.1 上一次请求输入"></a>5.4.2.1 上一次请求输入</h4><p>laravel 允许你在两次请求之间保存输入数据，这个特性在检测校验数据失败后需要重新填充表单数据时很有用。</p>
<p>但如果使用的是laravel内置的验证服务，则不需要手动使用这些方法，因为一些laravel内置的校验会自动调用它们。</p>
<ul>
<li><p><strong>将输入存储到一次性Session</strong></p>
<p>  <code>Illuminate\Http\Request</code>实例的<code>flash</code>方法会将当前输入存放到一次性<code>Session</code>中，下次使用者发出请求至应用程序时就可以使用它们：</p>
<pre><code>  $request-&gt;flash();
</code></pre>
<p>  还可以使用<code>flashOnly</code>和<code>flashExcept</code>方法将输入数据子集存储到Session中：</p>
<pre><code>  $request-&gt;flashOnly(&#39;username&#39;, &#39;email&#39;);
  $request-&gt;flashExcept(&#39;password&#39;);
</code></pre>
</li>
<li><p><strong>将输入存储到一次性Session然后重定向</strong></p>
<p>  可能常常需要使用Session中的数据，并重新定向到前一页。可以简单使用<code>withInput</code>方法来将输入数据链接到<code>redirect</code>后面:</p>
<pre><code>  return redirect(&#39;form&#39;)-&gt;withInput();
  return redirect(&#39;form&#39;)-&gt;withInput($request-&gt;except(&#39;password&#39;));
</code></pre>
</li>
<li><p><strong>获取上次输入数据</strong></p>
<p>  要从Session中取出上次请求的输入数据，可以使用Request实例的<code>old</code>方法。<code>old</code>方法提供了便利方式从Session中取出数据：</p>
<pre><code>  $username = $request-&gt;old(&#39;username&#39;);
</code></pre>
<p>  laravel还提供了一个全局的辅助函数<code>old</code>，如果在Blade模板中显示上次输入数据，使用辅助函数<code>old</code>更方便，如果给定参数没有对应输入，返回null：</p>
<pre><code>  &#123;&#123; old('username') &#125;&#125;
</code></pre>
</li>
</ul>
<h4 id="5-4-2-2-Cookies"><a href="#5-4-2-2-Cookies" class="headerlink" title="5.4.2.2 Cookies"></a>5.4.2.2 Cookies</h4><ul>
<li><p><strong>从请求中取出Cookies</strong></p>
<p>  laravel 框架创建的所有cookies都经过加密并使用一个认证码进行签名，这意味着如果客户端修改了它们则需要对其进行有效性验证。使用<code>Illuminate\Http\Request</code>类中的 <code>cookie</code>方法从请求中获取cookie的值：</p>
<pre><code>  $value = $request-&gt;cookie(&#39;name&#39;);
</code></pre>
</li>
</ul>
<ul>
<li><p><strong>新增Cookies到回应</strong></p>
<p>  laravel 提供一个全局辅助函数<code>cookie</code>作为一个简单工厂来生成新的<code>Symfony\Component\HttpFoundation\Cookie</code>实例，新增的<code>cookie</code>通过<code>withCookie</code>方法被附加到<code>Illuminate\Http\Response</code>实例：</p>
<pre><code>  $response = new Illuminate\Http\Response(&#39;Hello World&#39;);
  $response-&gt;withCookie(cookie(&#39;name&#39;, &#39;value&#39;, $minutes));
  return $response;
</code></pre>
<p>  想要创建一个长期有效的cookie，可以使用cookie工厂的<code>forever</code>方法：</p>
<pre><code>  $response-&gt;withCookie(cookie()-&gt;forever(&#39;name&#39;, &#39;value&#39;));
</code></pre>
</li>
</ul>
<h4 id="5-4-2-3-文件上传"><a href="#5-4-2-3-文件上传" class="headerlink" title="5.4.2.3 文件上传"></a>5.4.2.3 文件上传</h4><ul>
<li><p><strong>获取上传的文件</strong></p>
<p>  使用<code>Illuminate\Http\Request</code>实例的<code>file</code>方法来访问上传文件，该方法返回的对象是<code>Symfony\Component\HttpFoundation\File\UploadedFile</code>类的一个实例，该类继承自PHP标准库中，与文件交互的<code>SplFileInfo</code>类：</p>
<pre><code>  $file = $request-&gt;file(&#39;photo&#39;);
</code></pre>
<p>  可以使用<code>hasFile</code>方法，判断上传文件是否存在：</p>
<pre><code>  if ($request-&gt;hasFile(&#39;photo&#39;)) &#123;
      //
  &#125;
</code></pre>
</li>
<li><p><strong>验证文件是否上传成功</strong></p>
<p>  使用<code>isValid</code>方法判断文件在上传过程中是否出错：</p>
<pre><code>  if ($request-&gt;file(&#39;photo&#39;)-&gt;isValid())&#123;
      //
  &#125;
  
</code></pre>
</li>
<li><p><strong>保存上传的文件</strong></p>
<p>  如果要移动文件到新位置，必须使用<code>move</code>方法。该方法会将文件从暂存位置（根据机器PHP设定来确定）移动到指定的永久保存位置：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$request</span>-&gt;file(<span class="string">&#x27;photo&#x27;</span>)-&gt;move(<span class="variable">$destinationPath</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$request</span>-&gt;file(<span class="string">&#x27;photo&#x27;</span>)-&gt;move(<span class="variable">$destinationPath</span>, <span class="variable">$fileName</span>);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>其它文件方法</strong></p>
<p>  <code>UploadedFile</code>实例中有很多可用的方法。可以到<a href="http://api.symfony.com/2.7/Symfony/Component/HttpFoundation/File/UploadedFile.html">该类的API</a>了解。</p>
</li>
</ul>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第五章 第三节</title>
    <url>/2016/07/17/1fe554b80964/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-3-控制器"><a href="#5-3-控制器" class="headerlink" title="5.3 控制器"></a>5.3 控制器</h2><h3 id="5-3-1-简介"><a href="#5-3-1-简介" class="headerlink" title="5.3.1 简介"></a>5.3.1 简介</h3><p>将所有的请求处理逻辑都放在单个<code>routes.php</code>中显示是不合理的，你也许还希望使用控制器类组织管理这些行为。</p>
<p>控制器可以将相关的HTTP请求封装到一个类中进行处理。</p>
<p>通常控制器存放在<code>app/Http/Controllers</code>目录中。</p>
<hr>
<h3 id="5-3-2-基本控制器"><a href="#5-3-2-基本控制器" class="headerlink" title="5.3.2 基本控制器"></a>5.3.2 基本控制器</h3><p>下面是一个基本控制器类的例子。所有的laravel控制器应该继承，laravel自带的控制器基类<code>Controller</code>:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为指定用户显示详情</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showProfile</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">&#x27;user.profile&#x27;</span>, [<span class="string">&#x27;user&#x27;</span> =&gt; User::findOrFail(<span class="variable">$id</span>)]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以像这样定义指向控制器动作的路由：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="string">&#x27;UserController@showProfile&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>现在，如果一个请求匹配上面的路由URL，<code>UserController</code>的<code>showProfile</code>方法就会被执行。</p>
<p>当然，路由参数也会被传递给这个方法。</p>
<h4 id="5-3-2-1-控制器-amp-命名空间"><a href="#5-3-2-1-控制器-amp-命名空间" class="headerlink" title="5.3.2.1 控制器 &amp; 命名空间"></a>5.3.2.1 控制器 &amp; 命名空间</h4><p>在命名时，没有使用完整的控制器命名，而只定义了<code>App\Http\Controllers</code>之后的部分。</p>
<p>默认<code>RouteServiceProvider</code>会将一个路由群组载入<code>routes.php</code>文件，并且该路由群组指定了，群组中路由控制器所在的命名空间。</p>
<p>如果在<code>App\Http\Controllers</code>目录下选择使用PHP命名空间 或者 组织控制器，只需要使用相对于<code>App\Http\Controllers</code>命令空间的指定类名即可。因此，如果完整控制器类是<code>App\Http\Controllers\Photos\AdminController</code>,可以像这样注册路由：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;Photos\AdminController@method&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="5-3-2-2-命名控制器路由"><a href="#5-3-2-2-命名控制器路由" class="headerlink" title="5.3.2.2 命名控制器路由"></a>5.3.2.2 命名控制器路由</h4><p>和闭包路由一样，可以指定控制器路由的名称：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;foo&#x27;</span>, [<span class="string">&#x27;uses&#x27;</span> =&gt; <span class="string">&#x27;FooController@method&#x27;</span>, <span class="string">&#x27;as&#x27;</span> =&gt; <span class="string">&#x27;name&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<p>你可以使用辅助函数<code>route</code>来为己命名的控制器路由生成对应的URL：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$url</span> = route(<span class="string">&#x27;name&#x27;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-3-3-控制器中间件"><a href="#5-3-3-控制器中间件" class="headerlink" title="5.3.3 控制器中间件"></a>5.3.3 控制器中间件</h3><p>中间件可以分配给控制器路由：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;profile&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;middleware&#x27;</span> =&gt; <span class="string">&#x27;auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;uses&#x27;</span> =&gt; <span class="string">&#x27;UserController@showProfile&#x27;</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p>但是，将中间件放在控制器构造函数中更方便，在控制器的构建函数中使用<code>middleware</code>方法可以很轻松的分配中间件给控制器。</p>
<p>甚至可以限定中间件应用到控制器的指定方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实例化一个新的 UserController 实例</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;middleware(<span class="string">&#x27;auth&#x27;</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;middleware(<span class="string">&#x27;log&#x27;</span>, [<span class="string">&#x27;only&#x27;</span> =&gt; [<span class="string">&#x27;fooAction&#x27;</span>, <span class="string">&#x27;barAction&#x27;</span>]]);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;middleware(<span class="string">&#x27;subscribed&#x27;</span>, [<span class="string">&#x27;except&#x27;</span> =&gt; [<span class="string">&#x27;fooAction&#x27;</span>, <span class="string">&#x27;barAction&#x27;</span>]]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<hr>
<h3 id="5-3-4-RESTful-资源控制器"><a href="#5-3-4-RESTful-资源控制器" class="headerlink" title="5.3.4 RESTful 资源控制器"></a>5.3.4 RESTful 资源控制器</h3><p>laravel的资源控制器使得构建围绕资源的<code>RESTful</code>控制器变得毫无痛苦。</p>
<p>例如，想要在应用中创建一个控制器，用于处理关于图片存储的HTTP请求，使用Artisan命令<code>make:controller</code>，可以快速创建这样的控制器：</p>
<pre><code>php artisan make:controller PhotoController --resource
</code></pre>
<p>这个Artisan命令将会生成一个控制器文件<code>app/Http/Controllers/PhotoController.php</code>,这个控制器包含了每一个资源操作的方法。</p>
<p>接下来，可以为该控制器注册一个资源路由：</p>
<pre><code>Route::resource(&#39;photo&#39;, &#39;PhotoController&#39;);
</code></pre>
<p>这个理由声明包含了处理图片资源RESTful 动作的多个路由，相应地，Artisan 生成的控制器也已经为这些动作设置了对应的处理方法。</p>
<h4 id="5-3-4-1-资源控制器处理的动作"><a href="#5-3-4-1-资源控制器处理的动作" class="headerlink" title="5.3.4.1 资源控制器处理的动作"></a>5.3.4.1 资源控制器处理的动作</h4><table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">路径</th>
<th align="left">动作</th>
<th align="left">路由名称</th>
</tr>
</thead>
<tbody><tr>
<td align="left">GET</td>
<td align="left">/photo</td>
<td align="left">index</td>
<td align="left">photo.index</td>
</tr>
<tr>
<td align="left">GET</td>
<td align="left">/photo/create</td>
<td align="left">create</td>
<td align="left">photo.create</td>
</tr>
<tr>
<td align="left">POST</td>
<td align="left">/photo</td>
<td align="left">store</td>
<td align="left">photo.store</td>
</tr>
<tr>
<td align="left">GET</td>
<td align="left">/photo/{photo}</td>
<td align="left">show</td>
<td align="left">photo.show</td>
</tr>
<tr>
<td align="left">GET</td>
<td align="left">/photo/{photo}/edit</td>
<td align="left">edit</td>
<td align="left">photo.edit</td>
</tr>
<tr>
<td align="left">PUT/PATCH</td>
<td align="left">/photo/{photo}</td>
<td align="left">update</td>
<td align="left">photo.update</td>
</tr>
<tr>
<td align="left">DELETE</td>
<td align="left">/photo/{photo}</td>
<td align="left">destroy</td>
<td align="left">photo.destroy</td>
</tr>
</tbody></table>
<p><em>注意：HTTP表单不支持PUT、PATCH、DELETE请求，需要添加一个隐藏的<code>_method</code>文件来仿照这些动词。</em></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="5-3-4-2-只定义部分资源路由"><a href="#5-3-4-2-只定义部分资源路由" class="headerlink" title="5.3.4.2 只定义部分资源路由"></a>5.3.4.2 只定义部分资源路由</h4><p>声明资源路由时可以指定该路由处理的动作子集：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::resource(<span class="string">&#x27;photo&#x27;</span>, <span class="string">&#x27;PhotoController&#x27;</span>,</span><br><span class="line">[<span class="string">&#x27;only&#x27;</span> =&gt; [<span class="string">&#x27;index&#x27;</span>, <span class="string">&#x27;show&#x27;</span>]]);</span><br><span class="line"></span><br><span class="line">Route::resource(<span class="string">&#x27;photo&#x27;</span>, <span class="string">&#x27;PhotoController&#x27;</span>,</span><br><span class="line">[<span class="string">&#x27;except&#x27;</span> =&gt; [<span class="string">&#x27;create&#x27;</span>, <span class="string">&#x27;store&#x27;</span>, <span class="string">&#x27;update&#x27;</span>, <span class="string">&#x27;destroy&#x27;</span>]]);</span><br></pre></td></tr></table></figure>

<h4 id="5-3-4-3-命名资源路由"><a href="#5-3-4-3-命名资源路由" class="headerlink" title="5.3.4.3 命名资源路由"></a>5.3.4.3 命名资源路由</h4><p>默认情况下，所有资源控制器动作都有一个路由名称，然而，我们可以通过传入<code>names</code>数组来覆盖这些默认的名字：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::resource(<span class="string">&#x27;photo&#x27;</span>, <span class="string">&#x27;PhotoController&#x27;</span>,</span><br><span class="line">                [<span class="string">&#x27;names&#x27;</span> =&gt; [<span class="string">&#x27;create&#x27;</span> =&gt; <span class="string">&#x27;photo.build&#x27;</span>]]);</span><br></pre></td></tr></table></figure>

<h4 id="5-3-4-4-补充资源控制器"><a href="#5-3-4-4-补充资源控制器" class="headerlink" title="5.3.4.4 补充资源控制器"></a>5.3.4.4 补充资源控制器</h4><p>如果有必要在默认资源路由之外添加额外的路由到资源控制器，应该在调用<code>Route::resource</code>之前定义这些路由，否则，通过<code>resource</code>方法定义的路由可能无意中优于补充的额外路由：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;photos/popular&#x27;</span>, <span class="string">&#x27;PhotoController@method&#x27;</span>);</span><br><span class="line">Route::resource(<span class="string">&#x27;photos&#x27;</span>, <span class="string">&#x27;PhotoController&#x27;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-3-5-依赖注入-amp-控制器"><a href="#5-3-5-依赖注入-amp-控制器" class="headerlink" title="5.3.5 依赖注入 &amp; 控制器"></a>5.3.5 依赖注入 &amp; 控制器</h3><h4 id="5-3-5-1-构造函数注入"><a href="#5-3-5-1-构造函数注入" class="headerlink" title="5.3.5.1 构造函数注入"></a>5.3.5.1 构造函数注入</h4><p>laravel使用服务容器解析所有的Laravel控制器，因此，可以在控制器的构造函数中声明任何依赖，这些依赖会被自动解析并注入到控制器实例中：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Routing</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Repositories</span>\<span class="title">UserRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The user repository instance.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$users</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建新的控制器实例</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> UserRepository $users</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">UserRepository <span class="variable">$users</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;users = <span class="variable">$users</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，还可以对任何的<code>laravel contact</code> 使用类别提示。若容器能解析它，就可以使用型别提示。</p>
<h4 id="5-3-5-2-方法注入"><a href="#5-3-5-2-方法注入" class="headerlink" title="5.3.5.2 方法注入"></a>5.3.5.2 方法注入</h4><p>除了构造函数注入外，还可以在控制器的动作方法中进行依赖的类型提示。</p>
<p>例如，可以对<code>Illuminate\Http\Request </code>实例，其中的一个方法使用类别提示：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 儲存一個新的使用者。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  Request  $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$request</span>-&gt;input(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果控制器方法期望输入路由参数，只需要将路由参数放到其他依赖之后，例如，如果你的路由定义如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::put(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, <span class="string">&#x27;UserController@update&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>你需要通过定义控制器方法如下所示来类型提示 <code>Illuminate\Http\Request</code> 并访问路由参数 <code>id</code>：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Routing</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新指定用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@translator</span> http://laravelacademy.org</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">Request <span class="variable">$request</span>, <span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-3-6-路由缓存"><a href="#5-3-6-路由缓存" class="headerlink" title="5.3.6 路由缓存"></a>5.3.6 路由缓存</h3><p><strong>使用控制器路由的重要性</strong></p>
<p><em>注意：路由缓存不会作用于基于闭包的路由。要使用路由缓存，必须将闭包路由转化为控制器路由。</em></p>
<p>如果你的应用完全基于控制器路由，可以使用 Laravel 的路由缓存，使用路由缓存将会极大减少注册所有应用路由所花费的时间开销，在某些案例中，路由注册速度甚至能提高100倍！想要生成路由缓存，只需执行 Artisan 命令·<code>route:cache</code>:</p>
<pre><code>php artisan route:cache
</code></pre>
<p>就这么简单！你的缓存路由文件现在取代 <code>app/Http/routes.php</code> 文件被使用，记住，如果你添加新的路由需要重新生成路由缓存。因此，只有在项目部署阶段才需要运行 <code>route:cache</code> 命令。</p>
<p>想要移除缓存路由文件，使用 <code>route:clear</code> 命令即可：</p>
<pre><code>php artisan route:clear
</code></pre>
<hr>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第五章 第二节</title>
    <url>/2016/07/17/348d503381f4/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-2-中间件"><a href="#5-2-中间件" class="headerlink" title="5.2 中间件"></a>5.2 中间件</h2><h3 id="5-2-1-简介"><a href="#5-2-1-简介" class="headerlink" title="5.2.1 简介"></a>5.2.1 简介</h3><p>laravel中间件提供一个方便的机制来过滤进入web应用的HTTP请求。</p>
<p>例如，laravel内置一个中间件来验证用户是否经过授权，如果用户没有经过授权，中间件会将用户重定向到登陆页面，否则如果用户经过授权，中间件就会允许请求继续往前进行下一步操作。</p>
<p>当然，除了认证之外，中间件还可以用来处理更多任务。</p>
<p>例如：CORS中间件可以为离开站点的响应添加合适的头，日记中间件可以记录所有进入站点的请求。</p>
<p>laravel框架自带了一些中间件，包括维护模式、认证、CSRF等等。所有的中间件都位于<code>App/Http/Middleware</code>目录中。</p>
<hr>
<h3 id="5-2-2-定义中间件"><a href="#5-2-2-定义中间件" class="headerlink" title="5.2.2 定义中间件"></a>5.2.2 定义中间件</h3><p>可以使用Artisan命令<code>make:middleware</code>创建一个新的中间件</p>
<pre><code>php artisan make:middleware OldMiddleware
</code></pre>
<p>其中的<code>OldMiddleware</code>可以为任意名称。</p>
<p>命令会下<code>app/Http/Middleware</code>目录下创建一个新的中间件<code>OldMiddlware</code>,在这个中间件中，设定只允许<code>age</code>大于<code>200</code>的才能访问路由，否则，将用户重新定向到主页：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OldMiddleware</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回请求过滤器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Illuminate\Http\Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Closure $next</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$request</span>-&gt;input(<span class="string">&#x27;age&#x27;</span>) &lt;= <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;home&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果<code>age&lt;=200</code>,中间件会返回一个HTTP重定向到客户端；否则，请求会被传统下去。将请求往下传递可以通过调用回调函数<code>$next</code>并传入<code>$request</code>。</p>
<p>理解中间件最好的方式是将中间件看做HTTP请求，到达目标动作之前必须经过的<code>层</code>，每一层都会检查请求并且可以完全拒绝它。</p>
<h4 id="5-2-2-1-中间件之前-之后"><a href="#5-2-2-1-中间件之前-之后" class="headerlink" title="5.2.2.1 中间件之前/之后"></a>5.2.2.1 中间件之前/之后</h4><p>一个中间件，在请求前执行还是请求后执行取决于中间件本身。</p>
<p>比如，下方中间件会在请求处理前执行一些任务：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OldMiddleware</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回请求过滤器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Illuminate\Http\Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Closure $next</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$request</span>-&gt;input(<span class="string">&#x27;age&#x27;</span>) &lt;= <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;home&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下方中间件会在请求处理后执行任务：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AfterMiddleware</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$response</span> = <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行动作</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-2-3-注册中间件"><a href="#5-2-3-注册中间件" class="headerlink" title="5.2.3 注册中间件"></a>5.2.3 注册中间件</h3><h4 id="5-2-3-1-全局中间件"><a href="#5-2-3-1-全局中间件" class="headerlink" title="5.2.3.1 全局中间件"></a>5.2.3.1 全局中间件</h4><p>如果想要中间件放在每个HTTP请求期间被执行，只需要将相应的中间件类，设置到<code>app/Http/Kernel.php</code>的<code>$middleware</code>属性中。</p>
<h4 id="5-2-3-2-为路由指派中间件"><a href="#5-2-3-2-为路由指派中间件" class="headerlink" title="5.2.3.2 为路由指派中间件"></a>5.2.3.2 为路由指派中间件</h4><p>如果想要分配中间件到指定路由，先要在<code>app/Http/Kernel.php</code>文件中分配给中间件一个简写的<code>key</code>,默认情况下，该类的<code>$routeMiddleware</code>属性包含了laravel内置的入口中间件，添加自己的中间件只需要将其追加到后面并为其分配一个<code>key</code>:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在 App\Http\Kernel 里中</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$routeMiddleware</span> = [</span><br><span class="line">    <span class="string">&#x27;auth&#x27;</span> =&gt; \App\Http\Middleware\Authenticate::class,</span><br><span class="line">    <span class="string">&#x27;auth.basic&#x27;</span> =&gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,</span><br><span class="line">    <span class="string">&#x27;guest&#x27;</span> =&gt; \App\Http\Middleware\RedirectIfAuthenticated::class,</span><br><span class="line">    <span class="string">&#x27;throttle&#x27;</span> =&gt; \Illuminate\Routing\Middleware\ThrottleRequests::class,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>中间件在 HTTP Kernel 中被定义后，可以在路由选项数组中使用 <code>$middleware</code> 键来指定该中间件：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;admin/profile&#x27;</span>, [<span class="string">&#x27;middleware&#x27;</span> =&gt; <span class="string">&#x27;auth&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;]);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>使用数组分配多个中间件到路由,使用数组方式排列:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, [<span class="string">&#x27;middleware&#x27;</span> =&gt; [<span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;second&#x27;</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>处理使用数组外，还可以使用<code>middleware</code>方法链方式定义路由：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;)-&gt;middleware([<span class="string">&#x27;first&#x27;</span>, <span class="string">&#x27;second&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="5-2-3-3-中间件群组"><a href="#5-2-3-3-中间件群组" class="headerlink" title="5.2.3.3 中间件群组"></a>5.2.3.3 中间件群组</h4><p>有时你可能想将多个中间件组成单一的键，让它可以简单的指派给路由。</p>
<p>这可以通过使用HTTP的<code>$middlewareGroups</code>实现。</p>
<p>laravel自带了<code>web</code>与<code>api</code>两个中间件组，包含可以应用到webUI和API路由的通用中间件：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 应用的路由中间件组</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$middlewareGroups</span> = [</span><br><span class="line">    <span class="string">&#x27;web&#x27;</span> =&gt; [</span><br><span class="line">        \App\Http\Middleware\EncryptCookies::class,</span><br><span class="line">        \Illuminate\Cookie\Middleware\AddQueuedCookiesToResponse::class,</span><br><span class="line">        \Illuminate\Session\Middleware\StartSession::class,</span><br><span class="line">        \Illuminate\View\Middleware\ShareErrorsFromSession::class,</span><br><span class="line">        \App\Http\Middleware\VerifyCsrfToken::class,</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;api&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;throttle:60,1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;auth:api&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>中间件组可以被分配给路由和控制器动作，使用方法与单个中间件相同。</p>
<p><strong>注意：中间件组只是让指派多个中间件变得简单</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;middleware&#x27;</span> =&gt; [<span class="string">&#x27;web&#x27;</span>]], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-2-4-中间件参数"><a href="#5-2-4-中间件参数" class="headerlink" title="5.2.4 中间件参数"></a>5.2.4 中间件参数</h3><p>中间件还可以接收额外的自定义参数。</p>
<p>例如，应用要先检查使用者是否有权限，后执行特定的操作。</p>
<p>可以建立<code>RoleMiddleware</code>来接收使用者名称作为额外的参数。</p>
<p>额外的中间件参数会在<code>$next</code>参数之后传入中间件:</p>
<p><em>注意：下方代价中指<code> Closure $next</code>后</em></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RoleMiddleware</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 运行请求过滤器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Illuminate\Http\Request $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> \Closure $next</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $role</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     * translator http://laravelacademy.org</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span>, <span class="variable">$role</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (! <span class="variable">$request</span>-&gt;user()-&gt;hasRole(<span class="variable">$role</span>)) &#123;</span><br><span class="line">            <span class="comment">// Redirect...</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>中间件参数可以在定义路由时通过<code>:</code>分隔中间件名和参数名来指定，多个中间件参数可以通过<code>,</code>分隔：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::put(<span class="string">&#x27;post/&#123;id&#125;&#x27;</span>, [<span class="string">&#x27;middleware&#x27;</span> =&gt; <span class="string">&#x27;role:editor&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-2-5-可终止的中间件"><a href="#5-2-5-可终止的中间件" class="headerlink" title="5.2.5 可终止的中间件"></a>5.2.5 可终止的中间件</h3><p>有时中间件需要在HTTP响应发送到浏览器后做一些工作。</p>
<p>例如，让<code>Session</code>中间件在响应发送到浏览器后，将Session中的数据写到存储器中。</p>
<p>为了实现这个，定义一个终止中间件，并在其中使用<code>terminable</code>方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Session</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StartSession</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">terminate</span>(<span class="params"><span class="variable">$request</span>, <span class="variable">$response</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Store the session data...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个<code>terminate</code>方法要接受<code>$request</code>和<code>$response</code>。一旦使用终止中间，应将其添加到<code>Http Kernel</code>作为全局变量使用。</p>
<p>当调用中间件中的<code>terminate</code>方法时，laravel将从服务器容器中取出这个中间件的新实例。</p>
<p>如果想在调用<code>handle</code>和<code>terminate</code>使用同一中间件实例，需要使用<code>container(容器)</code>的<code>singleton</code>方法将中间注入到容器。</p>
<p>这里<code>实例</code>可以理解为数据包。</p>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第五章 第五节</title>
    <url>/2016/07/26/78a7f2eb97d1/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-5-响应"><a href="#5-5-响应" class="headerlink" title="5.5 响应"></a>5.5 响应</h2><h3 id="5-5-1-基本响应"><a href="#5-5-1-基本响应" class="headerlink" title="5.5.1 基本响应"></a>5.5.1 基本响应</h3><p>所有路由和控制器都会返回某种被发送到用户浏览器的响应，laravel提供多种不同的方式来返回响应，最基本的响应就是从路由或控制器返回一个简单的字符串：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Hello World&#x27;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>给定的字符串会被框架自动转化为HTTP响应。</p>
<h4 id="5-5-1-1-Response对象"><a href="#5-5-1-1-Response对象" class="headerlink" title="5.5.1.1 Response对象"></a>5.5.1.1 Response对象</h4><p>大多数路由和控制器动作都会返回一个完整的<code>Illuminate\Http\Response</code>实例或视图，返回一个完整的Response实例允许你自定义响应的HTTP状态码和头信息。Responses实例继承自<code>Symfony\Component\HttpFoundation\Response</code>类，该类提供了一系列方法用于创建HTTP响应：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Response</span>;</span><br><span class="line"></span><br><span class="line">Route::get(<span class="string">&#x27;home&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> (<span class="keyword">new</span> Response(<span class="variable">$content</span>, <span class="variable">$status</span>))</span><br><span class="line">-&gt;header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="variable">$value</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>为了方便，还可以使用辅助函数<code>response</code>:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;home&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response(<span class="variable">$content</span>, <span class="variable">$status</span>)</span><br><span class="line">        -&gt;header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="variable">$value</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>注意：要查看完整的Response方法列表，看可以查看<a href="https://laravel.com/api/master/Illuminate/Http/Response.html">API文档</a>与<a href="http://api.symfony.com/2.7/Symfony/Component/HttpFoundation/Response.html">Symfony API 文档</a></em></p>
<h4 id="5-5-1-2-添加响应头"><a href="#5-5-1-2-添加响应头" class="headerlink" title="5.5.1.2 添加响应头"></a>5.5.1.2 添加响应头</h4><p>大部分响应方法可以用方法链形式调用，从而使得可以建立平滑的响应。</p>
<p>例如，你可以在响应送出给使用者之前，使用<code>header</code>方法增加一系列的响应头到响应：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> response(<span class="variable">$content</span>)</span><br><span class="line">            -&gt;header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="variable">$type</span>)</span><br><span class="line">            -&gt;header(<span class="string">&#x27;X-Header-One&#x27;</span>, <span class="string">&#x27;Header Value&#x27;</span>)</span><br><span class="line">            -&gt;header(<span class="string">&#x27;X-Header-Two&#x27;</span>, <span class="string">&#x27;Header Value&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>或者，可以使用<code>withHeaders</code>方法指定要增加至回应的响应头数组：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> response(<span class="variable">$content</span>)</span><br><span class="line">    -&gt;withHeaders([</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span> =&gt; <span class="variable">$type</span>,</span><br><span class="line">        <span class="string">&#x27;X-Header-One&#x27;</span> =&gt; <span class="string">&#x27;Header Value&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;X-Header-Two&#x27;</span> =&gt; <span class="string">&#x27;Header Value&#x27;</span>,</span><br><span class="line">    ]);</span><br></pre></td></tr></table></figure>

<h4 id="5-5-1-3-添加Cookie到响应"><a href="#5-5-1-3-添加Cookie到响应" class="headerlink" title="5.5.1.3 添加Cookie到响应"></a>5.5.1.3 添加Cookie到响应</h4><p>透过响应实例的函数<code>cookie</code>可以轻松添加Cookie到响应：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> response(<span class="variable">$content</span>)-&gt;header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="variable">$type</span>)</span><br><span class="line">    -&gt;cookie(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;value&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p><code>cookie</code>方法接收额外的可选参数，使你可以进一步自定cookies的属性：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">-&gt;cookie(<span class="variable">$name</span>, <span class="variable">$value</span>, <span class="variable">$minutes</span>, <span class="variable">$path</span>, <span class="variable">$domain</span>, <span class="variable">$secure</span>, <span class="variable">$httpOnly</span>)</span><br></pre></td></tr></table></figure>
<p>默认情况下，laravel框架生成的Cookie经过了加密和签名，以免在客户端被纂改。</p>
<p>如果想要让特定的Cookie子集在生成时取消加密，可以使用中间件<code>App\Http\Middleware\EncryptCookies</code>的<code>$except</code>属性来排除这些Cookie：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 不需要被加密的cookies名称</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$except</span> = [</span><br><span class="line">    <span class="string">&#x27;cookie_name&#x27;</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-5-2-其他响应类型"><a href="#5-5-2-其他响应类型" class="headerlink" title="5.5.2 其他响应类型"></a>5.5.2 其他响应类型</h3><p>辅助函数<code>response</code>可以很方便地用来生成其他类型的响应实例，当无参数调用<code>response</code>时会返回<code>Illuminate\Contracts\Routing\ResponseFactory</code>的一个实现类实例契约，该契约提供了一些有用的方法来生成响应。</p>
<h4 id="5-5-2-1-视图"><a href="#5-5-2-1-视图" class="headerlink" title="5.5.2.1 视图"></a>5.5.2.1 视图</h4><p>如果需要控制响应状态和响应头，并还需要返回一个视图作为响应内容，可以使用<code>view</code>方法:</p>
<pre><code>return response()-&gt;view(&#39;hello&#39;, $data)-&gt;header(&#39;Content-Type&#39;, $type);
</code></pre>
<p>当然，如果不需要传递自定义的HTTP状态码和头信息，只需要简单使用全局函数<code>view</code>即可。</p>
<h4 id="5-5-2-2-JSON"><a href="#5-5-2-2-JSON" class="headerlink" title="5.5.2.2 JSON"></a>5.5.2.2 JSON</h4><p><code>json</code>方法会自动将<code>Content-Type</code>头设置为<code>application/json</code>,并使用PHP函数<code>json_encode</code>方法将给定数组转化为JSON：</p>
<pre><code>return response()-&gt;json([&#39;name&#39; =&gt; &#39;Abigail&#39;, &#39;state&#39; =&gt; &#39;CA&#39;]);
</code></pre>
<p>如果要创建一个JSONP响应，可以在<code>json</code>方法之后调用<code>setCallback</code>方法：</p>
<pre><code>return response()-&gt;json([&#39;name&#39; =&gt; &#39;Abigail&#39;, &#39;state&#39; =&gt; &#39;CA&#39;])
    -&gt;setCallback($request-&gt;input(&#39;callback&#39;));
</code></pre>
<h4 id="5-5-2-3-文件下载"><a href="#5-5-2-3-文件下载" class="headerlink" title="5.5.2.3 文件下载"></a>5.5.2.3 文件下载</h4><p><code>download</code>方法用于生成强制用户浏览器下载给定路由文件的响应。<code>download</code>文件接受文件名作为第二个参数，该参数决定用户下载文件的显示名称，可以将HTTP头信息作为第三个参数传递到该方法：</p>
<pre><code>return response()-&gt;download($pathToFile);
return response()-&gt;download($pathToFile, $name, $headers);
</code></pre>
<p><em>注意：管理文件下载的 Symfony HttpFoundation 类要求被下载文件有一个ASCII文件名。</em></p>
<hr>
<h3 id="5-5-3-重定向"><a href="#5-5-3-重定向" class="headerlink" title="5.5.3 重定向"></a>5.5.3 重定向</h3><p>重定向响应是<code>Illuminate\Http\RedirectResponse</code>类的实例，其中包含了必须的头信息将用户重定向到另一个 URL，有很多方式来生成 <code>RedirectResponse</code> 实例，最简单的方法就是使用全局辅助函数 <code>redirect</code>：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;dashboard&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;home/dashboard&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>有时候想要将用户重定向到上一个请求的位置。</p>
<p>例如，表单提交后，验证不通过，就可以使用辅助函数<code>back</code>返回到前一个URL(使用该方法之前确保路由使用了<code>web</code>中间件组或都使用了<code>session </code>中间件)：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::post(<span class="string">&#x27;user/profile&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 验证请求...</span></span><br><span class="line">    <span class="keyword">return</span> back()-&gt;withInput();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5-5-3-1-重定向到命名路由"><a href="#5-5-3-1-重定向到命名路由" class="headerlink" title="5.5.3.1 重定向到命名路由"></a>5.5.3.1 重定向到命名路由</h4><p>如果调用不带参数的<code>redirect</code>方法，会返回一个<code>Illuminate\Routing\Redirector</code>实例，然后可以调用该实例上的任何方法。</p>
<p>例如:为了生成一个<code>RedirectResponse</code>到命令路由，可以使用<code>route</code>方法：</p>
<pre><code>return redirect()-&gt;route(&#39;login&#39;);
</code></pre>
<p>如果路由中有参数，可以将其作为第二个参数传递到<code>route</code>方法：</p>
<pre><code>// For a route with the following URI: profile/&#123;id&#125;
return redirect()-&gt;route(&#39;profile&#39;, [1]);
</code></pre>
<p>如果要重定向到带ID参数的路由(Eloquent 模型绑定),可以传递模型本身，ID会被自动解析出来：</p>
<pre><code>return redirect()-&gt;route(&#39;profile&#39;, [$user]);
</code></pre>
<h4 id="5-5-3-2-重定向到控制器动作"><a href="#5-5-3-2-重定向到控制器动作" class="headerlink" title="5.5.3.2 重定向到控制器动作"></a>5.5.3.2 重定向到控制器动作</h4><p>还可以生成重定向到控制器动作，只需传递控制器和动作名到<code>action</code>方法即可。记住，不需要指定控制器的完整命名。laravel的<code>RouteServiceProvider</code>会自动设置默认的控制器命名：</p>
<pre><code>return redirect()-&gt;action(&#39;HomeController@index&#39;);
</code></pre>
<p>当然，如果控制器路由要求参数，可以将参数作为第二个参数传递给<code>action</code>方法：</p>
<pre><code>return redirect()-&gt;action(&#39;UserController@profile&#39;, [1]);
</code></pre>
<h4 id="5-5-3-3-带一次性-Session-数据的重定向"><a href="#5-5-3-3-带一次性-Session-数据的重定向" class="headerlink" title="5.5.3.3 带一次性 Session 数据的重定向"></a>5.5.3.3 带一次性 Session 数据的重定向</h4><p>重定向到一个新的URL并将数据存储到一次性Session中通常是同时完成的，为了方便，可以创建一个<code>RedirectResponse</code>实例然后在同一方法上将数据存储到Session，这种方式在action之后存储状态信息特别方便：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::post(<span class="string">&#x27;user/profile&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 更新用户属性...</span></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;dashboard&#x27;</span>)-&gt;with(<span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;Profile updated!&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当然，用户重定向到新页面之后，你可以从Session中取出并显示这些一次性信息。</p>
<p>例如，使用Blade语法实现：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@if (session(&#x27;status&#x27;))</span><br><span class="line">    &lt;div class=&quot;alert alert-success&quot;&gt;</span><br><span class="line">        &#123;&#123; session(&#x27;status&#x27;) &#125;&#125;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">@endif</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-5-4-响应宏"><a href="#5-5-4-响应宏" class="headerlink" title="5.5.4 响应宏"></a>5.5.4 响应宏</h3><p>如果想要定义一个自定义的响应并且在多个路由和控制器中复用，可以使用<code>Illuminate\Contracts\Routing\ResponseFactory</code>类，或者<code>Response</code>函数中的<code>macro</code>方法。</p>
<p>例如：在某个服务提供者的boot方法中编写代码如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Response</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResponseMacroServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Perform post-registration booting of services.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Response::macro(<span class="string">&#x27;caps&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Response::make(strtoupper(<span class="variable">$value</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>macro</code>方法接收响应名称作为第一个参数，闭包函数作为第二个参数，<code>macro</code>的闭包在<code>ResponseFactory</code>类或<code>Response</code>函数中的<code>macro</code>方法时执行：</p>
<pre><code>return response()-&gt;caps(&#39;foo&#39;);
</code></pre>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第三章</title>
    <url>/2016/07/15/ba9e3cb46214/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="3-跟随快速入门"><a href="#3-跟随快速入门" class="headerlink" title="3. 跟随快速入门"></a>3. 跟随快速入门</h2><p><a href="https://laravel.com/docs/5.2/quickstart">官方地址</a></p>
<p><a href="http://laravelacademy.org/post/3291.html">中文版地址</a></p>
<p><a href="https://laravel.tw/docs/5.2/quickstart">台湾版地址</a></p>
<p>开始前先创建一个新的数据库，并添加到.<code>env</code>文件中。</p>
<h3 id="3-1-创建quickstart项目"><a href="#3-1-创建quickstart项目" class="headerlink" title="3.1 创建quickstart项目"></a>3.1 创建quickstart项目</h3><h4 id="3-1-1-使用composer"><a href="#3-1-1-使用composer" class="headerlink" title="3.1.1 使用composer"></a>3.1.1 使用composer</h4><pre><code>$ composer create-project laravel/laravel quickstart --prefer-dist
</code></pre>
<h4 id="3-1-2-克隆整个快速入门文档"><a href="#3-1-2-克隆整个快速入门文档" class="headerlink" title="3.1.2 克隆整个快速入门文档"></a>3.1.2 克隆整个快速入门文档</h4><pre><code>$ git clone https://github.com/laravel/quickstart-basic quickstart
$ cd quickstart
$ composer install
$ php artisan migrate
</code></pre>
<h3 id="3-2-准备数据库"><a href="#3-2-准备数据库" class="headerlink" title="3.2 准备数据库"></a>3.2 准备数据库</h3><p>laravel有一种简单的定义与修改数据表的方法。</p>
<p>现在使用<code>make:migration</code>生成<code>tasks</code>新的数据表：</p>
<pre><code>$ php artisan make:migration create_tasks_table --create=tasks
</code></pre>
<p><code>make:migration</code>自动添加了<code>id</code>与<code>时间戳</code>。</p>
<p>手动增加一个条码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$table</span>-&gt;string(<span class="string">&#x27;name&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>随后使用下方命令将<code>tasks</code>写入数据表。</p>
<pre><code>$ php artisan migrate
</code></pre>
<p><em>注意：如果数据库中以及存在<code>tasks</code>数据表，会报错。</em></p>
<h3 id="3-3-Eloquent-ORM模型"><a href="#3-3-Eloquent-ORM模型" class="headerlink" title="3.3 Eloquent ORM模型"></a>3.3 Eloquent ORM模型</h3><p>laravel 使用默认ORM是Eloquent，[ORM：物件关联对应]，每一个Eloquent模型都有一个对应的数据表。</p>
<p>所有创建<code>tasks</code>对应的<code>Task</code>模型，使用<code>Artisan</code>命令来生成模型。</p>
<pre><code>$ php artisan make:model Task
</code></pre>
<p>模型在<code>app</code>目录下，默认情况下，模型类是空的。不需要说明Eloquent模型要对应哪张数据表，它会假设数据表是模型的复数形态。</p>
<p>这里<code>Task</code>对应的是<code>tasks</code>。</p>
<h3 id="3-4-路由"><a href="#3-4-路由" class="headerlink" title="3.4 路由"></a>3.4 路由</h3><h4 id="3-4-1-建置路由"><a href="#3-4-1-建置路由" class="headerlink" title="3.4.1 建置路由"></a>3.4.1 建置路由</h4><p>默认情况下，所有的路由都定义在<code>app/Http/routes.php</code></p>
<p>这个需要至少三个路由：显示所有任务的路由，添加新任务的路由，以及删除己存在任务的路由。</p>
<p>下面再<code>app/Http/routse.php</code>中创建这三个路由。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Task</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Display All Tasks</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Add A New Task</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Route::post(<span class="string">&#x27;/task&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Delete An Existing Task</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Route::delete(<span class="string">&#x27;/task/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br></pre></td></tr></table></figure>

<h4 id="3-4-2-显示视图"><a href="#3-4-2-显示视图" class="headerlink" title="3.4.2 显示视图"></a>3.4.2 显示视图</h4><p>laravel的全部，HTML模板都存放在<code>resources/view</code>目录下，使用<code>view</code>函数从路由中返回一个模板。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;tasks&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>现在要在创建一个对应的视图模板<code>resources/views/tasks.blade.php</code>作为<code>View</code>对象。</p>
<h3 id="3-5-创建布局-amp-视图"><a href="#3-5-创建布局-amp-视图" class="headerlink" title="3.5 创建布局&amp;视图"></a>3.5 创建布局&amp;视图</h3><p>下图中使用了<code>Bootstrap CSS</code>样式</p>
<p><img src="https://raw.githubusercontent.com/422303771/web/master/ubuntu/laravel/img/basic-overview.png"></p>
<h4 id="3-5-1-定义布局"><a href="#3-5-1-定义布局" class="headerlink" title="3.5.1 定义布局"></a>3.5.1 定义布局</h4><p><strong>几乎所有的web应用都在不同的页面中共享同一个布局。</strong></p>
<p>例如，这个应用在视图顶部的导航条，这个导航条在每个页面都会出现。</p>
<p>laravel通过在每个页面中使用Blade布局让共享这些公共特性变得简单。</p>
<p>在<code>resources/views/layouts/app.blade.php</code>中定义一个新布局，<code>.blade.php</code>表明使用Blade模板引擎来渲染视图。</p>
<p>也可以使用PHP原生模板然而，Blade提供的标签语法可以编写简洁的模板。</p>
<p><code>app.blade.php</code>的内容如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">// resources/views/layouts/app.blade.php</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>Laravel Quickstart - Basic<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- CSS And JavaScript --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar navbar-default&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- Navbar Contents --&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        @yield(&#x27;content&#x27;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>布局中的<code>@yield(&#39;content&#39;)</code>部分，是一个Blade指令，用于指定继承布局的子页面，在这里可以注入自己的内容。</p>
<h4 id="3-5-2-定义子视图"><a href="#3-5-2-定义子视图" class="headerlink" title="3.5.2 定义子视图"></a>3.5.2 定义子视图</h4><p>现在定义<code>resources/views/tasks.blade.php</code>视图。<code>Bootstrap CSS</code>的样本文件可以到<a href="https://github.com/laravel/quickstart-basic">github</a>下载</p>
<p><code>tasks.blade.php</code>内容如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">//resources/views/tasks.blade.php</span><br><span class="line"></span><br><span class="line">@extends(&#x27;layouts.app&#x27;)</span><br><span class="line"></span><br><span class="line">@section(&#x27;content&#x27;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap Boilerplate... --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;panel-body&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Display Validation Errors --&gt;</span></span><br><span class="line">        @include(&#x27;common.errors&#x27;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- New Task Form --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/task&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-horizontal&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123; csrf_field() &#125;&#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- Task Name --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;task&quot;</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-3 control-label&quot;</span>&gt;</span>Task<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">id</span>=<span class="string">&quot;task-name&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- Add Task Button --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-sm-offset-3 col-sm-6&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-default&quot;</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-plus&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> Add Task</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- <span class="doctag">TODO:</span> Current Tasks --&gt;</span></span><br><span class="line">@endsection</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<p>使用<code>@extends</code>告诉Blade要使用在<code>resources/views/layouts/app.blade.php</code>的布局。</p>
<p>在<code>@section(&#39;content&#39;)</code>与<code>@endsection</code>之间的内容会被注入到<code>app.blade.php</code>的<code>@yield(&#39;contents&#39;)</code>位置。</p>
<p><code> @include(&#39;common.errors&#39;)</code>指令将会加载<code>resources/views/common/errors.blade.php</code>中的内容，目前还没有定义。</p>
<p>现在可以设置路由：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;tasks&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="3-6-添加任务"><a href="#3-6-添加任务" class="headerlink" title="3.6 添加任务"></a>3.6 添加任务</h3><h4 id="3-6-1-验证"><a href="#3-6-1-验证" class="headerlink" title="3.6.1 验证"></a>3.6.1 验证</h4><p>验证表单，在<code>POST /task</code>路由中编写代码，处理表单请求，我们需要验证表单输入，然后才能创建一个新任务。</p>
<p>对这个表单而言，将<code>name</code>字段设置为必填项，而长度不超过255个字符。如果表单验证失败，将会跳转到前一个页面，并将错误信息存入一次性的<code>Session</code>中：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::post(<span class="string">&#x27;/task&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$validator</span> = Validator::make(<span class="variable">$request</span>-&gt;all(), [</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;required|max:255&#x27;</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$validator</span>-&gt;fails()) &#123;</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">            -&gt;withInput()</span><br><span class="line">            -&gt;withErrors(<span class="variable">$validator</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Create The Task...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><strong>$errors</strong></p>
<p><code>-&gt;withErrors($validator)</code>将验证错误信息存放在一次性的session中，以便视图通过<code>$errors</code>访问。</p>
<p><code>errors.blade.php</code>文件</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// resources/views/common/errors.blade.php</span></span><br><span class="line"></span><br><span class="line">@<span class="keyword">if</span> (count(<span class="variable">$errors</span>) &gt; <span class="number">0</span>)</span><br><span class="line">    &lt;!-- Form <span class="built_in">Error</span> <span class="keyword">List</span> --&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">alert</span> <span class="title">alert</span>-<span class="title">danger</span>&quot;&gt;</span></span><br><span class="line"><span class="class">        &lt;<span class="title">strong</span>&gt;<span class="title">Whoops</span>! <span class="title">Something</span> <span class="title">went</span> <span class="title">wrong</span>!&lt;/<span class="title">strong</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        &lt;<span class="title">br</span>&gt;&lt;<span class="title">br</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        &lt;<span class="title">ul</span>&gt;</span></span><br><span class="line"><span class="class">            @<span class="title">foreach</span> ($<span class="title">errors</span>-&gt;<span class="title">all</span>() <span class="title">as</span> $<span class="title">error</span>)</span></span><br><span class="line"><span class="class">                &lt;<span class="title">li</span>&gt;</span>&#123;&#123; <span class="variable">$error</span> &#125;&#125;&lt;/li&gt;</span><br><span class="line">            @<span class="keyword">endforeach</span></span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">@<span class="keyword">endif</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong></p>
<p><code>errors</code>变量可用于每个laravel的视图中。如果没有验证错误信息存在，那么他就是一个空的<code>ViewErroeBag</code>实例。</p>
<h4 id="3-6-2-创建任务"><a href="#3-6-2-创建任务" class="headerlink" title="3.6.2 创建任务"></a>3.6.2 创建任务</h4><p>接下来开始创建一个新任务。一旦新任务创建成功，页面会跳转到<code>/</code>。要创建任务，可以有<code>Eloquent</code>模式提供的<code>save</code>方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::post(<span class="string">&#x27;/task&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$validator</span> = Validator::make(<span class="variable">$request</span>-&gt;all(), [</span><br><span class="line">        <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;required|max:255&#x27;</span>,</span><br><span class="line">    ]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$validator</span>-&gt;fails()) &#123;</span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">            -&gt;withInput()</span><br><span class="line">            -&gt;withErrors(<span class="variable">$validator</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$task</span> = <span class="keyword">new</span> Task;</span><br><span class="line">    <span class="variable">$task</span>-&gt;name = <span class="variable">$request</span>-&gt;name;</span><br><span class="line">    <span class="variable">$task</span>-&gt;save();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="3-6-3-显示己存在的任务"><a href="#3-6-3-显示己存在的任务" class="headerlink" title="3.6.3 显示己存在的任务"></a>3.6.3 显示己存在的任务</h4><p>添加代码到视图来显示所有任务列表。</p>
<p>需要编辑/路由传递所有已存在任务到视图，view函数接收一个数组作为第二个参数，我们可以将数据通过该数组传递到视图中：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$tasks</span> = Task::orderBy(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;asc&#x27;</span>)-&gt;get();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;tasks&#x27;</span>, [</span><br><span class="line">        <span class="string">&#x27;tasks&#x27;</span> =&gt; <span class="variable">$tasks</span></span><br><span class="line">    ]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>数据被传递到视图后，我们可以在<code>tasks.blade.php</code>中以表格形式显示所有任务。Blade中使用<code>@foreach</code>处理循环数据：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@<span class="keyword">extends</span>(<span class="string">&#x27;layouts.app&#x27;</span>)</span><br><span class="line"></span><br><span class="line">@section(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">    &lt;!-- Create Task Form... --&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Current Tasks --&gt;</span><br><span class="line">    @<span class="keyword">if</span> (count(<span class="variable">$tasks</span>) &gt; <span class="number">0</span>)</span><br><span class="line">        &lt;div <span class="class"><span class="keyword">class</span>=&quot;<span class="title">panel</span> <span class="title">panel</span>-<span class="title">default</span>&quot;&gt;</span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">panel</span>-<span class="title">heading</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                <span class="title">Current</span> <span class="title">Tasks</span></span></span><br><span class="line"><span class="class">            &lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">            &lt;<span class="title">div</span> <span class="title">class</span>=&quot;<span class="title">panel</span>-<span class="title">body</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                &lt;<span class="title">table</span> <span class="title">class</span>=&quot;<span class="title">table</span> <span class="title">table</span>-<span class="title">striped</span> <span class="title">task</span>-<span class="title">table</span>&quot;&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                    &lt;!-- <span class="title">Table</span> <span class="title">Headings</span> --&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">thead</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">th</span>&gt;<span class="title">Task</span>&lt;/<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">th</span>&gt;&amp;<span class="title">nbsp</span>;&lt;/<span class="title">th</span>&gt;</span></span><br><span class="line"><span class="class">                    &lt;/<span class="title">thead</span>&gt;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">                    &lt;!-- <span class="title">Table</span> <span class="title">Body</span> --&gt;</span></span><br><span class="line"><span class="class">                    &lt;<span class="title">tbody</span>&gt;</span></span><br><span class="line"><span class="class">                    @<span class="title">foreach</span> ($<span class="title">tasks</span> <span class="title">as</span> $<span class="title">task</span>)</span></span><br><span class="line"><span class="class">                        &lt;<span class="title">tr</span>&gt;</span></span><br><span class="line"><span class="class">                            &lt;!-- <span class="title">Task</span> <span class="title">Name</span> --&gt;</span></span><br><span class="line"><span class="class">                            &lt;<span class="title">td</span> <span class="title">class</span>=&quot;<span class="title">table</span>-<span class="title">text</span>&quot;&gt;</span></span><br><span class="line"><span class="class">                                &lt;<span class="title">div</span>&gt;</span>&#123;&#123; <span class="variable">$task</span>-&gt;name &#125;&#125;&lt;/div&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line"></span><br><span class="line">                            &lt;td&gt;</span><br><span class="line">                                &lt;!-- TODO: Delete Button --&gt;</span><br><span class="line">                            &lt;/td&gt;</span><br><span class="line">                        &lt;/tr&gt;</span><br><span class="line">                    @<span class="keyword">endforeach</span></span><br><span class="line">                    &lt;/tbody&gt;</span><br><span class="line">                &lt;/table&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    @<span class="keyword">endif</span></span><br><span class="line">@endsection</span><br></pre></td></tr></table></figure>

<h3 id="3-7-删除任务"><a href="#3-7-删除任务" class="headerlink" title="3.7 删除任务"></a>3.7 删除任务</h3><h4 id="3-7-1-添加删除按钮"><a href="#3-7-1-添加删除按钮" class="headerlink" title="3.7.1 添加删除按钮"></a>3.7.1 添加删除按钮</h4><p>我们在<code>tasks.blade.php</code>视图中留了一个“TODO”注释用于放置删除按钮。当删除按钮被点击时，<code>DELETE /task</code>请求被发送到应用后台：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Task Name --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">&quot;table-text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123; $task-&gt;name &#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Delete Button --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/task/&#123;&#123; $task-&gt;id &#125;&#125;&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123; csrf_field() &#125;&#125;</span><br><span class="line">            &#123;&#123; method_field(&#x27;DELETE&#x27;) &#125;&#125;</span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span>&gt;</span>Delete Task<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>方法伪造</strong></p>
<p>尽管我们使用的路由是<code>Route::delete</code>，但我们在删除按钮表单中使用的请求方法为<code>POST</code>，HTML表单只支持<code>GET</code>和<code>POST</code>两种请求方式，因此我们需要使用某种方式来伪造DELETE请求。</p>
<p>我们可以在表单中通过输出<code>method_field(&#39;DELETE&#39;)</code>来伪造<code>DELETE</code>请求，该函数生成一个隐藏的表单输入框，然后Laravel识别出该输入并使用其值覆盖实际的HTTP请求方法。生成的输入框如下：</p>
<input type="hidden" name="_method" value="DELETE">

<h4 id="3-7-2-删除任务"><a href="#3-7-2-删除任务" class="headerlink" title="3.7.2 删除任务"></a>3.7.2 删除任务</h4><p>最后，让我们添加业务逻辑到路由中执行删除操作，我们可以使用<code>Eloquent</code>提供的<code>findOrFail</code>方法从数据库通过ID获取模型实例，如果不存在则抛出404异常。获取到模型后，我们使用模型的<code>delete</code>方法删除该模型在数据库中对应的记录。记录被删除后，跳转到<code>/</code>页面:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::delete(<span class="string">&#x27;/task/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    Task::findOrFail(<span class="variable">$id</span>)-&gt;delete();</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第五章 第六节</title>
    <url>/2016/07/26/e09a3c31d8b4/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-6-视图"><a href="#5-6-视图" class="headerlink" title="5.6 视图"></a>5.6 视图</h2><h3 id="5-6-1-基本使用"><a href="#5-6-1-基本使用" class="headerlink" title="5.6.1 基本使用"></a>5.6.1 基本使用</h3><p>视图包含的HTML代码并将控制器逻辑和表面逻辑进行分离。视图文件存放在<code>resources/views</code>目录。</p>
<p>下面是一个简单视图：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 该视图存放 resources/views/greeting.php --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &lt;?php echo $name; ?&gt;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>由于这个视图存放在<code>resources/views/greeting.php</code>,可以在全局的辅助函数<code>view</code>中这样返回它：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;greeting&#x27;</span>, [<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;James&#x27;</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>view</code>的第一个参是<code>resources/views</code>目录下相应的视图文件的名字，第二个参数是一个数组，该数组包含了在视图中的有效数据。</p>
<p>例子中，传递的是一个<code>name</code>变量，在视图中通过执行<code>echo</code>将其显示出来。</p>
<p>当然，视图还可以嵌套在<code>resources/views</code>的子目录中，用<code>.</code>来引用嵌套视图。</p>
<p>例如，视图存放路径是<code>resources/views/admin/profile.php</code>,那可以这样应用它：</p>
<pre><code>return view(&#39;admin.profile&#39;, $data);
</code></pre>
<h4 id="5-6-1-1-判断视图是否存在"><a href="#5-6-1-1-判断视图是否存在" class="headerlink" title="5.6.1.1 判断视图是否存在"></a>5.6.1.1 判断视图是否存在</h4><p>如果需要判断视图是否存在，可调用不带参数的<code>view</code>之后，使用<code>exists</code>方法，如果视图存在则返回<code>ture</code>:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (view()-&gt;exists(<span class="string">&#x27;emails.customer&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用不带参数的<code>view</code>时，将会返回一个<code>Illuminate\Contracts\View\Factory</code>实例，从而调用该类上所有方法。</p>
<hr>
<h3 id="5-6-2-视图数据"><a href="#5-6-2-视图数据" class="headerlink" title="5.6.2 视图数据"></a>5.6.2 视图数据</h3><h4 id="5-6-2-1-传递数据到视图"><a href="#5-6-2-1-传递数据到视图" class="headerlink" title="5.6.2.1 传递数据到视图"></a>5.6.2.1 传递数据到视图</h4><p>在上述例子中可以看到，可以简单通过数组方式将数据传递到视图：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">return view(&#x27;greetings&#x27;, [&#x27;name&#x27; =&gt; &#x27;Victoria&#x27;]);</span><br></pre></td></tr></table></figure>
<p>以这种方式传递数据，<code>$data</code>应该是一个键值对应该数组，在视图中，就可以使用响应的键来访问数组值。</p>
<p>例如<code>&lt;?php echo $key; ?&gt;</code>。还可以通过<code>with</code>方法添加独立的数据片段到视图：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$view</span> = view(<span class="string">&#x27;greeting&#x27;</span>)-&gt;with(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;Victoria&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="5-6-2-2-在视图间共享数据"><a href="#5-6-2-2-在视图间共享数据" class="headerlink" title="5.6.2.2 在视图间共享数据"></a>5.6.2.2 在视图间共享数据</h4><p>有时候需要在所有视图之间共享数据片段，这时可以使用视图类的<code>share</code>方法，通常，需要在服务提供者的<code>boot</code>方法中调用<code>share</code>方法，你可以将其添加到<code>AppServiceProvider</code>或生成独立的服务提供者来存放它们：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动所有应用服务</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        view()-&gt;share(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册服务提供者</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-6-3-视图Composer"><a href="#5-6-3-视图Composer" class="headerlink" title="5.6.3 视图Composer"></a>5.6.3 视图Composer</h3><p>视图Composer就是在视图被渲染前，会呼叫的闭包或类别方法。</p>
<p>如果想在每次渲染都绑定一些数据，可以使用视图Composer将这种的程序逻辑放到同一个地方。</p>
<p>首先在服务提供者中注册视图Composer。</p>
<p>之后将使用<code>view</code>访问<code>Illuminate\Contracts\View\Factory </code>的底层实现。</p>
<p>laravel不会包含默认的视图Composer目录，可以随意设置路径。</p>
<p>例如，创建一个<code>App\Http\ViewComposers</code>目录：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ComposerServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在容器中注册绑定.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@author</span> http://laravelacademy.org</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 使用基于类的composers...</span></span><br><span class="line">        view()-&gt;composer(</span><br><span class="line">            <span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;App\Http\ViewComposers\ProfileComposer&#x27;</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用基于闭包的composers...</span></span><br><span class="line">        view()-&gt;composer(<span class="string">&#x27;dashboard&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$view</span></span>) </span>&#123;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册服务提供者.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果创建一个新的服务提供者包含视图Composer注册，需要添加该服务提供者到配置文件<code>config/app.php</code>的<code>providers</code>数组中。</p>
<p>现在我们已经注册了Composer，每次<code>profile</code>视图被渲染时都会执行<code>PrefileComposer@compose</code>,接下来定义Composer类：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">ViewComposers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">View</span>\<span class="title">View</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Users</span>\<span class="title">Repository</span> <span class="title">as</span> <span class="title">UserRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProfileComposer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户仓库实现.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> UserRepository</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$users</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个新的属性composer.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> UserRepository $users</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">UserRepository <span class="variable">$users</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Dependencies automatically resolved by service container...</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;users = <span class="variable">$users</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 绑定数据到视图.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> View $view</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">compose</span>(<span class="params">View <span class="variable">$view</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$view</span>-&gt;with(<span class="string">&#x27;count&#x27;</span>, <span class="keyword">$this</span>-&gt;users-&gt;count());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>视图被渲染前，Composer类的composer方法被调用，同时<code>Illuminate\Contracts\View\View</code>被注入该方法，从而可以使用<code>with</code>方法来绑定数据到视图。</p>
<p><em>注意：所有视图Composer都通过服务容器被解析，所以可以在Composer类的构造函数中声明任何需要的依赖。</em></p>
<h4 id="5-6-3-1-添加-Composer-到多个视图"><a href="#5-6-3-1-添加-Composer-到多个视图" class="headerlink" title="5.6.3.1 添加 Composer 到多个视图"></a>5.6.3.1 添加 Composer 到多个视图</h4><p>可以传递视图数组作为<code>composer</code>方法的第一个参数，来一次将视图Composer添加到多个视图：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">view()-&gt;composer(</span><br><span class="line">    [<span class="string">&#x27;profile&#x27;</span>, <span class="string">&#x27;dashboard&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;App\Http\ViewComposers\MyViewComposer&#x27;</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><code>composer</code>方法接受<code>*</code>通配符，从而允许将一个Composer添加到所有视图:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">view()-&gt;composer(<span class="string">&#x27;*&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$view</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-6-4-视图创建器"><a href="#5-6-4-视图创建器" class="headerlink" title="5.6.4 视图创建器"></a>5.6.4 视图创建器</h3><p>视图创造器和视图Composer非常类似。不同在于，前者在视图实例化之后立即失效而不是等到视图即将渲染。</p>
<p>使用<code>create</code>方法可注册一个视图创建器：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">view()-&gt;creator(&#x27;profile&#x27;, &#x27;App\Http\ViewCreators\ProfileCreator&#x27;);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第五章 第七节</title>
    <url>/2016/07/26/afa67e043e16/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="5-7-Blade-模板"><a href="#5-7-Blade-模板" class="headerlink" title="5.7 Blade 模板"></a>5.7 Blade 模板</h2><h3 id="5-7-1-简介"><a href="#5-7-1-简介" class="headerlink" title="5.7.1 简介"></a>5.7.1 简介</h3><p>Blade 是 Laravel 提供的一个非常简单但很强大的模板引擎，不同于其他流行的PHP模板引擎，Blade在视图中并不约束你使用PHP原生代码。所有的Blade视图都会被编译成原生PHP代码并缓存起来直到被修改，这意味着对应用的性能而言Blade基本上是零开销。Blade视图文件使用<code>.blade.php</code>文件扩展并存放在<code>resources/views</code>目录下。</p>
<hr>
<h3 id="5-7-2-模板继承"><a href="#5-7-2-模板继承" class="headerlink" title="5.7.2 模板继承"></a>5.7.2 模板继承</h3><h4 id="5-7-2-1-定义页面布局"><a href="#5-7-2-1-定义页面布局" class="headerlink" title="5.7.2.1 定义页面布局"></a>5.7.2.1 定义页面布局</h4><p>使用Blade的两个最大的优点是模板继承和切片，开始之前先看一个例子。</p>
<p>首先，检测一个主页面布局，由于大多数web应用在不同页面中使用同一个布局，可以很方便的将这个布局定义为一个单独的Blade页面：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 存放在 resources/views/layouts/master.blade.php --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>App Name - @yield(&#x27;title&#x27;)<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        @section(&#x27;sidebar&#x27;)</span><br><span class="line">            This is the master sidebar.</span><br><span class="line">        @show</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">            @yield(&#x27;content&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>正如所看到的，该文件包含典型的HTML标记，然而，注意<code>@section</code>和<code>@yield</code>指令，前者正如其名字所暗示的，定义了一个内容的片段，而后者用于显示给定片段的内容。</p>
<p>现在我们已经为应用定义了一个布局，接下来让我们定义继承该布局的子页面。</p>
<h4 id="5-7-2-2-扩展页面布局"><a href="#5-7-2-2-扩展页面布局" class="headerlink" title="5.7.2.2 扩展页面布局"></a>5.7.2.2 扩展页面布局</h4><p>定义子页面的时候，可以使用Blade的<code>@extends</code>指令来指定子页面所继承的布局，继承一个Blade布局的视图将会使用<code>@section</code>指令注入内容到布局的片段中，记住，如上面例子所示，这些片段的内容将会显示在布局中使用<code>@yield</code>的地方：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;!-- 存放在 resources/views/child.blade.php --&gt;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">extends</span>(<span class="string">&#x27;layouts.master&#x27;</span>)</span><br><span class="line"></span><br><span class="line">@section(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;Page Title&#x27;</span>)</span><br><span class="line"></span><br><span class="line">@section(<span class="string">&#x27;sidebar&#x27;</span>)</span><br><span class="line">    @<span class="built_in">parent</span></span><br><span class="line"></span><br><span class="line">    &lt;p&gt;This is appended to the master sidebar.&lt;/p&gt;</span><br><span class="line">@endsection</span><br><span class="line"></span><br><span class="line">@section(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">    &lt;p&gt;This is my body content.&lt;/p&gt;</span><br><span class="line">@endsection</span><br></pre></td></tr></table></figure>
<p>在本例中，<code>sidebar</code>片段使用<code>@parent</code>指令来追加内容到布局中<code>sidebar</code>,<code>@parent</code>指令在视图渲染时将会被布局中的内容替换。</p>
<p>当然，和原始PHP视图一样，Blade视图可以通过<code>view</code>方法直接从路由中返回：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;blade&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> view(<span class="string">&#x27;child&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-7-3-数据显示"><a href="#5-7-3-数据显示" class="headerlink" title="5.7.3 数据显示"></a>5.7.3 数据显示</h3><p>可以通过两个花括号包裹变量来显示传递到视图的数据，比如，如果给出如下路由：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;greeting&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">&#x27;welcome&#x27;</span>, [<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Samantha&#x27;</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>那么可以通过如下方式显示<code>name</code>变量的内容:</p>
<pre><code>Hello, &#123;&#123; $name &#125;&#125;.
</code></pre>
<p>当然，不限制显示到视图中的变量内容，你还可以输出任何PHP函数，实际上，可以将任何PHP代码放到Blade模板语句中：</p>
<pre><code>The current UNIX timestamp is &#123;&#123; time() &#125;&#125;.
</code></pre>
<p>*注意：Blade的<code>&#123;&#123;&#125;&#125;`语句已经经过PHP的`htmlentities`函数处理以避免XSS攻击。*

#### 5.7.3.1 Blade & JavaScript 框架

由于很多Javascript框架也是用花括号表示，要显示在浏览器中的表达式，可以使用`@`告诉Blade渲染引擎该表达式应该保持原生格式不作改动。例如：

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Laravel<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">Hello, @&#123;&#123; name &#125;&#125;.</span><br></pre></td></tr></table></figure>
这里`@`符合会被Blade移除。而且，Blade引擎会保留`&#123;&#123;name&#125;&#125;</code>表单式，如此一来可让其它Javascript框架使用。</p>
<h4 id="5-7-3-2-输出存在的数据"><a href="#5-7-3-2-输出存在的数据" class="headerlink" title="5.7.3.2 输出存在的数据"></a>5.7.3.2 输出存在的数据</h4><p>有时候想要输出一个变量，但是不确定该变量是否被设置，我们可以通过如下PHP代码：</p>
<pre><code>&#123;&#123; isset($name) ? $name : 'Default' &#125;&#125;
</code></pre>
<p>处理上方的方法，Blade还提供了更简单的方式：</p>
<pre><code>&#123;&#123; $name or 'Default' &#125;&#125;
</code></pre>
<p>在这里，如果<code>$name</code>变量存在，将会显示，否则将显示<code>Default</code></p>
<h4 id="5-7-3-3-显示原生数据"><a href="#5-7-3-3-显示原生数据" class="headerlink" title="5.7.3.3 显示原生数据"></a>5.7.3.3 显示原生数据</h4><p>默认情况下，Blade的<code>&#123;&#123; &#125;&#125;</code>语法已经通过PHP的<code>htmlentities</code>函数处理以避免XSS攻击，如果不想要数据被处理，可以使用如下语法：</p>
<pre><code>Hello, &#123;!! $name !!&#125;.
</code></pre>
<p><em>注意：对于用户输入的内容要当心，要使用双花括号以避免直接输出HTML代码。</em></p>
<hr>
<h3 id="5-7-4-流程控制"><a href="#5-7-4-流程控制" class="headerlink" title="5.7.4 流程控制"></a>5.7.4 流程控制</h3><p>除了模板继承和数据显示之外，Blade还为常用的PHP流程提供了便利操作，比如条件语句和循环，这些快捷操作提供了一个干净，简单的方式来处理PHP的流程控制，同时保持和PHP相应语句相似。</p>
<h4 id="5-7-4-1-If-语句"><a href="#5-7-4-1-If-语句" class="headerlink" title="5.7.4.1 If 语句"></a>5.7.4.1 If 语句</h4><p>可以使用<code>@if</code>,<code>@elseif</code>,<code>@else</code>,<code>@endif</code>,来构造if语句，这些指令函数和PHP的相同：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@<span class="keyword">if</span> (count(<span class="variable">$records</span>) === <span class="number">1</span>)</span><br><span class="line">    I have one record!</span><br><span class="line">@<span class="keyword">elseif</span> (count(<span class="variable">$records</span>) &gt; <span class="number">1</span>)</span><br><span class="line">    I have multiple records!</span><br><span class="line">@<span class="keyword">else</span></span><br><span class="line">    I don<span class="string">&#x27;t have any records!</span></span><br><span class="line"><span class="string">@endif</span></span><br></pre></td></tr></table></figure>

<p>为了方便，Blade还提供了<code>@unless</code>指令：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@unless (Auth::check())</span><br><span class="line">    You are not signed in.</span><br><span class="line">@endunless</span><br></pre></td></tr></table></figure>

<h4 id="5-7-4-2-循环"><a href="#5-7-4-2-循环" class="headerlink" title="5.7.4.2 循环"></a>5.7.4.2 循环</h4><p>除了条件语句，Blade还提供了简单指令处理PHP支持的循环结构，同样，这些指令函数和PHP一样：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@<span class="keyword">for</span> (<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">10</span>; <span class="variable">$i</span>++)</span><br><span class="line">    The current value is &#123;&#123; <span class="variable">$i</span> &#125;&#125;</span><br><span class="line">@<span class="keyword">endfor</span></span><br><span class="line"></span><br><span class="line">@<span class="keyword">foreach</span> (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>)</span><br><span class="line">    &lt;p&gt;This is user &#123;&#123; <span class="variable">$user</span>-&gt;id &#125;&#125;&lt;/p&gt;</span><br><span class="line">@<span class="keyword">endforeach</span></span><br><span class="line"></span><br><span class="line">@forelse (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>)</span><br><span class="line">    &lt;li&gt;&#123;&#123; <span class="variable">$user</span>-&gt;name &#125;&#125;&lt;/li&gt;</span><br><span class="line">    @<span class="keyword">empty</span></span><br><span class="line">    &lt;p&gt;No users&lt;/p&gt;</span><br><span class="line">@endforelse</span><br><span class="line"></span><br><span class="line">@<span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    &lt;p&gt;I<span class="string">&#x27;m looping forever.&lt;/p&gt;</span></span><br><span class="line"><span class="string">@endwhile</span></span><br></pre></td></tr></table></figure>

<h4 id="5-7-4-3-包含子视图"><a href="#5-7-4-3-包含子视图" class="headerlink" title="5.7.4.3 包含子视图"></a>5.7.4.3 包含子视图</h4><p>Blade的<code>@include</code>指令允许你很简单的在一个视图中包含另一个Blade视图，所有父级视图中变量在被包含的子视图中依然有效：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    @include(&#x27;shared.errors&#x27;)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Form Contents --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>尽管被包含的视图继承所有父视图中的数据，还可以传递额外参数到被包含的视图：</p>
<pre><code>@include(&#39;view.name&#39;, [&#39;some&#39; =&gt; &#39;data&#39;])
</code></pre>
<p><em>注意：不要再Blade视图中使用<code>__DIR__</code>和<code>__FIFL__</code>常量，因为他们会指向缓存视图的路径。</em></p>
<h4 id="5-7-4-4-为集合渲染视图"><a href="#5-7-4-4-为集合渲染视图" class="headerlink" title="5.7.4.4 为集合渲染视图"></a>5.7.4.4 为集合渲染视图</h4><p>使用Blade的<code>@each</code>指令将循环或引入 压缩成一行：</p>
<pre><code>@each(&#39;view.name&#39;, $jobs, &#39;job&#39;)
</code></pre>
<p>第一个参数为：对数组或集合的每个元素渲染的局部视图。</p>
<p>第二个参数为：要迭代的数组或集合。</p>
<p>第三个参数为：迭代时被分配到视图中的变数名称。</p>
<p>举例来说:如果迭代一个<code>jobs</code>数组，通常希望在局部视图中透过<code>job</code>变数存取每一个job。</p>
<p>传递第四个参数至<code>@each</code>指令。此参数为：当给定的数组为空时，将会被渲染的视图。</p>
<pre><code>@each(&#39;view.name&#39;, $jobs, &#39;job&#39;, &#39;view.empty&#39;)
</code></pre>
<h4 id="5-7-4-5-注释"><a href="#5-7-4-5-注释" class="headerlink" title="5.7.4.5 注释"></a>5.7.4.5 注释</h4><p>Blade还允许在视图中定义注释，然而，不同于HTML注释，Blade注释并不会包含到HTML中被返回：</p>
<pre><code>&#123;&#123;-- This comment will not be present in the rendered HTML --&#125;&#125;
</code></pre>
<hr>
<h3 id="5-7-5-服务注入"><a href="#5-7-5-服务注入" class="headerlink" title="5.7.5 服务注入"></a>5.7.5 服务注入</h3><p><code>@inject</code>指令可以用于从服务容器中获取服务，传递给<code>@inject</code>的第一个参数是服务将要被放置的变量名，第二个参数是要解析的服务类名或接口名：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@inject(<span class="string">&#x27;metrics&#x27;</span>, <span class="string">&#x27;App\Services\MetricsService&#x27;</span>)</span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line">    Monthly Revenue: &#123;&#123; <span class="variable">$metrics</span>-&gt;monthlyRevenue() &#125;&#125;.</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="5-7-6-扩展-Blade"><a href="#5-7-6-扩展-Blade" class="headerlink" title="5.7.6 扩展 Blade"></a>5.7.6 扩展 Blade</h3><p>Blade还允许你自定义指令，可以使用<code>directive</code>方法来注册一个指令。当Blade编辑器遇到该指令，将会传入参数并调用提供的回调。</p>
<p>下面的例子创建了一个<code>@datetime($var)</code>指令,格式化给定的<code>$var</code>:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Blade</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Perform post-registration booting of services.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Blade::directive(<span class="string">&#x27;datetime&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$expression</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&lt;?php echo with<span class="subst">&#123;$expression&#125;</span>-&gt;format(&#x27;m/d/Y H:i&#x27;); ?&gt;&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在容器中注册绑定.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>laravel 辅助函数<code>with</code>被用在该指令中，<code>with</code>方法返回给定的对象或值，允许方法链。最终该指令生成的PHP代码如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> with(<span class="variable">$var</span>)-&gt;format(<span class="string">&#x27;m/d/Y H:i&#x27;</span>); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第六章 第一节</title>
    <url>/2016/07/26/661ec6791c3e/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-laravel框架"><a href="#6-laravel框架" class="headerlink" title="6 laravel框架"></a>6 laravel框架</h2><h2 id="6-1-一次请求的生命周期"><a href="#6-1-一次请求的生命周期" class="headerlink" title="6.1 一次请求的生命周期"></a>6.1 一次请求的生命周期</h2><h3 id="6-1-1-简介"><a href="#6-1-1-简介" class="headerlink" title="6.1.1 简介"></a>6.1.1 简介</h3><p>当我们使用现实世界中的任何工具时，如果理解了该工具的工作原理，那么用起来就会得心应手，应用开发也是如此。当你理解了开发工具如何工作，用起来就会更加游刃有余。</p>
<p>本文档的目标就是从一个更好、更高层面向你阐述 Laravel 框架的工作原理。通过对框架更全面的了解，一切都不再那么神秘，你将会更加自信的构建应用。</p>
<p>如果你不能马上理解所有这些条款，不要失去信心！先试着掌握一些基本的东西，你的知识将会随着对本文档的探索而不断提高。</p>
<hr>
<h3 id="6-1-2-生命周期预览"><a href="#6-1-2-生命周期预览" class="headerlink" title="6.1.2 生命周期预览"></a>6.1.2 生命周期预览</h3><h4 id="6-1-2-1-第一件事"><a href="#6-1-2-1-第一件事" class="headerlink" title="6.1.2.1 第一件事"></a>6.1.2.1 第一件事</h4><p>Laravel应用的所有请求入口都是<code>public/index.php</code>文件，所有请求都会被web服务器(Apache/Nginx)导向这个文件。<code>index.php</code>文件包含的代码并不多，但是，是加载框架其他部分的起点。</p>
<p><code>index.php</code>文件载入Composer生成的自动加载设置，然后从<code>bootstrap/app.php</code>脚本获取Laravel应用实例，Laravel的第一个动作就是创建服务容器实例。</p>
<h4 id="6-1-2-2-HTTP-Console内核"><a href="#6-1-2-2-HTTP-Console内核" class="headerlink" title="6.1.2.2 HTTP/Console内核"></a>6.1.2.2 HTTP/Console内核</h4><p>接下来，请求被发送到 HTTP 内核或 Console 内核，这取决于进入应用的请求类型。这两个内核是所有请求都要经过的中央处理器，现在，就让我们聚焦在位于 <code>app/Http/Kernel.php</code> 的 HTTP 内核。</p>
<p>HTTP 内核继承自 <code>Illuminate\Foundation\Http\Kernel</code> 类，该类定义了一个 <code>bootstrappers</code> 数组，这个数组中的类在请求被执行前运行，这些 <code>bootstrappers</code> 配置了错误处理、日志、检测应用环境以及其它在请求被处理前需要执行的任务。</p>
<p>HTTP 内核还定义了一系列所有请求在处理前需要经过的 HTTP 中间件，这些中间件处理 HTTP 会话的读写、判断应用是否处于维护模式、验证 CSRF 令牌等等。</p>
<p>HTTP 内核的标志性方法 handle 处理的逻辑相当简单：获取一个 Request，返回一个 Response，把该内核想象作一个代表整个应用的大黑盒子，输入 HTTP 请求，返回 HTTP 响应。</p>
<ul>
<li><p><strong>服务提供者</strong></p>
<p>  内核启动过程中最重要的动作之一就是为应用载入服务提供者，应用的所有服务提供者都被配置在 <code>config/app.php</code> 配置文件的  <code>providers</code> 数组中。首先，所有提供者的 <code>register</code> 方法被调用，然后，所有提供者被注册之后，<code>boot</code> 方法被调用。</p>
<p>  服务提供者负责启动框架的所有各种各样的组件，比如数据库、队列、验证器，以及路由组件等，正是因为他们启动并配置了框架提供的所有特性，服务提供者是整个 Laravel 启动过程中最重要的部分。</p>
</li>
<li><p><strong>分发请求</strong></p>
<p>  一旦应用被启动并且所有的服务提供者被注册，Request 将会被交给路由器进行分发，路由器将会分发请求到路由或控制器，同时运行所有路由指定的中间件。</p>
</li>
</ul>
<hr>
<h3 id="6-1-3-聚集服务提交者"><a href="#6-1-3-聚集服务提交者" class="headerlink" title="6.1.3 聚集服务提交者"></a>6.1.3 聚集服务提交者</h3><p>服务提供者是启动 Laravel 应用中最关键的部分，应用实例被创建后，服务提供者被注册，请求被交给启动后的应用进行处理，整个过程就是这么简单！</p>
<p>对 Laravel 应用如何通过服务提供者构建和启动有一个牢固的掌握非常有价值，当然，应用默认的服务提供者存放在 <code>app/Providers</code> 目录下。</p>
<p>默认情况下，<code>AppServiceProvider</code> 是空的，这里是添加自定义启动和服务容器绑定的最佳位置，当然，对大型应用，你可能希望创建多个服务提供者，每一个都有着更加细粒度的启动。</p>
<h3 id="阅读感言"><a href="#阅读感言" class="headerlink" title="阅读感言"></a>阅读感言</h3><p>上面说了那么多，实际上可以理解为下方的简单流程。</p>
<ol>
<li><p><code>public/index.php</code>laravel访问的起点。创建服务容器。</p>
</li>
<li><p>请求进入内核(HTTP或Console)。</p>
</li>
<li><p>HTTP内核启动，laravel最重要的应用——服务提供者。</p>
</li>
<li><p>服务提供者启动各种各样的组件。</p>
</li>
<li><p>当所有的服务提供者被注册，路由开始工作。</p>
</li>
</ol>
<p>默认服务提供者存放在<code>app/Providers</code>。</p>
<hr>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第六章 第二节</title>
    <url>/2016/07/26/132ebfee2e44/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-2-应用目录结构"><a href="#6-2-应用目录结构" class="headerlink" title="6.2 应用目录结构"></a>6.2 应用目录结构</h2><h3 id="6-2-1-简介"><a href="#6-2-1-简介" class="headerlink" title="6.2.1 简介"></a>6.2.1 简介</h3><p>Laravel 应用默认的目录结构试图为不管是大型应用还是小型应用提供一个好的起点，当然，你可以自己按照喜好重新组织应用目录结构，Laravel 对类在何处被加载没有任何限制——只要 Composer 可以自动载入它们即可。</p>
<hr>
<h3 id="6-2-2-根目录"><a href="#6-2-2-根目录" class="headerlink" title="6.2.2 根目录"></a>6.2.2 根目录</h3><p>新安装的 Laravel 应用包含许多文件夹：</p>
<table>
<thead>
<tr>
<th align="left">目录名称</th>
<th align="left">目录说</th>
</tr>
</thead>
<tbody><tr>
<td align="left">app</td>
<td align="left">目录包含了应用的核心代码</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">bootstrap</td>
<td align="left">目录包含了少许文件用于框架的启动和自动载入配置</td>
</tr>
<tr>
<td align="left">bootstrap/cache</td>
<td align="left">用于包含框架生成的启动文件以提高性能</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">config</td>
<td align="left">目录包含了应用所有的配置文件</td>
</tr>
<tr>
<td align="left">database</td>
<td align="left">目录包含了数据迁移及填充文件，如果你喜欢的话还可以将其作为 SQLite 数据库存放目录</td>
</tr>
<tr>
<td align="left">public</td>
<td align="left">目录包含了前端控制器和资源文件（图片、JavaScript、CSS等）</td>
</tr>
<tr>
<td align="left">resources</td>
<td align="left">目录包含了视图文件及原生资源文件（LESS、SASS、CoffeeScript），以及本地化文件</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">storage</td>
<td align="left">目录包含了编译过的Blade模板、基于文件的session、文件缓存，以及其它由框架生成的文件</td>
</tr>
<tr>
<td align="left">storage/app</td>
<td align="left">目录用于存放应用要使用的文件</td>
</tr>
<tr>
<td align="left">storage/framework</td>
<td align="left">目录用于存放框架生成的文件和缓存</td>
</tr>
<tr>
<td align="left">storage/logs</td>
<td align="left">目录包含应用的日志文件</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">tests</td>
<td align="left">目录包含自动化测试，其中已经提供了一个开箱即用的PHPUnit示例</td>
</tr>
<tr>
<td align="left">vendor</td>
<td align="left">目录包含Composer依赖</td>
</tr>
</tbody></table>
<hr>
<h3 id="6-2-3-App目录"><a href="#6-2-3-App目录" class="headerlink" title="6.2.3 App目录"></a>6.2.3 App目录</h3><p>默认情况下，在项目的<code>App</code>文件夹，并且被 Composer 通过 PSR-4自动载入标准 自动加载。可以通过Artisan命令<code>app:name</code>来修改该命名空间。</p>
<p><code>App</code>目录下有多个子目录。</p>
<p><code>Console</code>和<code>Http</code>目录提供了进入应用核心的API。</p>
<p>它们是两个向应用发布命令的方式。</p>
<p><code>Console</code>目录包含了所有的<code>Artisan</code>命令。 </p>
<p><code>Http</code>目录包含了控制器，中间件请求等等。</p>
<p><code>Jobs</code>目录是放置列队任务的地方，应用中的任务可以被队列化，也可以在当前请求生命周期内同步执行。</p>
<p><code>Events</code>目录是放置事件类的地方，事件可以同于通知应用其他部分给定的动作已经发生，并提供灵活的解耦的处理。</p>
<p><code>Listeners</code>目录包含事件的处理器类，处理器接收一个事件并提供对该事件发生后的响应逻辑。</p>
<p>例如，<code>UserRegstered</code>事件可以被<code>SendWelcomeEmail</code>监听器处理。</p>
<p><code>Exceptions</code>目录包含应用的异常处理器，同时还是处理应用抛出的异常的好地方。</p>
<p><em>注意：<code>app</code>目录中的很多类都可以通过Artisan命令生成，要查看所有命令，使用命令：<code>php artisan list make</code></em></p>
<hr>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第六章 第三节</title>
    <url>/2016/07/26/8788d26396c1/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-3-服务提交者"><a href="#6-3-服务提交者" class="headerlink" title="6.3 服务提交者"></a>6.3 服务提交者</h2><h3 id="6-3-1-简介"><a href="#6-3-1-简介" class="headerlink" title="6.3.1 简介"></a>6.3.1 简介</h3><p>服务提供者是所有laravel应用启动的中心，你自己的应用以及所有Laravel的核心服务都是通过服务提供者启动。</p>
<p>但是，我们所谓的<code>启动</code>指的是什么？通常，这意味着注册事物，包括注册服务容器绑定，事件监听器，中间件甚至路由。服务提供者是应用配置的中心。</p>
<p>如果你打开Laravel自带的<code>config/app.php</code>文件，将会看到一个<code>providers</code>数组，这里就是应用所要加载的所有服务提供者类，当然，其中很多是延迟加载的，也就是说不是每次请求都会被加载，只有真的用到它们的时候才会加载。</p>
<p>本章里你将会学习如何编写自己的服务提供者并在Laravel应用中注册它们。</p>
<hr>
<h3 id="6-3-2-编写服务提供者"><a href="#6-3-2-编写服务提供者" class="headerlink" title="6.3.2 编写服务提供者"></a>6.3.2 编写服务提供者</h3><p>所以得服务提供者继承自<code>Illuminate\Support\ServiceProvider</code>类。继承该抽象类要求至少在服务提供者中定义一个方法：<code>register</code>。在<code>register</code>方法内，你唯一要做的事情就是绑事物到服务容器，不要尝试在其中注册任何时间监听器，路由或者任何其它功能。</p>
<p>通过Artisan命令<code>make:provider</code>可以简单生成一个新的提供者：</p>
<pre><code>php artisan make:provider RiakServiceProvider
</code></pre>
<p>文件被创建到<code>App/Providers/RiakServiceProvider.php</code></p>
<h4 id="6-3-2-1-register方法"><a href="#6-3-2-1-register方法" class="headerlink" title="6.3.2.1 register方法"></a>6.3.2.1 register方法</h4><p>正如前面所提到的，在<code>register</code>方法中只绑定事物到服务容器，而不要做其它事情，否则，一不小心就会用到一个尚未被加载的服务提供者提供的服务。</p>
<p>现在来看看一个基本的服务提供者是什么样：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Riak</span>\<span class="title">Connection</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RiakServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在容器中注册绑定.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;app-&gt;singleton(<span class="string">&#x27;Riak\Contracts\Connection&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Connection(config(<span class="string">&#x27;riak&#x27;</span>));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编辑的文件为<code>App/Providers/RiakServiceProvider.php</code></p>
<p>这个服务提供者只定义了一个<code>register</code>方法，并在服务容器中使用此方法定义了一份<code>Riak/connection</code>的实例。如果不清楚它是如何运作的，查看下一章节<code>服务容器</code>。</p>
<h4 id="6-3-2-2-boot方法"><a href="#6-3-2-2-boot方法" class="headerlink" title="6.3.2.2 boot方法"></a>6.3.2.2 boot方法</h4><p>如果我们想要在服务提供者中注册视图composer该怎么做？这就要用到<code>boot</code>方法，该方法在所有服务提供者被注册以后才会被调用，这就是说我们可以在其中访问框架已注册的所有其他服务：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Perform post-registration booting of services.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        view()-&gt;composer(<span class="string">&#x27;view&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在容器中注册绑定.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>boot方法的依赖注入</strong></li>
</ul>
<p>我们可以在<code>boot</code>方法中类型提升依赖，服务容器会自动注册你需要的依赖：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Routing</span>\<span class="title">ResponseFactory</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params">ResponseFactory <span class="variable">$factory</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$factory</span>-&gt;macro(<span class="string">&#x27;caps&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="6-3-3-注册服务提供者"><a href="#6-3-3-注册服务提供者" class="headerlink" title="6.3.3 注册服务提供者"></a>6.3.3 注册服务提供者</h3><p>所有服务提供者都是通过配置文件<code>config/app.php</code>中进行注册，该文件包含了一个列出所有服务提供者名字的<code>providers</code>数组，默认情况下，其中列出了所有核心服务提供者，这些服务提供者启动Laravel核心组件，比如邮件、列队、缓存等等。</p>
<p>要注册你自己的服务提供者，只需要将其追加到该数组中：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;providers&#x27;</span> =&gt; [</span><br><span class="line">     <span class="comment">// 其它服务提供者</span></span><br><span class="line">     App\Providers\AppServiceProvider::class,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="6-3-4-延迟加载服务提供者"><a href="#6-3-4-延迟加载服务提供者" class="headerlink" title="6.3.4 延迟加载服务提供者"></a>6.3.4 延迟加载服务提供者</h3><p>如果你的提供者仅仅只是在服务容器中注册绑定，你可以选择在延迟加载该绑，定直到注册绑定真的需要时再加载，延迟加载这样的一个提供者将会提升应用的性能，因为它不会在每次请求时都从文件系统加载。</p>
<p>想要延迟加载一个提供者，设置defer属性为true并定义一个provides方法，该方法返回该提供者注册的服务容器绑定：</p>
<p>想要延迟加载一个提供者，设置<code>defer</code>属性为<code>true</code>并定义一个<code>provides</code>方法，该方法返回该提供者注册的服务容器绑定：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Riak</span>\<span class="title">Connection</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RiakServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 服务提供者加是否延迟加载.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$defer</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册服务提供者</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;app-&gt;singleton(<span class="string">&#x27;Riak\Contracts\Connection&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Connection(<span class="variable">$app</span>[<span class="string">&#x27;config&#x27;</span>][<span class="string">&#x27;riak&#x27;</span>]);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取由提供者提供的服务.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">provides</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;Riak\Contracts\Connection&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Laravel编译并保存所有延迟服务者提供的服务以及服务提供者的类名。</p>
<p>然后，只有当你尝试解析其中某个服务时Laravel才会加载其服务提交者。</p>
<hr>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第六章 第四节</title>
    <url>/2016/07/26/744e42db9d2a/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-4-服务容器"><a href="#6-4-服务容器" class="headerlink" title="6.4 服务容器"></a>6.4 服务容器</h2><h3 id="6-4-1-简介"><a href="#6-4-1-简介" class="headerlink" title="6.4.1 简介"></a>6.4.1 简介</h3><p>Laravel 服务容器是一个用于管理类依赖和执行依赖注入的强大工具。依赖注入听上去很花哨，其实质是通过构造函数或者某些情况下通过 <code>setter</code> 方法将类依赖注入到类中。</p>
<p>让我们看一个简单的例子：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Jobs</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Mail</span>\<span class="title">Mailer</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Bus</span>\<span class="title">SelfHandling</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PurchasePodcast</span> <span class="keyword">implements</span> <span class="title">SelfHandling</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * mailer 的實作。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$mailer</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 建立一個新實例。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  Mailer  $mailer</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Mailer <span class="variable">$mailer</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mailer = <span class="variable">$mailer</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 購買 podcast。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个例子中，购买<code>podcast</code>时，<code>PurchasePodcast</code>任务会需要寄送<code>e-mails</code>。因此，将注入能寄送<code>e-mails</code>的服务。由于服务被注入，我们能容易地切换成其它实例。当测试应用程序时，我们能很容易的测试，或者建立假的实例。</p>
<p>深入了解laravel服务容器对构建大型laravel应用很重要，对于贡献代码到laravel核心也很有帮助(很少需要这样做。)</p>
<hr>
<h3 id="6-4-2-绑定"><a href="#6-4-2-绑定" class="headerlink" title="6.4.2 绑定"></a>6.4.2 绑定</h3><p>几乎所有的<code>服务容器</code>绑定都是在<code>服务提供者</code>中注册。所以下方所有的例子将示范在该情况中使用容器。不过，如果类别没有任何依赖，那么就没有将类绑定到容器的必要。并不是需要告诉容器如果构建这些物件，因为它会透PHP的<code>reflection</code>自动解析<code>对象</code>。</p>
<p>在一个服务提供者中，可以通过 <code>$this-&gt;app</code> 变量访问容器，然后使用 <code>bind</code>方法注册一个绑定，该方法需要两个参数，第一个参数是我们想要注册的类名或接口名称，第二个参数是返回类的实例的闭包：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">&#x27;HelpSpot\API&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> HelpSpot\API(<span class="variable">$app</span>[<span class="string">&#x27;HttpClient&#x27;</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>注意，我们接受容器本身作为解析器的一个参数，然后我们可以使用该容器，来解析我们正在构建的对象的子依赖。</p>
<ul>
<li><p><strong>绑定一个单例</strong></p>
<p>  <code>singleton</code> 方法绑定，一个只需要解析一次的类或接口到容器，然后接下来对容器的调用将会返回同一个实例：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;singleton(<span class="string">&#x27;FooBar&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FooBar(<span class="variable">$app</span>[<span class="string">&#x27;SomethingElse&#x27;</span>]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>绑定实例</strong></p>
<p>  你还可以使用 <code>instance</code> 方法绑定一个已存在的对象实例到容器，随后对容器的调用将总是返回给定的实例：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$fooBar</span> = <span class="keyword">new</span> FooBar(<span class="keyword">new</span> SomethingElse);</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;instance(<span class="string">&#x27;FooBar&#x27;</span>, <span class="variable">$fooBar</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-4-2-1-绑定接口到实现方法"><a href="#6-4-2-1-绑定接口到实现方法" class="headerlink" title="6.4.2.1 绑定接口到实现方法"></a>6.4.2.1 绑定接口到实现方法</h4><p>服务容器的一个非常强大的特性是，其绑定接口到实现方法的能力。</p>
<p>我们假设有一个 <code>EventPusher</code> 接口及其 <code>RedisEventPusher</code> 实现方法，编写完该接口的 <code>RedisEventPusher</code> 实现方法后，就可以将其注册到服务容器：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">&#x27;App\Contracts\EventPusher&#x27;</span>, <span class="string">&#x27;App\Services\RedisEventPusher&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>这段代码告诉容器当一个类需要 <code>EventPusher</code> 的实现方法将会注入 <code>RedisEventPusher</code>，现在我们可以在构造器或者任何其它通过服务容器注入依赖的地方进行 <code>EventPusher</code> 接口的类型提示：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Contracts</span>\<span class="title">EventPusher</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建一个新的类实例</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  EventPusher  $pusher</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">EventPusher <span class="variable">$pusher</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;pusher = <span class="variable">$pusher</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="6-4-2-2-上下文绑定"><a href="#6-4-2-2-上下文绑定" class="headerlink" title="6.4.2.2 上下文绑定"></a>6.4.2.2 上下文绑定</h4><p>有时侯我们可能有两个类使用同一个接口，但我们希望在每个类中注入不同实现方法。</p>
<p>例如，当系统接到一个新的订单的时候，我们想要通过<code>PubNub</code>而不是 <code>Pusher</code> 发送一个事件。Laravel 定义了一个简单、平滑的方式来定义这种行为：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;when(<span class="string">&#x27;App\Handlers\Commands\CreateOrderHandler&#x27;</span>)</span><br><span class="line">          -&gt;needs(<span class="string">&#x27;App\Contracts\EventPusher&#x27;</span>)</span><br><span class="line">          -&gt;give(<span class="string">&#x27;App\Services\PubNubEventPusher&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>你甚至还可以传递一个闭包到 <code>give</code> 方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;when(<span class="string">&#x27;App\Handlers\Commands\CreateOrderHandler&#x27;</span>)</span><br><span class="line">    -&gt;needs(<span class="string">&#x27;App\Contracts\EventPusher&#x27;</span>)</span><br><span class="line">    -&gt;give(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Resolve dependency...</span></span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>绑定原始值</strong></p>
<p>  有时候你可能有一个获取若干注入类的类，但还需要一个注入的原始值，比如整型数据，你可以轻松使用上下文绑定来注入指定类所需要的任何值：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;when(<span class="string">&#x27;App\Handlers\Commands\CreateOrderHandler&#x27;</span>)</span><br><span class="line">    -&gt;needs(<span class="string">&#x27;$maxOrderCount&#x27;</span>)</span><br><span class="line">    -&gt;give(<span class="number">10</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-4-2-2-标签"><a href="#6-4-2-2-标签" class="headerlink" title="6.4.2.2 标签"></a>6.4.2.2 标签</h4><p>有些情况下，需要解析特定分类下的所有绑定。</p>
<p>例如：你正在构建一个报表规整器，要通过接收有多个不同<code>Report</code>接口数组实现，在注册完 <code>Report</code> 实现方法之后，可以通过<code>tag</code>方法给它们分配一个标签：</p>
<p>将<code>SpeedReport</code>与<code>MemoryReport</code>打上名为<code>reports</code>的标签。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">&#x27;SpeedReport&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line">	</span><br><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">&#x27;MemoryReport&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="comment">//</span></span><br><span class="line">&#125;);</span><br><span class="line">	</span><br><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;tag([<span class="string">&#x27;SpeedReport&#x27;</span>, <span class="string">&#x27;MemoryReport&#x27;</span>], <span class="string">&#x27;reports&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>这些服务被打上标签后，可以通过 <code>tagged</code> 方法来轻松解析它们：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">	<span class="keyword">$this</span>-&gt;app-&gt;bind(<span class="string">&#x27;ReportAggregator&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> ReportAggregator(<span class="variable">$app</span>-&gt;tagged(<span class="string">&#x27;reports&#x27;</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="6-4-3-解析"><a href="#6-4-3-解析" class="headerlink" title="6.4.3 解析"></a>6.4.3 解析</h3><p>有很多方式可以从容器中解析对象，首先，你可以使用 <code>make</code> 方法，该方法接收你想要解析的类名或接口名作为参数：</p>
<pre><code>$fooBar = $this-&gt;app-&gt;make(&#39;FooBar&#39;);
</code></pre>
<p>其次，你可以以数组方式访问容器，因为其实现了 PHP 的 <code>ArrayAccess</code> 接口：</p>
<pre><code>$fooBar = $this-&gt;app[&#39;FooBar&#39;];
</code></pre>
<p>最后，也是最常用的，你可以简单的通过,在类的构造函数中,对依赖进行类型提示,来从容器中解析对象.包括控制器、事件监听器、队列任务、中间件等都是通过这种方式。在实践中，这是大多数对象从容器中解析的方式。</p>
<p>容器会自动为其解析类注入依赖.</p>
<p>例如：你可以在控制器的构造函数中为应用定义的仓库进行类型提示，该仓库会自动解析并注入该类。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Routing</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Users</span>\<span class="title">Repository</span> <span class="title">as</span> <span class="title">UserRepository</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户仓库实例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$users</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个控制器实例</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  UserRepository  $users</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">UserRepository <span class="variable">$users</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;users = <span class="variable">$users</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过指定ID显示用户</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="6-4-4-容器事件"><a href="#6-4-4-容器事件" class="headerlink" title="6.4.4 容器事件"></a>6.4.4 容器事件</h3><p>服务容器在每一次解析对象时都会触发一个事件，可以使用 resolving 方法监听该事件：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;resolving(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$object</span>, <span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 容器解析所有类型对象时调用</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;resolving(<span class="function"><span class="keyword">function</span> (<span class="params">FooBar <span class="variable">$fooBar</span>, <span class="variable">$app</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 容器解析“FooBar”对象时调用</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>正如你所看到的，被解析的对象将会传递给回调，从而允许你在对象被传递给消费者之前为其设置额外属性。</p>
<hr>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第六章 第五节</title>
    <url>/2016/07/26/ac4f8e8c42ad/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-5-门面"><a href="#6-5-门面" class="headerlink" title="6.5 门面"></a>6.5 门面</h2><h3 id="6-5-1-简介"><a href="#6-5-1-简介" class="headerlink" title="6.5.1 简介"></a>6.5.1 简介</h3><p>Facades为应用在服务容器中的绑定类，提供一个<code>静态</code>接口。</p>
<p><code>Laravel</code>附带许多<code>facades</code>，你可以在不知道的情况下正在使用它们。</p>
<p><code>Laravel</code>的门面作为服务容器中底层类的<code>静态代理</code>，相比于传统静态方法，在维护时能够提供更加易于测试，简明的语法。</p>
<hr>
<h3 id="6-5-2-使用门面"><a href="#6-5-2-使用门面" class="headerlink" title="6.5.2 使用门面"></a>6.5.2 使用门面</h3><p>在Laravel应用的上下文中，门面是一个提供访问容器中对象的类。该机制原理由<code>Facade</code>类实现，Laravel自带的门面，以及创建的自定义门面，都会继承自<code>Illuminate\Support\Facades\Facade</code>基类。</p>
<p>门面类只需要实现一个方法：<code>getFacadeAccessor</code>。<code>getFacadeAccessor</code> 方法定义了从容器中解析什么，然后 <code>Facade</code> 基类使用魔术方法 <code>__callStatic()</code> 从你的门面中调用解析对象。</p>
<p>下面的例子中，将会调用Laravel的缓存系统，浏览代码后，也许你会觉得我们调用了<code>Cache</code>的静态方法<code>get</code>:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Cache</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为指定用户显示属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showProfile</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$user</span> = Cache::get(<span class="string">&#x27;user:&#x27;</span>.<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">&#x27;profile&#x27;</span>, [<span class="string">&#x27;user&#x27;</span> =&gt; <span class="variable">$user</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意我们在顶部位置引入<code>Cache</code>门面。该门面作为代理访问底层<code>Illuminate\Contracts\Cache\Factory</code>接口的实现方法。我们对门面的所有调用都会被传递给Laravel缓存服务的底层实例。</p>
<p>如果我们查看<code>Illuminate\Support\Facades\Cache</code>类的源码，将会发现其中并没有静态方法<code>get</code>:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cache</span> <span class="keyword">extends</span> <span class="title">Facade</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取组件注册名称</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFacadeAccessor</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;cache&#x27;</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Cache</code>门面继承<code>Facade</code>基类并定义了<code>getFacadeAccessor</code>方法，该方法的工作就是返回服务容器绑定类的别名，当用户引用<code>Cache</code>类的任何静态方法时，Laravel从服务容器中解析<code>Cache</code>绑定，然后在解析出的对象上调用所有请求方法(本例中是<code>get</code>)。</p>
<hr>
<h3 id="6-5-3-门面类列表"><a href="#6-5-3-门面类列表" class="headerlink" title="6.5.3 门面类列表"></a>6.5.3 门面类列表</h3><p>下面列出了每个门面及其对应的底层类，这对深入给定门面的API文档而言是个很有用的工具。服务容器绑定键也被包含进来：</p>
<table>
<thead>
<tr>
<th align="left">门面</th>
<th align="left">类</th>
<th align="left">服务器绑定别名</th>
</tr>
</thead>
<tbody><tr>
<td align="left">App</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Foundation/Application.html">Illuminate\Foundation\Application</a></td>
<td align="left">app</td>
</tr>
<tr>
<td align="left">Artisan</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Contracts/Console/Kernel.html">Illuminate\Console\Application</a></td>
<td align="left">artisan</td>
</tr>
<tr>
<td align="left">Auth</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Auth/AuthManager.html">Illuminate\Auth\AuthManager</a></td>
<td align="left">auth</td>
</tr>
<tr>
<td align="left">Blade</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/View/Compilers/BladeCompiler.html">Illuminate\View\Compilers\BladeCompiler</a></td>
<td align="left">blade.compiler</td>
</tr>
<tr>
<td align="left">Bus</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Contracts/Bus/Dispatcher.html">Illuminate\Contracts\Bus\Dispatcher</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Cache</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Cache/Repository.html">Illuminate\Cache\Repository</a></td>
<td align="left">cache</td>
</tr>
<tr>
<td align="left">Config</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Config/Repository.html">Illuminate\Config\Repository</a></td>
<td align="left">config</td>
</tr>
<tr>
<td align="left">Cookie</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Cookie/CookieJar.html">Illuminate\Cookie\CookieJar</a></td>
<td align="left">cookie</td>
</tr>
<tr>
<td align="left">Crypt</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Encryption/Encrypter.html">Illuminate\Encryption\Encrypter</a></td>
<td align="left">encrypter</td>
</tr>
<tr>
<td align="left">DB</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Database/DatabaseManager.html">Illuminate\Database\DatabaseManager</a></td>
<td align="left">db</td>
</tr>
<tr>
<td align="left">DB (Instance)</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Database/Connection.html">Illuminate\Database\Connection</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Event</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Events/Dispatcher.html">Illuminate\Events\Dispatcher</a></td>
<td align="left">events</td>
</tr>
<tr>
<td align="left">File</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Filesystem/Filesystem.html">Illuminate\Filesystem\Filesystem</a></td>
<td align="left">files</td>
</tr>
<tr>
<td align="left">Gate</td>
<td align="left"><a href="https://laravel.com/api/5.1/Illuminate/Contracts/Auth/Access/Gate.html">Illuminate\Contracts\Auth\Access\Gate</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Hash</td>
<td align="left"><a href="http://laravel.com/api/5.2/Illuminate/Contracts/Hashing/Hasher.html">Illuminate\Contracts\Hashing\Hasher</a></td>
<td align="left">hash</td>
</tr>
<tr>
<td align="left">Lang</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Translation/Translator.html">Illuminate\Translation\Translator</a></td>
<td align="left">translator</td>
</tr>
<tr>
<td align="left">Log</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Log/Writer.html">Illuminate\Log\Writer</a></td>
<td align="left">log</td>
</tr>
<tr>
<td align="left">Mail</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Mail/Mailer.html">Illuminate\Mail\Mailer</a></td>
<td align="left">mailer</td>
</tr>
<tr>
<td align="left">Password</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Auth/Passwords/PasswordBroker.html">Illuminate\Auth\Passwords\PasswordBroker</a></td>
<td align="left">auth.password</td>
</tr>
<tr>
<td align="left">Queue</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Queue/QueueManager.html">Illuminate\Queue\QueueManager</a></td>
<td align="left">queue</td>
</tr>
<tr>
<td align="left">Queue (Instance)</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Contracts/Queue/Queue.html">Illuminate\Contracts\Queue\Queue</a></td>
<td align="left">queue</td>
</tr>
<tr>
<td align="left">Queue (Base Class)</td>
<td align="left"><a href="http://laravel.com/api/5.2/Illuminate/Queue/Queue.html">Illuminate\Queue\Queue</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Redirect</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Routing/Redirector.html">Illuminate\Routing\Redirector</a></td>
<td align="left">redirect</td>
</tr>
<tr>
<td align="left">Redis</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Redis/Database.html">Illuminate\Redis\Database</a></td>
<td align="left">redis</td>
</tr>
<tr>
<td align="left">Request</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Http/Request.html">Illuminate\Http\Request</a></td>
<td align="left">request</td>
</tr>
<tr>
<td align="left">Response</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Contracts/Routing/ResponseFactory.html">Illuminate\Contracts\Routing\ResponseFactory</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Route</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Routing/Router.html">Illuminate\Routing\Router</a></td>
<td align="left">router</td>
</tr>
<tr>
<td align="left">Schema</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Database/Schema/Blueprint.html">Illuminate\Database\Schema\Blueprint</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Session</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Session/SessionManager.html">Illuminate\Session\SessionManager</a></td>
<td align="left">session</td>
</tr>
<tr>
<td align="left">Session (Instance)</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Session/Store.html">Illuminate\Session\Store</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">Storage</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Contracts/Filesystem/Factory.html">Illuminate\Contracts\Filesystem\Factory</a></td>
<td align="left">filesystem</td>
</tr>
<tr>
<td align="left">URL</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Routing/UrlGenerator.html">Illuminate\Routing\UrlGenerator</a></td>
<td align="left">url</td>
</tr>
<tr>
<td align="left">Validator</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Validation/Factory.html">Illuminate\Validation\Factory</a></td>
<td align="left">validator</td>
</tr>
<tr>
<td align="left">Validator (Instance)</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/Validation/Validator.html">Illuminate\Validation\Validator</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">View</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/View/Factory.html">Illuminate\View\Factory</a></td>
<td align="left">view</td>
</tr>
<tr>
<td align="left">View (Instance)</td>
<td align="left"><a href="https://laravel.com/api/5.2/Illuminate/View/View.html">Illuminate\View\View</a></td>
<td align="left"></td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第六章 第六节</title>
    <url>/2016/07/26/93c105dd03b6/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="6-6-合约"><a href="#6-6-合约" class="headerlink" title="6.6 合约"></a>6.6 合约</h2><h3 id="6-6-1-简介"><a href="#6-6-1-简介" class="headerlink" title="6.6.1 简介"></a>6.6.1 简介</h3><p>Laravel的合约是一组由框架(framework)提供的核心服务接口。</p>
<p>例如：</p>
<p><code>Illuminate\Contracts\Queue\Queue</code>合约规定，列队工作需要的方法。</p>
<p><code>Illuminate\Contracts\Mail\Mailer</code>合约规定，发送电子邮件的方法。</p>
<p>每个合约都有框架提供的，相应的实现方法。</p>
<p>例如：</p>
<p>Laravel提供一个列队实现方法与各种驱动，和一个由<code>SwiftMailer</code>提供的邮件接收服务。</p>
<p>所有的Laravel合约都在各自的<code>github</code>仓库中更新。这为所有的合约，提供了一个快速参考点，以及一个单一的分离包，用于包开发。</p>
<p><a href="https://github.com/illuminate/contracts">Github参考点</a>。</p>
<h4 id="6-6-1-1-合约Vs-门面"><a href="#6-6-1-1-合约Vs-门面" class="headerlink" title="6.6.1.1 合约Vs.门面"></a>6.6.1.1 合约Vs.门面</h4><p>Laravel的门面提供一种简单的方法，利用Laravel服务无须输入和提示。这好于使用需要服务容器的合约方法。</p>
<p>但是，使用合约运行你定义依赖类。多余大多数应用，使用门面就好了。</p>
<p>但是，如果你真有的需要额外的松耦合，合约就可以提供，阅读下面的了解更多。</p>
<h3 id="6-6-2-为什么用合约？"><a href="#6-6-2-为什么用合约？" class="headerlink" title="6.6.2 为什么用合约？"></a>6.6.2 为什么用合约？</h3><p>关于合约你可能有几个问题要问。为什么全部使用接口？不使用接口会更复杂？</p>
<p>下方是使用接口的重要原因：<code>松耦合</code>与<code>简洁性</code></p>
<h4 id="6-6-2-1-松耦合"><a href="#6-6-2-1-松耦合" class="headerlink" title="6.6.2.1  松耦合"></a>6.6.2.1  松耦合</h4><p>首先，让我们来看一个使用紧耦合缓存实现方法的代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Orders</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The cache instance.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$cache</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new repository instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \SomePackage\Cache\Memcached  $cache</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">\SomePackage\Cache\Memcached <span class="variable">$cache</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;cache = <span class="variable">$cache</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieve an Order by ID.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Order</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">find</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;cache-&gt;has(<span class="variable">$id</span>))    &#123;</span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这这个类中，代码是使用紧耦合，到给定的缓存实现方法。</p>
<p>因为是从一个包中取得缓存，所以这是一个紧耦合。</p>
<p>如果这个包的API发生了改变，我们的代码也要随之改变。</p>
<p>同样的，如果我们要使用其他技术(例如：redis)，取代正在使用的技术(Memcached),我们还是要修改代码。</p>
<p>我们的类不应该用这些设定，例如，谁为他们提供数据，它是如何提供的等等。</p>
<p>使用下方松耦合方法，不需要绑定注入，进而优化代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Orders</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Cache</span>\<span class="title">Repository</span> <span class="title">as</span> <span class="title">Cache</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Repository</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The cache instance.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$cache</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new repository instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  Cache  $cache</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Cache <span class="variable">$cache</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;cache = <span class="variable">$cache</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在代码没有连接任何的服务提供者，甚至Laravel。由于合约包中没有实现方法也没有依赖关系，你可以很容易的替换合约，更换缓存技术，而无需修改代码。</p>
<h4 id="6-6-2-2-简洁性"><a href="#6-6-2-2-简洁性" class="headerlink" title="6.6.2.2 简洁性"></a>6.6.2.2 简洁性</h4><p>当所有的Laravel的服务，在简单接口中整洁的定义，就可以很容易的给定服务提供的功能。</p>
<p>合约服务为框架功能提了简洁的文档。</p>
<p>当你使用简单接口时，你的代码更容易理解和维护。</p>
<h3 id="6-6-3-合约参考"><a href="#6-6-3-合约参考" class="headerlink" title="6.6.3 合约参考"></a>6.6.3 合约参考</h3><table>
<thead>
<tr>
<th align="left">合约</th>
<th align="left">参考的门面</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Auth/Factory.php">Illuminate\Contracts\Auth\Factory</a></td>
<td align="left">Auth</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Auth/PasswordBroker.php">Illuminate\Contracts\Auth\PasswordBroker</a></td>
<td align="left">Password</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Bus/Dispatcher.php">Illuminate\Contracts\Bus\Dispatcher</a></td>
<td align="left">Bus</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Broadcasting/Broadcaster.php">Illuminate\Contracts\Broadcasting\Broadcaster</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Cache/Repository.php">Illuminate\Contracts\Cache\Repository</a></td>
<td align="left">Cache</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Cache/Factory.php">Illuminate\Contracts\Cache\Factory</a></td>
<td align="left">Cache::driver()</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Config/Repository.php">Illuminate\Contracts\Config\Repository</a></td>
<td align="left">Config</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Container/Container.php">Illuminate\Contracts\Container\Container</a></td>
<td align="left">App</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Cookie/Factory.php">Illuminate\Contracts\Cookie\Factory</a></td>
<td align="left">Cookie</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Cookie/QueueingFactory.php">Illuminate\Contracts\Cookie\QueueingFactory</a></td>
<td align="left">Cookie::queue()</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Encryption/Encrypter.php">Illuminate\Contracts\Encryption\Encrypter</a></td>
<td align="left">Crypt</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Events/Dispatcher.php">Illuminate\Contracts\Events\Dispatcher</a></td>
<td align="left">Event</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Filesystem/Cloud.php">Illuminate\Contracts\Filesystem\Cloud</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Filesystem/Factory.php">Illuminate\Contracts\Filesystem\Factory</a></td>
<td align="left">File</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Filesystem/Filesystem.php">Illuminate\Contracts\Filesystem\Filesystem</a></td>
<td align="left">File</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Foundation/Application.php">Illuminate\Contracts\Foundation\Application</a></td>
<td align="left">App</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Hashing/Hasher.php">Illuminate\Contracts\Hashing\Hasher</a></td>
<td align="left">Hash</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Logging/Log.php">Illuminate\Contracts\Logging\Log</a></td>
<td align="left">Log</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Mail/MailQueue.php">Illuminate\Contracts\Mail\MailQueue</a></td>
<td align="left">Mail::queue()</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Mail/Mailer.php">Illuminate\Contracts\Mail\Mailer</a></td>
<td align="left">Mail</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Queue/Factory.php">Illuminate\Contracts\Queue\Factory</a></td>
<td align="left">Queue::driver()</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Queue/Queue.php">Illuminate\Contracts\Queue\Queue</a></td>
<td align="left">Queue</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Redis/Database.php">Illuminate\Contracts\Redis\Database</a></td>
<td align="left">Redis</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Routing/Registrar.php">Illuminate\Contracts\Routing\Registrar</a></td>
<td align="left">Route</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Routing/ResponseFactory.php">Illuminate\Contracts\Routing\ResponseFactory</a></td>
<td align="left">Response</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Routing/UrlGenerator.php">Illuminate\Contracts\Routing\UrlGenerator</a></td>
<td align="left">URL</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Support/Arrayable.php">Illuminate\Contracts\Support\Arrayable</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Support/Jsonable.php">Illuminate\Contracts\Support\Jsonable</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Support/Renderable.php">Illuminate\Contracts\Support\Renderable</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Validation/Factory.php">Illuminate\Contracts\Validation\Factory</a></td>
<td align="left">Validator::make()</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/Validation/Validator.php">Illuminate\Contracts\Validation\Validator</a></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/View/Factory.php">Illuminate\Contracts\View\Factory</a></td>
<td align="left">View::make()</td>
</tr>
<tr>
<td align="left"><a href="https://github.com/illuminate/contracts/blob/master/View/View.php">Illuminate\Contracts\View\View</a></td>
<td align="left"></td>
</tr>
</tbody></table>
<h3 id="6-6-4-如何使用合约"><a href="#6-6-4-如何使用合约" class="headerlink" title="6.6.4 如何使用合约"></a>6.6.4 如何使用合约</h3><p>那么，如果使用一个合约的实现方法？这其实很简单。</p>
<p>许多类型的Laravel类，是通过服务容器解决的，包括控制器，事件监听，中间件，列队甚至是路由。</p>
<p>要使用合约，只需要进行类型提示，注册类的接口函数。</p>
<p>例如：下面的事件监听器：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Listeners</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Events</span>\<span class="title">NewUserRegistered</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Redis</span>\<span class="title">Database</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CacheUserInformation</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The Redis database implementation.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$redis</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new event handler instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  Database  $redis</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">Database <span class="variable">$redis</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;redis = <span class="variable">$redis</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Handle the event.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  NewUserRegistered  $event</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">NewUserRegistered <span class="variable">$event</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当事件监听器运行完成，服务容器将读取构造函数的类型提示，并注入相应的值。</p>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第七章 第二节</title>
    <url>/2016/07/26/f1816657eb28/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="7-2-查询构建器"><a href="#7-2-查询构建器" class="headerlink" title="7.2 查询构建器"></a>7.2 查询构建器</h2><h3 id="7-2-1-简介"><a href="#7-2-1-简介" class="headerlink" title="7.2.1 简介"></a>7.2.1 简介</h3><p><code>数据库查询构建器</code>提供了一个方便的、平滑的接口来创建和运行<code>数据库查询</code>。<code>查询构建器</code>可以用于执行应用中大部分数据库操作，并且能够在支持的所有数据库系统上工作。</p>
<p><em>注意：Laravel 查询构建器使用<code> PDO 参数</code>绑定来避免 SQL 注入攻击，不再需要过滤传递到绑定的字符串。</em></p>
<hr>
<h3 id="7-2-2-获取结果集"><a href="#7-2-2-获取结果集" class="headerlink" title="7.2.2 获取结果集"></a>7.2.2 获取结果集</h3><h4 id="7-2-2-1-从一张表中取出所有行"><a href="#7-2-2-1-从一张表中取出所有行" class="headerlink" title="7.2.2.1 从一张表中取出所有行"></a>7.2.2.1 从一张表中取出所有行</h4><p>在查询之前，使用<code>DB门面</code>的<code>table</code>方法，<code>table</code>方法为给定表返回一个查询构建器，允许你在查询上链接更多约束条件并最终返回查询结果。在本例中，我们使用<code>get</code>方法获取表中所有记录：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">DB</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示用户列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;get();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">&#x27;user.index&#x27;</span>, [<span class="string">&#x27;users&#x27;</span> =&gt; <span class="variable">$users</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和原生查询一样，get方法返回结果集的数组，其中每一个结果都是PHP对象的StdClass实例。你可以像访问对象的属性一样访问列的值：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$user</span>-&gt;name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-2-2-2-从一张表中获取一行-一列"><a href="#7-2-2-2-从一张表中获取一行-一列" class="headerlink" title="7.2.2.2 从一张表中获取一行/一列"></a>7.2.2.2 从一张表中获取一行/一列</h4><p>如果你只是想要从数据表中获取一行数据，可以使用<code>first</code>方法，该方法将会返回单个<code>StdClass</code>对象：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;where(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;John&#x27;</span>)-&gt;first();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$user</span>-&gt;name;</span><br></pre></td></tr></table></figure>
<p>如果你不需要完整的一行，可以使用value方法从结果中获取单个值，该方法会直接返回指定列的值：</p>
<pre><code>$email = DB::table(&#39;users&#39;)-&gt;where(&#39;name&#39;, &#39;John&#39;)-&gt;value(&#39;email&#39;);
</code></pre>
<h4 id="7-2-2-3-从一张表中获取组块结果集"><a href="#7-2-2-3-从一张表中获取组块结果集" class="headerlink" title="7.2.2.3 从一张表中获取组块结果集"></a>7.2.2.3 从一张表中获取组块结果集</h4><p>如果你需要处理成千上百条数据库记录，可以考虑使用<code>chunk</code>方法，该方法一次获取结果集的一小块，然后填充每一小块数据到要处理的闭包，该方法在编写处理大量数据库记录的 <code>Artisan 命令</code>的时候非常有用。</p>
<p>例如：我们可以将处理全部 <code>users</code> 表数据，处理成一次处理 100 条记录的小组块：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;chunk(<span class="number">100</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$users</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>你可以通过从闭包函数中返回false来中止组块的运行：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;chunk(<span class="number">100</span>, <span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$users</span></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 处理结果集...</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="7-2-2-4-获取数据列值列表"><a href="#7-2-2-4-获取数据列值列表" class="headerlink" title="7.2.2.4 获取数据列值列表"></a>7.2.2.4 获取数据列值列表</h4><h4 id="7-2-2-5-聚合函数"><a href="#7-2-2-5-聚合函数" class="headerlink" title="7.2.2.5 聚合函数"></a>7.2.2.5 聚合函数</h4><p>队列构建器还提供了很多聚合方法，比如<code>count</code>, <code>max</code>, <code>min</code>, <code>avg</code>, 和 <code>sum</code>，你可以在构造查询之后调用这些方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;count();</span><br><span class="line"><span class="variable">$price</span> = DB::table(<span class="string">&#x27;orders&#x27;</span>)-&gt;max(<span class="string">&#x27;price&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>当然，你可以联合其它查询子句和聚合函数来构建查询：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$price</span> = DB::table(<span class="string">&#x27;orders&#x27;</span>)</span><br><span class="line">                -&gt;where(<span class="string">&#x27;finalized&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">                -&gt;avg(<span class="string">&#x27;price&#x27;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-2-3-查询（Select）"><a href="#7-2-3-查询（Select）" class="headerlink" title="7.2.3 查询（Select）"></a>7.2.3 查询（Select）</h3><h4 id="7-2-3-1-指定查询子句"><a href="#7-2-3-1-指定查询子句" class="headerlink" title="7.2.3.1 指定查询子句"></a>7.2.3.1 指定查询子句</h4><p>当然，我们并不总是想要获取数据表的所有列，使用<code>select</code>方法，你可以为查询指定自定义的<code>select</code>子句：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;select(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;email as user_email&#x27;</span>)-&gt;get();</span><br></pre></td></tr></table></figure>

<p><code>distinct</code>方法允许你强制查询返回不重复的结果集：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;distinct()-&gt;get();</span><br></pre></td></tr></table></figure>
<p>如果你已经有了一个查询构建器实例并且希望添加一个查询列到已存在的<code>select</code>子句，可以使用<code>addSelect</code>方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;select(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="variable">$users</span> = <span class="variable">$query</span>-&gt;addSelect(<span class="string">&#x27;age&#x27;</span>)-&gt;get();</span><br></pre></td></tr></table></figure>
<h4 id="7-2-3-2-原生表达式"><a href="#7-2-3-2-原生表达式" class="headerlink" title="7.2.3.2 原生表达式"></a>7.2.3.2 原生表达式</h4><p>有时候你希望在查询中使用原生表达式，这些表达式将会以字符串的形式注入到查询中，所以要格外小心避免被 SQL 注入。想要创建一个原生表达式，可以使用<code>DB::raw</code>方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                     -&gt;select(DB::raw(<span class="string">&#x27;count(*) as user_count, status&#x27;</span>))</span><br><span class="line">                     -&gt;where(<span class="string">&#x27;status&#x27;</span>, <span class="string">&#x27;&lt;&gt;&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">                     -&gt;groupBy(<span class="string">&#x27;status&#x27;</span>)</span><br><span class="line">                     -&gt;get();</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-2-4-连接（Join）"><a href="#7-2-4-连接（Join）" class="headerlink" title="7.2.4 连接（Join）"></a>7.2.4 连接（Join）</h3><h4 id="7-2-4-1-内连接（等值连接）"><a href="#7-2-4-1-内连接（等值连接）" class="headerlink" title="7.2.4.1 内连接（等值连接）"></a>7.2.4.1 内连接（等值连接）</h4><p>查询构建器还可以用于编写基本的SQL“内连接”，你可以使用查询构建器实例上的<code>join</code>方法，传递给<code>join</code>方法的第一次参数是你需要连接到的表名，剩余的其它参数则是为连接指定的列约束，当然，正如你所看到的，你可以在单个查询中连接多张表：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;join(<span class="string">&#x27;contacts&#x27;</span>, <span class="string">&#x27;users.id&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;contacts.user_id&#x27;</span>)</span><br><span class="line">            -&gt;join(<span class="string">&#x27;orders&#x27;</span>, <span class="string">&#x27;users.id&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;orders.user_id&#x27;</span>)</span><br><span class="line">            -&gt;select(<span class="string">&#x27;users.*&#x27;</span>, <span class="string">&#x27;contacts.phone&#x27;</span>, <span class="string">&#x27;orders.price&#x27;</span>)</span><br><span class="line">            -&gt;get();</span><br></pre></td></tr></table></figure>

<h4 id="7-2-4-2-左连接"><a href="#7-2-4-2-左连接" class="headerlink" title="7.2.4.2 左连接"></a>7.2.4.2 左连接</h4><p>如果你是想要执行“左连接”而不是“内连接”，可以使用<code>leftJoin</code>方法。该方法和<code>join</code>方法的使用方法一样：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;leftJoin(<span class="string">&#x27;posts&#x27;</span>, <span class="string">&#x27;users.id&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;posts.user_id&#x27;</span>)</span><br><span class="line">            -&gt;get();</span><br></pre></td></tr></table></figure>

<h4 id="7-2-4-3-高级连接语句"><a href="#7-2-4-3-高级连接语句" class="headerlink" title="7.2.4.3 高级连接语句"></a>7.2.4.3 高级连接语句</h4><p>你还可以指定更多的高级连接子句，传递一个闭包到<code>join</code>方法作为该方法的第2个参数，该闭包将会返回允许你指定<code>join</code>子句约束的<code>JoinClause</code>对象：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">        -&gt;join(<span class="string">&#x27;contacts&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$join</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$join</span>-&gt;on(<span class="string">&#x27;users.id&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;contacts.user_id&#x27;</span>)-&gt;orOn(...);</span><br><span class="line">        &#125;)</span><br><span class="line">        -&gt;get();</span><br></pre></td></tr></table></figure>
<p>如果你想要在连接中使用“where”风格的子句，可以在查询中使用<code>where</code>和<code>orWhere</code>方法。这些方法将会将列和值进行比较而不是列和列进行比较：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">        -&gt;join(<span class="string">&#x27;contacts&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$join</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$join</span>-&gt;on(<span class="string">&#x27;users.id&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;contacts.user_id&#x27;</span>)</span><br><span class="line">                 -&gt;where(<span class="string">&#x27;contacts.user_id&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">5</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        -&gt;get();</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-2-5-联合（Union）"><a href="#7-2-5-联合（Union）" class="headerlink" title="7.2.5 联合（Union）"></a>7.2.5 联合（Union）</h3><p>查询构建器还提供了一条“联合”两个查询的快捷方式.</p>
<p>例如：你要创建一个独立的查询，然后使用<code>union</code>方法将其和第二个查询进行联合：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$first</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;whereNull(<span class="string">&#x27;first_name&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;whereNull(<span class="string">&#x27;last_name&#x27;</span>)</span><br><span class="line">            -&gt;union(<span class="variable">$first</span>)</span><br><span class="line">            -&gt;get();</span><br></pre></td></tr></table></figure>
<p><code>unionAll</code>方法也是有效的，并且和<code>union</code>有同样的使用方法。</p>
<hr>
<h3 id="7-2-6-Where子句"><a href="#7-2-6-Where子句" class="headerlink" title="7.2.6 Where子句"></a>7.2.6 Where子句</h3><h4 id="7-2-6-1-简单where子句"><a href="#7-2-6-1-简单where子句" class="headerlink" title="7.2.6.1 简单where子句"></a>7.2.6.1 简单where子句</h4><p>使用查询构建器上的<code>where</code>方法可以添加<code>where</code>子句到查询中，调用<code>where</code>最基本的方法需要三个参数，第一个参数是列名，第二个参数是一个数据库系统支持的任意操作符，第三个参数是该列要比较的值。</p>
<p>例如，下面是一个验证<code>votes</code>列的值是否等于100的查询：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;where(<span class="string">&#x27;votes&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="number">100</span>)-&gt;get();</span><br></pre></td></tr></table></figure>
<p>为了方便，如果你只是简单比较列值和给定数值是否相等，可以将数值直接作为<code>where</code>方法的第二个参数：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;where(<span class="string">&#x27;votes&#x27;</span>, <span class="number">100</span>)-&gt;get();</span><br></pre></td></tr></table></figure>
<p>当然，你可以使用其它操作符来编写<code>where</code>子句：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                -&gt;where(<span class="string">&#x27;votes&#x27;</span>, <span class="string">&#x27;&gt;=&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">                -&gt;get();</span><br><span class="line"></span><br><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                -&gt;where(<span class="string">&#x27;votes&#x27;</span>, <span class="string">&#x27;&lt;&gt;&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">                -&gt;get();</span><br><span class="line"></span><br><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                -&gt;where(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;T%&#x27;</span>)</span><br><span class="line">                -&gt;get();</span><br></pre></td></tr></table></figure>


<h4 id="7-2-6-2-or"><a href="#7-2-6-2-or" class="headerlink" title="7.2.6.2 or"></a>7.2.6.2 or</h4><p>你可以通过方法链将多个<code>where</code>约束链接到一起，也可以添加<code>or</code>子句到查询，<code>orWhere</code>方法和<code>where</code>方法接收参数一样：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;where(<span class="string">&#x27;votes&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">                    -&gt;orWhere(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;John&#x27;</span>)</span><br><span class="line">                    -&gt;get();</span><br></pre></td></tr></table></figure>

<h4 id="7-2-6-3-更多Where子句"><a href="#7-2-6-3-更多Where子句" class="headerlink" title="7.2.6.3 更多Where子句"></a>7.2.6.3 更多Where子句</h4><ul>
<li><p><strong>whereBetween</strong></p>
<p>  <code>whereBetween</code>方法验证列值是否在给定值之间：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;whereBetween(<span class="string">&#x27;votes&#x27;</span>, [<span class="number">1</span>, <span class="number">100</span>])-&gt;get();</span><br></pre></td></tr></table></figure></li>
<li><p><strong>whereNotBetween</strong></p>
<p>  <code>whereNotBetween</code>方法验证列值不在给定值之间：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;whereNotBetween(<span class="string">&#x27;votes&#x27;</span>, [<span class="number">1</span>, <span class="number">100</span>])</span><br><span class="line">                    -&gt;get();</span><br></pre></td></tr></table></figure></li>
<li><p><strong>whereIn/whereNotIn</strong></p>
<p>  <code>whereIn</code>方法验证给定列的值是否在给定数组中：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;whereIn(<span class="string">&#x27;id&#x27;</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">                    -&gt;get();</span><br></pre></td></tr></table></figure>
<p>  <code>whereNotIn</code>方法验证给定列的值不在给定数组中：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;whereNotIn(<span class="string">&#x27;id&#x27;</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>])</span><br><span class="line">                    -&gt;get();</span><br></pre></td></tr></table></figure></li>
<li><p><strong>whereNull/whereNotNull</strong></p>
<p>  <code>whereNull</code>方法验证给定列的值为NULL：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;whereNull(<span class="string">&#x27;updated_at&#x27;</span>)</span><br><span class="line">                    -&gt;get();</span><br></pre></td></tr></table></figure>
<p>  <code>whereNotNull</code>方法验证给定列的值不是NULL：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                    -&gt;whereNotNull(<span class="string">&#x27;updated_at&#x27;</span>)</span><br><span class="line">                    -&gt;get();</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="7-2-6-4-高级Where子句"><a href="#7-2-6-4-高级Where子句" class="headerlink" title="7.2.6.4 高级Where子句"></a>7.2.6.4 高级Where子句</h4><ul>
<li><p><strong>参数分组</strong></p>
<p>  有时候你需要创建更加高级的<code>where</code>子句,比如<code>where exists</code>或者嵌套的参数分组。Laravel查询构建器也可以处理这些。作为开始，让我们看一个在括号中进行分组约束的例子：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;where(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;John&#x27;</span>)</span><br><span class="line">            -&gt;orWhere(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">                <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;votes&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">                      -&gt;where(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;&lt;&gt;&#x27;</span>, <span class="string">&#x27;Admin&#x27;</span>);</span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;get();</span><br></pre></td></tr></table></figure>
<p>  正如你所看到的，传递闭包到<code>orWhere</code>方法构造查询构建器来开始一个约束分组，该闭包将会获取一个用于设置括号中包含的约束的查询构建器实例。上述语句等价于下面的SQL：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">select * <span class="keyword">from</span> users where name = <span class="string">&#x27;John&#x27;</span> <span class="keyword">or</span> (votes &gt; <span class="number">100</span> <span class="keyword">and</span> title &lt;&gt; <span class="string">&#x27;Admin&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p><strong>exists语句</strong></p>
<p>  <code>whereExists</code>方法允许你编写<code>where exist</code>SQL子句，<code>whereExists</code>方法接收一个闭包参数，该闭包获取一个查询构建器实例从而允许你定义放置在<code>exists</code>子句中的查询：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;whereExists(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">                <span class="variable">$query</span>-&gt;select(DB::raw(<span class="number">1</span>))</span><br><span class="line">                      -&gt;from(<span class="string">&#x27;orders&#x27;</span>)</span><br><span class="line">                      -&gt;whereRaw(<span class="string">&#x27;orders.user_id = users.id&#x27;</span>);</span><br><span class="line">            &#125;)</span><br><span class="line">            -&gt;get();</span><br></pre></td></tr></table></figure>
<p>  上述查询等价于下面的SQL语句：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">select * <span class="keyword">from</span> users</span><br><span class="line">where exists (</span><br><span class="line">    select <span class="number">1</span> <span class="keyword">from</span> orders where orders.user_id = users.id</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="7-2-7-排序、分组、限定"><a href="#7-2-7-排序、分组、限定" class="headerlink" title="7.2.7 排序、分组、限定"></a>7.2.7 排序、分组、限定</h3><h4 id="7-2-7-1-orderBy"><a href="#7-2-7-1-orderBy" class="headerlink" title="7.2.7.1 orderBy"></a>7.2.7.1 orderBy</h4><p><code>orderBy</code>方法允许你通过给定列对结果集进行排序，orderBy的第一个参数应该是你希望排序的列，第二个参数控制着排序的方向——<code>asc(正序)</code>或<code>desc(倒序)</code>：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                -&gt;orderBy(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>)</span><br><span class="line">                -&gt;get();</span><br></pre></td></tr></table></figure>
<h4 id="7-2-7-2-groupBy-having-havingRaw"><a href="#7-2-7-2-groupBy-having-havingRaw" class="headerlink" title="7.2.7.2 groupBy / having / havingRaw"></a>7.2.7.2 groupBy / having / havingRaw</h4><p><code>groupBy</code>和<code>having</code>方法用于对结果集进行分组，<code>having</code>方法和<code>where</code>方法的用法类似：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">                -&gt;groupBy(<span class="string">&#x27;account_id&#x27;</span>)</span><br><span class="line">                -&gt;having(<span class="string">&#x27;account_id&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">                -&gt;get();</span><br></pre></td></tr></table></figure>
<p><code>havingRaw</code>方法可以用于设置原生字符串作为<code>having</code>子句的值，例如，我们要找到所有售价大于<code>$2500</code>的部分：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;orders&#x27;</span>)</span><br><span class="line">                -&gt;select(<span class="string">&#x27;department&#x27;</span>, DB::raw(<span class="string">&#x27;SUM(price) as total_sales&#x27;</span>))</span><br><span class="line">                -&gt;groupBy(<span class="string">&#x27;department&#x27;</span>)</span><br><span class="line">                -&gt;havingRaw(<span class="string">&#x27;SUM(price) &gt; 2500&#x27;</span>)</span><br><span class="line">                -&gt;get();</span><br></pre></td></tr></table></figure>

<h4 id="7-2-7-3-skip-take"><a href="#7-2-7-3-skip-take" class="headerlink" title="7.2.7.3 skip / take"></a>7.2.7.3 skip / take</h4><p>想要限定查询返回的结果集的数目，或者在查询中跳过给定数目的结果，可以使用<code>skip</code>和<code>take</code>方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;skip(<span class="number">10</span>)-&gt;take(<span class="number">5</span>)-&gt;get();</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-2-8-插入（Insert）"><a href="#7-2-8-插入（Insert）" class="headerlink" title="7.2.8 插入（Insert）"></a>7.2.8 插入（Insert）</h3><p>查询构建器还提供了<code>insert</code>方法来插入记录到数据表。<code>insert</code>方法接收数组形式的列名和值进行插入操作：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;insert(</span><br><span class="line">    [<span class="string">&#x27;email&#x27;</span> =&gt; <span class="string">&#x27;john@example.com&#x27;</span>, <span class="string">&#x27;votes&#x27;</span> =&gt; <span class="number">0</span>]);</span><br></pre></td></tr></table></figure>
<p>你甚至可以一次性通过传入多个数组来插入多条记录，每个数组代表要插入数据表的记录：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;insert([</span><br><span class="line">    [<span class="string">&#x27;email&#x27;</span> =&gt; <span class="string">&#x27;taylor@example.com&#x27;</span>, <span class="string">&#x27;votes&#x27;</span> =&gt; <span class="number">0</span>],</span><br><span class="line">    [<span class="string">&#x27;email&#x27;</span> =&gt; <span class="string">&#x27;dayle@example.com&#x27;</span>, <span class="string">&#x27;votes&#x27;</span> =&gt; <span class="number">0</span>]</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h4 id="7-2-8-1-自增ID"><a href="#7-2-8-1-自增ID" class="headerlink" title="7.2.8.1 自增ID"></a>7.2.8.1 自增ID</h4><p>如果数据表有自增ID，使用<code>insertGetId</code>方法来插入记录将会返回ID值：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$id</span> = DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;insertGetId(</span><br><span class="line">    [<span class="string">&#x27;email&#x27;</span> =&gt; <span class="string">&#x27;john@example.com&#x27;</span>, <span class="string">&#x27;votes&#x27;</span> =&gt; <span class="number">0</span>]</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><em>注意：当使用<code>PostgresSQL</code>时,<code>insertGetId</code>方法默认自增列被命名为<code>id</code>，如果你想要从其他<code>序列</code>获取<code>ID</code>，可以将序列名作为第二个参数传递到<code>insertGetId</code>方法。</em></p>
<hr>
<h3 id="7-2-9-更新（Update）"><a href="#7-2-9-更新（Update）" class="headerlink" title="7.2.9 更新（Update）"></a>7.2.9 更新（Update）</h3><p>当然，除了插入记录到数据库，查询构建器还可以通过使用<code>update</code>方法更新已有记录。<code>update</code>方法和<code>insert</code>方法一样，接收列和值的键值对数组包含要更新的列，你可以通过<code>where</code>子句来对<code>update</code>查询进行约束：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">            -&gt;where(<span class="string">&#x27;id&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">            -&gt;update([<span class="string">&#x27;votes&#x27;</span> =&gt; <span class="number">1</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="7-2-9-1-增加-减少"><a href="#7-2-9-1-增加-减少" class="headerlink" title="7.2.9.1 增加/减少"></a>7.2.9.1 增加/减少</h4><p>查询构建器还提供了方便增减给定列名数值的方法。相较于编写<code>update</code>语句，这是一条捷径，提供了更好的体验和测试接口。</p>
<p>这两个方法都至少接收一个参数：需要修改的列。第二个参数是可选的，用于控制列值增加/减少的数目。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;increment(<span class="string">&#x27;votes&#x27;</span>);</span><br><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;increment(<span class="string">&#x27;votes&#x27;</span>, <span class="number">5</span>);</span><br><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;decrement(<span class="string">&#x27;votes&#x27;</span>);</span><br><span class="line">DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;decrement(<span class="string">&#x27;votes&#x27;</span>, <span class="number">5</span>);</span><br></pre></td></tr></table></figure>
<p>在操作过程中你还可以指定额外的列进行更新：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DB::table(&#x27;users&#x27;)-&gt;increment(&#x27;votes&#x27;, 1, [&#x27;name&#x27; =&gt; &#x27;John&#x27;]);</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="7-2-10-删除（Delete）"><a href="#7-2-10-删除（Delete）" class="headerlink" title="7.2.10 删除（Delete）"></a>7.2.10 删除（Delete）</h3><p>当然，查询构建器还可以通过<code>delete</code>方法从表中删除记录：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DB::table(&#x27;users&#x27;)-&gt;delete();</span><br></pre></td></tr></table></figure>
<p>在调用<code>delete</code>方法之前可以通过添加<code>where</code>子句对<code>delete</code>语句进行约束：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DB::table(&#x27;users&#x27;)-&gt;where(&#x27;votes&#x27;, &#x27;&lt;&#x27;, 100)-&gt;delete();</span><br></pre></td></tr></table></figure>
<p>如果你希望清除整张表，也就是删除所有列并将自增ID置为0，可以使用truncate方法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DB::table(&#x27;users&#x27;)-&gt;truncate();</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-2-11-悲观锁"><a href="#7-2-11-悲观锁" class="headerlink" title="7.2.11 悲观锁"></a>7.2.11 悲观锁</h3><p>查询构建器还包含一些方法帮助你在<code>select</code>语句中实现<code>悲观锁</code>。可以在查询中使用<code>sharedLock</code>方法从而在运行语句时带一把<code>共享锁</code>。共享锁可以避免,被选择的行被修改直到事务提交：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DB::table(&#x27;users&#x27;)-&gt;where(&#x27;votes&#x27;, &#x27;&gt;&#x27;, 100)-&gt;sharedLock()-&gt;get();</span><br></pre></td></tr></table></figure>
<p>此外你还可以使用<code>lockForUpdate</code>方法。<code>for update</code>锁避免选择行被其它共享锁修改或删除：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DB::table(&#x27;users&#x27;)-&gt;where(&#x27;votes&#x27;, &#x27;&gt;&#x27;, 100)-&gt;lockForUpdate()-&gt;get();</span><br></pre></td></tr></table></figure>

<hr>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第七章 第一节</title>
    <url>/2016/07/26/fb9d8bedfd30/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="7-数据库"><a href="#7-数据库" class="headerlink" title="7 数据库"></a>7 数据库</h2><h2 id="7-1-起步"><a href="#7-1-起步" class="headerlink" title="7.1 起步"></a>7.1 起步</h2><h3 id="7-1-1-简介"><a href="#7-1-1-简介" class="headerlink" title="7.1.1 简介"></a>7.1.1 简介</h3><p>Laravel 让连接多种数据库以及对数据库进行查询变得非常简单，不论使用原生 SQL、还是查询构建器，还是 Eloquent ORM。目前，Laravel 支持四种类型的数据库系统：</p>
<ul>
<li>MySQL</li>
<li>Postgres</li>
<li>SQLite</li>
<li>SQL Server</li>
</ul>
<h4 id="7-1-1-1-配置"><a href="#7-1-1-1-配置" class="headerlink" title="7.1.1.1 配置"></a>7.1.1.1 配置</h4><p>Laravel 让连接数据库和运行查询都变得非常简单。应用的数据库配置位于<code>config/database.php</code>。在该文件中你可以定义所有的数据库连接，并指定哪个连接是默认连接。该文件中提供了所有支持数据库系统的配置示例。</p>
<p>默认情况下，Laravel 示例环境配置已经为 Laravel Homestead 做好了设置，当然，你也可以按照需要为本地的数据库修改该配置。</p>
<ul>
<li><strong>读/写连接</strong></li>
</ul>
<p>有时候你希望使用一个数据库连接做查询，另一个数据库连接做插入、更新和删除，Laravel 使得这件事情轻而易举，不管你用的是原生 SQL，还是查询构建器，还是 Eloquent ORM，合适的连接总是会被使用。</p>
<p>想要知道如何配置读/写连接，让我们看看下面这个例子：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;mysql&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;read&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;host&#x27;</span> =&gt; <span class="string">&#x27;192.168.1.1&#x27;</span>,</span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;write&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;host&#x27;</span> =&gt; <span class="string">&#x27;196.168.1.2&#x27;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="string">&#x27;driver&#x27;</span>    =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;database&#x27;</span>  =&gt; <span class="string">&#x27;database&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span>  =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;charset&#x27;</span>   =&gt; <span class="string">&#x27;utf8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;collation&#x27;</span> =&gt; <span class="string">&#x27;utf8_unicode_ci&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;prefix&#x27;</span>    =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<p>注意我们在配置数组中新增了两个键：read和write，这两个键都对应一个包含单个键“host”的数组，读/写连接的其它数据库配置选项都共用 mysql 的主数组配置。</p>
<p>如果我们想要覆盖主数组中的配置，只需要将相应配置项放到<code>read</code>和<code>write</code>数组中即可。在本例中，<code>192.168.1.1</code>将被用作“读”连接，而<code>192.168.1.2</code>将被用作“写”连接。两个数据库连接的凭证（用户名/密码）、前缀、字符集以及其它配置将会共享<code>mysql</code>数组中的设置。</p>
<hr>
<h3 id="7-1-2-运行原生-SQL-查询"><a href="#7-1-2-运行原生-SQL-查询" class="headerlink" title="7.1.2 运行原生 SQL 查询"></a>7.1.2 运行原生 SQL 查询</h3><p>配置好数据库连接后，就可以使用<code>DB门</code>面来运行查询。<code>DB门面</code>为每种查询提供了相应方法：<code>select</code>, <code>update</code>, <code>insert</code>, <code>delete</code>, 和<code>statement</code>。</p>
<h4 id="7-1-2-1-运行-Select-查询"><a href="#7-1-2-1-运行-Select-查询" class="headerlink" title="7.1.2.1 运行 Select 查询"></a>7.1.2.1 运行 Select 查询</h4><p>运行一个最基本的查询，可以使用<code>DB门面</code>的<code>select</code>方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">DB</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示用户列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$users</span> = DB::select(<span class="string">&#x27;select * from users where active = ?&#x27;</span>, [<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">&#x27;user.index&#x27;</span>, [<span class="string">&#x27;users&#x27;</span> =&gt; <span class="variable">$users</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>传递给<code>select</code>方法的第一个参数是原生的<code>SQL</code>语句，第二个参数需要绑定到查询的参数绑定，通常，这些都是<code>where</code>字句约束中的值。参数绑定可以避免<code>SQL</code>注入攻击。</p>
<p><code>select</code>方法以数组的形式返回结果，数组中的每一个结果都是一个PHP <code>StdClass</code>对象，从而允许你像下面这样访问结果值：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$user</span>-&gt;name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="7-1-2-2-使用命名绑定"><a href="#7-1-2-2-使用命名绑定" class="headerlink" title="7.1.2.2 使用命名绑定"></a>7.1.2.2 使用命名绑定</h4><p>除了使用?占位符来代表参数绑定外，还可以使用命名绑定来执行查询:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$results</span> = DB::select(<span class="string">&#x27;select * from users where id = :id&#x27;</span>, [<span class="string">&#x27;id&#x27;</span> =&gt; <span class="number">1</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="7-1-2-3-运行插入语句"><a href="#7-1-2-3-运行插入语句" class="headerlink" title="7.1.2.3 运行插入语句"></a>7.1.2.3 运行插入语句</h4><p>使用<code>DB门面</code>的<code>insert</code>方法执行插入语句。和<code>select</code>一样，改方法将原生SQL语句作为第一个参数，将绑定作为第二个参数：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$results</span> = DB::insert(<span class="string">&#x27;insert into users (id, name) values (?, ?)&#x27;</span>, [<span class="number">1</span>, <span class="string">&#x27;Dayle&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="7-1-2-4-运行更新语句"><a href="#7-1-2-4-运行更新语句" class="headerlink" title="7.1.2.4 运行更新语句"></a>7.1.2.4 运行更新语句</h4><p><code>update</code>方法用于更新数据库中已存在的记录，该方法返回受更新语句影响的行数：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$affected</span> = DB::update(<span class="string">&#x27;update users set votes = 100 where name = ?&#x27;</span>, [<span class="string">&#x27;John&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<h4 id="7-1-2-5-运行删除语句"><a href="#7-1-2-5-运行删除语句" class="headerlink" title="7.1.2.5 运行删除语句"></a>7.1.2.5 运行删除语句</h4><p><code>delete</code>方法用于删除数据库中已存在的记录，和<code>update</code>一样，该语句返回被删除的行数：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$deleted</span> = DB::delete(<span class="string">&#x27;delete from users&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="7-1-2-6-运行一个通用语句"><a href="#7-1-2-6-运行一个通用语句" class="headerlink" title="7.1.2.6 运行一个通用语句"></a>7.1.2.6 运行一个通用语句</h4><p>有些数据库语句不返回任何值，对于这种类型的操作，可以使用<code>DB门面</code>的<code>statement</code>方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DB::statement(<span class="string">&#x27;drop table users&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="7-1-2-7-监听查询事件"><a href="#7-1-2-7-监听查询事件" class="headerlink" title="7.1.2.7 监听查询事件"></a>7.1.2.7 监听查询事件</h4><p>如果你想要获取应用中每次 SQL 语句的执行，可以使用<code>listen</code>方法，该方法对查询日志和调试非常有用，你可以在服务提供者中注册查询监听器：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">DB</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动所有应用服务</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        DB::listen(<span class="function"><span class="keyword">function</span>(<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// $query-&gt;sql</span></span><br><span class="line">            <span class="comment">// $query-&gt;bindings</span></span><br><span class="line">            <span class="comment">// $query-&gt;time</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册服务提供者</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-1-3-数据库事务"><a href="#7-1-3-数据库事务" class="headerlink" title="7.1.3 数据库事务"></a>7.1.3 数据库事务</h3><p>想要在一个数据库事务中运行一连串操作，可以使用<code>DB门面</code>的<code>transaction</code>方法，如果事务闭包中抛出异常，事务将会自动回滚。</p>
<p>如果闭包执行成功，事务将会自动提交。使用<code>transaction</code>方法时不需要担心手动回滚或提交：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">DB::transaction(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    DB::table(<span class="string">&#x27;users&#x27;</span>)-&gt;update([<span class="string">&#x27;votes&#x27;</span> =&gt; <span class="number">1</span>]);</span><br><span class="line">    DB::table(<span class="string">&#x27;posts&#x27;</span>)-&gt;delete();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="7-1-3-1-手动使用事务"><a href="#7-1-3-1-手动使用事务" class="headerlink" title="7.1.3.1 手动使用事务"></a>7.1.3.1 手动使用事务</h4><p>如果你想要手动开始事务从而对回滚和提交有一个完整的控制，可以使用<code>DB门面</code>的<code>beginTransaction</code>方法：</p>
<pre><code>DB::beginTransaction();
</code></pre>
<p>你可以通过<code>rollBack</code>方法回滚事务：</p>
<pre><code>DB::rollBack();
</code></pre>
<p>最后，可以通过<code>commit</code>方法提交事务：</p>
<pre><code>DB::commit();
</code></pre>
<p><em>注意：使用<code>DB门面</code>的事务方法还可以用于控制查询构建器和 <code>Eloquent ORM</code> 的事务。</em></p>
<hr>
<h3 id="7-1-4-使用多个数据库连接"><a href="#7-1-4-使用多个数据库连接" class="headerlink" title="7.1.4 使用多个数据库连接"></a>7.1.4 使用多个数据库连接</h3><p>使用多个数据库连接的时候，可以使用<code>DB门面</code>的<code>connection</code>方法访问每个连接。传递给<code>connection</code>方法的连接名对应配置文件<code>config/database.php</code>中相应的连接：</p>
<pre><code>$users = DB::connection(&#39;foo&#39;)-&gt;select(...);
</code></pre>
<p>你还可以通过连接实例上的<code>getPdo</code>方法底层原生的 PDO 实例：</p>
<pre><code>$pdo = DB::connection()-&gt;getPdo();
</code></pre>
<hr>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第八章 第一节</title>
    <url>/2016/07/26/c9cbd0eea6cb/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="8-Eloquent-ORM"><a href="#8-Eloquent-ORM" class="headerlink" title="8. Eloquent ORM"></a>8. Eloquent ORM</h2><h2 id="8-1-起步"><a href="#8-1-起步" class="headerlink" title="8.1 起步"></a>8.1 起步</h2><h3 id="8-1-1-简介"><a href="#8-1-1-简介" class="headerlink" title="8.1.1 简介"></a>8.1.1 简介</h3><p>Laravel 自带的 <code>Eloquent ORM </code>提供了一个美观、简单的与数据库打交道的 <code>ActiveRecord</code> 实现方法，每张数据表都对应一个与该表进行交互的“模型”，模型允许你在表中进行数据查询，以及插入、更新、删除等操作。</p>
<p>在开始之前，确保在config/database.php文件中配置好了数据库连接。更多关于数据库配置的信息，请查看文档。</p>
<hr>
<h3 id="8-1-2-定义模型"><a href="#8-1-2-定义模型" class="headerlink" title="8.1.2 定义模型"></a>8.1.2 定义模型</h3><p>作为开始，让我们创建一个 <code>Eloquent</code> 模型，模型通常位于<code>app目录</code>下，你也可以将其放在其他可以被<code>composer.json</code>文件自动加载的地方。所有Eloquent模型都继承自 <code>Illuminate\Database\Eloquent\Model</code>类。</p>
<p>创建模型实例最简单的办法就是使用 Artisan 命令<code>make:model</code>：</p>
<pre><code>php artisan make:model User
</code></pre>
<p>如果你想要在生成模型时生成数据库迁移，可以使用<code>--migration</code>或<code>-m</code>选项：</p>
<pre><code>php artisan make:model User --migration
php artisan make:model User -m
</code></pre>
<h4 id="8-1-2-1-Eloquent-模型约定"><a href="#8-1-2-1-Eloquent-模型约定" class="headerlink" title="8.1.2.1 Eloquent 模型约定"></a>8.1.2.1 Eloquent 模型约定</h4><p>现在，让我们来看一个 <code>Flight </code>模型类例子，我们将用该类获取和存取数据表<code>flights</code>中的信息：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flight</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>表名</strong></p>
<p>  注意我们并没有告诉 <code>Eloquent</code> 我们的<code>Flight</code>模型使用哪张表。默认规则是模型类名的复数作为与其对应的表名，除非在模型类中明确指定了其它名称。</p>
<p>  所以，在本例中，Eloquent 认为<code>Flight</code>模型存储记录在<code>flights</code>表中。你也可以在模型中定义table属性来指定自定义的表名：</p>
<p>  下面例子中表明被定义为<code>my_flights</code></p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flight</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 关联到模型的数据表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$table</span> = <span class="string">&#x27;my_flights&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>主键</strong></p>
<p>  Eloquent 默认每张表的主键名为<code>id</code>，你可以在模型类中定义一个<code>$primaryKey</code>属性来覆盖该设置。</p>
</li>
<li><p><strong>时间戳</strong></p>
<p>  默认情况下，Eloquent 期望<code>created_at</code>和<code>updated_at</code>已经存在于数据表中，如果你不想要这些 Laravel 自动管理的列，在模型类中设置<code>$timestamps</code>属性为<code>false</code>：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flight</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 表明模型是否应该被打上时间戳</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$timestamps</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  如果你需要自定义时间戳格式，设置模型中的<code>$dateFormat</code>属性。该属性决定日期被如何存储到数据库中，以及模型被序列化为数组或 JSON 时日期的格式：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flight</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模型日期列的存储格式</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$dateFormat</span> = <span class="string">&#x27;U&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>数据库连接</strong></p>
<p>  默认情况下，所有的 Eloquent 模型使用应用配置中的默认数据库连接，如果你想要为模型指定不同的连接，可以通过 <code>$connection</code>属性来设置。</p>
<p>  这里的<code>Flight</code>模型，默认连接到<code>Flights</code>。设置后将<code>Flight</code>模型连接到<code>connection_name</code>，这里的<code>connection_name</code>可以随意命名。</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flight</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The connection name for the model.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$connection</span> = <span class="string">&#x27;connection_name&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="8-1-3-获取多个模型"><a href="#8-1-3-获取多个模型" class="headerlink" title="8.1.3 获取多个模型"></a>8.1.3 获取多个模型</h3><p>创建完模型及其关联的数据表后，就要准备从数据库中获取数据。将Eloquent模型看作功能强大的查询构建器，你可以使用它来流畅的查询与其关联的数据表。</p>
<p>例如：例子中将<code>Flights</code>表中全部数据，注入到<code>flight.index</code>页面中。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Flight</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlightController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示所有有效航班列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$flights</span> = Flight::all();</span><br><span class="line">        <span class="keyword">return</span> view(<span class="string">&#x27;flight.index&#x27;</span>, [<span class="string">&#x27;flights&#x27;</span> =&gt; <span class="variable">$flights</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-1-3-1-访问列值"><a href="#8-1-3-1-访问列值" class="headerlink" title="8.1.3.1 访问列值"></a>8.1.3.1 访问列值</h4><p>如果你有一个 Eloquent 模型实例，可以通过访问其相应的属性来访问模型的列值。</p>
<p>例如，让我们循环查询返回的每一个<code>Flight</code>实例并输出<code>name</code>的值：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$flights</span> <span class="keyword">as</span> <span class="variable">$flight</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flight</span>-&gt;name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-1-3-2-添加额外约束"><a href="#8-1-3-2-添加额外约束" class="headerlink" title="8.1.3.2 添加额外约束"></a>8.1.3.2 添加额外约束</h4><p>Eloquent 的<code>all</code>方法返回模型表的所有结果，由于每一个Eloquent模型都是一个查询构建器，你还可以添加约束条件到查询，然后使用get方法获取对应结果：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$flights</span> = App\Flight::where(<span class="string">&#x27;active&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">               -&gt;orderBy(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>)</span><br><span class="line">               -&gt;take(<span class="number">10</span>)</span><br><span class="line">               -&gt;get();</span><br></pre></td></tr></table></figure>

<p><em>注意：由于 Eloquent 模型本质上就是查询构建器，你可以在Eloquent查询中使用查询构建器的所有方法</em></p>
<h4 id="8-1-3-3-集合"><a href="#8-1-3-3-集合" class="headerlink" title="8.1.3.3 集合"></a>8.1.3.3 集合</h4><p>对 Eloquent 中获取多个结果的方法（比如<code>all</code>和<code>get</code>）而言，其返回值是<code>Illuminate\Database\Eloquent\Collection</code>的一个实例，<code>Collection</code>类提供了多个有用的函数来处理Eloquent结果。</p>
<p>当然，你可以像操作数组一样简单循环这个集合：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$flights</span> <span class="keyword">as</span> <span class="variable">$flight</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$flight</span>-&gt;name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-1-3-4-组块结果集"><a href="#8-1-3-4-组块结果集" class="headerlink" title="8.1.3.4 组块结果集"></a>8.1.3.4 组块结果集</h4><p>如果你需要处理成千上万个 Eloquent 结果，可以使用<code>chunk</code>命令。<code>chunk</code>方法会获取一个“组块”的 Eloquent 模型，并将其填充到给定闭包进行处理。使用<code>chunk</code>方法能够在处理大量数据集合时有效减少内存消耗：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Flight::chunk(<span class="number">200</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$flights</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$flights</span> <span class="keyword">as</span> <span class="variable">$flight</span>) &#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>传递给该方法的第一个参数是你想要获取的<code>组块</code>数目，闭包作为第二个参数被调用用于处理每个从数据库获取的区块数据。</p>
<hr>
<h3 id="8-1-4-获取单个模型-聚合"><a href="#8-1-4-获取单个模型-聚合" class="headerlink" title="8.1.4 获取单个模型/聚合"></a>8.1.4 获取单个模型/聚合</h3><p>当然，除了从给定表中获取所有记录之外，还可以使用<code>find</code>和<code>first</code>获取单个记录。这些方法返回单个模型实例而不是返回模型集合：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 通过主键获取模型...</span></span><br><span class="line"><span class="variable">$flight</span> = App\Flight::find(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// 获取匹配查询条件的第一个模型...</span></span><br><span class="line"><span class="variable">$flight</span> = App\Flight::where(<span class="string">&#x27;active&#x27;</span>, <span class="number">1</span>)-&gt;first();</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Not Found 异常</strong></li>
</ul>
<p>有时候你可能想要在模型找不到的时候抛出异常，这在路由或控制器中非常有用，<code>findOrFail</code>和<code>firstOrFail</code>方法会获取查询到的第一个结果。</p>
<p>然而，如果没有任何查询结果，<code>Illuminate\Database\Eloquent\ModelNotFoundException</code>异常将会被抛出：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$model</span> = App\Flight::findOrFail(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$model</span> = App\Flight::where(<span class="string">&#x27;legs&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">100</span>)-&gt;firstOrFail();</span><br></pre></td></tr></table></figure>
<p>如果异常没有被捕获，那么HTTP 404 响应将会被发送给用户，所以在使用这些方法的时候没有必要对返回404响应编写明确的检查：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/api/flights/&#123;id&#125;&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> App\Flight::findOrFail(<span class="variable">$id</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="8-1-4-1-获取聚合"><a href="#8-1-4-1-获取聚合" class="headerlink" title="8.1.4.1 获取聚合"></a>8.1.4.1 获取聚合</h4><p>当然，你还可以使用查询构建器聚合方法，例如<code>count</code>、<code>sum</code>、<code>max</code>，以及其它查询构建器提供的聚合方法。这些方法返回计算后的结果而不是整个模型实例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$count</span> = App\Flight::where(<span class="string">&#x27;active&#x27;</span>, <span class="number">1</span>)-&gt;count();</span><br><span class="line"><span class="variable">$max</span> = App\Flight::where(<span class="string">&#x27;active&#x27;</span>, <span class="number">1</span>)-&gt;max(<span class="string">&#x27;price&#x27;</span>);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="8-1-5-插入-更新模型"><a href="#8-1-5-插入-更新模型" class="headerlink" title="8.1.5 插入/更新模型"></a>8.1.5 插入/更新模型</h3><h4 id="8-1-5-1-基本插入"><a href="#8-1-5-1-基本插入" class="headerlink" title="8.1.5.1 基本插入"></a>8.1.5.1 基本插入</h4><p>想要在数据库中插入新的记录，只需创建一个新的模型实例，设置模型的属性，然后调用<code>save</code>方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Flight</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FlightController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个新的航班实例</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  Request  $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Validate the request...</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$flight</span> = <span class="keyword">new</span> Flight;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$flight</span>-&gt;name = <span class="variable">$request</span>-&gt;name;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$flight</span>-&gt;save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个例子中，我们只是简单分配HTTP请求中的<code>name</code>参数值给<code>App\Flight</code>模型实例的那么属性，当我们调用<code>save</code>方法时，一条记录将会被插入数据库。<code>created_at</code>和<code>updated_at</code>时间戳在<code>save</code>方法被调用时会自动被设置，所以没必要手动设置它们。</p>
<h4 id="8-1-5-2-基本更新"><a href="#8-1-5-2-基本更新" class="headerlink" title="8.1.5.2 基本更新"></a>8.1.5.2 基本更新</h4><p><code>save</code>方法还可以用于更新数据库中已存在的模型。要更新一个模型，应该先获取它，设置你想要更新的属性，然后调用<code>save</code>方法。同样，<code>updated_at</code>时间戳会被自动更新，所以没必要手动设置其值：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$flight</span> = App\Flight::find(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$flight</span>-&gt;name = <span class="string">&#x27;New Flight Name&#x27;</span>;</span><br><span class="line"><span class="variable">$flight</span>-&gt;save();</span><br></pre></td></tr></table></figure>
<p>更新操作还可以同时修改给定查询提供的多个模型实例，在本例中，所有有效且<code>destination=San Diego</code>的航班都被标记为延迟：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">App\Flight::where(<span class="string">&#x27;active&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">          -&gt;where(<span class="string">&#x27;destination&#x27;</span>, <span class="string">&#x27;San Diego&#x27;</span>)</span><br><span class="line">          -&gt;update([<span class="string">&#x27;delayed&#x27;</span> =&gt; <span class="number">1</span>]);</span><br></pre></td></tr></table></figure>
<p><code>update</code>方法要求以数组形式传递键值对参数，代表着数据表中应该被更新的列。</p>
<h4 id="8-1-5-3-批量赋值"><a href="#8-1-5-3-批量赋值" class="headerlink" title="8.1.5.3 批量赋值"></a>8.1.5.3 批量赋值</h4><p>还可以使用<code>create</code>方法保存一个新的模型。该方法返回被插入的模型实例。</p>
<p>但是，在此之前，你需要指定模型的<code>fillable</code>或<code>guarded</code>属性，因为所有Eloquent模型都通过批量赋值（Mass Assignment）进行保护。</p>
<p>当用户通过 HTTP 请求传递一个不被期望的参数值时就会出现安全隐患，然后该参数以不被期望的方式修改数据库中的列值。</p>
<p>例如，恶意用户通过 HTTP 请求发送一个<code>is_admin</code>参数，然后该参数映射到模型的create方法，从而允许用户将自己变成管理员。</p>
<p>所以，你应该在模型中定义哪些属性是可以进行赋值的，使用模型上的<code>$fillable</code>属性即可实现。</p>
<p>例如，我们设置<code>Flight</code>模型上的<code>name</code>属性可以被赋值：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flight</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 可以被批量赋值的属性.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$fillable</span> = [<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>设置完可以被赋值的属性之后，我们就可以使用<code>create</code>方法在数据库中插入一条新的记录。<code>create</code>方法返回保存后的模型实例：</p>
<pre><code>$flight = App\Flight::create([&#39;name&#39; =&gt; &#39;Flight 10&#39;]);
</code></pre>
<p><code>$fillable</code>就像是可以被赋值属性的“白名单”，还可以选择使用<code>$guarded</code>。<code>$guarded</code>属性包含你不想被赋值的属性数组。所以不被包含在其中的属性都是可以被赋值的，因此，<code>$guarded</code>方法就像“黑名单”。</p>
<p>当然，你只能同时使用其中一个——而不是一起使用：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flight</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 不能被批量赋值的属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$guarded</span> = [<span class="string">&#x27;price&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个例子中，除了<code>$price</code>之外的所有属性都是可以被赋值的。</p>
<ul>
<li><p><strong>其它创建方法</strong></p>
<p>  还有其它两种可以用来创建模型的方法：<code>firstOrCreate</code>和<code>firstOrNew</code>。</p>
<p>  <code>firstOrCreate</code>方法先尝试通过给定列/值对在数据库中查找记录，如果没有找到的话则通过给定属性创建一个新的记录。</p>
<p>  <code>firstOrNew</code>方法和<code>firstOrCreate</code>方法一样先尝试在数据库中查找匹配的记录，如果没有找到，则返回一个的模型实例。</p>
<p>  注意通过<code>firstOrNew</code>方法返回的模型实例并没有持久化到数据库中，你还需要调用<code>save</code>方法手动持久化：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 通过属性获取航班, 如果不存在则创建...</span></span><br><span class="line"><span class="variable">$flight</span> = App\Flight::firstOrCreate([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Flight 10&#x27;</span>]);</span><br><span class="line"><span class="comment">// 通过属性获取航班, 如果不存在初始化一个新的实例...</span></span><br><span class="line"><span class="variable">$flight</span> = App\Flight::firstOrNew([<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Flight 10&#x27;</span>]);</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="8-1-6-删除模型"><a href="#8-1-6-删除模型" class="headerlink" title="8.1.6 删除模型"></a>8.1.6 删除模型</h3><p>要删除一个模型，调用模型实例上的<code>delete</code>方法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$flight = App\Flight::find(1);</span><br><span class="line">$flight-&gt;delete();</span><br></pre></td></tr></table></figure>

<h4 id="8-1-6-1-通过主键删除模型"><a href="#8-1-6-1-通过主键删除模型" class="headerlink" title="8.1.6.1 通过主键删除模型"></a>8.1.6.1 通过主键删除模型</h4><p>在上面的例子中，我们在调用<code>delete</code>方法之前从数据库中获取该模型，然而，如果你知道模型的主键的话，可以调用<code>destroy</code>方法直接删除而不需要获取它：</p>
<p>下方三种方式相同。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">App\Flight::destroy(1);</span><br><span class="line">App\Flight::destroy([1, 2, 3]);</span><br><span class="line">App\Flight::destroy(1, 2, 3);</span><br></pre></td></tr></table></figure>

<h4 id="8-1-6-2-通过查询删除模型"><a href="#8-1-6-2-通过查询删除模型" class="headerlink" title="8.1.6.2 通过查询删除模型"></a>8.1.6.2 通过查询删除模型</h4><p>当然，你还可以通过查询删除多个模型，在本例中，我们删除所有被标记为无效的航班：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$deletedRows = App\Flight::where(&#x27;active&#x27;, 0)-&gt;delete();</span><br></pre></td></tr></table></figure>

<h4 id="8-1-6-3-软删除"><a href="#8-1-6-3-软删除" class="headerlink" title="8.1.6.3 软删除"></a>8.1.6.3 软删除</h4><p>除了从数据库删除记录外，Eloquent还可以对模型进行“软删除”。当模型被软删除后，它们并没有真的从数据库删除，而是在模型上设置一个<code>deleted_at</code>属性并插入数据库，如果模型有一个非空<code>deleted_at</code>值，那么该模型已经被软删除了。</p>
<p>要启用模型的软删除功能，可以使用模型上的<code>Illuminate\Database\Eloquent\SoftDeletes</code>方法并添加<code>deleted_at</code>列到<code>$dates</code>属性：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">SoftDeletes</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flight</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">SoftDeletes</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 应该被调整为日期的属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$dates</span> = [<span class="string">&#x27;deleted_at&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，应该添加<code>deleted_at</code>列到数据表。Laravel Schema构建器包含一个帮助函数来创建该列：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Schema::table(<span class="string">&#x27;flights&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$table</span>-&gt;softDeletes();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>现在，当调用模型的<code>delete</code>方法时，<code>deleted_at</code>列将被设置为当前日期和时间，并且，当查询一个使用软删除的模型时，被软删除的模型将会自动从查询结果中排除。</p>
<p>判断给定模型实例是否被软删除，可以使用<code>trashed</code>方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$flight</span>-&gt;trashed()) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-1-6-4-查询被软删除的模型"><a href="#8-1-6-4-查询被软删除的模型" class="headerlink" title="8.1.6.4 查询被软删除的模型"></a>8.1.6.4 查询被软删除的模型</h4><ul>
<li><p><strong>包含软删除模型</strong></p>
<p>  正如上面提到的，软删除模型将会自动从查询结果中排除，但是，如果你想要软删除模型出现在查询结果中，可以使用<code>withTrashed</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$flights</span> = App\Flight::withTrashed()</span><br><span class="line">                -&gt;where(<span class="string">&#x27;account_id&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">                -&gt;get();</span><br></pre></td></tr></table></figure>
<p>  <code>withTrashed</code>方法也可以用于关联查询中：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$flight</span>-&gt;history()-&gt;withTrashed()-&gt;get();</span><br></pre></td></tr></table></figure></li>
<li><p><strong>只获取软删除模型</strong></p>
<p>  <code>onlyTrashed</code>方法之获取软删除模型：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$flights</span> = App\Flight::onlyTrashed()</span><br><span class="line">                -&gt;where(<span class="string">&#x27;airline_id&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">                -&gt;get();</span><br></pre></td></tr></table></figure></li>
<li><p><strong>恢复软删除模型</strong></p>
<p>  有时候你希望恢复一个被软删除的模型，可以使用<code>restore</code>方法：</p>
<pre><code>  $flight-&gt;restore();
</code></pre>
<p>  你还可以在查询中使用<code>restore</code>方法来快速恢复多个模型：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">App\Flight::withTrashed()</span><br><span class="line">        -&gt;where(<span class="string">&#x27;airline_id&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">        -&gt;restore();</span><br></pre></td></tr></table></figure>
<p>  和<code>withTrashed</code>方法一样，<code>restore</code>方法也可以用于关联查询：</p>
<pre><code>  $flight-&gt;history()-&gt;restore();
</code></pre>
</li>
<li><p><strong>永久删除模型</strong></p>
<p>  有时候你真的需要从数据库中删除一个模型，可以使用forceDelete方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 强制删除单个模型实例...</span></span><br><span class="line"><span class="variable">$flight</span>-&gt;forceDelete();</span><br><span class="line"><span class="comment">// 强制删除所有关联模型...</span></span><br><span class="line"><span class="variable">$flight</span>-&gt;history()-&gt;forceDelete();</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="8-1-7-查询作用域"><a href="#8-1-7-查询作用域" class="headerlink" title="8.1.7 查询作用域"></a>8.1.7 查询作用域</h3><h4 id="8-1-7-1-全局作用域"><a href="#8-1-7-1-全局作用域" class="headerlink" title="8.1.7.1 全局作用域"></a>8.1.7.1 全局作用域</h4><p>全局作用域允许我们为给定模型的所有查询添加条件约束。Laravel 自带的软删除功能就使用了全局作用域来从数据库中拉出所有没有被删除的模型。编写自定义的全局作用域可以提供一种方便的、简单的方式来确保给定模型的每个查询都有特定的条件约束。</p>
<ul>
<li><p><strong>编写全局作用域</strong></p>
<p>  自定义全局作用域很简单，首先定义一个实现 <code>Illuminate\Database\Eloquent\Scope</code> 接口的类，该接口要求你实现一个方法：<code>apply</code>。需要的话可以在 <code>apply</code> 方法中添加 <code>where</code> 条件到查询：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Scopes</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Scope</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Builder</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AgeScope</span> <span class="keyword">implements</span> <span class="title">Scope</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Apply the scope to a given Eloquent query builder.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Database\Eloquent\Builder  $builder</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Database\Eloquent\Model  $model</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">apply</span>(<span class="params">Builder <span class="variable">$builder</span>, Model <span class="variable">$model</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$builder</span>-&gt;where(<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">200</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>应用全局作用域</strong></p>
<p>  要将全局作用域分配给模型，需要重写给定模型的 <code>boot</code> 方法并使用 <code>addGlobalScope</code> 方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Scopes</span>\<span class="title">AgeScope</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The &quot;booting&quot; method of the model.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::boot();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">static</span>::addGlobalScope(<span class="keyword">new</span> AgeScope);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  添加作用域后，如果使用 <code>User::all()</code> 查询则会生成如下SQL语句：</p>
<pre><code>  select * from `users` where `age` &gt; 200
</code></pre>
</li>
<li><p><strong>匿名的全局作用域</strong></p>
</li>
</ul>
<p>Eloquent还允许我们使用闭包定义全局作用域，这在实现简单作用域的时候特别有用，这样的话，我们就没必要定义一个单独的类了：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Builder</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The &quot;booting&quot; method of the model.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::boot();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">static</span>::addGlobalScope(<span class="string">&#x27;age&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">Builder <span class="variable">$builder</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$builder</span>-&gt;where(<span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">200</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们还可以通过以下方式移除全局作用：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">User::withoutGlobalScope(<span class="string">&#x27;age&#x27;</span>)-&gt;get();</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>移除全局作用域</strong></li>
</ul>
<p>如果想要在给定查询中移除指定全局作用域，可以使用 <code>withoutGlobalScope</code>：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">User::withoutGlobalScope(AgeScope::class)-&gt;get();</span><br></pre></td></tr></table></figure>
<p>如果你想要移除某几个或全部全局作用域，可以使用 <code>withoutGlobalScopes</code> 方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">User::withoutGlobalScopes()-&gt;get();</span><br><span class="line">User::withoutGlobalScopes([FirstScope::class, SecondScope::class])-&gt;get();</span><br></pre></td></tr></table></figure>


<h4 id="8-1-7-2-本地作用域"><a href="#8-1-7-2-本地作用域" class="headerlink" title="8.1.7.2 本地作用域"></a>8.1.7.2 本地作用域</h4><p>本地作用域允许我们定义通用的约束集合以便在应用中复用。</p>
<p>例如，你可能经常需要获取最受欢迎的用户，要定义这样的一个作用域，只需简单在对应Eloquent模型方法前加上一个<code>scope</code>前缀，作用域总是返回查询构建器：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 只包含活跃用户的查询作用域</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Database\Eloquent\Builder</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">scopePopular</span>(<span class="params"><span class="variable">$query</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;votes&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 只包含激活用户的查询作用域</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Database\Eloquent\Builder</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">scopeActive</span>(<span class="params"><span class="variable">$query</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;active&#x27;</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>使用查询作用域</strong></p>
<p>  作用域被定义好了之后，就可以在查询模型的时候调用作用域方法，但调用时不需要加上<code>scope</code>前缀，你甚至可以在同时调用多个作用域，例如：</p>
<pre><code>  $users = App\User::popular()-&gt;active()-&gt;orderBy(&#39;created_at&#39;)-&gt;get();
</code></pre>
</li>
<li><p><strong>动态作用域</strong></p>
<p>  有时候你可能想要定义一个可以接收参数的作用域，你只需要将额外的参数添加到你的作用域即可。作用域参数应该被定义在<code>$query</code>参数之后：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 只包含给用类型用户的查询作用域</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Database\Eloquent\Builder</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">scopeOfType</span>(<span class="params"><span class="variable">$query</span>, <span class="variable">$type</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;type&#x27;</span>, <span class="variable">$type</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  现在，你可以在调用作用域时传递参数了：</p>
<pre><code>  $users = App\User::ofType(&#39;admin&#39;)-&gt;get();
</code></pre>
</li>
</ul>
<hr>
<h3 id="8-1-8-事件"><a href="#8-1-8-事件" class="headerlink" title="8.1.8 事件"></a>8.1.8 事件</h3><p>Eloquent模型可以触发事件，允许你在模型生命周期中的多个时间点调用如下这些方法：<code>creating</code>, <code>created</code>, <code>updating</code>, <code>updated</code>, <code>saving</code>, <code>saved</code>,<code>deleting</code>, <code>deleted</code>, <code>restoring</code>, <code>restored</code>。事件允许你在一个指定模型类每次保存或更新的时候执行代码。</p>
<h4 id="8-1-8-1-基本使用"><a href="#8-1-8-1-基本使用" class="headerlink" title="8.1.8.1 基本使用"></a>8.1.8.1 基本使用</h4><p>一个新模型被首次保存的时候，<code>creating</code>和<code>created</code>事件会被触发。</p>
<p>如果一个模型已经在数据库中存在并调用<code>save</code>方法，<code>updating / updated</code>事件会被触发，无论是创建还是更新，<code>saving / saved</code>事件都会被调用。</p>
<p>举个例子，我们在服务提供者中定义一个<code>Eloquent事件监听器</code>，在事件监听器中，我们会调用给定模型的<code>isValid</code>方法，如果模型无效会返回<code>false</code>。如果从<code>Eloquent事件监听器</code>中返回<code>false</code>则取消<code>save/update</code>操作：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Providers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">ServiceProvider</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppServiceProvider</span> <span class="keyword">extends</span> <span class="title">ServiceProvider</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 启动所有应用服务</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        User::creating(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$user</span></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> ( ! <span class="variable">$user</span>-&gt;isValid()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册服务提供者.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第七章 第四节</title>
    <url>/2016/07/26/f984dd9711e2/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="7-4-填充数据"><a href="#7-4-填充数据" class="headerlink" title="7.4 填充数据"></a>7.4 填充数据</h2><h3 id="7-4-1-简介"><a href="#7-4-1-简介" class="headerlink" title="7.4.1 简介"></a>7.4.1 简介</h3><p>Laravel 包含了一个简单方法来填充数据库——使用填充类和测试数据。</p>
<p>所有的填充类都位于<code>database/seeds</code>目录。</p>
<p>填充类的类名完全由你自定义，但最好还是遵循一定的规则，比如可读性,例如<code>UserTableSeeder</code>等等。</p>
<p>安装完 Laravel 后，会默认提供一个<code>DatabaseSeeder</code>类。</p>
<p>从这个类中，你可以使用<code>call</code>方法来运行其他填充类，从而允许你控制填充顺序。</p>
<hr>
<h3 id="7-4-2-编写填充器"><a href="#7-4-2-编写填充器" class="headerlink" title="7.4.2 编写填充器"></a>7.4.2 编写填充器</h3><p>要生成一个填充器，可以通过 Artisan 命令<code>make:seeder</code>。所有框架生成的填充器都位于<code>database/seeders</code>目录：</p>
<pre><code>php artisan make:seeder UserTableSeeder
</code></pre>
<p>一个填充器类默认只包含一个方法：<code>run</code>。当Artisan命令<code>db:seed</code>运行时该方法被调用。在<code>run</code>方法中，可以插入任何你想插入数据库的数据，你可以使用查询构建器手动插入数据，也可以使用 Eloquent 模型工厂。</p>
<p>举个例子，让我们修改 Laravel 安装时自带的<code>DatabaseSeeder</code>类，添加一个数据库插入语句到<code>run</code>方法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">use Illuminate\Database\Seeder;</span><br><span class="line">use Illuminate\Database\Eloquent\Model;</span><br><span class="line"></span><br><span class="line">class DatabaseSeeder extends Seeder&#123;</span><br><span class="line">    /**</span><br><span class="line">     * 运行数据库填充</span><br><span class="line">     *</span><br><span class="line">     * @return void</span><br><span class="line">     */</span><br><span class="line">    public function run()</span><br><span class="line">    &#123;</span><br><span class="line">        DB::table(&#x27;users&#x27;)-&gt;insert([</span><br><span class="line">            &#x27;name&#x27; =&gt; str_random(10),</span><br><span class="line">            &#x27;email&#x27; =&gt; str_random(10).&#x27;@gmail.com&#x27;,</span><br><span class="line">            &#x27;password&#x27; =&gt; bcrypt(&#x27;secret&#x27;),</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-4-2-1-使用模型工厂"><a href="#7-4-2-1-使用模型工厂" class="headerlink" title="7.4.2.1 使用模型工厂"></a>7.4.2.1 使用模型工厂</h4><p>当然，手动指定每一个模型填充的属性是很笨重累赘的，取而代之的，我们可以使用模型工厂来方便的生成大量的数据库记录。首先，查看模型工厂文档来学习如何定义工厂，定义工厂后，可以使用帮助函数<code>factory</code>来插入记录到数据库。</p>
<p>举个例子，让我们创建50个用户并添加关联关系到每个用户：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 运行数据库填充</span><br><span class="line"> *</span><br><span class="line"> * @return void</span><br><span class="line"> */</span><br><span class="line">public function run()&#123;</span><br><span class="line">    factory(&#x27;App\User&#x27;, 50)-&gt;create()-&gt;each(function($u) &#123;</span><br><span class="line">        $u-&gt;posts()-&gt;save(factory(&#x27;App\Post&#x27;)-&gt;make());</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-4-2-2-调用额外的填充器"><a href="#7-4-2-2-调用额外的填充器" class="headerlink" title="7.4.2.2 调用额外的填充器"></a>7.4.2.2 调用额外的填充器</h4><p>在<code>DatabaseSeeder</code>类中，你可以使用<code>call</code>方法执行额外的填充类，使用<code>call</code>方法允许你将数据库填充分解成多个文件，这样单个填充器类就不会变得无比巨大，只需简单将你想要运行的填充器类名传递过去即可：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line">* 运行数据库填充</span><br><span class="line">*</span><br><span class="line">* @return void</span><br><span class="line">*/</span><br><span class="line">public function run()&#123;</span><br><span class="line">    Model::unguard();</span><br><span class="line"></span><br><span class="line">    $this-&gt;call(UserTableSeeder::class);</span><br><span class="line">    $this-&gt;call(PostsTableSeeder::class);</span><br><span class="line">    $this-&gt;call(CommentsTableSeeder::class);</span><br><span class="line"></span><br><span class="line">    Model::reguard();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="7-4-3-运行填充器"><a href="#7-4-3-运行填充器" class="headerlink" title="7.4.3 运行填充器"></a>7.4.3 运行填充器</h3><p>编写好填充器类之后，可以使用 Artisan 命令<code>db:seed</code>来填充数据库。默认情况下，<code>db:seed</code>命令运行可以用来运行其它填充器类的<code>DatabaseSeeder</code>类，但是，你也可以使用<code>--class </code>选项来指定你想要运行的独立的填充器类：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">php artisan db:seed</span><br><span class="line">php artisan db:seed --class=UserTableSeeder</span><br></pre></td></tr></table></figure>
<p>你还可以使用<code>migrate:refresh</code>命令来填充数据库，该命令还可以回滚并重新运行迁移，这在需要完全重建数据库时很有用：</p>
<pre><code>php artisan migrate:refresh --seed
</code></pre>
<hr>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第七章 第三节</title>
    <url>/2016/07/26/7e5f24379817/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="7-3-迁移"><a href="#7-3-迁移" class="headerlink" title="7.3 迁移"></a>7.3 迁移</h2><h3 id="7-3-1-简介"><a href="#7-3-1-简介" class="headerlink" title="7.3.1 简介"></a>7.3.1 简介</h3><p>迁移就像数据库的版本控制，允许团队简单轻松的编辑并共享应用的数据库表结构，迁移通常搭配 Laravel 结构构建器，可以很容易地构建应用的数据库表结构。</p>
<p>Laravel的<code>Schema门面</code>提供了与数据库系统无关的创建和操纵表的支持，在 Laravel 所支持的所有数据库系统中提供一致的、优雅的、平滑的API。</p>
<hr>
<h3 id="7-3-2-生成迁移"><a href="#7-3-2-生成迁移" class="headerlink" title="7.3.2 生成迁移"></a>7.3.2 生成迁移</h3><p>使用 <code>Artisan</code> 命令<code>make:migration</code>来创建一个新的迁移：</p>
<pre><code>php artisan make:migration create_users_table
</code></pre>
<p>新的迁移位于<code>database/migrations</code>目录下，每个迁移文件名都包含时间戳从而允许 Laravel 判断其顺序。</p>
<p><code>--table</code>和<code>--create</code>选项可以用于指定表名以及该迁移是否要创建一个新的数据表。这些选项只需要简单放在上述迁移命令后面并指定表名：</p>
<pre><code>php artisan make:migration add_votes_to_users_table --table=users
php artisan make:migration create_users_table --create=users
</code></pre>
<p>如果你想要指定生成迁移的自定义输出路径，在执行<code>make:migration</code>命令时可以使用<code>--path</code>选项，提供的路径应该是相对于应用根目录的。</p>
<hr>
<h3 id="7-3-3-迁移结构"><a href="#7-3-3-迁移结构" class="headerlink" title="7.3.3 迁移结构"></a>7.3.3 迁移结构</h3><p>迁移类包含了两个方法：<code>up</code>和<code>down</code>。</p>
<p><code>up</code>方法用于新增表，列或者索引到数据库，而<code>down</code>方法就是<code>up</code>方法的反操作，和<code>up</code>里的操作相反。</p>
<p>在这两个方法中你都要用到 Laravel 的表结构构建器来创建和修改表.</p>
<p>例如:让我们先看看创建<code>flights</code>表的简单示例：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Schema</span>\<span class="title">Blueprint</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Migrations</span>\<span class="title">Migration</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CreateFlightsTable</span> <span class="keyword">extends</span> <span class="title">Migration</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 运行迁移</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Schema::create(<span class="string">&#x27;flights&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">Blueprint <span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">            <span class="variable">$table</span>-&gt;string(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">            <span class="variable">$table</span>-&gt;string(<span class="string">&#x27;airline&#x27;</span>);</span><br><span class="line">            <span class="variable">$table</span>-&gt;timestamps();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 撤销迁移</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">down</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Schema::drop(<span class="string">&#x27;flights&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="7-3-4-运行迁移"><a href="#7-3-4-运行迁移" class="headerlink" title="7.3.4 运行迁移"></a>7.3.4 运行迁移</h3><p>要运行应用中所有未执行的迁移，可以使用 Artisan 命令的<code>migrate</code>方法。</p>
<p>如果你正在使用Homestead虚拟机，应该在你的虚拟机中运行如下这条命令：</p>
<pre><code>php artisan migrate
</code></pre>
<p>如果再运行时遇到“class not found”的错误提示，尝试运行<code>composer dump-autoload</code>命令然后重新运行迁移命令。</p>
<ul>
<li><p><strong>在生产环境中强制运行迁移</strong></p>
<p>  有些迁移操作是毁灭性的，这意味着它们可能造成数据的丢失，为了避免在生产环境数据库中运行这些命令，你将会在运行这些命令之前被提示并确认。想要强制运行这些命令而不被提示，可以使用<code>--force</code>：</p>
<pre><code>  php artisan migrate --force
</code></pre>
</li>
</ul>
<h4 id="7-3-4-1-回滚迁移"><a href="#7-3-4-1-回滚迁移" class="headerlink" title="7.3.4.1 回滚迁移"></a>7.3.4.1 回滚迁移</h4><p>想要回滚最新的一次迁移<code>操作</code>，可以使用<code>rollback</code>命令，注意这将会回滚最后一批运行的迁移，可能包含多个迁移文件：</p>
<pre><code>php artisan migrate:rollback
</code></pre>
<p><code>migrate:reset</code>命令将会回滚所有的应用迁移：</p>
<pre><code>php artisan migrate:reset
</code></pre>
<ul>
<li><strong>在单个命令中回滚/迁移</strong>  <code>migrate:refresh</code>命令将会先回滚所有数据库迁移，然后运行<code>migrate</code>命令。这个命令可以有效的重建整个数据库：<pre><code>  php artisan migrate:refresh
  php artisan migrate:refresh --seed
</code></pre>
</li>
</ul>
<hr>
<h3 id="7-3-5-编写迁移"><a href="#7-3-5-编写迁移" class="headerlink" title="7.3.5 编写迁移"></a>7.3.5 编写迁移</h3><h4 id="7-3-5-1-创建表"><a href="#7-3-5-1-创建表" class="headerlink" title="7.3.5.1 创建表"></a>7.3.5.1 创建表</h4><p>使用<code>Schema门面</code>上的<code>create</code>方法来创建新的数据表。<code>create</code>方法接收两个参数，第一个是表名，第二个是获取用于定义新表的<code>Blueprint</code>对象的闭包：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Schema::create(<span class="string">&#x27;users&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$table</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当然，创建新表的时候，可以使用表结构构建器中的任意列方法来定义数据表的列。</p>
<ul>
<li><p><strong>检查表/列是否存在</strong></p>
<p>  你可以轻松地使用 <code>hasTable</code> 和 <code>hasColumn</code> 方法检查表或列是否存在：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (Schema::hasTable(<span class="string">&#x27;users&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (Schema::hasColumn(<span class="string">&#x27;users&#x27;</span>, <span class="string">&#x27;email&#x27;</span>)) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li><p><strong>连接&amp;存储引擎</strong></p>
<p>  如果你想要在一个数据库连接上执行表结构操作，该数据库连接并不是默认数据库连接，使用<code>connection</code>方法：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Schema::connection(&#x27;foo&#x27;)-&gt;create(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;increments(&#x27;id&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>  要设置表的存储引擎，在表结构构建器上设置<code>engine</code>属性：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Schema::create(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;engine = &#x27;InnoDB&#x27;;</span><br><span class="line">    $table-&gt;increments(&#x27;id&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="7-3-5-2-重命名-删除表"><a href="#7-3-5-2-重命名-删除表" class="headerlink" title="7.3.5.2 重命名/删除表"></a>7.3.5.2 重命名/删除表</h4><p>要重命名一个已存在的数据表，使用<code>rename</code>方法：</p>
<pre><code>Schema::rename($from, $to);
</code></pre>
<p>要删除一个已存在的数据表，可以使用<code>drop</code>或<code>dropIfExists</code>方法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Schema::drop(&#x27;users&#x27;);</span><br><span class="line">Schema::dropIfExists(&#x27;users&#x27;);</span><br></pre></td></tr></table></figure>

<h4 id="7-3-5-3-创建列"><a href="#7-3-5-3-创建列" class="headerlink" title="7.3.5.3 创建列"></a>7.3.5.3 创建列</h4><p>要更新一个已存在的表，使用<code>Schema门面</code>上的<code>table</code>方法，和<code>create</code>方法一样，<code>table</code>方法接收两个参数：表名和获取用于添加列到表的<code>Blueprint</code>实例的闭包：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;string(&#x27;email&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>可用的列类型</strong></li>
</ul>
<p>当然，表结构构建器包含一系列你可以用来构建表的列类型：</p>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$table-&gt;bigIncrements(‘id’);</td>
<td align="left">自增ID，类型为bigint</td>
</tr>
<tr>
<td align="left">$table-&gt;bigInteger(‘votes’);</td>
<td align="left">等同于数据库中的BIGINT类型</td>
</tr>
<tr>
<td align="left">$table-&gt;binary(‘data’);</td>
<td align="left">等同于数据库中的BLOB类型</td>
</tr>
<tr>
<td align="left">$table-&gt;boolean(‘confirmed’);</td>
<td align="left">等同于数据库中的BOOLEAN类型</td>
</tr>
<tr>
<td align="left">$table-&gt;char(‘name’, 4);</td>
<td align="left">等同于数据库中的CHAR类型</td>
</tr>
<tr>
<td align="left">$table-&gt;date(‘created_at’);</td>
<td align="left">等同于数据库中的DATE类型</td>
</tr>
<tr>
<td align="left">$table-&gt;dateTime(‘created_at’);</td>
<td align="left">等同于数据库中的DATETIME类型</td>
</tr>
<tr>
<td align="left">$table-&gt;decimal(‘amount’, 5, 2);</td>
<td align="left">等同于数据库中的DECIMAL类型，带一个精度和范围</td>
</tr>
<tr>
<td align="left">$table-&gt;double(‘column’, 15, 8);</td>
<td align="left">等同于数据库中的DOUBLE类型，带精度, 总共15位数字，小数点后8位.</td>
</tr>
<tr>
<td align="left">$table-&gt;enum(‘choices’, [‘foo’, ‘bar’]);</td>
<td align="left">等同于数据库中的 ENUM类型</td>
</tr>
<tr>
<td align="left">$table-&gt;float(‘amount’);</td>
<td align="left">等同于数据库中的 FLOAT 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;increments(‘id’);</td>
<td align="left">数据库主键自增ID</td>
</tr>
<tr>
<td align="left">$table-&gt;integer(‘votes’);</td>
<td align="left">等同于数据库中的 INTEGER 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;json(‘options’);</td>
<td align="left">等同于数据库中的 JSON 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;jsonb(‘options’);</td>
<td align="left">等同于数据库中的 JSONB 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;longText(‘description’);</td>
<td align="left">等同于数据库中的 LONGTEXT 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;mediumInteger(‘numbers’);</td>
<td align="left">等同于数据库中的 MEDIUMINT类型</td>
</tr>
<tr>
<td align="left">$table-&gt;mediumText(‘description’);</td>
<td align="left">等同于数据库中的 MEDIUMTEXT类型</td>
</tr>
<tr>
<td align="left">$table-&gt;morphs(‘taggable’);</td>
<td align="left">添加一个 INTEGER类型的 <code>taggable_id</code> 列和一个 STRING类型的 <code>taggable_type</code>列</td>
</tr>
<tr>
<td align="left">$table-&gt;nullableTimestamps();</td>
<td align="left">和 <code>timestamps()</code>一样但允许 NULL值.</td>
</tr>
<tr>
<td align="left">$table-&gt;rememberToken();</td>
<td align="left">添加一个 <code>remember_token</code> 列： VARCHAR(100) NULL.</td>
</tr>
<tr>
<td align="left">$table-&gt;smallInteger(‘votes’);</td>
<td align="left">等同于数据库中的 SMALLINT 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;softDeletes();</td>
<td align="left">新增一个 deleted_at 列 用于软删除.</td>
</tr>
<tr>
<td align="left">$table-&gt;string(‘email’);</td>
<td align="left">等同于数据库中的 VARCHAR 列  .</td>
</tr>
<tr>
<td align="left">$table-&gt;string(‘name’, 100);</td>
<td align="left">等同于数据库中的 VARCHAR，带一个长度</td>
</tr>
<tr>
<td align="left">$table-&gt;text(‘description’);</td>
<td align="left">等同于数据库中的 TEXT 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;time(‘sunrise’);</td>
<td align="left">等同于数据库中的 TIME类型</td>
</tr>
<tr>
<td align="left">$table-&gt;tinyInteger(‘numbers’);</td>
<td align="left">等同于数据库中的 TINYINT 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;timestamp(‘added_on’);</td>
<td align="left">等同于数据库中的 TIMESTAMP 类型</td>
</tr>
<tr>
<td align="left">$table-&gt;timestamps();</td>
<td align="left">添加 <code>created_at</code> 和 <code>updated_at</code>列.</td>
</tr>
<tr>
<td align="left">$table-&gt;uuid(‘id’);</td>
<td align="left">等同于数据库的UUID</td>
</tr>
</tbody></table>
<h4 id="7-3-5-4-列修改器"><a href="#7-3-5-4-列修改器" class="headerlink" title="7.3.5.4 列修改器"></a>7.3.5.4 列修改器</h4><p>除了上面列出的列类型之外，在添加列的时候还可以使用一些其它列“修改器”。</p>
<p>例如:要使列默认为<code>null</code>，可以使用<code>nullable</code>方法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;string(&#x27;email&#x27;)-&gt;nullable();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>下面是所有可用的列修改器列表，该列表不包含索引修改器：</p>
<table>
<thead>
<tr>
<th align="left">修改器</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-&gt;first()</td>
<td align="left">将该列置为表中第一个列 (仅适用于MySQL)</td>
</tr>
<tr>
<td align="left">-&gt;after(‘column’)</td>
<td align="left">将该列置于另一个列之后 (仅适用于MySQL)</td>
</tr>
<tr>
<td align="left">-&gt;nullable()</td>
<td align="left">允许该列的值为NULL</td>
</tr>
<tr>
<td align="left">-&gt;default($value)</td>
<td align="left">指定列的默认值</td>
</tr>
<tr>
<td align="left">-&gt;unsigned()</td>
<td align="left">设置 <code>integer</code> 列为 <code>UNSIGNED</code></td>
</tr>
</tbody></table>
<h4 id="7-3-5-5-修改列"><a href="#7-3-5-5-修改列" class="headerlink" title="7.3.5.5 修改列"></a>7.3.5.5 修改列</h4><ul>
<li><p><strong>先决条件</strong></p>
<p>  在修改列之前，确保已经将<code>doctrine/dbal</code>依赖添加到<code>composer.json</code>文件，Doctrine DBAL 库用于判断列的当前状态并在需要时创建SQL查询来对列进行指定的调整。</p>
</li>
<li><p><strong>更新列属性</strong></p>
<p>  <code>change</code>方法允许你修改已存在的列为新的类型，或者修改列的属性。例如，你可能想要增加 string 类型列的尺寸，让我们将<code>name</code>列的尺寸从 25 增加到 50：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;string(&#x27;name&#x27;, 50)-&gt;change();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>  我们还可以修改该列允许 NULL 值：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;string(&#x27;name&#x27;, 50)-&gt;nullable()-&gt;change();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>重命名列</strong></p>
</li>
</ul>
<p>要重命名一个列，可以使用表结构构建器上的<code>renameColumn</code>方法，在重命名一个列之前，确保<code>doctrine/dbal</code>依赖已经添加到<code>composer.json</code>文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;renameColumn(&#x27;from&#x27;, &#x27;to&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>注意：暂不支持 enum类型的列的重命名。</em></p>
<h4 id="7-3-5-6-删除列"><a href="#7-3-5-6-删除列" class="headerlink" title="7.3.5.6 删除列"></a>7.3.5.6 删除列</h4><p>要删除一个列，使用表结构构建器上的<code>dropColumn</code>方法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;dropColumn(&#x27;votes&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>你可以传递列名数组到<code>dropColumn</code>方法从表中删除多个列：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Schema::table(&#x27;users&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;dropColumn([&#x27;votes&#x27;, &#x27;avatar&#x27;, &#x27;location&#x27;]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><em>注意：在从SQLite数据库删除列之前，需要添加<code>doctrine/dbal</code>依赖到<code>composer.json</code>文件并在终端中运行<code>composer update命</code>令来安装该库。此外，SQLite数据库暂不支持在单个迁移中删除或修改多个列。</em></p>
<h4 id="7-3-5-7-创建索引"><a href="#7-3-5-7-创建索引" class="headerlink" title="7.3.5.7 创建索引"></a>7.3.5.7 创建索引</h4><p>表结构构建器支持多种类型的索引，首先，让我们看一个指定列值为唯一索引的例子。要创建索引，可以使用<code>unique</code>方法：</p>
<pre><code>$table-&gt;string(&#39;email&#39;)-&gt;unique();
</code></pre>
<p>此外，你可以在定义列之后创建索引，例如：</p>
<pre><code>$table-&gt;unique(&#39;email&#39;);
</code></pre>
<p>你甚至可以传递列名数组到索引方法来创建组合索引：</p>
<pre><code>$table-&gt;index([&#39;account_id&#39;, &#39;created_at&#39;]);
</code></pre>
<p>Laravel 会自动生成合理的索引名称，但是你可以传递第二个参数到该方法用于指定索引名称：</p>
<pre><code>$table-&gt;index(&#39;email&#39;, &#39;my_index_name&#39;);
</code></pre>
<ul>
<li><p><strong>可用索引类型</strong></p>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$table-&gt;primary(‘id’);</td>
<td align="left">添加主键索引</td>
</tr>
<tr>
<td align="left">$table-&gt;primary([‘first’, ‘last’]);</td>
<td align="left">添加混合索引</td>
</tr>
<tr>
<td align="left">$table-&gt;unique(‘email’);</td>
<td align="left">添加唯一索引</td>
</tr>
<tr>
<td align="left">$table-&gt;unique(‘state’, ‘my_index_name’);</td>
<td align="left">指定自定义索引名称</td>
</tr>
<tr>
<td align="left">$table-&gt;index(‘state’);</td>
<td align="left">添加普通索引</td>
</tr>
</tbody></table>
</li>
</ul>
<h4 id="7-3-5-8-删除索引"><a href="#7-3-5-8-删除索引" class="headerlink" title="7.3.5.8 删除索引"></a>7.3.5.8 删除索引</h4><p>要删除索引，必须指定索引名。默认情况下，Laravel 自动分配适当的名称给索引——简单连接表名、列名和索引类型。下面是一些例子：</p>
<table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">$table-&gt;dropPrimary(‘users_id_primary’);</td>
<td align="left">从 “users”表中删除主键索引</td>
</tr>
<tr>
<td align="left">$table-&gt;dropUnique(‘users_email_unique’);</td>
<td align="left">从 “users”表中删除唯一索引</td>
</tr>
<tr>
<td align="left">$table-&gt;dropIndex(‘geo_state_index’);</td>
<td align="left">从 “geo”表中删除普通索引</td>
</tr>
</tbody></table>
<h4 id="7-3-5-9-外键约束"><a href="#7-3-5-9-外键约束" class="headerlink" title="7.3.5.9 外键约束"></a>7.3.5.9 外键约束</h4><p>Laravel 还提供了创建外键约束的支持，用于在数据库层面强制引用完整性。例如，我们在<code>posts</code>表中定义了一个引用<code>users</code>表的<code>id</code>列的<code>user_id</code>列：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Schema::table(&#x27;posts&#x27;, function ($table) &#123;</span><br><span class="line">    $table-&gt;integer(&#x27;user_id&#x27;)-&gt;unsigned();</span><br><span class="line">    $table-&gt;foreign(&#x27;user_id&#x27;)-&gt;references(&#x27;id&#x27;)-&gt;on(&#x27;users&#x27;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>你还可以为约束的<code>on delete</code>和<code>on update</code>属性指定期望的动作：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$table-&gt;foreign(&#x27;user_id&#x27;)</span><br><span class="line">      -&gt;references(&#x27;id&#x27;)-&gt;on(&#x27;users&#x27;)</span><br><span class="line">      -&gt;onDelete(&#x27;cascade&#x27;);</span><br></pre></td></tr></table></figure>

<p>要删除一个外键，可以使用<code>dropForeign</code>方法。外键约束和索引使用同样的命名规则——连接表名、外键名然后加上<code>_foreign</code>后缀：</p>
<pre><code>$table-&gt;dropForeign(&#39;posts_user_id_foreign&#39;);
</code></pre>
<hr>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第八章 第二节</title>
    <url>/2016/07/26/331b08b4c413/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="8-2-关联关系"><a href="#8-2-关联关系" class="headerlink" title="8.2 关联关系"></a>8.2 关联关系</h2><h3 id="8-2-1-简介"><a href="#8-2-1-简介" class="headerlink" title="8.2.1 简介"></a>8.2.1 简介</h3><p>数据表经常要与其它表做关联，比如一篇博客文章可能有很多评论，或者一个订单会被关联到下单用户，Eloquent 使得组织和处理这些关联关系变得简单，并且支持多种不同类型的关联关系：</p>
<ul>
<li>一对一</li>
<li>一对多</li>
<li>多对多</li>
<li>远层一对多</li>
<li>多态关联</li>
<li>多对多的多态关联</li>
</ul>
<hr>
<h3 id="8-2-2-定义关联关系"><a href="#8-2-2-定义关联关系" class="headerlink" title="8.2.2 定义关联关系"></a>8.2.2 定义关联关系</h3><p>Eloquent 关联关系以Eloquent模型类方法的形式被定义。和 Eloquent 模型本身一样，关联关系也是强大的查询构建器，定义关联关系为函数能够提供功能强大的方法链和查询能力。</p>
<p>例如：</p>
<pre><code>$user-&gt;posts()-&gt;where(&#39;active&#39;, 1)-&gt;get();
</code></pre>
<p>但是，在深入使用关联关系之前，让我们先学习如何定义每种关联类型。</p>
<h4 id="8-2-2-1-一对一"><a href="#8-2-2-1-一对一" class="headerlink" title="8.2.2.1 一对一"></a>8.2.2.1 一对一</h4><p>一对一关联是一个非常简单的关联关系，例如，一个<code>User</code>模型有一个与之对应的<code>Phone</code>模型。要定义这种模型，我们需要将<code>phone</code>方法置于<code>User</code>模型中，<code>phone</code>方法应该返回 Eloquent 模型基类,上的<code>hasOne</code><br>方法：</p>
<p>在User模型中，使用<code>hasOne</code>方法，设置<code>photo</code>方法的访问。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取关联到用户的手机</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">phone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasOne(<span class="string">&#x27;App\Phone&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>传递给<code>hasOne</code>方法的第一个参数是关联模型的名称，关联关系被定义后，我们可以使用 Eloquent 的动态属性获取关联记录。</p>
<p>动态属性允许我们访问关联函数就像它们是定义在模型上的属性一样：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$phone</span> = User::find(<span class="number">1</span>)-&gt;phone;</span><br></pre></td></tr></table></figure>
<p>Eloquent 默认关联关系的外键基于模型名称，在本例中，<code>Phone</code>模型默认有一个<code>user_id</code>外键，如果你希望重写这种约定，可以传递第二个参数到<code>hasOne</code>方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasOne(<span class="string">&#x27;App\Phone&#x27;</span>, <span class="string">&#x27;foreign_key&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>此外，Eloquent 假设外键应该在父级上有一个与之匹配的<code>id</code>，换句话说，Eloquent 将会通过<code>user</code>表的<code>id</code>值去<code>phone</code>表中查询<code>user_id</code>与之匹配的<code>Phone</code>记录。</p>
<p>如果你想要关联关系使用其他值而不是<code>id</code>，可以传递第三个参数到<code>hasOne</code>来指定自定义的主键：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">return $this-&gt;hasOne(&#x27;App\Phone&#x27;, &#x27;foreign_key&#x27;, &#x27;local_key&#x27;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>定义相对的关联</strong></p>
<p>  我们可以从<code>User</code>中访问<code>Phone</code>模型，相应的，我们也可以在<code>Phone</code>模型中定义关联关系从而让我们可以拥有该<code>phone</code>的<code>User</code>。我们可以使用<code>belongsTo</code>方法定义与<code>hasOne</code>关联关系相对的关联：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取手机对应的用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(<span class="string">&#x27;App\User&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  在上面的例子中，Eloquent 将会尝试通过<code>Phone</code>模型的<code>user_id</code>去<code>User</code>模型查找与之匹配的记录。Eloquent 通过关联关系方法名并在方法名后加<code>_id</code>后缀来生成默认的外键名。然而，如果<code>Phone</code>模型上的外键不是<code>user_id</code>，也可以将自定义的键名作为第二个参数传递到<code>belongsTo</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取手机对应的用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(<span class="string">&#x27;App\User&#x27;</span>, <span class="string">&#x27;foreign_key&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  如果父模型不使用id作为主键，或者你希望使用别的列来连接子模型，可以将父表自定义键作为第三个参数传递给belongsTo方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取手机对应的用户</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(<span class="string">&#x27;App\User&#x27;</span>, <span class="string">&#x27;foreign_key&#x27;</span>, <span class="string">&#x27;other_key&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-2-2-2-一对多"><a href="#8-2-2-2-一对多" class="headerlink" title="8.2.2.2 一对多"></a>8.2.2.2 一对多</h4><p>“一对多”是用于定义单个模型拥有多个其它模型的关联关系。</p>
<p>例如，一篇博客文章拥有无数评论，和其他关联关系一样，一对多关联通过在 Eloquent 模型中定义方法来定义：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取博客文章的评论</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">comments</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(<span class="string">&#x27;App\Comment&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>记住，Eloquent 会自动判断<code>Comment</code>模型的外键，为方便起见，Eloquent 将拥有者模型名称加上<code>id</code>后缀作为外键。因此，在本例中，Eloquent 假设<code>Comment</code>模型上的外键是<code>post_id</code>。</p>
<p>关联关系被定义后，我们就可以通过访问<code>comments</code>属性来访问评论集合。记住，由于 Eloquent 提供“动态属性”，我们可以像访问模型的属性一样访问关联方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$comments</span> = App\Post::find(<span class="number">1</span>)-&gt;comments;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$comments</span> <span class="keyword">as</span> <span class="variable">$comment</span>) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，由于所有关联同时也是查询构建器，我们可以添加更多的条件约束到通过调用<code>comments</code>方法获取到的评论上：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$comments = App\Post::find(1)-&gt;comments()-&gt;where(&#x27;title&#x27;, &#x27;foo&#x27;)-&gt;first();</span><br></pre></td></tr></table></figure>
<p>和<code>hasOne</code>方法一样，你还可以通过传递额外参数到<code>hasMany</code>方法来重新设置外键和本地主键：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">return $this-&gt;hasMany(&#x27;App\Comment&#x27;, &#x27;foreign_key&#x27;);</span><br><span class="line">return $this-&gt;hasMany(&#x27;App\Comment&#x27;, &#x27;foreign_key&#x27;, &#x27;local_key&#x27;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>定义相对的关联</strong></p>
<p>  现在我们可以访问文章的所有评论了，接下来让我们定义一个关联关系允许通过评论访问所属文章。要定义与<code>hasMany</code>相对的关联关系，需要在子模型中定义一个关联方法去调用<code>belongsTo</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取评论对应的博客文章</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(<span class="string">&#x27;App\Post&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  关联关系定义好之后，我们可以通过访问动态属性<code>post</code>来获取一条<code>Comment</code>对应的<code>Post</code>：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$comment</span> = App\Comment::find(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$comment</span>-&gt;post-&gt;title;</span><br></pre></td></tr></table></figure>
<p>  在上面这个例子中，Eloquent 尝试匹配<code>Comment</code>模型的<code>post_id</code>与<code>Post</code>模型的<code>id</code>，Eloquent 通过关联方法名加上<code>_id</code>后缀生成默认外键，当然，你也可以通过传递自定义外键名作为第二个参数传递到<code>belongsTo</code>方法，如果你的外键不是<code>post_id</code>，或者你想自定义的话：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取评论对应的博客文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(<span class="string">&#x27;App\Post&#x27;</span>, <span class="string">&#x27;foreign_key&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  如果你的父模型不使用<code>id</code>作为主键，或者你希望通过其他列来连接子模型，可以将自定义键名作为第三个参数传递给<code>belongsTo</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取评论对应的博客文章</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(<span class="string">&#x27;App\Post&#x27;</span>, <span class="string">&#x27;foreign_key&#x27;</span>, <span class="string">&#x27;other_key&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-2-2-3-多对多"><a href="#8-2-2-3-多对多" class="headerlink" title="8.2.2.3 多对多"></a>8.2.2.3 多对多</h4><p>多对多关系比<code>hasOne</code>和<code>hasMany</code>关联关系要稍微复杂一些。</p>
<p>这种关联关系的一个例子就是一个用户有多个角色，同时一个角色被多个用户共用。例如，很多用户可能都有一个<code>Admin</code>角色。要定义这样的关联关系，需要三个数据表：<code>users</code>、<code>roles</code>和<code>role_user</code>，<code>role_user</code>表按照关联模型名的字母顺序命名，并且包含<code>user_id</code>和<code>role_id</code>两个列。</p>
<p>多对多关联通过编写一个调用 Eloquent 基类上的<code>belongsToMany</code>方法的函数来定义：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户角色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">roles</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(<span class="string">&#x27;App\Role&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关联关系被定义之后，可以使用动态属性<code>roles</code>来访问用户的角色：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = App\User::find(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span>-&gt;roles <span class="keyword">as</span> <span class="variable">$role</span>) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当然，和所有其它关联关系类型一样，你可以调用<code>roles</code>方法来添加条件约束到关联查询上：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$roles</span> = App\User::find(<span class="number">1</span>)-&gt;roles()-&gt;orderBy(<span class="string">&#x27;name&#x27;</span>)-&gt;get();</span><br></pre></td></tr></table></figure>
<p>正如前面所提到的，为了决定关联关系连接表的表名，Eloquent以字母顺序连接两个关联模型的名字。然而，你可以重写这种约定——通过传递第二个参数到<code>belongsToMany</code>方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(<span class="string">&#x27;App\Role&#x27;</span>, <span class="string">&#x27;user_roles&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>除了自定义连接表的表名，你还可以通过传递额外参数到<code>belongsToMany</code>方法来自定义该表中字段的列名。</p>
<p>第三个参数是你定义的关系模型的外键名称，第四个参数你要连接到的模型的外键名称：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(<span class="string">&#x27;App\Role&#x27;</span>, <span class="string">&#x27;user_roles&#x27;</span>, <span class="string">&#x27;user_id&#x27;</span>, <span class="string">&#x27;role_id&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>定义相对的关联关系</strong></p>
<p>  要定义与多对多关联相对的关联关系，只需在关联模型中在调用一下<code>belongsToMany</code>方法即可。让我们在<code>Role</code>模型中定义<code>users</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Role</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 角色用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">users</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(<span class="string">&#x27;App\User&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  正如你所看到的，定义的关联关系和与其对应的<code>User</code>中定义的一模一样，只是前者引用<code>App\Role</code>，后者引用<code>App\User</code>，由于我们再次使用了<code>belongsToMany</code>方法，所有的常用表和键自定义选项在定义与多对多相对的关联关系时都是可用的。</p>
</li>
<li><p><strong>获取中间表的列</strong></p>
<p>  正如你已经学习到的，处理多对多关联要求一个中间表。Eloquent 提供了一些有用的方法来与其进行交互。</p>
<p>  例如，我们假设<code>User</code>对象有很多与之关联的<code>Role</code>对象，访问这些关联关系之后，我们可以使用模型上的<code>pivot</code>属性访问中间表：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = App\User::find(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span>-&gt;roles <span class="keyword">as</span> <span class="variable">$role</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$role</span>-&gt;pivot-&gt;created_at;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  注意我们获取到的每一个<code>Role</code>模型都被自动赋上了<code>pivot</code>属性。该属性包含一个代表中间表的模型，并且可以像其它 Eloquent 模型一样使用。</p>
<p>  默认情况下，只有模型键才能用在pivot对象上，如果你的pivot表包含额外的属性，必须在定义关联关系时进行指定：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(<span class="string">&#x27;App\Role&#x27;</span>)-&gt;withPivot(<span class="string">&#x27;column1&#x27;</span>, <span class="string">&#x27;column2&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>  如果你想要你的<code>pivot</code>表自动包含<code>created_at</code>和<code>updated_at</code>时间戳，在关联关系定义时使用<code>withTimestamps</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(<span class="string">&#x27;App\Role&#x27;</span>)-&gt;withTimestamps();</span><br></pre></td></tr></table></figure></li>
<li><p><strong>定义中间表过滤</strong></p>
<p>  你还可以对<code>belongsToMany</code>的返回结果使用<code>wherePivot</code>与<code>wherePivotIn</code>过滤：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(<span class="string">&#x27;App\Role&#x27;</span>)-&gt;wherePivot(<span class="string">&#x27;approved&#x27;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsToMany(<span class="string">&#x27;App\Role&#x27;</span>)-&gt;wherePivotIn(<span class="string">&#x27;approved&#x27;</span>, [<span class="number">1</span>, <span class="number">2</span>]);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-2-2-4-远层的一对多"><a href="#8-2-2-4-远层的一对多" class="headerlink" title="8.2.2.4 远层的一对多"></a>8.2.2.4 远层的一对多</h4><p>“远层一对多”关联为通过中间关联访问远层的关联关系提供了一个便利之道。</p>
<p>例如：<code>Country</code>模型通过中间的<code>User</code>模型可能拥有多个<code>Post</code>模型。在这个例子中，你可以轻易的找到给定国家的所有文章，让我们看看定义这个关联关系需要哪些表：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">countries</span><br><span class="line">    id - integer</span><br><span class="line">    name - string</span><br><span class="line"></span><br><span class="line">users</span><br><span class="line">    id - integer</span><br><span class="line">    country_id - integer</span><br><span class="line">    name - string</span><br><span class="line"></span><br><span class="line">posts</span><br><span class="line">    id - integer</span><br><span class="line">    user_id - integer</span><br><span class="line">    title - string</span><br></pre></td></tr></table></figure>
<p>尽管<code>posts</code>表不包含<code>country_id</code>列，<code>hasManyThrough</code>关联提供了通过<code>$country-&gt;posts</code>来访问一个国家的所有文章。</p>
<p>要执行该查询，Eloquent 在中间表<code>$users</code>上检查<code>country_id</code>，查找到相匹配的用户<code>ID</code>后，通过用户<code>ID</code>来查询<code>posts</code>表。</p>
<p>既然我们已经查看了该关联关系的数据表结构，接下来让我们在<code>Country</code>模型上进行定义：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Country</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取指定国家的所有文章</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">posts</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasManyThrough(<span class="string">&#x27;App\Post&#x27;</span>, <span class="string">&#x27;App\User&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第一个传递到<code>hasManyThrough</code>方法的参数是最终我们希望访问的模型的名称，第二个参数是中间模型名称。</p>
<p>当执行这种关联查询时通常 Eloquent 外键规则会被使用，如果你想要自定义该关联关系的外键，可以将它们作为第三个、第四个参数传递给<code>hasManyThrough</code>方法。第三个参数是中间模型的外键名，第四个参数是最终模型的外键名。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Country</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">posts</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasManyThrough(<span class="string">&#x27;App\Post&#x27;</span>, <span class="string">&#x27;App\User&#x27;</span>, <span class="string">&#x27;country_id&#x27;</span>, <span class="string">&#x27;user_id&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-2-2-5-多态关联"><a href="#8-2-2-5-多态关联" class="headerlink" title="8.2.2.5 多态关联"></a>8.2.2.5 多态关联</h4><ul>
<li><strong>表结构</strong></li>
</ul>
<p>多态关联允许一个模型在单个关联下属于多个不同模型。</p>
<p>例如，假如应用用户可以对文章点赞也可以对评论点赞，使用多态关联，你可以在这两种场景下使用单个<code>likes</code>表，首先，让我们看看构建这种关联关系需要的表结构：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">posts</span><br><span class="line">    id - integer</span><br><span class="line">    title - string</span><br><span class="line">    body - text</span><br><span class="line"></span><br><span class="line">comments</span><br><span class="line">    id - integer</span><br><span class="line">    post_id - integer</span><br><span class="line">    body - text</span><br><span class="line"></span><br><span class="line">likes</span><br><span class="line">    id - integer</span><br><span class="line">    likeable_id - integer</span><br><span class="line">    likeable_type - string</span><br></pre></td></tr></table></figure>
<p>两个重要的需要注意的列是 <code>likes</code> 表上的 <code>likeable_id</code> 和 <code>likeable_type</code>。</p>
<p><code>likeable_id</code>列对应 <code>Post</code> 或 <code>Comment</code> 的 <code>ID</code> 值，而 <code>likeable_type</code> 列对应所属模型的类名。当访问 <code>likeable</code> 关联时，ORM 根据 <code>likeable_type</code> 列来判断所属模型的类型并返回相应模型实例。</p>
<ul>
<li><p><strong>模型结构</strong></p>
<p>  接下来，让我们看看构建这种关联关系需要在模型中定义什么：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Like</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所属的likeable模型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">likeable</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphTo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取该文章的所有点赞</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">likes</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphMany(<span class="string">&#x27;App\Like&#x27;</span>, <span class="string">&#x27;likeable&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取该评论的所有点赞</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">likes</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphMany(<span class="string">&#x27;App\Like&#x27;</span>, <span class="string">&#x27;likeable&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>获取多态关联</strong></p>
<p>  数据表和模型定义好以后，可以通过模型访问关联关系。</p>
<p>  例如，要访问一篇文章的所有点赞，可以通过使用动态属性likes ：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$post</span> = App\Post::find(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$post</span>-&gt;likes <span class="keyword">as</span> <span class="variable">$like</span>) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  你还可以通过调用 <code>morphTo</code> 方法从多态模型中获取多态关联的所属对象。在本例中，就是 <code>Like</code> 模型中的 <code>likeable</code> 方法。因此，我们可以用动态属性的方式访问该方法：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$like = App\Like::find(1);</span><br><span class="line">$likeable = $like-&gt;likeable;</span><br></pre></td></tr></table></figure>
<p>  <code>Like</code> 模型的 <code>likeable</code> 关联返回 <code>Post</code> 或 <code>Comment</code> 实例，这取决于哪个类型的模型拥有该点赞。</p>
</li>
</ul>
<h4 id="8-2-2-6-多对多的多态关联"><a href="#8-2-2-6-多对多的多态关联" class="headerlink" title="8.2.2.6 多对多的多态关联"></a>8.2.2.6 多对多的多态关联</h4><ul>
<li><p><strong>表结构</strong></p>
<p>  除了传统的多态关联，还可以定义“多对多”的多态关联，例如，一个博客的 <code>Post</code> 和 <code>Video</code> 模型可能共享一个 <code>Tag</code> 模型的多态关联。</p>
<p>  使用多对多的多态关联允许你在博客文章和视频之间有唯一的标签列表。</p>
<p>  首先，让我们看看表结构：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">posts</span><br><span class="line">    id - integer</span><br><span class="line">    name - string</span><br><span class="line"></span><br><span class="line">videos</span><br><span class="line">    id - integer</span><br><span class="line">    name - string</span><br><span class="line"></span><br><span class="line">tags</span><br><span class="line">    id - integer</span><br><span class="line">    name - string</span><br><span class="line"></span><br><span class="line">taggables</span><br><span class="line">    tag_id - integer</span><br><span class="line">    taggable_id - integer</span><br><span class="line">    taggable_type - string</span><br></pre></td></tr></table></figure></li>
<li><p><strong>模型结构</strong></p>
<p>  接下来，我们准备在模型中定义该关联关系。<code>Post</code> 和 <code>Video</code> 模型都有一个 <code>tags</code> 方法调用 Eloquent 基类的 <code>morphToMany</code> 方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取指定文章所有标签</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">tags</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphToMany(<span class="string">&#x27;App\Tag&#x27;</span>, <span class="string">&#x27;taggable&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>定义相对的关联关系</strong></p>
<p>  接下来，在<code>Tag</code>模型中，应该为每一个关联模型定义一个方法。</p>
<p>  例如，我们定义一个<code>posts</code>方法和<code>videos</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tag</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有分配该标签的文章</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">posts</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphedByMany(<span class="string">&#x27;App\Post&#x27;</span>, <span class="string">&#x27;taggable&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取分配该标签的所有视频</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">videos</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;morphedByMany(<span class="string">&#x27;App\Video&#x27;</span>, <span class="string">&#x27;taggable&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>获取关联关系</strong></p>
<p>  定义好数据库和模型后可以通过模型访问关联关系。</p>
<p>  例如，要访问一篇文章的所有标签，可以使用动态属性tags：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$post</span> = App\Post::find(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$post</span>-&gt;tags <span class="keyword">as</span> <span class="variable">$tag</span>) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  还可以通过访问调用<code>morphedByMany</code>的方法名从多态模型中获取多态关联的所属对象。</p>
<p>  在本例中，就是<code>Tag</code>模型中的<code>posts</code>或者<code>videos</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$tag</span> = App\Tag::find(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$tag</span>-&gt;videos <span class="keyword">as</span> <span class="variable">$video</span>) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="8-2-3-关联查询"><a href="#8-2-3-关联查询" class="headerlink" title="8.2.3 关联查询"></a>8.2.3 关联查询</h3><p>由于 Eloquent 所有关联关系都是通过函数定义，你可以调用这些方法来获取关联关系的实例而不需要再去手动执行关联查询。此外，所有 Eloquent 关联关系类型同时也是查询构建器，允许你在最终在数据库执行 SQL 之前继续添加条件约束到关联查询上。</p>
<p>例如，假定在一个博客系统中一个 User 模型有很多相关的 Post 模型：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取指定用户的所有文章</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">posts</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(<span class="string">&#x27;App\Post&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你可以像这样查询<code>posts</code>关联并添加额外的条件约束到该关联关系上：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$user = App\User::find(1);</span><br><span class="line">$user-&gt;posts()-&gt;where(&#x27;active&#x27;, 1)-&gt;get();</span><br></pre></td></tr></table></figure>

<h4 id="8-2-3-1-关联关系方法-VS-动态属性"><a href="#8-2-3-1-关联关系方法-VS-动态属性" class="headerlink" title="8.2.3.1 关联关系方法 VS 动态属性"></a>8.2.3.1 关联关系方法 VS 动态属性</h4><p>如果你不需要添加额外的条件约束到 Eloquent 关联查询，你可以简单通过动态属性来访问关联对象。</p>
<p>例如，还是拿<code>User</code>和<code>Post</code>模型作为例子，你可以像这样访问所有用户的文章：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = App\User::find(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$user</span>-&gt;posts <span class="keyword">as</span> <span class="variable">$post</span>) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>动态属性就是“懒惰式加载”，意味着当你真正访问它们的时候才会加载关联数据。</p>
<p>正因为如此，开发者经常使用渴求式加载来预加载他们知道在加载模型时要被访问的关联关系。</p>
<p>渴求式加载有效减少了必须要被执以加载模型关联的 SQL 查询。</p>
<h4 id="8-2-3-2-查询已存在的关联关系"><a href="#8-2-3-2-查询已存在的关联关系" class="headerlink" title="8.2.3.2 查询已存在的关联关系"></a>8.2.3.2 查询已存在的关联关系</h4><p>访问一个模型的记录的时候，你可能希望基于关联关系是否存在来限制查询结果的数目。</p>
<p>例如，假设你想要获取所有至少有一个评论的博客文章，要实现这个，可以传递关联关系的名称到<code>has</code>方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取所有至少有一条评论的文章...</span></span><br><span class="line"><span class="variable">$posts</span> = App\Post::has(<span class="string">&#x27;comments&#x27;</span>)-&gt;get();</span><br></pre></td></tr></table></figure>
<p>你还可以指定操作符和大小来自定义查询：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取所有至少有三条评论的文章...</span></span><br><span class="line"><span class="variable">$posts</span> = Post::has(<span class="string">&#x27;comments&#x27;</span>, <span class="string">&#x27;&gt;=&#x27;</span>, <span class="number">3</span>)-&gt;get();</span><br></pre></td></tr></table></figure>
<p>还可以使用<code>.</code>来构造嵌套<code>has</code>语句。</p>
<p>例如，你要获取所有至少有一条评论及投票的所有文章：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取所有至少有一条评论获得投票的文章...</span></span><br><span class="line"><span class="variable">$posts</span> = Post::has(<span class="string">&#x27;comments.votes&#x27;</span>)-&gt;get();</span><br></pre></td></tr></table></figure>
<p>如果你需要更强大的功能，可以使用<code>whereHas</code>和<code>orWhereHas</code>方法将<code>where</code>条件放到<code>has</code>查询上，这些方法允许你添加自定义条件约束到关联关系条件约束，例如检查一条评论的内容：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取所有至少有一条评论包含foo字样的文章</span></span><br><span class="line"><span class="variable">$posts</span> = Post::whereHas(<span class="string">&#x27;comments&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;content&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;foo%&#x27;</span>);</span><br><span class="line">&#125;)-&gt;get();</span><br></pre></td></tr></table></figure>

<h4 id="8-2-3-3-渴求式加载"><a href="#8-2-3-3-渴求式加载" class="headerlink" title="8.2.3.3 渴求式加载"></a>8.2.3.3 渴求式加载</h4><p>当以属性方式访问数据库关联关系的时候，关联关系数据是<code>懒惰式加载</code>的，这意味着关联关系数据直到第一次访问的时候才被加载。</p>
<p>然而，Eloquent 可以在查询父级模型的同时，<code>渴求式加载</code>关联关系。渴求式加载缓解了<code>N+1</code>查询问题，要阐明<code>N+1</code>查询问题，考虑下关联到<code>Author</code>的<code>Book</code>模型：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取写这本书的作者</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">author</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(<span class="string">&#x27;App\Author&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，让我们获取所有书及其作者：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$books</span> = App\Book::all();</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$books</span> <span class="keyword">as</span> <span class="variable">$book</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$book</span>-&gt;author-&gt;name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该循环先执行1次查询获取表中的所有书，然后另一个查询获取每一本书的作者，因此，如果有25本书，要执行26次查询：1次是获取书本身，剩下的25次查询是为每一本书获取其作者。</p>
<p>谢天谢地，我们可以使用渴求式加载来减少该操作到2次查询。当查询的时候，可以使用<code>with</code>方法指定应该被渴求式加载的关联关系：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$books</span> = App\Book::with(<span class="string">&#x27;author&#x27;</span>)-&gt;get();</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$books</span> <span class="keyword">as</span> <span class="variable">$book</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$book</span>-&gt;author-&gt;name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在该操作中，只执行两次查询即可：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">select * from books</span><br><span class="line">select * from authors where id in (1, 2, 3, 4, 5, ...)</span><br></pre></td></tr></table></figure>


<ul>
<li><p><strong>渴求式加载多个关联关系</strong></p>
<p>  有时候你需要在单个操作中渴求式加载几个不同的关联关系。要实现这个，只需要添加额外的参数到<code>with</code>方法即可：</p>
<pre><code>  $books = App\Book::with(&#39;author&#39;, &#39;publisher&#39;)-&gt;get();
</code></pre>
</li>
<li><p><strong>嵌套的渴求式加载</strong></p>
<p>  要渴求式加载嵌套的关联关系，可以使用<code>.</code>语法。例如，让我们在一个Eloquent语句中渴求式加载所有书的作者及所有作者的个人联系方式：</p>
<pre><code>  $books = App\Book::with(&#39;author.contacts&#39;)-&gt;get();
</code></pre>
</li>
</ul>
<h4 id="8-2-3-4-带条件约束的渴求式加载"><a href="#8-2-3-4-带条件约束的渴求式加载" class="headerlink" title="8.2.3.4 带条件约束的渴求式加载"></a>8.2.3.4 带条件约束的渴求式加载</h4><p>有时候我们希望渴求式加载一个关联关系，但还想为渴求式加载指定更多的查询条件：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = App\User::with([<span class="string">&#x27;posts&#x27;</span> =&gt; <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;where(<span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;like&#x27;</span>, <span class="string">&#x27;%first%&#x27;</span>);</span><br><span class="line">&#125;])-&gt;get();</span><br></pre></td></tr></table></figure>
<p>在这个例子中，Eloquent 只渴求式加载 title 包含 first 的文章。当然，你可以调用其它查询构建器来自定义渴求式加载操作：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = App\User::with([<span class="string">&#x27;posts&#x27;</span> =&gt; <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;orderBy(<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>);</span><br><span class="line">&#125;])-&gt;get();</span><br></pre></td></tr></table></figure>

<h4 id="8-2-3-5-懒惰渴求式加载"><a href="#8-2-3-5-懒惰渴求式加载" class="headerlink" title="8.2.3.5 懒惰渴求式加载"></a>8.2.3.5 懒惰渴求式加载</h4><p>有时候你需要在父模型已经被获取后,渴求式加载一个关联关系。</p>
<p>例如，这在你需要动态决定是否加载关联模型时可能很有用：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$books</span> = App\Book::all();</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$someCondition</span>) &#123;</span><br><span class="line">    <span class="variable">$books</span>-&gt;load(<span class="string">&#x27;author&#x27;</span>, <span class="string">&#x27;publisher&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果你需要设置更多的查询条件到渴求式加载查询上，可以传递一个闭包到<code>load</code>方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$books</span>-&gt;load([<span class="string">&#x27;author&#x27;</span> =&gt; <span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$query</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$query</span>-&gt;orderBy(<span class="string">&#x27;published_date&#x27;</span>, <span class="string">&#x27;asc&#x27;</span>);</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="8-2-4-插入关联模型"><a href="#8-2-4-插入关联模型" class="headerlink" title="8.2.4 插入关联模型"></a>8.2.4 插入关联模型</h3><h4 id="8-2-4-1-基本使用"><a href="#8-2-4-1-基本使用" class="headerlink" title="8.2.4.1 基本使用"></a>8.2.4.1 基本使用</h4><ul>
<li><p><strong>save方法</strong></p>
<p>  Eloquent 提供了便利的方法来添加新模型到关联关系。</p>
<p>  例如，也许你需要插入新的<code>Comment</code>到<code>Post</code>模型，你可以从关联关系的<code>save</code>方法直接插入<code>Comment</code>而不是手动设置<code>Comment</code>的<code>post_id</code>属性：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$comment</span> = <span class="keyword">new</span> App\Comment([<span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;A new comment.&#x27;</span>]);</span><br><span class="line"><span class="variable">$post</span> = App\Post::find(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$post</span>-&gt;comments()-&gt;save(<span class="variable">$comment</span>);</span><br></pre></td></tr></table></figure>
<p>  注意我们没有用动态属性方式访问<code>comments</code>，而是调用<code>comments</code>方法获取关联关系实例。<code>save</code>方法会自动添加<code>post_id</code>值到新的<code>Comment</code>模型。</p>
<p>  如果你需要保存多个关联模型，可以使用<code>saveMany</code>方法：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$post = App\Post::find(1);</span><br><span class="line"></span><br><span class="line">$post-&gt;comments()-&gt;saveMany([</span><br><span class="line">    new App\Comment([&#x27;message&#x27; =&gt; &#x27;A new comment.&#x27;]),</span><br><span class="line">    new App\Comment([&#x27;message&#x27; =&gt; &#x27;Another comment.&#x27;]),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>save &amp; 多对多关联</strong></p>
<p>  当处理多对多关联的时候，<code>save</code>方法以数组形式接收额外的中间表属性作为第二个参数：</p>
<pre><code>  App\User::find(1)-&gt;roles()-&gt;save($role, [&#39;expires&#39; =&gt; $expires]);
</code></pre>
</li>
<li><p><strong>create方法</strong></p>
<p>  除了<code>save</code>和<code>saveMany</code>方法外，还可以使用<code>create</code>方法，该方法接收属性数组、创建模型、然后插入数据库。<code>save</code>和<code>create</code>的不同之处在于<code>save</code>接收整个Eloquent模型实例而<code>create</code>接收原生PHP数组：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$post</span> = App\Post::find(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$comment</span> = <span class="variable">$post</span>-&gt;comments()-&gt;create([</span><br><span class="line">    <span class="string">&#x27;message&#x27;</span> =&gt; <span class="string">&#x27;A new comment.&#x27;</span>,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p>  使用<code>create</code>方法之前确保先浏览属性[批量赋值]文档(<a href="http://laravelacademy.org/post/2995.html)%E3%80%82">http://laravelacademy.org/post/2995.html)。</a></p>
</li>
</ul>
<h4 id="8-2-4-2-更新”属于“关联"><a href="#8-2-4-2-更新”属于“关联" class="headerlink" title="8.2.4.2 更新”属于“关联"></a>8.2.4.2 更新”属于“关联</h4><p>更新<code>belongsTo</code>关联的时候，可以使用<code>associate</code>方法，该方法会在子模型设置外键：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$account</span> = App\Account::find(<span class="number">10</span>);</span><br><span class="line"><span class="variable">$user</span>-&gt;account()-&gt;associate(<span class="variable">$account</span>);</span><br><span class="line"><span class="variable">$user</span>-&gt;save();</span><br></pre></td></tr></table></figure>
<p>移除<code>belongsTo</code>关联的时候，可以使用<code>dissociate</code>方法。该方法在子模型上取消外键和关联：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span>-&gt;account()-&gt;dissociate();</span><br><span class="line"><span class="variable">$user</span>-&gt;save();</span><br></pre></td></tr></table></figure>

<h4 id="8-2-4-3-多对多关联"><a href="#8-2-4-3-多对多关联" class="headerlink" title="8.2.4.3 多对多关联"></a>8.2.4.3 多对多关联</h4><ul>
<li><p><strong>附加/分离</strong></p>
<p>  处理多对多关联的时候，Eloquent提供了一些额外的帮助函数来使得处理关联模型变得更加方便。</p>
<p>  例如，让我们假定一个用户可能有多个角色同时一个角色属于多个用户，要通过在连接模型的中间表中插入记录附加角色到用户上，可以使用<code>attach</code>方法：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = App\User::find(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$user</span>-&gt;roles()-&gt;attach(<span class="variable">$roleId</span>);</span><br></pre></td></tr></table></figure>
<p>  附加关联关系到模型，还可以以数组形式传递额外被插入数据到中间表：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$user-&gt;roles()-&gt;attach($roleId, [&#x27;expires&#x27; =&gt; $expires]);</span><br></pre></td></tr></table></figure>
<p>  当然，有时候有必要从用户中移除角色，要移除一个多对多关联记录，使用<code>detach</code>方法。<code>detach</code>方法将会从中间表中移除相应的记录；然而，两个模型在数据库中都保持不变：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 从指定用户中移除角色...</span><br><span class="line">$user-&gt;roles()-&gt;detach($roleId);</span><br><span class="line">// 从指定用户移除所有角色...</span><br><span class="line">$user-&gt;roles()-&gt;detach();</span><br></pre></td></tr></table></figure>
<p>  为了方便，<code>attach</code>和<code>detach</code>还接收数组形式的 ID 作为输入：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$user = App\User::find(1);</span><br><span class="line">$user-&gt;roles()-&gt;detach([1, 2, 3]);</span><br><span class="line">$user-&gt;roles()-&gt;attach([1 =&gt; [&#x27;expires&#x27; =&gt; $expires], 2, 3]);</span><br></pre></td></tr></table></figure></li>
<li><p><strong>同步</strong></p>
<p>  你还可以使用<code>sync</code>方法构建多对多关联。<code>sync</code>方法接收数组形式的<code>ID</code>并将其放置到中间表。任何不在该数组中的<code>ID</code>对应记录将会从中间表中移除。因此，该操作完成后，只有在数组中的<code>ID</code>对应记录还存在于中间表：</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$user-&gt;roles()-&gt;sync([1, 2, 3]);</span><br></pre></td></tr></table></figure>
<p>  你还可以和ID一起传递额外的中间表值:</p>
  <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$user-&gt;roles()-&gt;sync([1 =&gt; [&#x27;expires&#x27; =&gt; true], 2, 3]);</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="8-2-4-4-触发父级时间戳"><a href="#8-2-4-4-触发父级时间戳" class="headerlink" title="8.2.4.4 触发父级时间戳"></a>8.2.4.4 触发父级时间戳</h4><p>当一个模型属于另外一个时，例如<code>Comment</code>属于<code>Post</code>，子模型更新时父模型的时间戳也被更新将很有用。</p>
<p>例如，当<code>Comment</code>模型被更新时，你可能想要<code>触发</code>创建其所属模型<code>Post</code>的<code>updated_at</code>时间戳。</p>
<p>Eloquent使得这项操作变得简单，只需要添加包含关联关系名称的<code>touches</code>属性到子模型中即可：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Comment</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 要触发的所有关联关系</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$touches</span> = [<span class="string">&#x27;post&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 评论所属文章</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">post</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;belongsTo(<span class="string">&#x27;App\Post&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，当你更新<code>Comment</code>时，所属模型<code>Post</code>将也会更新其<code>updated_at</code>值：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$comment</span> = App\Comment::find(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$comment</span>-&gt;text = <span class="string">&#x27;Edit to this comment!&#x27;</span>;</span><br><span class="line"><span class="variable">$comment</span>-&gt;save();</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第八章 第四节</title>
    <url>/2016/07/26/23e58ff808f7/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="8-4-访问器-amp-修改器"><a href="#8-4-访问器-amp-修改器" class="headerlink" title="8.4 访问器&amp;修改器"></a>8.4 访问器&amp;修改器</h2><h3 id="8-4-1-简介"><a href="#8-4-1-简介" class="headerlink" title="8.4.1 简介"></a>8.4.1 简介</h3><p><code>访问器</code>和<code>修改器</code>允许你在获取模型属性或设置其值时格式化 Eloquent 属性。</p>
<p>例如，你可能想要使用Laravel加密器对存储在数据库中的数据进行加密，并且在 Eloquent 模型中访问时自动进行解密。</p>
<p>除了自定义访问器和修改器，Eloquent 还可以自动转换日期字段为Carbon实例，甚至将文本转换为JSON。</p>
<hr>
<h3 id="8-4-2-访问器-amp-修改器"><a href="#8-4-2-访问器-amp-修改器" class="headerlink" title="8.4.2 访问器 &amp; 修改器"></a>8.4.2 访问器 &amp; 修改器</h3><h4 id="8-4-2-1-定义访问器"><a href="#8-4-2-1-定义访问器" class="headerlink" title="8.4.2.1 定义访问器"></a>8.4.2.1 定义访问器</h4><p>要定义一个访问器，需要在模型中创建一个<code>getFooAttribute</code>方法，其中<code>Foo</code>是你想要访问的字段名（使用驼峰式命名规则）。</p>
<p>在本例中，我们将会为<code>first_name</code>属性定义一个访问器，该访问器在获取<code>first_name</code>的值时被 Eloquent 自动调用：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户的名字</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  string  $value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFirstNameAttribute</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ucfirst(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>正如你所看到的，该字段的原生值被传递给访问器，然后返回处理过的值。</p>
<p>要访问该值只需要简单访问<code>first_name</code>即可：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = App\User::find(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$firstName</span> = <span class="variable">$user</span>-&gt;first_name;</span><br></pre></td></tr></table></figure>

<h4 id="8-4-2-2-定义修改器"><a href="#8-4-2-2-定义修改器" class="headerlink" title="8.4.2.2 定义修改器"></a>8.4.2.2 定义修改器</h4><p>要定义一个修改器，需要在模型中定义<code>setFooAttribute</code>方法，其中<code>Foo</code>是你想要访问的字段（使用驼峰式命名规则）。</p>
<p>接下来让我们为<code>first_name</code>属性定义一个修改器，当我们为模型上的<code>first_name</code>赋值时该修改器会被自动调用：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置用户的名字</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  string  $value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setFirstNameAttribute</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;attributes[<span class="string">&#x27;first_name&#x27;</span>] = strtolower(<span class="variable">$value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该修改器获取要被设置的属性值，允许你操纵该值并设置 Eloquent 模型内部属性值为操作后的值。</p>
<p>例如，如果你尝试设置<code>Sally</code>的<code>first_name</code>属性：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = App\User::find(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$user</span>-&gt;first_name = <span class="string">&#x27;Sally&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>在本例中，<code>setFirstNameAttribute</code>方法会被调用，传入参数为<code>Sally</code>，修改器会对其调用<code>strtolower</code>函数并将处理后的值设置为内部属性的值。</p>
<hr>
<h3 id="8-4-3-日期修改器"><a href="#8-4-3-日期修改器" class="headerlink" title="8.4.3 日期修改器"></a>8.4.3 日期修改器</h3><p>默认情况下，Eloquent 将会转化<code>created_at</code>和<code>updated_at</code>列的值为 <code>Carbon</code> 实例，该类继承自 PHP 原生的<code>Datetime</code>类，并提供了各种有用的方法。</p>
<p>你可以自定义哪些字段被自动调整修改，甚至可以通过重写模型中的<code>$dates</code>属性完全禁止调整：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 应该被调整为日期的属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$dates</span> = [<span class="string">&#x27;created_at&#x27;</span>, <span class="string">&#x27;updated_at&#x27;</span>, <span class="string">&#x27;disabled_at&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果字段是日期格式时，你可以将其值设置为 UNIX 时间戳，日期字符串（<code>Y-m-d</code>），日期-时间字符串，<code>Datetime/Carbon</code>实例，日期的值将会自动以正确格式存储到数据库中：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = App\User::find(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$user</span>-&gt;disabled_at = Carbon::now();</span><br><span class="line"><span class="variable">$user</span>-&gt;save();</span><br></pre></td></tr></table></figure>
<p>正如上面提到的，当获取被罗列在<code>$dates</code>数组中的属性时，它们会被自动转化为<code>Carbon</code>实例，允许你在属性上使用任何<code>Carbon</code>的方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = App\User::find(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$user</span>-&gt;disabled_at-&gt;getTimestamp();</span><br></pre></td></tr></table></figure>
<p>默认情况下，时间戳的格式是<code>Y-m-d H:i:s</code>，如果你需要自定义时间戳格式，在模型中设置<code>$dateFormat</code>属性，该属性决定日期属性存储在数据库以及序列化为数组或 <code>JSON</code> 时的格式：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flight</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模型日期的存储格式</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$dateFormat</span> = <span class="string">&#x27;U&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="8-4-4-属性转换"><a href="#8-4-4-属性转换" class="headerlink" title="8.4.4 属性转换"></a>8.4.4 属性转换</h3><p>模型中的<code>$casts</code>属性为属性字段转换到通用数据类型提供了便利方法 。<code>$casts</code>属性是数组格式，其键是要被转换的属性名称，其值时你想要转换的类型。目前支持的转换类型包括：<code>integer</code>, <code>real</code>, <code>float</code>, <code>double</code>, <code>string</code>, <code>boolean</code>, <code>object</code>，<code>array</code>，<code>collection</code>，<code>date</code>和<code>datetime</code>。</p>
<p>例如，让我们转换<code>is_admin</code>属性，将其由<code>integer</code>类型（0或1）转换为<code>boolean</code>类型：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 应该被转化为原生类型的属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$casts</span> = [</span><br><span class="line">        <span class="string">&#x27;is_admin&#x27;</span> =&gt; <span class="string">&#x27;boolean&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>现在，<code>is_admin</code>属性在被访问时总是被转换为<code>boolean</code>，即使底层存储在数据库中的值是<code>integer</code>：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = App\User::find(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$user</span>-&gt;is_admin) &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-4-4-1-数组转换"><a href="#8-4-4-1-数组转换" class="headerlink" title="8.4.4.1 数组转换"></a>8.4.4.1 数组转换</h4><p><code>array</code>类型转换在处理被存储为,序列化 JSON 格式的字段时特别有用。</p>
<p>例如，如果数据库有一个<code>TEXT</code>字段类型包含了序列化<code>JSON</code>，添加<code>array</code>类型转换到该属性将会在 Eloquent 模型中访问其值时自动将其反序列化为<code>PHP</code>数组：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 应该被转化为原生类型的属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$casts</span> = [</span><br><span class="line">        <span class="string">&#x27;options&#x27;</span> =&gt; <span class="string">&#x27;array&#x27;</span>,</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>类型转换被定义后，访问<code>options</code>属性将会自动从 <code>JSON</code> 反序列化为 <code>PHP</code> 数组，反之，当你设置<code>options</code>属性的值时，给定数组将会自动转化为 <code>JSON</code> 以供存储：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = App\User::find(<span class="number">1</span>);</span><br><span class="line"><span class="variable">$options</span> = <span class="variable">$user</span>-&gt;options;</span><br><span class="line"><span class="variable">$options</span>[<span class="string">&#x27;key&#x27;</span>] = <span class="string">&#x27;value&#x27;</span>;</span><br><span class="line"><span class="variable">$user</span>-&gt;options = <span class="variable">$options</span>;</span><br><span class="line"><span class="variable">$user</span>-&gt;save();</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第八章 第三节</title>
    <url>/2016/07/26/68f82f5c469f/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="8-3-集合"><a href="#8-3-集合" class="headerlink" title="8.3 集合"></a>8.3 集合</h2><h3 id="8-3-1-简介"><a href="#8-3-1-简介" class="headerlink" title="8.3.1 简介"></a>8.3.1 简介</h3><p>Eloquent 返回的所有的,包含多条记录的,结果集,都是 <code>Illuminate\Database\Eloquent\Collection </code>对象的实例，包括通过 <code>get</code> 方法或者,通过访问关联关系获取的结果。Eloquent 集合对象继承自<code>Laravel</code>的集合基类，因此很自然的继承了很多处理 Eloquent 模型底层数组的方法。</p>
<p>当然，所有集合也是迭代器，允许你像数组一样对其进行循环：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = App\User::where(<span class="string">&#x27;active&#x27;</span>, <span class="number">1</span>)-&gt;get();</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$users</span> <span class="keyword">as</span> <span class="variable">$user</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$user</span>-&gt;name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然而，集合使用直观接口提供各种映射/简化操作，因此比数组更加强大。</p>
<p>例如，我们可以通过以下方式移除所有无效的模型并聚合还存在的用户的名字</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = App\User::where(<span class="string">&#x27;active&#x27;</span>, <span class="number">1</span>)-&gt;get();</span><br><span class="line"></span><br><span class="line"><span class="variable">$names</span> = <span class="variable">$users</span>-&gt;reject(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$user</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$user</span>-&gt;active === <span class="literal">false</span>;</span><br><span class="line">&#125;)-&gt;map(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$user</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$user</span>-&gt;name;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><em>注意：尽管大多数 Eloquent 集合返回的是一个新的 Eloquent 集合实例，但是<code>pluck</code>、<code>keys</code>、<code>zip</code>、<code>collapse</code>、<code>flatten</code>和<code>flip</code>方法返回的是集合基类实例。</em></p>
<hr>
<h3 id="8-3-2-可用方法"><a href="#8-3-2-可用方法" class="headerlink" title="8.3.2 可用方法"></a>8.3.2 可用方法</h3><p>关于服务的可用方法，可用查看<a href="http://laravelacademy.org/post/178.html#ipt_kb_toc_178_3">服务-合集</a></p>
<h3 id="8-3-3-自定义集合"><a href="#8-3-3-自定义集合" class="headerlink" title="8.3.3 自定义集合"></a>8.3.3 自定义集合</h3><p>如果你需要在自己扩展的方法中使用自定义的集合对象，可以重写模型上的 <code>newCollection</code> 方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">CustomCollection</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个新的Eloquent集合实例</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  array  $models</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Database\Eloquent\Collection</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">newCollection</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$models</span> = []</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CustomCollection(<span class="variable">$models</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义好 <code>newCollection</code> 方法后，无论何时 Eloquent 返回该模型的 <code>Collection</code> 实例你都会获取到自定义的集合。</p>
<p>如果你想要在应用中的每一个模型中使用自定义集合，需要在模型基类中重写 <code>newCollection</code> 方法。</p>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>laravel 学习指南 第八章 第五节</title>
    <url>/2016/07/26/3db1ab34f96e/</url>
    <content><![CDATA[<ul>
<li>TOC<br>{:toc}</li>
</ul>
<h2 id="8-5-序列化"><a href="#8-5-序列化" class="headerlink" title="8.5 序列化"></a>8.5 序列化</h2><h3 id="8-5-1-简介"><a href="#8-5-1-简介" class="headerlink" title="8.5.1 简介"></a>8.5.1 简介</h3><p>当构建 <code>JSON API</code> 时，经常需要转化模型和关联关系为<code>数组</code>或<code>JSON</code>。Eloquent 包含便捷方法实现这些转换，以及控制哪些属性被包含到序列化中。</p>
<hr>
<h3 id="8-5-2-基本使用"><a href="#8-5-2-基本使用" class="headerlink" title="8.5.2 基本使用"></a>8.5.2 基本使用</h3><h4 id="8-5-2-1-转化模型为数组"><a href="#8-5-2-1-转化模型为数组" class="headerlink" title="8.5.2.1 转化模型为数组"></a>8.5.2.1 转化模型为数组</h4><p>要转化模型及其加载的关联关系为数组，可以使用 <code>toArray</code> 方法。这个方法是递归的，所以所有属性及其关联对象属性（包括关联的关联）都会被转化为数组：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = App\User::with(<span class="string">&#x27;roles&#x27;</span>)-&gt;first();</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$user</span>-&gt;toArray();</span><br></pre></td></tr></table></figure>
<p>还可以转化集合为数组：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$users</span> = App\User::all();</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$users</span>-&gt;toArray();</span><br></pre></td></tr></table></figure>

<h4 id="8-5-2-2-转化模型为-JSON"><a href="#8-5-2-2-转化模型为-JSON" class="headerlink" title="8.5.2.2 转化模型为 JSON"></a>8.5.2.2 转化模型为 JSON</h4><p>要转化模型为 JSON，可以使用 <code>toJson</code> 方法，和 <code>toArray</code>一样，<code>toJson</code> 方法也是递归的，所有属性及其关联属性都会被转化为 JSON：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = App\User::find(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$user</span>-&gt;toJson();</span><br></pre></td></tr></table></figure>
<p>你还可以转化模型或集合为字符串，这将会自动调用 <code>toJson</code> 方法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span> = App\User::find(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> (<span class="keyword">string</span>) <span class="variable">$user</span>;</span><br></pre></td></tr></table></figure>
<p>由于模型和集合在转化为字符串的时候会被转化为 JSON，你可以从应用的路由或控制器中直接返回 Eloquent 对象：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;users&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> App\User::all();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="8-5-3-在-JSON-中隐藏属性"><a href="#8-5-3-在-JSON-中隐藏属性" class="headerlink" title="8.5.3 在 JSON 中隐藏属性"></a>8.5.3 在 JSON 中隐藏属性</h3><p>有时候你希望在模型数组或 JSON 显示中隐藏某些属性，比如密码，要实现这个，在定义模型的时候设置 <code>$hidden</code> 属性：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在数组中隐藏的属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$hidden</span> = [<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>注意：如果要隐藏关联关系，使用关联关系的方法名，而不是动态属性名。</em></p>
<p>此外，可以使用 <code>visible</code> 属性来定义模型数组和 JSON 显示的属性白名单：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在数组中显示的属性</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$visible</span> = [<span class="string">&#x27;first_name&#x27;</span>, <span class="string">&#x27;last_name&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-5-3-1-临时暴露隐藏属性"><a href="#8-5-3-1-临时暴露隐藏属性" class="headerlink" title="8.5.3.1 临时暴露隐藏属性"></a>8.5.3.1 临时暴露隐藏属性</h4><p>如果你想要在特定模型中临时显示隐藏的属性，可以使用 <code>makeVisible</code> 方法，该方法以方法链的方式返回模型实例：</p>
<pre><code>return $user-&gt;makeVisible(&#39;attribute&#39;)-&gt;toArray();
</code></pre>
<hr>
<h3 id="8-5-4-追加值到-JSON"><a href="#8-5-4-追加值到-JSON" class="headerlink" title="8.5.4 追加值到 JSON"></a>8.5.4 追加值到 JSON</h3><p>有时候，需要添加数据库中没有的字段到数组中，要实现这个功能，首先要为这个值定义一个访问器：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 为用户获取管理员标识</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getIsAdminAttribute</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;attributes[<span class="string">&#x27;admin&#x27;</span>] == <span class="string">&#x27;yes&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义好访问器后，添加字段名到该模型的 <code>appends</code> 属性：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Model</span></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 追加到模型数组表单的访问器</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$appends</span> = [<span class="string">&#x27;is_admin&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>字段被添加到 <code>appends</code> 列表之后，将会被包含到模型数组和 JSON 中，<code>appends</code> 数组中的字段还会遵循模型中配置的 <code>visible</code> 和 <code>hidden</code> 设置。</p>
]]></content>
      <categories>
        <category>laravel</category>
      </categories>
  </entry>
  <entry>
    <title>Arch Linux  安装指南</title>
    <url>/2016/07/07/a4789fecc6e7/</url>
    <content><![CDATA[<h2 id="1-基本系统安装"><a href="#1-基本系统安装" class="headerlink" title="1. 基本系统安装"></a>1. 基本系统安装</h2><h3 id="1-1-Arch-Linux镜像下载"><a href="#1-1-Arch-Linux镜像下载" class="headerlink" title="1.1. Arch Linux镜像下载"></a>1.1. Arch Linux镜像<a href="https://www.archlinux.org/download/">下载</a></h3><h3 id="1-2-安装"><a href="#1-2-安装" class="headerlink" title="1.2. 安装"></a>1.2. 安装</h3><h4 id="1-2-1-VWmare"><a href="#1-2-1-VWmare" class="headerlink" title="1.2.1. VWmare"></a>1.2.1. VWmare</h4><blockquote>
<p><strong>基本安装设定</strong></p>
</blockquote>
<blockquote>
<ul>
<li>设定任意 Linux 64位虚拟机</li>
<li>内存2G，硬盘20G</li>
<li>挂载镜像光盘</li>
</ul>
</blockquote>
<h4 id="1-2-2-实体机"><a href="#1-2-2-实体机" class="headerlink" title="1.2.2. 实体机"></a>1.2.2. 实体机</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># loadkeys us                                // 设置键盘</span><br><span class="line"># cfdisk                                       // 创建硬盘分区</span><br><span class="line"># mkfs.ext4 /dev/sda1                        // 格式化分区</span><br><span class="line"># mkswap /dev/sda2 &amp;&amp; swapon /dev/sda2       // 挂载swap</span><br><span class="line"># mount /dev/sda1 /mnt                       // 挂载 分区</span><br><span class="line"># vi /etc/pacman.d/mirrorlist                // 添加软件源</span><br><span class="line"># pacman -Syy                                // 更新软件源</span><br><span class="line"># pacstrap /mnt base base-devel net-tools    // 安装基础包</span><br><span class="line"># genfstab -U -p /mnt &gt;&gt; /mnt/etc/fstab      // 自动生成引导文件</span><br><span class="line"># arch-chroot /mnt                           // 切入硬盘root</span><br><span class="line"># vi /etc/locale.gen &amp;&amp; locale-gen              // 设置字符</span><br><span class="line"># echo LANG=&quot;zh_CN.UTF-8&quot; &gt;&gt; /etc/locale.conf   // 设置语言</span><br><span class="line"># echo KEYMAP=us &gt;&gt; /etc/vconsole.conf          // 设置键盘</span><br><span class="line"># ln -s /usr/share/zoneinfo/Asia/Chongqing /etc/localtime  // 设置本地时间</span><br><span class="line"># echo vm &gt;&gt; /etc/hostname                                 // 设置主机名称</span><br><span class="line"># mkinitcpio -p linux                                         // 根据配置生成镜像</span><br><span class="line"># passwd                                                   // 修改root密码</span><br><span class="line"># pacman -S grub-bios                                      // 安装grub引导</span><br><span class="line"># grub-install /dev/sda                                    // 安装到硬盘</span><br><span class="line"># grub-mkconfig -o /boot/grub/grub.cfg                     // 自动设置grub</span><br><span class="line"># exit                                                     // 退出root用户</span><br><span class="line"># umount /mnt                                              // 取消挂载硬盘</span><br><span class="line"># reboot                                                   // 重启</span><br></pre></td></tr></table></figure>

<p>备注：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># mkdir /mnt/home &amp;&amp; mount /dev/sda9 /mnt/home     //创建/home 并挂载硬盘。</span><br></pre></td></tr></table></figure>

<p>在创建硬盘分区后执行，如果有需要。</p>
<p>要添加的软件源： 参考官方 最新<a href="https://wiki.archlinux.org/index.php/Mirrors#China">地址</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://mirror.bit.edu.cn/archlinux/ - Beijing Institute of Technology</span><br><span class="line">http://mirrors.aliyun.com/archlinux/ - Alibaba</span><br><span class="line"></span><br><span class="line">http://mirrors.sohu.com/archlinux/</span><br><span class="line">http://mirrors.yun-idc.com/archlinux/</span><br></pre></td></tr></table></figure>

<p>以上基本安装完成。</p>
<h4 id="1-2-3-网站参考"><a href="#1-2-3-网站参考" class="headerlink" title="1.2.3. 网站参考"></a>1.2.3. 网站参考</h4><p><a href="https://bbs.archlinuxcn.org/viewtopic.php?id=1901">地址1</a></p>
<p><a href="https://bbs.archlinuxcn.org/viewtopic.php?id=1037">地址2</a></p>
<p>自动化安装设置工具<a href="https://github.com/helmuthdu/aui">Archlinux U Install</a></p>
<h2 id="2-桌面化安装"><a href="#2-桌面化安装" class="headerlink" title="2. 桌面化安装"></a>2. 桌面化安装</h2><h2 id="3-常用软件补全"><a href="#3-常用软件补全" class="headerlink" title="3. 常用软件补全"></a>3. 常用软件补全</h2><h2 id="4-美化"><a href="#4-美化" class="headerlink" title="4. 美化"></a>4. 美化</h2><h2 id="5-开发环境搭建"><a href="#5-开发环境搭建" class="headerlink" title="5. 开发环境搭建"></a>5. 开发环境搭建</h2>]]></content>
      <categories>
        <category>archlinux</category>
      </categories>
      <tags>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年7月12日</title>
    <url>/2016/07/12/572a7c4c0c84/</url>
    <content><![CDATA[<h2 id="日期：2016年7月12日"><a href="#日期：2016年7月12日" class="headerlink" title="日期：2016年7月12日"></a>日期：2016年7月12日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><p>在ubuntu中安装<code>gulp</code>与<code>sass</code>。</p>
<p>安装nginx+php7.0+mysql。</p>
<h3 id="明日计划"><a href="#明日计划" class="headerlink" title="明日计划"></a>明日计划</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="2">
<li>定制玩家天赋</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>laravel 学习</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>学习数据结构</li>
</ol>
</li>
</ul>
]]></content>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年7月10日</title>
    <url>/2016/07/10/39a3a55ca032/</url>
    <content><![CDATA[<h2 id="日期：2016年7月10日22-07-00"><a href="#日期：2016年7月10日22-07-00" class="headerlink" title="日期：2016年7月10日22:07:00"></a>日期：2016年7月10日22:07:00</h2><h3 id="今日活动"><a href="#今日活动" class="headerlink" title="今日活动"></a>今日活动</h3><p>安装空调用一天时间。</p>
<p><strong>以后早睡早起，零点前睡，六点钟起床</strong></p>
<h3 id="明天计划"><a href="#明天计划" class="headerlink" title="明天计划"></a>明天计划</h3><ul>
<li><p><input checked="" disabled="" type="checkbox"> </p>
<ol>
<li>完成PC端文档，不要玩游戏。</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="2">
<li>整理可能使用的数据结构。</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>学习laravel 5。</li>
</ol>
</li>
<li><p><input checked="" disabled="" type="checkbox"> </p>
<ol start="4">
<li>了解JS、 Sass、gulp、bootstrap、html5</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="5">
<li>Composer略微学习一下，创建笔记。</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="6">
<li>在hp-notebook上部署laravel。以及完整WEB开发环境。</li>
</ol>
</li>
<li><p><input checked="" disabled="" type="checkbox"> </p>
<ol start="7">
<li>制定开发顺序。</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="8">
<li>实现markdown画流程图的方法。</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="9">
<li>研究下 Emacs 如果写 ditaa 与 markdown 。</li>
</ol>
</li>
<li><p><input checked="" disabled="" type="checkbox"> </p>
<ol start="10">
<li>xmind思维图工具</li>
</ol>
</li>
</ul>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>gulp 学习指南</title>
    <url>/2016/07/12/3243f213ce74/</url>
    <content><![CDATA[<h1 id="about-gulp"><a href="#about-gulp" class="headerlink" title="about gulp"></a>about gulp</h1><h2 id="安装node"><a href="#安装node" class="headerlink" title="安装node"></a>安装node</h2><pre><code>sudo apt install nodejs
</code></pre>
<h2 id="安装-nodejs-legacy"><a href="#安装-nodejs-legacy" class="headerlink" title="安装 nodejs-legacy"></a>安装 nodejs-legacy</h2><pre><code>sudo apt install nodejs-legacy
</code></pre>
<h2 id="安装npm"><a href="#安装npm" class="headerlink" title="安装npm"></a>安装npm</h2><pre><code>sudo apt install npm
</code></pre>
<h2 id="安装gulp"><a href="#安装gulp" class="headerlink" title="安装gulp"></a>安装gulp</h2><pre><code>sudo npm install -g gulp
</code></pre>
<h2 id="查看node-版本"><a href="#查看node-版本" class="headerlink" title="查看node 版本"></a>查看node 版本</h2><pre><code>node -v
</code></pre>
<h2 id="查看npm-版本"><a href="#查看npm-版本" class="headerlink" title="查看npm 版本"></a>查看npm 版本</h2><pre><code>npm -v
</code></pre>
<h2 id="查看gulp-版本"><a href="#查看gulp-版本" class="headerlink" title="查看gulp 版本"></a>查看gulp 版本</h2><pre><code>gulp -v
</code></pre>
<p>测试gulp时，需要<code>package.json</code>与<code>gulpfile.js</code>文件</p>
<h2 id="安装gulp-sass"><a href="#安装gulp-sass" class="headerlink" title="安装gulp-sass"></a>安装gulp-sass</h2><pre><code>npm install gulp-sass
</code></pre>
]]></content>
      <categories>
        <category>ubuntu</category>
      </categories>
      <tags>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年7月11日</title>
    <url>/2016/07/11/c694b940233e/</url>
    <content><![CDATA[<h2 id="日期：2016年7月11日"><a href="#日期：2016年7月11日" class="headerlink" title="日期：2016年7月11日"></a>日期：2016年7月11日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><p>UE4 升级到4.12.5</p>
<p>初步设定完成，细化数据库结构以及通信接口。2016年7月11日19:51:58</p>
<ul>
<li><p>sass学习参考<a href="http://www.sasschina.com/">地址</a></p>
<p>  主要用来处理CSS</p>
</li>
<li><p>gulp参考<a href="http://www.gulpjs.com.cn/">地址1</a>  <a href="http://www.ydcss.com/archives/18">地址2</a></p>
<p>  前端开发监听工具</p>
</li>
<li><p>bootstrap参考<a href="http://www.bootcss.com/">地址</a></p>
<p>  样式与JS包</p>
</li>
<li><p>node.js参考<a href="http://nodeapp.cn/zh-cn/">地址</a></p>
<p>  js服务</p>
</li>
<li><p>composer参考<a href="http://www.phpcomposer.com/">地址</a></p>
<p>  php 包管理</p>
</li>
<li><p>laravel 学习参考<a href="http://laravelacademy.org/laravel-docs-5_2">地址</a></p>
<p>  PHP框架</p>
</li>
</ul>
<p>npm：node.js 包管理器</p>
<p>pip：python 包管理器</p>
<p>ruby：gem、bundle</p>
<p>开发顺序：</p>
<p>网站→服务端后台→ PC端→APP端。</p>
<p>其中网站的开发与游戏原画制作并行。</p>
<p>网站与服务器要求掌握的知识较多，PC端的机械性工作量较大，APP端需要大量的动画数据。</p>
<h3 id="明日计划"><a href="#明日计划" class="headerlink" title="明日计划"></a>明日计划</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="2">
<li>定制玩家天赋</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>laravel 学习</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>学习数据结构</li>
</ol>
</li>
</ul>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>jekyll 学习指南</title>
    <url>/2016/07/12/23c89f0bf146/</url>
    <content><![CDATA[<h2 id="1-jekyll"><a href="#1-jekyll" class="headerlink" title="1.jekyll"></a>1.jekyll</h2><p><a href="https://jekyllrb.com/">jekyll官方地址</a></p>
<p><a href="http://jekyllcn.com/">jekyll中文</a></p>
<h3 id="1-1安装jekyll必要组件"><a href="#1-1安装jekyll必要组件" class="headerlink" title="1.1安装jekyll必要组件"></a>1.1安装jekyll必要组件</h3><p>下文是在ubuntu上安装与设置</p>
<pre><code>$ sudo apt-get install ruby ruby-dev make gcc nodejs
</code></pre>
<h3 id="1-2安装jekyll"><a href="#1-2安装jekyll" class="headerlink" title="1.2安装jekyll"></a>1.2安装jekyll</h3><pre><code>$ sudo gem install jekyll
</code></pre>
<p>之后查看jekyll版本</p>
<pre><code>$ jekyll -v
</code></pre>
<h3 id="1-3jekyll使用"><a href="#1-3jekyll使用" class="headerlink" title="1.3jekyll使用"></a>1.3jekyll使用</h3><p>首先要设置<code>_config.yml</code>文件</p>
<p>随后build为site。</p>
<pre><code>$ jekyll build
</code></pre>
<p>build后网站文件在<code>_site</code></p>
<p>使用<code>jekyll server</code>运行测试。</p>
<pre><code>$ jekyll server
</code></pre>
<p>浏览器输入<code>localhost:4000</code>可以查看网站运行情况。</p>
<p><code>_post</code>文件下位文章列表，可以将文章放入后build。</p>
<p><em>注意：文件的头部要使用下方格式</em></p>
<pre><code>---
layout: post
title: Blogging Like a Hacker
---
</code></pre>
<h2 id="2-kramdown-语法说明"><a href="#2-kramdown-语法说明" class="headerlink" title="2. kramdown 语法说明"></a>2. kramdown 语法说明</h2><h3 id="2-1-TOC连接-文章目录"><a href="#2-1-TOC连接-文章目录" class="headerlink" title="2.1 TOC连接[文章目录]"></a>2.1 TOC连接[文章目录]</h3><pre><code>* TOC
&#123;：toc&#125;
</code></pre>
<p>生成目录带自动锚点</p>
<h3 id="2-2-删除线"><a href="#2-2-删除线" class="headerlink" title="2.2 删除线"></a>2.2 删除线</h3><pre><code>~~删除线~~
</code></pre>
<h3 id="2-3-数学公式"><a href="#2-3-数学公式" class="headerlink" title="2.3 数学公式"></a>2.3 数学公式</h3><p>需要增加<code>js</code>用于公式解析</p>
<pre><code>&lt;script src=&quot;https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
</code></pre>
<h2 id="3-disqus"><a href="#3-disqus" class="headerlink" title="3. disqus"></a>3. disqus</h2><p>添加<code>disqus</code>代码到<code>_layouts/post.html</code></p>
]]></content>
      <categories>
        <category>ubuntu</category>
      </categories>
      <tags>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>zsh指南</title>
    <url>/2016/07/12/1b289a08a4b0/</url>
    <content><![CDATA[<h1 id="zsh-plugin"><a href="#zsh-plugin" class="headerlink" title="zsh plugin"></a>zsh plugin</h1><h3 id="zsh-tmux"><a href="#zsh-tmux" class="headerlink" title="zsh tmux"></a>zsh tmux</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ta</td>
<td align="left">tmux attach -t</td>
</tr>
<tr>
<td align="left">ts</td>
<td align="left">tmux new-session -s</td>
</tr>
<tr>
<td align="left">tl</td>
<td align="left">tmux list-sessions</td>
</tr>
<tr>
<td align="left">tksv</td>
<td align="left">tmux kill-server</td>
</tr>
<tr>
<td align="left">tkss</td>
<td align="left">tmux kill-session -t</td>
</tr>
</tbody></table>
<h3 id="zsh-git"><a href="#zsh-git" class="headerlink" title="zsh git"></a>zsh git</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">g</td>
<td align="left">git</td>
</tr>
<tr>
<td align="left">ga</td>
<td align="left">git add</td>
</tr>
<tr>
<td align="left">gaa</td>
<td align="left">git add –add</td>
</tr>
<tr>
<td align="left">gapa</td>
<td align="left">git add –patsh</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gb</td>
<td align="left">git branch</td>
</tr>
<tr>
<td align="left">gba</td>
<td align="left">git branch -a</td>
</tr>
<tr>
<td align="left">gbnm</td>
<td align="left">git branch –no-merged</td>
</tr>
<tr>
<td align="left">gbr</td>
<td align="left">git branch –remote</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gc</td>
<td align="left">git commit -v</td>
</tr>
<tr>
<td align="left">gca</td>
<td align="left">git commit -v -a</td>
</tr>
<tr>
<td align="left">gcam</td>
<td align="left">git commit -a -m</td>
</tr>
<tr>
<td align="left">gcmsg</td>
<td align="left">git commit -m</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gco</td>
<td align="left">git checkout</td>
</tr>
<tr>
<td align="left">gcm</td>
<td align="left">git checkout master</td>
</tr>
<tr>
<td align="left">gcb</td>
<td align="left">git checkout -b</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gcl</td>
<td align="left">git clone –recursive</td>
</tr>
<tr>
<td align="left">gcf</td>
<td align="left">git config –list</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gd</td>
<td align="left">git diff</td>
</tr>
<tr>
<td align="left">gf</td>
<td align="left">git fetch</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gl</td>
<td align="left">git pull</td>
</tr>
<tr>
<td align="left">gm</td>
<td align="left">git merge</td>
</tr>
<tr>
<td align="left">gmom</td>
<td align="left">git merge origin/master</td>
</tr>
<tr>
<td align="left">gp</td>
<td align="left">git push</td>
</tr>
<tr>
<td align="left">gpd</td>
<td align="left">git push –dry-run</td>
</tr>
<tr>
<td align="left">gpoat</td>
<td align="left">git push origin –all &amp;&amp; git push origin –tags</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gr</td>
<td align="left">git remote</td>
</tr>
<tr>
<td align="left">gra</td>
<td align="left">git remote add</td>
</tr>
<tr>
<td align="left">grmv</td>
<td align="left">git remote rename</td>
</tr>
<tr>
<td align="left">grrm</td>
<td align="left">git remote remove</td>
</tr>
<tr>
<td align="left">grv</td>
<td align="left">git remote -v</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">grb</td>
<td align="left">git rebase</td>
</tr>
<tr>
<td align="left">grbm</td>
<td align="left">git rebase master</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">grh</td>
<td align="left">git reset HEAD</td>
</tr>
<tr>
<td align="left">grhh</td>
<td align="left">git reset HEAD –hard</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gsb</td>
<td align="left">git status -sb</td>
</tr>
<tr>
<td align="left">gss</td>
<td align="left">git status -s</td>
</tr>
<tr>
<td align="left">gst</td>
<td align="left">git status</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">gts</td>
<td align="left">git tag -s</td>
</tr>
<tr>
<td align="left">gtv</td>
<td align="left">git tag</td>
</tr>
</tbody></table>
<h3 id="zsh-laravel"><a href="#zsh-laravel" class="headerlink" title="zsh laravel"></a>zsh laravel</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">la5</td>
<td align="left">php artisan</td>
</tr>
<tr>
<td align="left">la5cache</td>
<td align="left">php artisan cache:clear</td>
</tr>
<tr>
<td align="left">la5routes</td>
<td align="left">php artisan route:list</td>
</tr>
<tr>
<td align="left">la5vendor</td>
<td align="left">php artisan vendor:publish</td>
</tr>
</tbody></table>
<h3 id="zsh-ubuntu"><a href="#zsh-ubuntu" class="headerlink" title="zsh ubuntu"></a>zsh ubuntu</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ag</td>
<td align="left">sudo apt-get</td>
</tr>
<tr>
<td align="left">aga</td>
<td align="left">sudo apt-get autoclean</td>
</tr>
<tr>
<td align="left">agar</td>
<td align="left">sudo apt-get autoremove</td>
</tr>
<tr>
<td align="left">agb</td>
<td align="left">sudo apt-get build-dep</td>
</tr>
<tr>
<td align="left">agc</td>
<td align="left">sudo apt-get clean</td>
</tr>
<tr>
<td align="left">agd</td>
<td align="left">sudo apt-get dselect-upgrade</td>
</tr>
<tr>
<td align="left">agi</td>
<td align="left">sudo apt-get install</td>
</tr>
<tr>
<td align="left">agp</td>
<td align="left">sudo apt-get purge</td>
</tr>
<tr>
<td align="left">agr</td>
<td align="left">sudo apt-get remove</td>
</tr>
<tr>
<td align="left">agu</td>
<td align="left">sudo apt-get update</td>
</tr>
<tr>
<td align="left">agud</td>
<td align="left">sudo apt-get update &amp;&amp; sudo apt-get dist-upgrade</td>
</tr>
<tr>
<td align="left">agug</td>
<td align="left">sudo apt-get upgrade</td>
</tr>
<tr>
<td align="left">aguu</td>
<td align="left">sudo apt-get update &amp;&amp; sudo apt-get upgrade</td>
</tr>
</tbody></table>
<h3 id="zsh-npm"><a href="#zsh-npm" class="headerlink" title="zsh npm"></a>zsh npm</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">npmg</td>
<td align="left">npm i -g</td>
</tr>
<tr>
<td align="left">npmS</td>
<td align="left">npm i -S</td>
</tr>
<tr>
<td align="left">npmD</td>
<td align="left">npm i -D</td>
</tr>
<tr>
<td align="left">npmO</td>
<td align="left">npm outdated</td>
</tr>
</tbody></table>
<h3 id="zsh-ruby"><a href="#zsh-ruby" class="headerlink" title="zsh ruby"></a>zsh ruby</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">sgem</td>
<td align="left">sudo gem</td>
</tr>
</tbody></table>
<h3 id="zsh-bundler"><a href="#zsh-bundler" class="headerlink" title="zsh bundler"></a>zsh bundler</h3><table>
<thead>
<tr>
<th align="left">缩写</th>
<th align="left">命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">be</td>
<td align="left">bundle exec</td>
</tr>
<tr>
<td align="left">bl</td>
<td align="left">bundle list</td>
</tr>
<tr>
<td align="left">bp</td>
<td align="left">bundle package</td>
</tr>
<tr>
<td align="left">bo</td>
<td align="left">bundle open</td>
</tr>
<tr>
<td align="left">bout</td>
<td align="left">bundle outdated</td>
</tr>
<tr>
<td align="left">bu</td>
<td align="left">bundle update</td>
</tr>
<tr>
<td align="left">bi</td>
<td align="left">bundle install</td>
</tr>
<tr>
<td align="left">bcn</td>
<td align="left">bundle clean</td>
</tr>
</tbody></table>
]]></content>
      <categories>
        <category>ubuntu</category>
      </categories>
      <tags>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年7月13日</title>
    <url>/2016/07/13/d4db3ba9f29f/</url>
    <content><![CDATA[<h2 id="日期：2016年7月13日"><a href="#日期：2016年7月13日" class="headerlink" title="日期：2016年7月13日"></a>日期：2016年7月13日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><ol>
<li><p>mysql禁止了root用户登录，所以新建一个高权限用户吧！<a href="http://jvdc.me/get-phpmyadmin-working-on-ubuntu-16-04-nginx-1-10-php-7-mariadb-10/">参考地址</a></p>
</li>
<li><p>学习laravel快速入门</p>
</li>
</ol>
<h3 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p>[1/2] 2. 定制玩家天赋</p>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>laravel 学习</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>学习数据结构</li>
</ol>
</li>
<li><p><input checked="" disabled="" type="checkbox"> </p>
<ol start="5">
<li>设置jekyll分页以及disqus模块</li>
</ol>
</li>
</ul>
<h3 id="明日计划"><a href="#明日计划" class="headerlink" title="明日计划"></a>明日计划</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="2">
<li>定制玩家天赋</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>laravel 学习</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>学习数据结构</li>
</ol>
</li>
</ul>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年7月17日</title>
    <url>/2017/12/24/98a9a79263c2/</url>
    <content><![CDATA[<h2 id="日期：2016年7月17日"><a href="#日期：2016年7月17日" class="headerlink" title="日期：2016年7月17日"></a>日期：2016年7月17日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><p>laravel学习到 控制器</p>
<p>完成部分笔记</p>
<h3 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h3><ul>
<li><input checked="" disabled="" type="checkbox"> <ol>
<li>laravel 入门学习</li>
</ol>
</li>
</ul>
<h3 id="3日计划"><a href="#3日计划" class="headerlink" title="3日计划"></a>3日计划</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="2">
<li>laravel 学习</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>学习数据结构</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>了解HTML5 与 CSS3</li>
</ol>
</li>
</ul>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>vim 学习指南</title>
    <url>/2016/07/13/c7d69e97b93f/</url>
    <content><![CDATA[<h1 id="vim-使用指南"><a href="#vim-使用指南" class="headerlink" title="vim 使用指南"></a>vim 使用指南</h1><h2 id="1-vim-插件管理器"><a href="#1-vim-插件管理器" class="headerlink" title="1.vim 插件管理器"></a>1.vim 插件管理器</h2><h3 id="1-1-Vundle-git仓库"><a href="#1-1-Vundle-git仓库" class="headerlink" title="1.1 Vundle git仓库"></a>1.1 Vundle <a href="https://github.com/VundleVim/Vundle.vim">git仓库</a></h3><p>安装文档有中文指南。</p>
<h3 id="1-2-第一步"><a href="#1-2-第一步" class="headerlink" title="1.2 第一步"></a>1.2 第一步</h3><pre><code>$ git clone https://github.com/VundleVim/Vundle.vim.git ~/.vim/bundle/Vundle.vim
</code></pre>
<h3 id="1-3-第二步"><a href="#1-3-第二步" class="headerlink" title="1.3 第二步"></a>1.3 第二步</h3><p>对<code>.vimrc</code>文件进行设置。</p>
<p><code>begin()</code>和<code>end()</code>之间的为可以添加的插件。</p>
<p>插件添加支持多种格式。</p>
<pre><code>set rtp+=~/.vim/bundle/Vundle.vim
call vundle#begin()

Plugin &#39;VundleVim/Vundle.vim&#39;
Plugin &#39;tpope/vim-fugitive&#39;
Plugin &#39;L9&#39;
Plugin &#39;wincent/command-t&#39;
Plugin &#39;godlygeek/tabular&#39;
Plugin &#39;plasticboy/vim-markdown&#39;
Plugin &#39;suan/vim-instant-markdown&#39;

call vundle#end()            
filetype plugin indent on
</code></pre>
<h3 id="1-4-第三步"><a href="#1-4-第三步" class="headerlink" title="1.4 第三步"></a>1.4 第三步</h3><p>在vim中输入<code>:PluginInstall</code>来安装插件。</p>
<hr>
<h2 id="2-vim-常用插件指南"><a href="#2-vim-常用插件指南" class="headerlink" title="2.vim 常用插件指南"></a>2.vim 常用插件指南</h2><h3 id="2-1-Command-t"><a href="#2-1-Command-t" class="headerlink" title="2.1 Command-t"></a>2.1 Command-t</h3><p>插件<a href="https://github.com/wincent/command-t">地址</a></p>
<p>插件需要安装<code>ruby</code>，安装完成后，进入目录<code>~/.vim/bundle/command-t/ruby/command-t</code></p>
<p>执行下方命令：</p>
<pre><code>ruby extconf.rb
make
</code></pre>
<p>之后进入Vim，输入命令<code>:CommandT</code>查看效果。</p>
<p>如果提示vim不支持<code>ruby</code>，则安装<code>vim-nox</code></p>
<pre><code>$ sudo apt-get install vim-nox
</code></pre>
<p>下图，为正常运行图</p>
<p><img src="https://raw.githubusercontent.com/wincent/command-t/media/command-t.gif"></p>
<p><strong>简要使用说明</strong></p>
<p><code>tab</code>为选择切换到文件选择。方向键用了选择文件。<code>enter</code>确认选择。</p>
<hr>
<h3 id="2-2-vim中编写markdown与预览"><a href="#2-2-vim中编写markdown与预览" class="headerlink" title="2.2 vim中编写markdown与预览"></a>2.2 vim中编写markdown与预览</h3><p>需要安装的插件有三个。</p>
<pre><code>Plugin &#39;godlygeek/tabular&#39;
Plugin &#39;plasticboy/vim-markdown&#39;
Plugin &#39;suan/vim-instant-markdown&#39;
</code></pre>
<p>其中<code>vim-instant-markdown</code>需要安装<code>nodejs</code>、<code>npm</code>、<code>xdg-utils</code>、<code>nodejs-legacy</code>。</p>
<p>安装<code>instant-markdown-d</code></p>
<pre><code>$ sudo npm -g install instant-markdown-d
</code></pre>
<p>其他需要组件：</p>
<pre><code>$ sudo apt-get install nodejs
$ sudo apt-get install npm
$ sudo apt-get install xdg-utils
$ sudo apt-get install nodejs-legacy
</code></pre>
<p>实现的效果为<code>浏览器预览</code>与<code>markdown语法高亮</code></p>
<p>安装完成后效果如下图：</p>
<p><img src="https://dl.dropboxusercontent.com/u/28956267/instant-markdown-demo.gif"></p>
<hr>
<h3 id="2-3-nerdTree"><a href="#2-3-nerdTree" class="headerlink" title="2.3 nerdTree"></a>2.3 nerdTree</h3><p>参考<a href="https://github.com/scrooloose/nerdtree">地址</a></p>
<p><a href="https://github.com/Xuyuanp/nerdtree-git-plugin">nerdtree-git-plugin</a> git语法提示</p>
<p><a href="https://github.com/jistr/vim-nerdtree-tabs">vim-nerdtree-tabs</a> NERDTree tag控制</p>
<pre><code>Plugin &#39;scrooloose/nerdTree&#39;
Plugin &#39;Xuyuanp/nerdtree-git-plugin&#39;
Plugin &#39;jistr/vim-nerdtree-tabs&#39;
</code></pre>
<p><code>vim</code>中输入<code>PluginInstall</code>，输入<code>NERDTree</code>检查是否运行</p>
<p>在<code>.vimrc</code>中添加设置</p>
<pre><code>&quot; NERDTRee config NERDTree 设置

autocmd vimenter * NERDTree  “ 当指定文件时，自动随VIM启动。

&quot;未指定文件时，加载NERDTree

autocmd StdinReadPre * let s:std_in=1
autocmd VimEnter * if argc() == 0 &amp;&amp; !exists(&quot;s:std_in&quot;) | NERDTree | endif

&quot;隐藏与显示快捷键[Ctrl+n]

map &lt;C-n&gt; :NERDTreeToggle&lt;CR&gt;

&quot;左侧只有一个窗口时，随Vim一起关闭

autocmd bufenter * if (winnr(&quot;$&quot;) == 1 &amp;&amp; exists(&quot;b:NERDTree&quot;) &amp;&amp; b:NERDTree.isTabTree()) | q | endif
</code></pre>
<hr>
]]></content>
      <categories>
        <category>ubuntu</category>
      </categories>
      <tags>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年7月15日</title>
    <url>/2017/12/24/334d5d3e0712/</url>
    <content><![CDATA[<h2 id="日期：2016年7月15日"><a href="#日期：2016年7月15日" class="headerlink" title="日期：2016年7月15日"></a>日期：2016年7月15日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><p>学习完成laravel入门，完成用户部分笔记。</p>
<p>构建laravel基础学习目录。自定义章节：第5章</p>
<p>预计完成web部分学习需要一周时间。</p>
<p>变更计划以时长为3天。后期根据情况调整。</p>
<h3 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p><input checked="" disabled="" type="checkbox"> </p>
<ol start="2">
<li>laravel 快速入门学习</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>学习数据结构</li>
</ol>
</li>
</ul>
<h3 id="3日计划"><a href="#3日计划" class="headerlink" title="3日计划"></a>3日计划</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="2">
<li>laravel 学习</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>学习数据结构</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>了解HTML5 与 CSS3</li>
</ol>
</li>
</ul>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年7月14日</title>
    <url>/2017/12/24/493bc66a74b1/</url>
    <content><![CDATA[<h2 id="日期：2016年7月14日"><a href="#日期：2016年7月14日" class="headerlink" title="日期：2016年7月14日"></a>日期：2016年7月14日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><p>学习完成laravel入门，完成学习笔记。</p>
<p>定制玩家天赋</p>
<h3 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p><input checked="" disabled="" type="checkbox"> </p>
<ol start="2">
<li>定制玩家天赋</li>
</ol>
</li>
<li><p><input checked="" disabled="" type="checkbox"> </p>
<ol start="3">
<li>laravel 快速入门学习</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>学习数据结构</li>
</ol>
</li>
</ul>
<h3 id="明日计划"><a href="#明日计划" class="headerlink" title="明日计划"></a>明日计划</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="2">
<li>laravel 学习</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>学习数据结构</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>了解HTML5 与 CSS3</li>
</ol>
</li>
</ul>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年7月19日</title>
    <url>/2017/12/24/af1bce2431c9/</url>
    <content><![CDATA[<h2 id="日期：2016年7月19日"><a href="#日期：2016年7月19日" class="headerlink" title="日期：2016年7月19日"></a>日期：2016年7月19日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><p>完成laravel HTTP组件学习。</p>
<p>寻找laravel的通信加密方法。</p>
<ul>
<li><p>使用dingo设计API</p>
</li>
<li><p>使用JWT进行通信加密。</p>
</li>
<li><p>JWT与UE4的兼容性有待研究。</p>
</li>
</ul>
<p>路由方法暂定为<code>控制器路由</code>。主要原因是使用缓存访问速度较快。</p>
<p>前端与后端分离是必然。PC端与App端使用的API也应该不同。</p>
<h3 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h3><ul>
<li><input checked="" disabled="" type="checkbox"> <ol>
<li>laravel HTTP组件学习</li>
</ol>
</li>
</ul>
<h3 id="3日计划"><a href="#3日计划" class="headerlink" title="3日计划"></a>3日计划</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="2">
<li>学习laravel 框架与数据部分。</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>学习数据结构</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>了解HTML5 与 CSS3</li>
</ol>
</li>
</ul>
<hr>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年8月3日</title>
    <url>/2016/08/03/1c888c36199a/</url>
    <content><![CDATA[<h2 id="日期：2016年08月03日"><a href="#日期：2016年08月03日" class="headerlink" title="日期：2016年08月03日"></a>日期：2016年08月03日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><p>安装并使用atom，比sublime好用一点。ubuntu下可以输入中文。</p>
<p>有markdown保存为pdf的插件。</p>
<p>完成laravel学习。</p>
<p>花费时间比预计的要长。</p>
<p>截个图吧~</p>
<p><img src="http://i.imgur.com/M4l2d00.png" alt="sp160803_232639"></p>
<h3 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h3><ul>
<li><input checked="" disabled="" type="checkbox"> 1. laravel学习完成。</li>
</ul>
<h3 id="3日计划"><a href="#3日计划" class="headerlink" title="3日计划"></a>3日计划</h3><ul>
<li><p><input disabled="" type="checkbox">  1. 学习gulp与sass</p>
</li>
<li><p><input disabled="" type="checkbox">  2. 学习laravel 服务。</p>
</li>
<li><p><input disabled="" type="checkbox">  3. 学习数据结构</p>
</li>
<li><p><input disabled="" type="checkbox">  4. 了解HTML5 与 CSS3</p>
</li>
<li><p><input disabled="" type="checkbox">  5. bootstrap学习（前端框架）</p>
</li>
<li><p><input disabled="" type="checkbox">  6. 设计网站制作进度表</p>
</li>
</ul>
<hr>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年7月23日</title>
    <url>/2017/12/24/641fa4fb3d6e/</url>
    <content><![CDATA[<h2 id="日期：2016年7月23日"><a href="#日期：2016年7月23日" class="headerlink" title="日期：2016年7月23日"></a>日期：2016年7月23日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><p>学习完成了，laravel 框架与数据部分。</p>
<p>Eloquent ORM 处理数据的优势很大。</p>
<p>感觉上比较容易。对于网站与APP的API实现起来也比较容易。</p>
<p>但是PC端，要考虑双向通信的延时问题。需要玩家等待登录的可能性大。</p>
<p>PC端最大问题可能是地图与玩家匹配。</p>
<p>全球大服务器需要很详细的分析。</p>
<h3 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h3><ul>
<li><input checked="" disabled="" type="checkbox"> <ol>
<li>laravel 框架与数据部分</li>
</ol>
</li>
</ul>
<h3 id="3日计划"><a href="#3日计划" class="headerlink" title="3日计划"></a>3日计划</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="2">
<li>学习laravel 服务。</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>学习数据结构</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>了解HTML5 与 CSS3</li>
</ol>
</li>
</ul>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年7月26日</title>
    <url>/2017/12/24/15254f88885b/</url>
    <content><![CDATA[<h2 id="日期：2016年7月26日"><a href="#日期：2016年7月26日" class="headerlink" title="日期：2016年7月26日"></a>日期：2016年7月26日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><p>整理完成笔记。进入laravel服务学习。</p>
<p>整理网站需求，根据laravel框架，进行调整。</p>
<h3 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h3><ul>
<li><input checked="" disabled="" type="checkbox"> <ol>
<li>laravel Eloquent ORM部分。</li>
</ol>
</li>
</ul>
<h3 id="3日计划"><a href="#3日计划" class="headerlink" title="3日计划"></a>3日计划</h3><ul>
<li><p><input disabled="" type="checkbox"> </p>
<ol>
<li>学习gulp与sass</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="2">
<li>学习laravel 服务。</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="3">
<li>学习数据结构</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="4">
<li>了解HTML5 与 CSS3</li>
</ol>
</li>
<li><p><input disabled="" type="checkbox"> </p>
<ol start="5">
<li>bootstrap学习（前端框架）</li>
</ol>
</li>
</ul>
<hr>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年08月04日</title>
    <url>/2016/08/04/e70a2d79b9a7/</url>
    <content><![CDATA[<h2 id="日期：2016年08月04日"><a href="#日期：2016年08月04日" class="headerlink" title="日期：2016年08月04日"></a>日期：2016年08月04日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><p>打印laravel文档,方便以后研究.</p>
<p>各个平台功能分析.</p>
<p>atom 的 markdown-preview-enhanced 插件有个功能很有意思 <a href="https://rawgit.com/shd101wyy/markdown-preview-enhanced/master/docs/presentation-intro.html">地址</a></p>
<h3 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h3><ul>
<li><p><input checked="" disabled="" type="checkbox">  1. laravel文档打印。</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  2. 安装atom插件,编辑对应笔记</p>
</li>
</ul>
<h3 id="3日计划"><a href="#3日计划" class="headerlink" title="3日计划"></a>3日计划</h3><ul>
<li><p><input disabled="" type="checkbox">  1. 学习gulp与sass</p>
</li>
<li><p><input disabled="" type="checkbox">  2. 学习数据结构</p>
</li>
<li><p><input disabled="" type="checkbox">  3. 了解HTML5 与 CSS3</p>
</li>
<li><p><input disabled="" type="checkbox">  4. bootstrap学习（前端框架）</p>
</li>
<li><p><input disabled="" type="checkbox">  5. 设计网站制作进度表</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年7月27日</title>
    <url>/2017/12/24/0a75986377f6/</url>
    <content><![CDATA[<h2 id="日期：2016年7月27日"><a href="#日期：2016年7月27日" class="headerlink" title="日期：2016年7月27日"></a>日期：2016年7月27日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><p>新头像很好看<del>想要大图</del></p>
<p>laravel 是一个框架，像一座空房子。之后要做的，自然就是装修了。</p>
<p>再根据情况对装修的风格进行设计，这叫<code>用户需求设计</code>。这个词在许多领域是通用的。</p>
<p>一个一个的组件可以看做房子里的家具，每个都有自己的使命。</p>
<p><code>CSS与HTML</code>就是壁纸啊，灯具啊，一些用来欣赏的。也是网页看起来的样子。也是叫前端~</p>
<p><code>API</code>可以看成墙壁上的电源，给手机充电的。实际上用来传递信息。</p>
<p>嗯 28日啦~ 祝我自己生日快乐啦~</p>
<p>愿望是在今年11月的某一天，能做完网站与PC端游戏，贪心一点能做完APP就更好了~</p>
<p>其他：</p>
<p>试用一个叫pandoc的软件，结论是对中文支持并不友好。</p>
<p>用途:转换各种文档的工具。</p>
<h3 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h3><ul>
<li><input checked="" disabled="" type="checkbox"> 1. laravel服务学习，进行中。</li>
</ul>
<h3 id="3日计划"><a href="#3日计划" class="headerlink" title="3日计划"></a>3日计划</h3><ul>
<li><p><input disabled="" type="checkbox">  1. 学习gulp与sass</p>
</li>
<li><p><input disabled="" type="checkbox">  2. 学习laravel 服务。</p>
</li>
<li><p><input disabled="" type="checkbox">  3. 学习数据结构</p>
</li>
<li><p><input disabled="" type="checkbox">  4. 了解HTML5 与 CSS3</p>
</li>
<li><p><input disabled="" type="checkbox">  5. bootstrap学习（前端框架）</p>
</li>
</ul>
<hr>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年08月09日</title>
    <url>/2016/08/09/667843e10b93/</url>
    <content><![CDATA[<h2 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h2><p>复习下HTML与CSS还是简单的.上次用是8年前呢~</p>
<p>因为修改bootstrap时要用到,直接用bootstrap没什么色彩:sob:</p>
<p><a href="http://159.203.2.137/">服务器的地址</a> 域名还没有想好.</p>
<p>然后还要拯救一下我的英文,太烂了:cold_sweat:</p>
<p>游戏的天赋精简到3层,每层4个选1个.</p>
<p>找到了vus.js用了处理前端数据.</p>
<p>总之加油:grey_exclamation:</p>
<hr>
<h2 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h2><ul>
<li><input checked="" disabled="" type="checkbox"> 复习HTML与CSS</li>
</ul>
<hr>
<h2 id="3日计划"><a href="#3日计划" class="headerlink" title="3日计划"></a>3日计划</h2><ul>
<li><p><input disabled="" type="checkbox">  1. 学习gulp与sass</p>
</li>
<li><p><input disabled="" type="checkbox">  2. 学习数据结构</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  3. 了解HTML5 与 CSS3</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  4. bootstrap学习（前端框架）</p>
</li>
<li><p><input disabled="" type="checkbox">  5. 设计网站制作进度表</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年08月05日</title>
    <url>/2016/08/05/36feedf9321b/</url>
    <content><![CDATA[<h2 id="日期：2016年08月05日"><a href="#日期：2016年08月05日" class="headerlink" title="日期：2016年08月05日"></a>日期：2016年08月05日</h2><h3 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h3><p>github.io 上不能挂载 bootstrap 样式,估计要自己写了!</p>
<p><img src="https://ooo.0o0.ooo/2016/08/04/57a416e402aa0.png" alt="2f36b18b336e53d11ad532f8828bac06"></p>
<p>boottstrap还是很简单的,前端除了javascript有点难度,其他的都简单.</p>
<p>下午在digital ocean 弄了一个主机,布置了一下laravel的运行环境.</p>
<p>当然是初步,什么都没有.<a href="http://159.203.2.137/">地址</a></p>
<p>顺手把梯子也设置了,GFW再见了~ :smiley:</p>
<p>网址什么的还在考虑~ 有推荐吗~ 最好又短又好记~ :ghost:</p>
<p>测试jemoji :+1:!</p>
<p><a href="http://www.webpagefx.com/tools/emoji-cheat-sheet/">emoji 使用表</a></p>
<h3 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h3><ul>
<li><input checked="" disabled="" type="checkbox"> 主机初步搭建</li>
</ul>
<h3 id="3日计划"><a href="#3日计划" class="headerlink" title="3日计划"></a>3日计划</h3><ul>
<li><p><input disabled="" type="checkbox">  1. 学习gulp与sass</p>
</li>
<li><p><input disabled="" type="checkbox">  2. 学习数据结构</p>
</li>
<li><p><input disabled="" type="checkbox">  3. 了解HTML5 与 CSS3</p>
</li>
<li><p><input disabled="" type="checkbox">  4. bootstrap学习（前端框架）</p>
</li>
<li><p><input disabled="" type="checkbox">  5. 设计网站制作进度表</p>
</li>
</ul>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年08月28日</title>
    <url>/2016/08/28/f509205cc9a9/</url>
    <content><![CDATA[<h2 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h2><p>参加好友婚礼，新郎一脸的幸福，感觉新娘有点冷，但愿是我想多了。</p>
<p>8月25日到8月27日，布置苹果系统。</p>
<p>网站大部分时间要在MAC上制作。</p>
<p>iphone的APP提上日程？</p>
<p>整个APP部分，11月之前是做不完了。有点小郁闷。</p>
<p>总之还是要先处理好网站与游戏吧。</p>
<p>至于游戏能不能在MAC上运行，还要研究。</p>
<p>MAC 与windows相比最大的优点就 命令行呢。别的还没发现。</p>
<p>然后好多的工具不能在MAC上用。</p>
<p>以上。</p>
<p>随手照片</p>
<p><img src="https://ooo.0o0.ooo/2016/08/28/57c2ffd39fd3c.jpg"></p>
<hr>
<h2 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h2><ul>
<li><input checked="" disabled="" type="checkbox"> 好友婚礼</li>
<li><input checked="" disabled="" type="checkbox"> 处理一些零碎的文档</li>
</ul>
<hr>
<h2 id="3日计划"><a href="#3日计划" class="headerlink" title="3日计划"></a>3日计划</h2><ul>
<li><input disabled="" type="checkbox"> 网站制做</li>
<li><input disabled="" type="checkbox"> 规划游戏的API</li>
<li><input disabled="" type="checkbox"> 规划APP的API</li>
<li><input disabled="" type="checkbox"> 网站的API</li>
</ul>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年09月11日</title>
    <url>/2016/09/11/f54928d0e6bf/</url>
    <content><![CDATA[<h2 id="一些唠叨"><a href="#一些唠叨" class="headerlink" title="一些唠叨"></a>一些唠叨</h2><p>看两周时间能不将网站做到可以访问的状态 😁 😁 😁</p>
<p>sunset的域名被别人注册过了 😞</p>
<p>想想也是必然呢~~ 算是常用词了。</p>
<h2 id="游戏的大概内容"><a href="#游戏的大概内容" class="headerlink" title="游戏的大概内容"></a>游戏的大概内容</h2><p>环境污染严重，人类决定在地表建设，高度30到40米的全新活动层，之下的地方完全被遗弃。</p>
<p>一些人为了探索恢复环境的方法，选择到活动层下去。下层还有一些没有迁移的原住民。</p>
<p>大部分人留在上面，人类在建立活动层后，下方就彻底的沦为了垃圾场。</p>
<p>100 年后，活动层发生破损，再次连接起，活动层上下的人们。</p>
<p>玩家的角色就是两方中的一个。在活动层下，为了各自的信念而战。</p>
<p>其他:嗯，和 有顶棚的车站还是有点像的。 😜 😜</p>
<h2 id="今天计划"><a href="#今天计划" class="headerlink" title="今天计划"></a>今天计划</h2><p>说是今天计划，应该是睡醒之后的事儿了😂 😂 😂</p>
<ul>
<li><p><input checked="" disabled="" type="checkbox">  实验用户注册与密码找回，添加社交账号登录。</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  注册与密码找回，要使用邮件验证功能。</p>
</li>
<li><p><input disabled="" type="checkbox">  在注册时，设定一般用户权限，同时开启对应API。</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  用户API管理在，用户设置中可以找到。</p>
</li>
<li><p><input disabled="" type="checkbox">  游戏 与 APP 登录 直接使用 API授权。</p>
</li>
<li><p><input disabled="" type="checkbox">  努力做到 前端 与 后端 完全 分离。</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  网站间使用HTTPS访问。—— 这个完成一半了，算是容易的。</p>
</li>
</ul>
<hr>
<ul>
<li><p><input checked="" disabled="" type="checkbox">  网站的debug工具安装，与 自动 API 文档 说明</p>
</li>
<li><p><input disabled="" type="checkbox">  了解OAuth2</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  对后台登录，要求使用二次验证登录。</p>
</li>
<li><p><input disabled="" type="checkbox">  计划为同时制作 前端 与 后端 ，后端预计要大量使用 <code>VUE.JS</code></p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  后端默认不开放注册，找回密码时，使用二次验证。</p>
</li>
</ul>
<hr>
<h2 id="明日计划"><a href="#明日计划" class="headerlink" title="明日计划"></a>明日计划</h2><p>构建 文章提交 与  评论</p>
<p>BUG页管理</p>
<hr>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年09月01日</title>
    <url>/2016/09/01/7f162b831ef0/</url>
    <content><![CDATA[<h2 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h2><ul>
<li>在mac上布置开发环境</li>
<li>设计网站基本布局 前端+后端</li>
<li>前端直接修改bootstrap，并结合vue.js，增强界面友好度。</li>
<li>laravel 5.3 支持创建API文档。使用自带工具，就可以实现网页聊天。</li>
<li>估计做完游戏的前几个月，收入要靠广告。</li>
<li>下一阶段，增加商店。嗯，之前都计划好了。</li>
</ul>
<p>:smile_cat::smile_cat::smile_cat:</p>
<p>写下对应的工作笔记。</p>
<hr>
<h2 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h2><ul>
<li><input disabled="" type="checkbox"> 制定网站制作时间表</li>
<li><input disabled="" type="checkbox"> 统计需要的原画</li>
</ul>
<hr>
<h2 id="3日计划"><a href="#3日计划" class="headerlink" title="3日计划"></a>3日计划</h2><ul>
<li><input disabled="" type="checkbox"> 设计网站风格</li>
<li><input disabled="" type="checkbox"> 考虑网站操作合理性</li>
</ul>
<hr>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年08月22日</title>
    <url>/2016/08/23/3677d62d0308/</url>
    <content><![CDATA[<h2 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h2><p>花时间处理一些琐事儿，电脑貌似不喜欢被别人动。</p>
<p>电脑闹脾气了，:kissing_heart:，借这个机会，几台电脑都整理了一下。</p>
<p>javascript也不难，:stuck_out_tongue_closed_eyes:。</p>
<p>然后 嗯～ ， 先弄出一个网站了。</p>
<p>网站制作，估计要2两周吧。看不见的地方更重要。</p>
<p>以上了～</p>
<hr>
<h2 id="今日计划完成度"><a href="#今日计划完成度" class="headerlink" title="今日计划完成度"></a>今日计划完成度</h2><p>空………………</p>
<hr>
<h2 id="3日计划"><a href="#3日计划" class="headerlink" title="3日计划"></a>3日计划</h2><ul>
<li><input disabled="" type="checkbox"> 网站制做</li>
<li><input disabled="" type="checkbox"> 规划游戏的API</li>
<li><input disabled="" type="checkbox"> 规划APP的API</li>
<li><input disabled="" type="checkbox"> 网站的API</li>
</ul>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>Atom设置指南</title>
    <url>/2016/08/04/1afa24ce16ec/</url>
    <content><![CDATA[<h1 id="Atom"><a href="#Atom" class="headerlink" title="Atom"></a>Atom</h1><p><a href="atom.io">官网</a></p>
<h2 id="安装atom"><a href="#安装atom" class="headerlink" title="安装atom"></a>安装atom</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ sudo add-apt-repository ppa:webupd8team/atom</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install atom</span><br></pre></td></tr></table></figure>

<h2 id="atom-packages"><a href="#atom-packages" class="headerlink" title="atom packages"></a>atom packages</h2><h3 id="atom-chrome"><a href="#atom-chrome" class="headerlink" title="atom-chrome"></a>atom-chrome</h3><h3 id="git-plus"><a href="#git-plus" class="headerlink" title="git-plus"></a>git-plus</h3><h3 id="markdown-pdf"><a href="#markdown-pdf" class="headerlink" title="markdown-pdf"></a>markdown-pdf</h3><h3 id="markdown-preview-plus"><a href="#markdown-preview-plus" class="headerlink" title="markdown-preview-plus"></a>markdown-preview-plus</h3><h3 id="markdown-writer"><a href="#markdown-writer" class="headerlink" title="markdown-writer"></a>markdown-writer</h3><h3 id="tidy-markdown"><a href="#tidy-markdown" class="headerlink" title="tidy-markdown"></a>tidy-markdown</h3><h3 id="emmet"><a href="#emmet" class="headerlink" title="emmet"></a>emmet</h3><p>html快速编写工具</p>
<h3 id="jshint"><a href="#jshint" class="headerlink" title="jshint"></a>jshint</h3><p>js语法插件</p>
<h3 id="minimap"><a href="#minimap" class="headerlink" title="minimap"></a>minimap</h3><p>与sublime相似的代码预览</p>
<h3 id="pigments"><a href="#pigments" class="headerlink" title="pigments"></a>pigments</h3><h3 id="markdown-preview-enhanced"><a href="#markdown-preview-enhanced" class="headerlink" title="markdown-preview-enhanced"></a>markdown-preview-enhanced</h3><p><a href="https://github.com/shd101wyy/markdown-preview-enhanced/blob/master/docs/README_CN.md">markdown-preview-enhanced</a></p>
<h4 id="mermaid-渲染-flowchart-和-sequence-diagram"><a href="#mermaid-渲染-flowchart-和-sequence-diagram" class="headerlink" title="mermaid 渲染 flowchart 和 sequence diagram"></a>mermaid 渲染 flowchart 和 sequence diagram</h4><p><a href="http://knsv.github.io/mermaid/#flowcharts-basic-syntax">mermaid 文档</a></p>
<h4 id="KaTex-渲染数学表达式"><a href="#KaTex-渲染数学表达式" class="headerlink" title="KaTex 渲染数学表达式"></a>KaTex 渲染数学表达式</h4><p>需要学习LaTeX语法</p>
<p><a href="https://github.com/Khan/KaTeX/wiki">KaTeX</a></p>
<p><a href="http://mlworks.cn/posts/introduction-to-mathjax-and-latex-expression/">参考1</a></p>
<p>$$\oint_C x^3, dx + 4y^2, dy 2 = \left( \frac{\left(3-x\right) \times 2}{3-x} \right)$$</p>
<p>$$\sum_{m=1}^\infty\sum_{n=1}^\infty\frac{m^2,n} {3^m\left(m,3^n+n,3^m\right)}$$</p>
<p>$$\phi_n(\kappa) = \frac{1}{4\pi^2\kappa^2} \int_0^\infty \frac{\sin(\kappa R)}{\kappa R} \frac{\partial}{\partial R} \left[R^2\frac{\partial D_n(R)}{\partial R}\right],dR$$</p>
<p><img src="http://i.imgur.com/PzFRo0S.png" alt="sp160804_133226"></p>
<!-- ![sp160804_133226](/assets/sp160804_133226.png) -->

<h4 id="PlantUML-渲染图形"><a href="#PlantUML-渲染图形" class="headerlink" title="PlantUML 渲染图形"></a>PlantUML 渲染图形</h4><p><a href="http://zh.plantuml.com/">PlantUML</a></p>
<h4 id="WaveDrom-来渲染-digital-timing-diagram"><a href="#WaveDrom-来渲染-digital-timing-diagram" class="headerlink" title="WaveDrom 来渲染 digital timing diagram."></a>WaveDrom 来渲染 digital timing diagram.</h4><p><a href="http://wavedrom.com/tutorial.html">WaveDrom</a></p>
<p>使用json样式文本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;signal: [</span><br><span class="line">  &#123;name:&#x27;clk&#x27;, wave: &#x27;p.....PPPPp....&#x27; &#125;,</span><br><span class="line">  &#123;name:&#x27;dat&#x27;, wave: &#x27;x....2345x.....&#x27;, data: &#x27;a b c d&#x27; &#125;,</span><br><span class="line">  &#123;name:&#x27;req&#x27;, wave: &#x27;0....1...0.....&#x27; &#125;</span><br><span class="line">],</span><br><span class="line">head: &#123;text:</span><br><span class="line">  [&#x27;tspan&#x27;,</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;class:&#x27;error h1&#x27;&#125;, &#x27;error &#x27;],</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;class:&#x27;warning h2&#x27;&#125;, &#x27;warning &#x27;],</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;class:&#x27;info h3&#x27;&#125;, &#x27;info &#x27;],</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;class:&#x27;success h4&#x27;&#125;, &#x27;success &#x27;],</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;class:&#x27;muted h5&#x27;&#125;, &#x27;muted &#x27;],</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;class:&#x27;h6&#x27;&#125;, &#x27;h6 &#x27;],</span><br><span class="line">    &#x27;default &#x27;,</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;fill:&#x27;pink&#x27;, &#x27;font-weight&#x27;:&#x27;bold&#x27;, &#x27;font-style&#x27;:&#x27;italic&#x27;&#125;, &#x27;pink-bold-italic&#x27;]</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br><span class="line">foot: &#123;text:</span><br><span class="line">  [&#x27;tspan&#x27;, &#x27;E=mc&#x27;,</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;dy:&#x27;-5&#x27;&#125;, &#x27;2&#x27;],</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;dy: &#x27;5&#x27;&#125;, &#x27;. &#x27;],</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;&#x27;font-size&#x27;:&#x27;25&#x27;&#125;, &#x27;B &#x27;],</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;&#x27;text-decoration&#x27;:&#x27;overline&#x27;&#125;,&#x27;over &#x27;],</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;&#x27;text-decoration&#x27;:&#x27;underline&#x27;&#125;,&#x27;under &#x27;],</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;&#x27;baseline-shift&#x27;:&#x27;sub&#x27;&#125;, &#x27;sub &#x27;],</span><br><span class="line">    [&#x27;tspan&#x27;, &#123;&#x27;baseline-shift&#x27;:&#x27;super&#x27;&#125;, &#x27;super &#x27;]</span><br><span class="line">  ],tock:-5</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="http://i.imgur.com/6fP55cx.png" alt="sp160804_133234"></p>
<!-- ![sp160804_133234](/assets/sp160804_133234.png) -->

<h4 id="Viz-js-来渲染-dot-language-图形"><a href="#Viz-js-来渲染-dot-language-图形" class="headerlink" title="Viz.js 来渲染 dot language 图形."></a>Viz.js 来渲染 dot language 图形.</h4><p><a href="https://en.wikipedia.org/wiki/DOT_(graph_description_language)">dot</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">graph ethane &#123;</span><br><span class="line">        C_0 -- H_0 [type=s];</span><br><span class="line">        C_0 -- H_1 [type=s];</span><br><span class="line">        C_0 -- H_2 [type=s];</span><br><span class="line">        C_0 -- C_1 [type=s];</span><br><span class="line">        C_1 -- H_3 [type=s];</span><br><span class="line">        C_1 -- H_4 [type=s];</span><br><span class="line">        C_1 -- H_5 [type=s];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="http://i.imgur.com/FVuu5Tw.png" alt="sp160804_133243"></p>
<!-- ![sp160804_133243](/assets/sp160804_133243.png) -->

<h4 id="reveal-js-来渲染漂亮的-presentations"><a href="#reveal-js-来渲染漂亮的-presentations" class="headerlink" title="reveal.js 来渲染漂亮的 presentations"></a>reveal.js 来渲染漂亮的 presentations</h4><p>幻灯片样式</p>
<p><a href="https://rawgit.com/shd101wyy/markdown-preview-enhanced/master/docs/presentation-intro.html">presentations</a></p>
]]></content>
      <categories>
        <category>ubuntu</category>
      </categories>
      <tags>
        <tag>ubuntu</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年08月13日</title>
    <url>/2016/08/13/33f6b68b3a97/</url>
    <content><![CDATA[<h2 id="今日记录"><a href="#今日记录" class="headerlink" title="今日记录"></a>今日记录</h2><p>心情极差。坏心情在肚子里烂掉算了，说出来只会更糟。</p>
<p>前两天注册了几个域名，留着私房用～</p>
<p>算是少数能提起精神的事儿</p>
<p>域名有五个</p>
<p><a href="http://janelovescherry.cf/">第一个</a></p>
<p><a href="http://janelovescherry.ga/">第二个</a></p>
<p><a href="http://janelovescherry.gq/">第三个</a></p>
<p><a href="http://janelovescherry.ml/">第四个</a></p>
<p><a href="http://janelovescherry.tk/">第五个</a></p>
<p>正式域名没想好之前，为了方便测试用。</p>
<p>以后大概会改成博客吧。</p>
<p>还处理了一些网站部署的问题，过几天网站，应该每天都有变化。</p>
<p>网站和游戏做完后，想放到<code>kickstarter.com</code>去众筹呢。</p>
<h2 id="明日计划"><a href="#明日计划" class="headerlink" title="明日计划"></a>明日计划</h2><p>清理下剩余的技术文档。要忙起来了。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>关于域名呐~</title>
    <url>/2016/09/30/eae16d0fc7b0/</url>
    <content><![CDATA[<h2 id="说明-1"><a href="#说明-1" class="headerlink" title="说明 1"></a>说明 1</h2><p>怪我之前没说过。</p>
<p><code>.ml</code>的域名代表着，马里共和国</p>
<p>是非洲西部的一个小国，没有办法用在比较重要的地方。</p>
<p><code>.cn</code>指明是中国，<code>.ca</code>是枫叶国，<code>.co.jp</code>是日本样。</p>
<p><code>.us</code>是美国，不常见是因为都去用<code>.com</code>了😂</p>
<p><code>.com</code>被默认国际化的域名，是<code>Commercial organization</code>的缩写。</p>
<h2 id="说明-2"><a href="#说明-2" class="headerlink" title="说明 2"></a>说明 2</h2><p>网站在mac上看不完整，没有测试过还是我的锅😳</p>
<p>用下面的这个吧</p>
<p><a href="https://www.namecheap.com/"></a></p>
<p><img src="https://ooo.0o0.ooo/2016/09/29/57ed4b3058596.png"></p>
<h2 id="最重要的"><a href="#最重要的" class="headerlink" title="最重要的~~~"></a>最重要的~~~</h2><p>真的很喜欢<code>mystery.ml</code>就用这个也问题啦~~👻 👻 👻</p>
<p>域名不一定要一个词的，只要方便让人记住，怎么用都是可以的~</p>
<p>以上~~~😊</p>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>域名超过  <code>$100 USD/year</code> 就算是天价 😡</p>
<p><img src="https://ooo.0o0.ooo/2016/09/29/57ed50211fb7a.png"></p>
<p>然后访问下,查询到的<code>mysterygame.com</code></p>
<p>看吧~</p>
<p><img src="https://ooo.0o0.ooo/2016/09/29/57ed511b3364d.png"></p>
<p>最后，没有注册的访问后是下面这样的。</p>
<p><img src="https://ooo.0o0.ooo/2016/09/29/57ed51e12f9c3.png"></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2016年09月27日</title>
    <url>/2016/09/27/be2f5bdae284/</url>
    <content><![CDATA[<h2 id="碎碎念"><a href="#碎碎念" class="headerlink" title="碎碎念"></a>碎碎念</h2><p>网站还没有弄完😱😱😱</p>
<p><img src="https://ooo.0o0.ooo/2016/09/27/57e9f8aa4b0fb.png"></p>
<p>算是能看了，后端还没有处理 😭😭😭</p>
<p>满满的Twitter样式…… 这个要根据游戏做对应的调整。可以之后慢慢弄。</p>
<p>莫名的无力感……</p>
<p>parallel 依然被注册了</p>
<p>附上一个域名查询地址 <a href="http://www.freenom.com/">freenom.com</a></p>
<p>如果看不全的话，登录下就可以了~</p>
<h2 id="今天计划"><a href="#今天计划" class="headerlink" title="今天计划"></a>今天计划</h2><ul>
<li><input disabled="" type="checkbox"> 制作网站</li>
</ul>
<hr>
<h2 id="最近计划"><a href="#最近计划" class="headerlink" title="最近计划"></a>最近计划</h2><ul>
<li><input disabled="" type="checkbox"> 完成网站！</li>
</ul>
<hr>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2017年12月27日</title>
    <url>/2017/12/27/4dd444f59f3a/</url>
    <content><![CDATA[<h1 id="小记"><a href="#小记" class="headerlink" title="小记"></a>小记</h1><p>为什么写日记，写日记可以让心情变好。</p>
<p>精神上的伤害远比肉体上的猛烈！！</p>
<p>失眠、疲惫、测试<code>bitbeans/Yubikey</code>包。</p>
<p>版本年代久远，手动修改一行，成功攻略。</p>
<h2 id="bitbeans-Yubikey的坑"><a href="#bitbeans-Yubikey的坑" class="headerlink" title="bitbeans/Yubikey的坑"></a><code>bitbeans/Yubikey</code>的坑</h2><p><code>src\YubiKey.php</code>第376行。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">--  while (list($key, $val) = each($rows)) &#123;</span><br><span class="line">++  foreach($rows as $key =&gt; $val)&#123;</span><br></pre></td></tr></table></figure>

<p><code>app/config/yubikey.php</code>中设置<code>CLIENT_ID</code> 与 <code>SECRET_KEY</code><br>控制器中使用。<br>注意：要先验证<code>otp</code>验证<code>identity</code>。<br>OTP = One Time Password</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">use YubiKey;</span><br><span class="line"></span><br><span class="line">// 验证OTP 返回 true or false</span><br><span class="line">$yubikey_auth = Yubikey::verify(Input::get(&#x27;otp&#x27;));</span><br><span class="line">// 排部 返回信息</span><br><span class="line">$yubikey_params = Yubikey::getParameters();</span><br><span class="line">// 获取返回信息中的`identity`字段，yubikey的硬件ID，通常捆绑用户名</span><br><span class="line">$yubikey_identity = Yubikey::getParameter(&#x27;identity&#x27;);</span><br></pre></td></tr></table></figure>

<h2 id="yubikey-是什么"><a href="#yubikey-是什么" class="headerlink" title="yubikey 是什么"></a>yubikey 是什么</h2><p>简单的说，不能保存文件的u盘，只用来验证身份。<br>长下面的样子。</p>
<p><img src="https://i.loli.net/2017/12/27/5a435d53dd617.png" alt="yubikey-4-series-sept-2017-444x444"></p>
<p>可以用来登陆电脑、提供一次性密码等等。 使用时按一下金属部分，就产生一串随机密码，30秒有效，验证窗口为1分30秒。</p>
<p>结合SSH登陆服务器安全性非常高。</p>
<p><strong>什么？你说windows？完全没安全性呢。</strong></p>
<p>还可以用来保存加密的密钥，解密时，要求提供密钥并插入yubikey。加密过文件10年内是不太可能被破解的。</p>
<p><strong>什么？yubikey丢了？嗯，放弃文件吧🤓</strong><br>这时候用2个yubikey就好了~~😂</p>
<p>最后可以就来加解密电子邮件，<code>Edward Joseph Snowden</code>告诉我们监控无处不在，在不暴露私钥的情况下，加密过的邮件是安全的。</p>
<p><code>yubikey</code>的私钥解密时要插入USB接口，不丢失的情况下无解。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>最后放个公钥，可以用来加密给我的邮件哦~ 欢迎勾搭~</p>
<p><a href="mailto:&#x6b;&#x31;&#49;&#x40;&#107;&#x65;&#108;&#x65;&#118;&#x65;&#110;&#x2e;&#109;&#101;">&#x6b;&#x31;&#49;&#x40;&#107;&#x65;&#108;&#x65;&#118;&#x65;&#110;&#x2e;&#109;&#101;</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-----BEGIN PGP PUBLIC KEY BLOCK-----</span><br><span class="line">mQINBFo/qwcBEAC3Pkl084A+27oVOBbgx7wzos05EjNWXYVUeEI4D1TY3JgJQ7kD</span><br><span class="line">n9q4KIFeqt9/mrpdxfTMLlNy/GOYdfDiB3W7aJQtI4Zn+nFy2ZHa9KSLrfi7FHFa</span><br><span class="line">++sPH2D5H0OFLq3DVoe56qn37m8rlhuv4ZUvqWyYrlV/L5S83TXFZEzQhwjvirx9</span><br><span class="line">BYdsxmzITEwvzfgDIE+lYTk8ULvf8yvOWQ5dlIfwkcSdDLJp1VCmoyKKfEtCY2Oo</span><br><span class="line">THy4XCpzEG6Tas3tOGWUcPxpBVm+b1ZSLGwPvzcwQr5TW4NmgKkH3cvWQGFLGajV</span><br><span class="line">0iZbobTKMEnRM7b+N+mEq4D/JRnPz9eYa2p1wtHS9L7EGuWzclb9Pg0ofZ3b3/mr</span><br><span class="line">llcbONj2DbGX4+20a2Ykr8H5kI+57D+LyIeGpsnL/XY5ehDQe+IMlDjOuwXDW4Vf</span><br><span class="line">ba5uIfqziQIaTzo1Ar+45OU8JmU8zLQx6vWu1a7lziBN0Q1Ztds1bMcgIwrn0S0v</span><br><span class="line">g4P34MI1bZphOQUAVsLpQnSusYPUasZVpEJ2knS7XL9v5XZLS40e5Uyder12AXjr</span><br><span class="line">47XHJ5peDBU76J2Cpp4qxAsxTOXS9RCi/XrPSC+7o2DUgtDzEUfGEdBd6o6cg4xZ</span><br><span class="line">e6dKLpLq8XJphuRIOWQawsOGxOc/wFkywsFyVVde/HFHv1zZtVJJwo53MQARAQAB</span><br><span class="line">tBhrZWxldmVuIDxrMTFAa2VsZXZlbi5tZT6JAlMEEwEIAD4WIQRXOvWRKhYRvxI9</span><br><span class="line">4a+dtsqqnxJQ1QUCWj+rBwIbAwUJB4YfgAULCQgHAgYVCAkKCwIEFgIDAQIeAQIX</span><br><span class="line">gAAKCRCdtsqqnxJQ1Rl3D/iXNoVFfl74kTC2SZtczMx0pBcvcwUxIOd/ggJfRSK4</span><br><span class="line">iAv29JLtTLJzLKnSf07DuGyWf0MCRqbJe7dxNpHmpWH3gkdgYA8W7B4Fx2eNn4wJ</span><br><span class="line">6mXOAWezlQrsFDlKQHfJRREe1GqtfHdLDYLT02dCby/IGnv4Yos+3grcOhsStcMn</span><br><span class="line">nw0WOE0Oj+gOGdmxmvB2nEE2c625zEtGGSNc9KOWzmaGw4S5pTm/QUwO41KXrmB/</span><br><span class="line">qH/fmNpWe8oIyxVd+JTNQJMrk4Jd9HiKFnAlu630gjtnEWqZiv34HzTM+++isOzi</span><br><span class="line">ZFsbf5wulXY9Sh69R9jcXFI+4Q5v6vCgJEUyZs/OosjEjpYfPF5q2xnNTK1Cy/C9</span><br><span class="line">qJnoTDGs6J1l8Yk3NukdcRndUsYUn8+5BnhfiEPQ29AkLLj5TqDa+YtCVTvfI0OG</span><br><span class="line">t98vINrw+Qw0M262vRtbHzscVcoNqraPe55kCgZe0S/hvhs1uApt71Z4IDlOe5O5</span><br><span class="line">lAMqne7zxco1gpriJHtXJgQPkBpPbM+BZ49ruZ1X1FvVmdgsMl8kQeHzkSuBR/Pz</span><br><span class="line">g8FD9g8LJOCM+4tFevdPxUbHZwfbnTDshVhsrtVgzfBxclGfxZuzHBK0CiLOgKvy</span><br><span class="line">8ik/hLas0wCJrFCur2qlIoz/UwQi8bAbAJANoCUG7QRwQk8vZBCZKkZrw6iaRTqO</span><br><span class="line">uQINBFo/qwcBEACkBGy4TArlk6uWh80IN09lDlxeNPkZGIw2/fubP+ndy8dM9qpE</span><br><span class="line">utuXipK1fzEUX0Q4c92FQWRxYQpxsyj2LjtUZZlYcGQCq4tIfaxBIM9DB1uZ509T</span><br><span class="line">5XthHPzV5P3GN4wxLsgVdt465l6UKJcylPcZnFgJbIupV2SyK29HNlC4dS6rSHYX</span><br><span class="line">VV3MphNkFFxVeoHlyAmei1Ph6eyKYbeUwR6K9Z4qRL7upIkwSphJOU4nbGs+0Bz6</span><br><span class="line">YjHl5vWcYkJXaJvsBGdj4gSZEir6Nx2qLuUOhuq4tVmB4DrJkxGG0QhHKaDglwiS</span><br><span class="line">Yx+4QssJ58SrLOH0RC6dnWKDX8yUTMrl21W4CtpeTo1/32RX23SSJPCPFqBJIsIp</span><br><span class="line">yx0SC8+MY9CfUznNors6oPcNyXkz3ffuiBqgLvokwi/gBBo8030EN4201rqvDqKx</span><br><span class="line">uJ9usIh6iuhDszWY0RrUFuAjXrJJVh1PXGH65yDiaBTasaJ39IGvM4a3kPKS5lPI</span><br><span class="line">5rD3imYjWe62+ki8LP5TPX1N/86ZZwuuLiiTSGku1nr5L+8cM74wJOVb2QQnCkOz</span><br><span class="line">kvL8Ki50hu/doGTaBiJehGBcrN+zb1oNjZaGonzhxxStzc7eZ3GMuidZi8jNX+f/</span><br><span class="line">6XTs/X1BNywtUwNWJUsqvUMbHtITuFtstM0+8X4N6YQQ0WQqxhC7KEsRkQARAQAB</span><br><span class="line">iQI8BBgBCAAmFiEEVzr1kSoWEb8SPeGvnbbKqp8SUNUFAlo/qwcCGwwFCQeGH4AA</span><br><span class="line">CgkQnbbKqp8SUNX0FA//SwRxUbyLQDcQWq6ScTH1Ym8N2JuST+QILmmvYsonPudV</span><br><span class="line">BbJwn9OYnU3mwkr0fCsb6inlApcEM5KlgaXYvQW7UmeNjo8fcdjgkiMh9eZHmRqi</span><br><span class="line">VUSr7zuJ2NlKdubptorh7EnmAV0IURgcBLdmyO9ZKYpS708nb5S4O7EY2T2hFSq4</span><br><span class="line">y8XklhHNm8kiD1JfjKqjNaMgz0oTBqlXBNlphiCEn5C3hPov8IqcL+qh5qRpQe/G</span><br><span class="line">yJ9ZSDfBNkw8iTN7+W0T0JC6POgWOUADw9lngYRB69bXkCcymNgsAKagS+mAJfRo</span><br><span class="line">jRq11qFCFLRjRhvDgy9THM7RkIS7HKaxkfoIUaj8vER5giAapoNtLIvlOj36XNeo</span><br><span class="line">Y8Z2Eqk6IOT3zv5E0AgfDgF0k01QQ47T4dU7HDGcURNXQmEZIID2GQjoxxLvBABS</span><br><span class="line">fvCi0kt/4KXNsAadfCz7vCuh4wjY11ZWsPGXhOj9/WKJU8FoyeVwXeJO4iPrlWRo</span><br><span class="line">1ctcUo7s8GrJWkAmd+lT6QSus7+eB7bMjgDDItcY3Xiz91+ijkZvcYMVDIbLBZog</span><br><span class="line">THNXc3XpzqGw1pgb7ehsjJxkqmG6FYPOZZ/wVqosit1+tNmmRK0MPitvO6LBBG6J</span><br><span class="line">kDSEWJun3tv0R0zNtv494ZfD29MmQEi1RFV1qbGEW4LlP19jnNhlr3pP2Xt18Kg=</span><br><span class="line">=7zR2</span><br><span class="line">-----END PGP PUBLIC KEY BLOCK-----</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>yubikey</tag>
      </tags>
  </entry>
  <entry>
    <title>ssh使用公钥 与 yubikey OTP</title>
    <url>/2017/12/24/1328b76df7ad/</url>
    <content><![CDATA[<h1 id="修改ssh-使用公钥-与-yubikey-OTP"><a href="#修改ssh-使用公钥-与-yubikey-OTP" class="headerlink" title="修改ssh 使用公钥 与  yubikey OTP"></a>修改ssh 使用公钥 与  yubikey OTP</h1><h2 id="ssh-部分"><a href="#ssh-部分" class="headerlink" title="ssh 部分"></a>ssh 部分</h2><p>在 <code>~/.ssh/authorized_keys</code>中添加公钥。没有文件则手动创建。</p>
<p>修改<code>sudo nano /etc/ssh/sshd_config</code>中的</p>
<ul>
<li>修改 <code>SSH</code> 登陆端口 <code>Port 22</code></li>
<li>可选 禁止Root用户密码登陆<br><code>PermitRootLogin without-password</code></li>
</ul>
<p>重启<code>SSH</code>服务</p>
<h2 id="yubikey-部分"><a href="#yubikey-部分" class="headerlink" title="yubikey 部分"></a>yubikey 部分</h2><p>添加<code>yubikey</code>软件源</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository ppa:yubico/stable</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install libpam-yubico</span><br></pre></td></tr></table></figure>

<p>在<code>/etc/pam.d/sshd</code> 中添加<code>id</code>,<code>key</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/pam.d/sshd</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">auth sufficient pam_yubico.so id=&lt;ID&gt; key=&lt;API_KEY&gt; debug authfile=/etc/yubikey_mappings mode=client</span><br></pre></td></tr></table></figure>

<p>创建<code>/etc/yubikey_mappings</code> 设置用户与对应的<code>yubikey </code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/yubikey_mappings</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;user1&gt;:&lt;cccccyubikey1&gt;:&lt;cccccyubikey2&gt;</span><br><span class="line">&lt;user2&gt;:&lt;cccccyubikey3&gt;</span><br></pre></td></tr></table></figure>

<p>设置<code>ssh</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>

<p>修改<code>ChallengeResponseAuthentication no</code>为<code>yes</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ChallengeResponseAuthentication yes</span><br></pre></td></tr></table></figure>

<p>增加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AuthenticationMethods publickey,keyboard-interactive:pam</span><br></pre></td></tr></table></figure>

<p>重启SSH</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo service sshd restart</span><br></pre></td></tr></table></figure>

<p><a href="https://medium.com/@james_poole/yubikey-2fa-on-ubuntu-ssh-e09b4e91bfc8">参考文档 1</a><br><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-ssh-keys--2">参考文档 2</a></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>ubuntu</tag>
        <tag>yubikey</tag>
        <tag>ssh</tag>
      </tags>
  </entry>
  <entry>
    <title>转眼 2020</title>
    <url>/2020/01/03/8dce33c70dd8/</url>
    <content><![CDATA[<h1 id="2020-新年快乐"><a href="#2020-新年快乐" class="headerlink" title="2020 新年快乐"></a>2020 新年快乐</h1><p>希望今年大多数关心事情都有一个好的结果！</p>
<h1 id="健身环"><a href="#健身环" class="headerlink" title="健身环"></a>健身环</h1><p>健身环还是有用的，真的会瘦哦~</p>
<h1 id="划分功能"><a href="#划分功能" class="headerlink" title="划分功能"></a>划分功能</h1><p>对功能进行划分。</p>
<p>服务器端监听<code>socket</code>有点浪费资源就先不想了。</p>
<p>多服务器控制划分让人一吵都一点烦。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>Lamy</title>
    <url>/2017/07/27/20654ed62ee2/</url>
    <content><![CDATA[<h1 id="lamy"><a href="#lamy" class="headerlink" title="lamy"></a>lamy</h1><table>
<thead>
<tr>
<th align="left">Item</th>
<th align="center">Size</th>
<th align="center">QTY(Quantity)</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Lamy AL-star black Fountain pen</td>
<td align="center">F</td>
<td align="center">1</td>
<td align="left">钢笔</td>
</tr>
<tr>
<td align="left">Lamy AL-star black Mechanical pencil</td>
<td align="center">0.7 HB</td>
<td align="center">1</td>
<td align="left">自动铅笔</td>
</tr>
<tr>
<td align="left">LAMY pencil lead</td>
<td align="center">-</td>
<td align="center">1</td>
<td align="left">铅笔芯</td>
</tr>
<tr>
<td align="left">LAMY spare eraser tip</td>
<td align="center">-</td>
<td align="center">1</td>
<td align="left">铅笔橡皮</td>
</tr>
<tr>
<td align="left">LAMY AL-star black Special Edition Ballpoint pen</td>
<td align="center">black F</td>
<td align="center">1</td>
<td align="left">签字笔</td>
</tr>
<tr>
<td align="left">LAMY giant ballpoint pen refill</td>
<td align="center">black F</td>
<td align="center">2</td>
<td align="left">签字笔芯</td>
</tr>
</tbody></table>
<p>说明：</p>
<p>  钢笔与签字笔的笔芯大小不同，买的时候注意下。</p>
<p>  钢笔 笔尖<code>F尖</code>。<br>  签字笔 笔尖<code>F尖</code>，笔芯<code>黑色</code>。</p>
<p>  三种笔的外观都要黑色。</p>
<p>下方是外观识别：</p>
<p><img src="https://ooo.0o0.ooo/2016/09/14/57d91786165e1.png"></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>lamy</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel logs</title>
    <url>/2020/01/10/b78e679b0fa4/</url>
    <content><![CDATA[<h1 id="为laravel-logs添加自定义格式与处理方法"><a href="#为laravel-logs添加自定义格式与处理方法" class="headerlink" title="为laravel logs添加自定义格式与处理方法"></a>为laravel logs添加自定义格式与处理方法</h1><p><code>Monolog\Formatter\LineFormatter</code> 用来定义<code>log</code>内容。</p>
<p><code>Monolog\Processor\IntrospectionProcessor</code> 用来获取控制器、方法、行数。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Logging</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Monolog</span>\<span class="title">Logger</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Monolog</span>\<span class="title">Formatter</span>\<span class="title">LineFormatter</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Monolog</span>\<span class="title">Processor</span>\<span class="title">IntrospectionProcessor</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收log</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestLogging</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$logFormat</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$dateFormat</span> = <span class="string">&#x27;Y/m/d H:i:s&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 设置行内容</span></span><br><span class="line">        <span class="variable">$cols</span> = [</span><br><span class="line">            <span class="string">&quot;%datetime%&quot;</span>,</span><br><span class="line">            <span class="string">&quot;[%channel%.%level_name%]&quot;</span>,</span><br><span class="line">            <span class="string">&quot;%extra.class%@%extra.function%(%extra.line%)&quot;</span>, </span><br><span class="line">            <span class="string">&quot;%message%&quot;</span>,</span><br><span class="line">            <span class="string">&quot;%context%&quot;</span>,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 成表格</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;logFormat = implode(<span class="string">&quot;\t&quot;</span>, <span class="variable">$cols</span>) . PHP_EOL;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$monolog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// 定义新的日记样式</span></span><br><span class="line">        <span class="variable">$formatter</span> = <span class="keyword">new</span> LineFormatter(<span class="keyword">$this</span>-&gt;logFormat, <span class="keyword">$this</span>-&gt;dateFormat, <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 控制器 内容追加</span></span><br><span class="line">        <span class="variable">$ip</span> = <span class="keyword">new</span> IntrospectionProcessor(Logger::DEBUG, [] , <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$monolog</span>-&gt;getHandlers() <span class="keyword">as</span> <span class="variable">$handler</span>) &#123;</span><br><span class="line">            <span class="variable">$handler</span>-&gt;setFormatter(<span class="variable">$formatter</span>);</span><br><span class="line">            <span class="variable">$handler</span>-&gt;pushProcessor(<span class="variable">$ip</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="设置logging-php"><a href="#设置logging-php" class="headerlink" title="设置logging.php"></a>设置logging.php</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;daily&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;daily&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;tap&#x27;</span> =&gt; [App\Logging\TestLogging::class],</span><br><span class="line">    <span class="string">&#x27;path&#x27;</span> =&gt; storage_path(<span class="string">&#x27;logs/laravel.log&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;level&#x27;</span> =&gt; <span class="string">&#x27;debug&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;days&#x27;</span> =&gt; <span class="number">14</span>,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p><a href="https://qiita.com/nuuuuume/items/a6bcf340c50f18cfb71c">参考1</a><br><a href="https://qiita.com/k_hoso/items/5070873721d48529635f">参考2</a></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>Clashx</title>
    <url>/2020/01/11/cad7debc9bfa/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>移动网络天生带墙</p>
<p><code>v2ray</code> 使用不能</p>
<p>尝试<code>trojan</code>，不能使用 <code>cloudflare</code> ，不能使用<code>nginx</code>反正代理 </p>
<p>放弃。</p>
<h1 id="Clashx"><a href="#Clashx" class="headerlink" title="Clashx"></a>Clashx</h1><p><code>mac</code>上<code>v2rayX</code>经常崩溃。换到<code>ClashX</code></p>
<p>设置全部在<code>config.yml</code>中不复杂</p>
<p><code>Clash</code>用在<code>windows</code></p>
<p><code>ClashX</code>用在<code>mac</code> </p>
<p>设置方向相同</p>
<p><a href="https://github.com/Dreamacro/clash">文档使用Clash</a></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel 包中创建新 view 并使用 vue-route</title>
    <url>/2020/01/16/66267133e2af/</url>
    <content><![CDATA[<h1 id="laravel-包中创建新-view-并使用-vue-route"><a href="#laravel-包中创建新-view-并使用-vue-route" class="headerlink" title="laravel 包中创建新 view 并使用 vue-route"></a>laravel 包中创建新 view 并使用 vue-route</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>自行开发的<code>laravel</code>扩展包少不了<code>UI</code>的显示。</p>
<p>官方又没有写明，于是就踩了不少的坑。</p>
<p>填坑方法如下。</p>
<h2 id="js-设置文件"><a href="#js-设置文件" class="headerlink" title="js 设置文件"></a>js 设置文件</h2><h3 id="package-json"><a href="#package-json" class="headerlink" title="package.json"></a>package.json</h3><p>复制<code>laravel</code>最初的设置就好</p>
<h3 id="webpack-mix-js"><a href="#webpack-mix-js" class="headerlink" title="webpack.mix.js"></a>webpack.mix.js</h3><p>注意<code>copy</code>到对应的<code>laravel</code>项目路径</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> mix = <span class="built_in">require</span>(<span class="string">&#x27;laravel-mix&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mix.setPublicPath(<span class="string">&#x27;public&#x27;</span>)</span><br><span class="line">    .js(<span class="string">&#x27;resources/js/app.js&#x27;</span>, <span class="string">&#x27;public&#x27;</span>)</span><br><span class="line">    .sass(<span class="string">&#x27;resources/sass/app.scss&#x27;</span>, <span class="string">&#x27;public&#x27;</span>)</span><br><span class="line">    .copy(<span class="string">&#x27;public&#x27;</span>, <span class="string">&#x27;../../../web/public/vendor/logsservice&#x27;</span>)</span><br><span class="line">    .webpackConfig(&#123;</span><br><span class="line">        <span class="attr">resolve</span>: &#123;</span><br><span class="line">            <span class="attr">symlinks</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">alias</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;@&#x27;</span>: path.resolve(__dirname, <span class="string">&#x27;resources/js/&#x27;</span>),</span><br><span class="line">            &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">plugins</span>: [<span class="keyword">new</span> webpack.IgnorePlugin(<span class="regexp">/^\.\/locale$/</span>, <span class="regexp">/moment$/</span>)],</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="resources-文件夹"><a href="#resources-文件夹" class="headerlink" title="resources 文件夹"></a>resources 文件夹</h3><h4 id="app-js"><a href="#app-js" class="headerlink" title="app.js"></a>app.js</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Routes <span class="keyword">from</span> <span class="string">&#x27;./routes&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;vue-router&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; BootstrapVue, IconsPlugin &#125; <span class="keyword">from</span> <span class="string">&#x27;bootstrap-vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment-timezone&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;./socket&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> token = <span class="built_in">document</span>.head.querySelector(<span class="string">&#x27;meta[name=&quot;csrf-token&quot;]&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (token) &#123;</span><br><span class="line">    axios.defaults.headers.common[<span class="string">&#x27;X-CSRF-TOKEN&#x27;</span>] = token.content;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter);</span><br><span class="line">Vue.use(BootstrapVue);</span><br><span class="line">Vue.use(IconsPlugin);</span><br><span class="line"></span><br><span class="line">moment.tz.setDefault(LogsService.timezone);</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.LogsService.basePath = <span class="string">&#x27;/&#x27;</span> + <span class="built_in">window</span>.LogsService.path;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> routerBasePath = <span class="built_in">window</span>.LogsService.basePath + <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.LogsService.path === <span class="string">&#x27;&#x27;</span> || <span class="built_in">window</span>.LogsService.path === <span class="string">&#x27;/&#x27;</span>) &#123;</span><br><span class="line">    routerBasePath = <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">    <span class="built_in">window</span>.LogsService.basePath = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">    <span class="attr">routes</span>: Routes,</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&#x27;history&#x27;</span>,</span><br><span class="line">    <span class="attr">base</span>: routerBasePath,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">	router,</span><br><span class="line">	<span class="attr">el</span>: <span class="string">&#x27;#logs&#x27;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="routes-js"><a href="#routes-js" class="headerlink" title="routes.js"></a>routes.js</h4><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> [</span><br><span class="line">	&#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span> , <span class="attr">redirect</span>: <span class="string">&#x27;/home&#x27;</span> &#125;,</span><br><span class="line">	&#123; </span><br><span class="line">		<span class="attr">path</span>: <span class="string">&#x27;/home&#x27;</span> ,</span><br><span class="line">		<span class="attr">name</span>: <span class="string">&#x27;home&#x27;</span>, </span><br><span class="line">		<span class="attr">component</span>: <span class="built_in">require</span>(<span class="string">&#x27;./screens/home/index&#x27;</span>).default,</span><br><span class="line">	&#125;,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h4 id="其他vue组件"><a href="#其他vue组件" class="headerlink" title="其他vue组件"></a>其他vue组件</h4><p>正常写法，没什么需要注意的</p>
<h2 id="laravel"><a href="#laravel" class="headerlink" title="laravel"></a>laravel</h2><h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>有使用<code>vue-router</code>,不按照下面的写会<code>404</code>哦。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">&#x27;/&#123;view?&#125;&#x27;</span> , <span class="string">&#x27;LogServiceController@getHome&#x27;</span>)-&gt;where(<span class="string">&#x27;view&#x27;</span>, <span class="string">&#x27;(.*)&#x27;</span> )-&gt;name(<span class="string">&#x27;home&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h3><p>传递<code>logsServicePath</code>到页面。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> view(<span class="string">&#x27;logsservice::layout&#x27;</span> , [ <span class="string">&#x27;logsServicePath&#x27;</span> =&gt; [ <span class="string">&#x27;path&#x27;</span> =&gt; <span class="string">&#x27;logs&#x27;</span> ] ]);</span><br></pre></td></tr></table></figure>

<h3 id="blade"><a href="#blade" class="headerlink" title="blade"></a>blade</h3><p>注意<code>$logsServicePath</code>有控制器传递了。注意根据需要修改。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- CSRF Token --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;csrf-token&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&#123;&#123; csrf_token() &#125;&#125;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>logs &#123;&#123; config(&#x27;app.name&#x27;) ? &#x27; - &#x27; . config(&#x27;app.name&#x27;) : &#x27;&#x27;  &#125;&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://fonts.googleapis.com/css?family=Nunito&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; asset( &#x27;vendor/logsservice/app.css&#x27;) &#125;&#125;&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;logs&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.LogsService = @json($logsServicePath);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123; asset( &#x27;vendor/logsservice/app.js&#x27;) &#125;&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>更新phpredis</title>
    <url>/2020/02/21/d1c5271d4ee4/</url>
    <content><![CDATA[<h1 id="更新到-php-7-4"><a href="#更新到-php-7-4" class="headerlink" title="更新到 php 7.4"></a>更新到 php 7.4</h1><p>切换到对应的<code>php</code>版本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">brew-php-switcher 7.4</span><br><span class="line">sudo brew services stop php@7.3</span><br><span class="line">sudo brew services start php</span><br></pre></td></tr></table></figure>


<p>安装<code>redis</code>扩展</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pecl install redis</span><br></pre></td></tr></table></figure>

<p>确认redis包安装完成</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">php -m</span><br></pre></td></tr></table></figure>


<p>确认设置文件位置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">php --ini</span><br></pre></td></tr></table></figure>

<p>添加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">extension=&quot;redis.so&quot;</span><br></pre></td></tr></table></figure>

<p>重启<code>php</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo brew services restart php</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>在 vue 独立组件中使用 laravel echo</title>
    <url>/2020/01/18/2157cd6e0624/</url>
    <content><![CDATA[<h1 id="在-vue-独立组件中使用-laravel-echo"><a href="#在-vue-独立组件中使用-laravel-echo" class="headerlink" title="在 vue 独立组件中使用 laravel echo"></a>在 vue 独立组件中使用 laravel echo</h1><p>引入包</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Echo <span class="keyword">from</span> <span class="string">&quot;laravel-echo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.io = <span class="built_in">require</span>(<span class="string">&#x27;socket.io-client&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>设置新的<code>Echo</code>,同时监听新的<code>echo</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.echo = <span class="keyword">new</span> Echo(&#123;</span><br><span class="line">                    <span class="attr">broadcaster</span>: <span class="string">&#x27;socket.io&#x27;</span>,</span><br><span class="line">                    <span class="attr">host</span>: <span class="built_in">this</span>.url.host,</span><br><span class="line">                    <span class="attr">key</span>: <span class="built_in">this</span>.url.key,</span><br><span class="line">                &#125;)</span><br><span class="line"><span class="built_in">this</span>.echo.channel(<span class="built_in">this</span>.url.channel)</span><br><span class="line">                .listen(<span class="built_in">this</span>.url.listen, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.pushData(res)</span><br><span class="line">                &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>随手记录</title>
    <url>/2020/03/11/55461af198ba/</url>
    <content><![CDATA[<h1 id="随手"><a href="#随手" class="headerlink" title="随手"></a>随手</h1><p>订的<code>3M 7093C</code>到了。之后也是可以用的没事儿。</p>
<p>喜欢<code>ff14</code>挖宝，数据多了，老方式有点抗不住了。</p>
<p>是时候写个<code>UI</code>了。数据库还想好用什么也是一个问题。</p>
<p>前端<code>vue</code> , 后端<code>express</code> ，数据库<code>SQLite3</code>也许是个不错的选择。</p>
<p>通过<code>Nginx</code>反向代理。</p>
<p>为什么不使用<code>laravel</code>?</p>
<p>你要打一个蚊子会用榴弹炮吗？也许有人会吧。</p>
<h1 id="枫叶国"><a href="#枫叶国" class="headerlink" title="枫叶国"></a>枫叶国</h1><p>在枫叶国的孩子们应该准备<code>防护用品</code>与<code>食物</code>了，最少3个月的份哦~</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>无言</title>
    <url>/2020/01/27/b3aed02ce4d8/</url>
    <content><![CDATA[<h1 id="无言"><a href="#无言" class="headerlink" title="无言"></a>无言</h1><p>不知道说什么</p>
<p>想说的书上都写了</p>
<p>分包顺利进行中</p>
<p>更多的是无力感</p>
<h1 id="新年快乐"><a href="#新年快乐" class="headerlink" title="新年快乐"></a>新年快乐</h1><p>并快乐不起来</p>
<p>如果没估计错的话</p>
<p>之后也不会快乐的</p>
<p>纵观千年，一成不变</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>无言2</title>
    <url>/2020/02/06/856443fa116e/</url>
    <content><![CDATA[<h1 id="无言"><a href="#无言" class="headerlink" title="无言"></a>无言</h1><p>没什么要说的了</p>
<p>可能持续到6月</p>
<p>担心粮食储备 </p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>vue 与 _.remove</title>
    <url>/2020/03/26/39b7ea4f673d/</url>
    <content><![CDATA[<h1 id="remove-不渲染更新数据的问题"><a href="#remove-不渲染更新数据的问题" class="headerlink" title="_.remove 不渲染更新数据的问题"></a>_.remove 不渲染更新数据的问题</h1><p><code>vue</code>中使用<code>_.remove</code>后，不会渲染数据</p>
<p>原因在于<code>vue</code>不识别<code>_.remove</code>产生的数据变化</p>
<p>使用<code>splice()</code>可以正常更新</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.items.splice(<span class="built_in">this</span>.items.indexOf(data) , <span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>也可以</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">_.remove(<span class="built_in">this</span>.items , data)</span><br><span class="line"><span class="built_in">this</span>.items.sort()</span><br></pre></td></tr></table></figure>

<p><a href="https://cn.vuejs.org/v2/guide/list.html#%E6%95%B0%E7%BB%84%E6%9B%B4%E6%96%B0%E6%A3%80%E6%B5%8B">vue 数组更新检测</a></p>
<h1 id="moment本地时间显示"><a href="#moment本地时间显示" class="headerlink" title="moment本地时间显示"></a>moment本地时间显示</h1><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">&#x27;moment&#x27;</span></span><br><span class="line">moment().utc(time).format(<span class="string">&#x27;YYYY-MM-DD HH:mm:ss&#x27;</span>)</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>VeeValidate</title>
    <url>/2020/03/23/e9787d0f083c/</url>
    <content><![CDATA[<h1 id="使用VeeValidate"><a href="#使用VeeValidate" class="headerlink" title="使用VeeValidate"></a>使用VeeValidate</h1><p><code>bootstrap vue</code> 的表单验证推荐使用<code>VeeValidate</code></p>
<p>安装！</p>
<p>效果不错</p>
<p><code>app.js</code>中添加<code>require(&#39;./veevalidate&#39;);</code></p>
<p>使用独立文件引入</p>
<p><code>veevalidate.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; ValidationObserver, ValidationProvider, extend , localize &#125; <span class="keyword">from</span> <span class="string">&#x27;vee-validate&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> en <span class="keyword">from</span> <span class="string">&quot;vee-validate/dist/locale/en.json&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> rules <span class="keyword">from</span> <span class="string">&quot;vee-validate/dist/rules&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> VueI18n <span class="keyword">from</span> <span class="string">&#x27;vue-i18n&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.keys(rules).forEach(<span class="function"><span class="params">rule</span> =&gt;</span> &#123;</span><br><span class="line">  extend(rule, rules[rule]);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">localize(<span class="string">&quot;en&quot;</span>, en);</span><br><span class="line"></span><br><span class="line">Vue.component(<span class="string">&quot;ValidationObserver&quot;</span>, ValidationObserver);</span><br><span class="line">Vue.component(<span class="string">&#x27;ValidationProvider&#x27;</span>, ValidationProvider);</span><br></pre></td></tr></table></figure>

<p>使用方法查看<a href="https://bootstrap-vue.js.org/docs/reference/validation/">官方例子</a></p>
<blockquote>
<p>注意<code>passes</code> 与 <code>handleSubmit</code> 是相同的 <code>v-slot</code>, 文档中没有写明。</p>
</blockquote>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>诸神佛是存在的！</title>
    <url>/2020/04/13/da9a1c663179/</url>
    <content><![CDATA[<h1 id="诸神是存在的！"><a href="#诸神是存在的！" class="headerlink" title="诸神是存在的！"></a>诸神是存在的！</h1><p>2020-04-12 （庚子年庚辰月乙酉日） 发生了一些事情</p>
<p>证实了一些事情</p>
<p>结论是好好做人！上天什么都知道！</p>
<p>没事儿多念念经，记得回向。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>沉迷动森</title>
    <url>/2020/04/03/1a6ee5f31522/</url>
    <content><![CDATA[<h1 id="沉迷动森"><a href="#沉迷动森" class="headerlink" title="沉迷动森"></a>沉迷动森</h1><p>自由度高的游戏果然吸引人。角色也可爱~</p>
<p>switch 确实也过滤掉了一些人</p>
<p>不过普及也只是时间问题</p>
<p>用旧机器刷大气层改存档，也成为一种赚钱的手段</p>
<p>也是本地化存档的缺点之一</p>
<p>使用淘宝买数字版的也被超级ban了一些</p>
<p>国行依然是笑话，没什么未来，完全抹除了互联网的优越性</p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>这次武汉肺炎，明显看出天朝的基础产业不怎么样。</p>
<p>装备设施，到应急响应，速度太慢，没有跟上时代。</p>
<p>全世界也没好到哪里去！</p>
<p>之后只会更惨！</p>
<p>当一些已知的存在被进一步解明，世界会变好吗？</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>mac 下 node 版本切换</title>
    <url>/2020/05/26/98387c21ca2f/</url>
    <content><![CDATA[<h1 id="mac-下-node-版本切换"><a href="#mac-下-node-版本切换" class="headerlink" title="mac 下 node 版本切换"></a>mac 下 node 版本切换</h1><p><code>hexo</code> 不支持 新版的<code>node</code>，需要切换为旧版本</p>
<p>使用<code>nvm</code> 可以进行版本切换。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install nvm</span><br></pre></td></tr></table></figure>

<p>编辑<code>.zshrc</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> NVM_DIR=<span class="string">&quot;<span class="variable">$HOME</span>/.nvm&quot;</span></span><br><span class="line">  [ -s <span class="string">&quot;/usr/local/opt/nvm/nvm.sh&quot;</span> ] &amp;&amp; . <span class="string">&quot;/usr/local/opt/nvm/nvm.sh&quot;</span>  <span class="comment"># This loads nvm</span></span><br><span class="line">  [ -s <span class="string">&quot;/usr/local/opt/nvm/etc/bash_completion.d/nvm&quot;</span> ] &amp;&amp; . <span class="string">&quot;/usr/local/opt/nvm/etc/bash_completion.d/nvm&quot;</span>  <span class="comment"># This loads nvm bash_completion</span></span><br></pre></td></tr></table></figure>

<p>重载zsh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">. ~/.zshrc</span><br></pre></td></tr></table></figure>

<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>查看有哪些版本可以被安裝</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nvm ls-remote</span><br></pre></td></tr></table></figure>

<p>指定想要的版本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nvm install &lt;version&gt;</span><br></pre></td></tr></table></figure>

<p>安裝目前的穩定版</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nvm install stable</span><br></pre></td></tr></table></figure>

<h2 id="自动切换"><a href="#自动切换" class="headerlink" title="自动切换"></a>自动切换</h2><p>项目文件夹运行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">node -v &gt; .nvmrc</span><br></pre></td></tr></table></figure>

<p><code>.zshrc</code> 加入钩子</p>
<p>作用：<code>cd</code>进入文件夹是自动切换为设定的<code>node</code>版本，未设定时切换为系统默认版本。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">autoload</span> -U add-zsh-hook</span><br><span class="line">load-<span class="function"><span class="title">nvmrc</span></span>() &#123;</span><br><span class="line">  <span class="keyword">if</span> [[ -f .nvmrc &amp;&amp; -r .nvmrc ]]; <span class="keyword">then</span></span><br><span class="line">    nvm use</span><br><span class="line">  <span class="keyword">elif</span> [[ $(nvm version) != $(nvm version default)  ]]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Reverting to nvm default version&quot;</span></span><br><span class="line">    nvm use default</span><br><span class="line">  <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line">add-zsh-hook chpwd load-nvmrc</span><br><span class="line">load-nvmrc</span><br></pre></td></tr></table></figure>

<p><a href="https://medium.com/@kinduff/automatic-version-switch-for-nvm-ff9e00ae67f3">帮助文档</a></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>有人想我吗~</title>
    <url>/2020/05/24/1dcb936229e7/</url>
    <content><![CDATA[<h1 id="没有呢！"><a href="#没有呢！" class="headerlink" title="没有呢！"></a>没有呢！</h1><p>无事儿……</p>
<p>果然不是自己架设的东西都靠不住……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>docker-compose 下使用 clash</title>
    <url>/2020/06/10/118447343b0f/</url>
    <content><![CDATA[<h1 id="docker-compose-下使用-clash"><a href="#docker-compose-下使用-clash" class="headerlink" title="docker-compose 下使用 clash"></a>docker-compose 下使用 clash</h1><p>天朝的墙很高，新装系统都需要翻之。</p>
<p>理论上<code>docker</code>在全平台可以使用。</p>
<p>不同<code>linux</code>设置方法是相同的。</p>
<h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><p><a href="https://docs.docker.com/engine/install/ubuntu/">安装docker方法</a></p>
<p><code>docker-compose</code>也是必须的。</p>
<p><a href="https://docs.docker.com/compose/install/">安装docker-compose方法</a></p>
<p><a href="https://github.com/Dreamacro/clash/wiki/Run-clash-in-docker">clash官方文档</a></p>
<h2 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h2><p>直接在修改官方设置就可以。</p>
<p>这里使用的本地<code>ui</code></p>
<p>放在<code>docker-compose.yml</code>相同目录下</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">clash:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">dreamacro/clash</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config.yaml:/root/.config/clash/config.yaml</span></span><br><span class="line">      <span class="comment"># dashboard volume</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./ui:/ui</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;7890:7890&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;7891:7891&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9090:9090&quot;</span></span><br><span class="line">      <span class="comment"># If you need external controller, you can export this port.</span></span><br><span class="line">      <span class="comment"># - &quot;8080:8080&quot;</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="comment"># When your system is Linux, you can use `network_mode: &quot;host&quot;` directly.</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">clash</span></span><br></pre></td></tr></table></figure>

<h2 id="config-yaml"><a href="#config-yaml" class="headerlink" title="config.yaml"></a>config.yaml</h2><p><code>proxy</code>部分省略</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">port:</span> <span class="number">7890</span></span><br><span class="line"><span class="attr">socks-port:</span> <span class="number">7891</span></span><br><span class="line"><span class="comment">#允许局域网连接</span></span><br><span class="line"><span class="attr">allow-lan:</span> <span class="literal">true</span> </span><br><span class="line"><span class="attr">mode:</span> <span class="string">Rule</span></span><br><span class="line"><span class="attr">log-level:</span> <span class="string">info</span></span><br><span class="line"><span class="comment">#访问密码，可以移除</span></span><br><span class="line"><span class="attr">secret:</span> <span class="string">&#x27;secret&#x27;</span> </span><br><span class="line"><span class="attr">external-controller:</span> <span class="string">&#x27;0.0.0.0:9090&#x27;</span></span><br><span class="line"><span class="comment"># ui连接</span></span><br><span class="line"><span class="attr">external-ui:</span> <span class="string">/ui</span> </span><br></pre></td></tr></table></figure>

<h2 id="ui选择"><a href="#ui选择" class="headerlink" title="ui选择"></a>ui选择</h2><p>如果不设置<code>ui</code>,可以直接访问对应的开放<code>UI</code></p>
<p><a href="https://yacd.haishan.me/">Yacd UI</a></p>
<p><a href="https://clash.razord.top/#/proxies">Dashboard文档</a></p>
<p><a href="https://github.com/haishanh/yacd">yacd文档</a></p>
<p><a href="https://github.com/Dreamacro/clash-dashboard">dashboard文档</a></p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>访问<code>127.0.0.1:9090/ui</code></p>
<p>填入对应信息就可以使用了</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>clash</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel 设置清空</title>
    <url>/2020/05/27/6f33d77656d9/</url>
    <content><![CDATA[<h1 id="laravel-设置清空"><a href="#laravel-设置清空" class="headerlink" title="laravel 设置清空"></a>laravel 设置清空</h1><p>使用<code>Passport::tokensCan</code>时</p>
<p>发现不能读取<code>config</code>中的设置<code>scopes</code></p>
<p>需要使用下方命令清空<code>config</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">la5 config:clear</span><br></pre></td></tr></table></figure>

<p>之后就可以正常使用了。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>无事儿</title>
    <url>/2020/08/05/2ad0a9280443/</url>
    <content><![CDATA[<h1 id="无事儿"><a href="#无事儿" class="headerlink" title="无事儿"></a>无事儿</h1><p>进度推进中！</p>
<p>闲逛，发呆，</p>
<p>上线就会感到舒适的游戏 </p>
<p>也是不错的</p>
<p>如果还能对大多数用户提供稳定收入呢？</p>
<p>好多认为最重要的事儿，在他人眼中毫无价值。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>换路由器了！</title>
    <url>/2020/10/29/c9e8b628e7ee/</url>
    <content><![CDATA[<p>换路由器了！带宽能跑满了_(:з」∠)_</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>vue i18n 设置保存到 Cookies</title>
    <url>/2020/05/30/f2ee67c18566/</url>
    <content><![CDATA[<h1 id="vue-i18n-设置保存到-Cookies"><a href="#vue-i18n-设置保存到-Cookies" class="headerlink" title="vue i18n 设置保存到 Cookies"></a>vue i18n 设置保存到 Cookies</h1><p>安装js-cookie</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">yarn add js-cookie --save</span><br></pre></td></tr></table></figure>

<p>引起</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Cookies <span class="keyword">from</span> <span class="string">&#x27;js-cookie&#x27;</span></span><br></pre></td></tr></table></figure>

<p>在<code>i18n</code>文件中设置</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> VueI18n <span class="keyword">from</span> <span class="string">&#x27;vue-i18n&#x27;</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> locale <span class="keyword">from</span> <span class="string">&#x27;./locales&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Cookies <span class="keyword">from</span> <span class="string">&#x27;js-cookie&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueI18n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> VueI18n(&#123;</span><br><span class="line">  <span class="attr">locale</span>: Cookies.get(<span class="string">&#x27;language&#x27;</span>) || <span class="string">&#x27;en&#x27;</span>,</span><br><span class="line">  <span class="attr">messages</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;en&#x27;</span> : locale.enUS,</span><br><span class="line">    <span class="string">&#x27;zh&#x27;</span> : locale.zhCH, </span><br><span class="line">  &#125;, </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>组件中使用</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">b-navbar</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b-navbar-nav</span> <span class="attr">class</span>=<span class="string">&quot;ml-auto&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">b-nav-item-dropdown</span> <span class="attr">:text</span>=<span class="string">&quot;$t(&#x27;message.lang&#x27;)&quot;</span> <span class="attr">right</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">b-dropdown-item</span> <span class="attr">v-for</span>=<span class="string">&quot;(lang, i) in langs&quot;</span> <span class="attr">:key</span>=<span class="string">&quot;lang.index&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;setLocalLanguage(lang)&quot;</span>&gt;</span>&#123;&#123; lang &#125;&#125;<span class="tag">&lt;/<span class="name">b-dropdown-item</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">b-nav-item-dropdown</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">b-navbar-nav</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">b-navbar</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">import</span> Cookies <span class="keyword">from</span> <span class="string">&#x27;js-cookie&#x27;</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">export</span> <span class="keyword">default</span> &#123; </span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="title">data</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">return</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">langs</span> : [<span class="string">&#x27;en&#x27;</span>, <span class="string">&#x27;zh&#x27;</span>],</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">  &#125;,</span></span><br><span class="line"><span class="javascript">  <span class="attr">methods</span>:&#123; </span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">setLocalLanguage</span>(<span class="params">lang</span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">this</span>.$i18n.locale = lang</span></span><br><span class="line"><span class="javascript">        Cookies.set(<span class="string">&#x27;language&#x27;</span>, lang)</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">  &#125;,</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>感染一个月了，还是有点咳</title>
    <url>/2023/01/27/f89f226d2930/</url>
    <content><![CDATA[<h1 id="闲聊"><a href="#闲聊" class="headerlink" title="闲聊"></a>闲聊</h1><p>向日葵开花了，长的不错。</p>
<p><img src="/images/post/2023-01-27/IMG_2635.jpg"></p>
<p>薰衣草就剩一颗独苗了。</p>
<p>本来好好的移盆后发现土里面都是虫卵，放了除虫药后没几天就是死了。</p>
<p>同样土的罗勒也是。土是我爸提供的，应该相信一下的，但是看来不怎么可靠。</p>
<p>薄荷有点黑，用力长效肥，好转了不少，再长长可以移盆了。</p>
<p>当然土是无菌土。</p>
<p>迷迭香，也应该移盆了。</p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>有来有去的感情还是不错的</p>
<p>至少能感受到温度</p>
<p>比不交流好的多，舒服的多</p>
<p>连最简单开心都做不到，也就没什么以后了。</p>
<p>节前定了一个耳坠，不知道送谁，先放着吧。</p>
<p>一时冲动。</p>
<p><img src="/images/post/2023-01-27/IMG_2609.jpg"></p>
<p>还拼了一个Spotify会员，音质不错，想入手新的HomePod了。</p>
<p>反正没人看就这样吧</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel sanctum</title>
    <url>/2021/06/11/f4ac3f0b03f0/</url>
    <content><![CDATA[<h1 id="laravel-sanctum-使用-postman"><a href="#laravel-sanctum-使用-postman" class="headerlink" title="laravel sanctum 使用 postman"></a>laravel sanctum 使用 postman</h1><p>生成的<code>token</code>，在<code>Authorization</code>-&gt;<code>Type</code>中，选择<code>Bearer Token</code>。</p>
<p>手动请求时使用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;Authorization&#x27; =&gt; &#x27;Bearer YourToken&#x27; </span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>到数据整合了，后端的最后程</title>
    <url>/2023/03/23/f036326059eb/</url>
    <content><![CDATA[<h1 id="要对数据整合了"><a href="#要对数据整合了" class="headerlink" title="要对数据整合了"></a>要对数据整合了</h1><p>地图随机部分使用内存加预先生成了，否则速度太慢了。</p>
<p>上线那天开心不会很多吧。担心性能和体验倒是真的。</p>
<p>也不知道为啥，一点都不担心游戏端。</p>
<p>明明也是一堆坑要填。大概比起构建整个后端容易吧。</p>
<p>好想有钱把重复的工作都发包出去。</p>
<p>只做创造，设计，整合。这样比较有效率。</p>
<p>之后事儿，有想过大方向。</p>
<p>感觉有点远。</p>
<h1 id="短期目标"><a href="#短期目标" class="headerlink" title="短期目标"></a>短期目标</h1><p>夏天前赚够买房车的钱吧</p>
<p>过了10万用户数，就要考虑开公司了。</p>
<p>自己绝对搞不定的。</p>
<p>希望顺利吧。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>久不更新 想我了吗</title>
    <url>/2021/06/07/7bbc7fbe3075/</url>
    <content><![CDATA[<h1 id="久不更新-想我了吗"><a href="#久不更新-想我了吗" class="headerlink" title="久不更新 想我了吗"></a>久不更新 想我了吗</h1><h2 id="laravel-Sanctum-使用uuid"><a href="#laravel-Sanctum-使用uuid" class="headerlink" title="laravel Sanctum 使用uuid"></a>laravel Sanctum 使用uuid</h2><p>需要在主laravel目标下运行，尝试过在自建包中使用<code>-&gt;change()</code>失败。</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php artisan vendor:publish --tag=sanctum-migrations</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$table</span>-&gt;uuidMorphs(<span class="string">&#x27;tokenable&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/laravel/sanctum/issues/82">参考</a></p>
<hr>
<h2 id="laravel-sail-安装"><a href="#laravel-sail-安装" class="headerlink" title="laravel sail 安装"></a>laravel sail 安装</h2><p><code>laravel sail</code>在<code>win10</code>上安装。</p>
<p>什么? 你用<code>mac</code>? <code>laravle valet</code>不香吗？</p>
<p>ps: 等一个新版<code>macbook pro</code>, <code>XDR</code>真香 ✿✿ヽ(°▽°)ノ✿</p>
<p><code>laravel sail</code>需要使用<code>Docker</code>与<code>WSL2</code></p>
<h3 id="安装-Docker-Desktop"><a href="#安装-Docker-Desktop" class="headerlink" title="安装 Docker Desktop"></a>安装 Docker Desktop</h3><p><code>Docker</code>直接去下载 <code>Docker Desktop</code>安装。</p>
<h3 id="安装一个WSL2的镜像"><a href="#安装一个WSL2的镜像" class="headerlink" title="安装一个WSL2的镜像"></a>安装一个WSL2的镜像</h3><p>下面的连接中有许多<code>linux</code>，选一个熟悉的，使用<code>Microsoft Store</code>安装，坐标天朝记得关闭VPN。</p>
<p>我用的是<code>Ubuntu-20.04 LTS</code>。</p>
<p>推荐随手安装一个<a href="https://www.microsoft.com/zh-tw/p/windows-terminal/9n0dx20hk701?rtc=1#activetab=pivot:overviewtab"><code>Windows Terminal</code></a>，比自带的强了好多_(:з」∠)_</p>
<p><a href="https://docs.microsoft.com/zh-cn/windows/wsl/install-win10">适用于 Linux 的 Windows 子系统安装指南</a></p>
<h3 id="设置WSL2"><a href="#设置WSL2" class="headerlink" title="设置WSL2"></a>设置WSL2</h3><h4 id="Windows-修改默认-WSL2"><a href="#Windows-修改默认-WSL2" class="headerlink" title="Windows 修改默认 WSL2"></a>Windows 修改默认 WSL2</h4><p>查看<code>WSL</code>版本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wsl --list --verbose</span><br><span class="line">wsl -l</span><br></pre></td></tr></table></figure>

<p>设置<code>WSL</code>版本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">wsl --set-version Ubuntu-20.04 2</span><br><span class="line">wsl -s Ubuntu-20.04 2</span><br></pre></td></tr></table></figure>

<h4 id="Docker-Desktop-设置-WSL2"><a href="#Docker-Desktop-设置-WSL2" class="headerlink" title="Docker Desktop 设置 WSL2"></a>Docker Desktop 设置 WSL2</h4><pre><code class="主要是在`Setting`-&gt;`Resources`中开启对应的`linux`。这个设置的是`docker`的`WSL2`。设置完可以在`Docker">[~~~~`Docker`设置`WSL2`~~~~](https://laravel.com/docs/8.x/installation#getting-started-on-windows)

基础安装到这里也结束了~

`WSL2`目录使用`\\wsl$`可以直接访问

### 使用

先重启！先重启！先重启！

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -s https://laravel.build/example-app | bash</span><br><span class="line"></span><br><span class="line">cd example-app</span><br><span class="line">./vendor/bin/sail up</span><br></pre></td></tr></table></figure>

随后访问[localhost](http://localhost)

如果不能正常使用关闭`SEP`，或者其他防护墙试试。

以上
</code></pre>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>要出门了！</title>
    <url>/2021/06/23/e62cef9d42d9/</url>
    <content><![CDATA[<h1 id="出门"><a href="#出门" class="headerlink" title="出门"></a>出门</h1><p>预计要出门一个月，地点是深圳，嗯！</p>
<p>面具和护目镜也带了，估计用不上。</p>
<p>顺利的话，游戏也要上架了。</p>
<p>所以要减肥了_(:з」∠)_</p>
<p>工作都是远程了，也不知道网速怎么样。</p>
<p>新的MacBook Pro还不出，蹲个XDR屏幕</p>
<p>前几天刚刚知道日版的小可是关西腔🤣🤣🤣</p>
<p>ps：知道有人去了秦皇岛，哎，反正写在这里也没人看~~</p>
<p>最想去的地方吗？短期内是楼兰古城。长期是太空。</p>
<p>最想要的东西？短期是<code>bliss mobil</code>的房车，长期是飞机。</p>
<p>最想实现的愿望？游戏上市3个月内用户超过100万人。</p>
<p>最后希望一切顺利。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>回家啦~</title>
    <url>/2021/08/31/44d6fe79a5b1/</url>
    <content><![CDATA[<h1 id="回家啦"><a href="#回家啦" class="headerlink" title="回家啦~"></a>回家啦~</h1><p>19号就到家了~ </p>
<p>几乎每天睡觉都会做梦，梦的都是见到一个人。</p>
<p>一个很喜欢很喜欢的人，可是ta总是不理我。o(╥﹏╥)o</p>
<p>工作也在加速中。</p>
<p>以上？才怪！</p>
<p>有一个计划不知道能不能顺利。</p>
<p>一定要顺利！</p>
<p>一定要顺利！</p>
<p>一定要顺利！</p>
<p>以上！</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>久违的更新</title>
    <url>/2021/02/09/5d37b96d5afd/</url>
    <content><![CDATA[<h1 id="久违的更新"><a href="#久违的更新" class="headerlink" title="久违的更新"></a>久违的更新</h1><p>马上就是农历新年了~ 撒花~</p>
<p>最近的事情有点多 倒着说吧</p>
<h2 id="车祸"><a href="#车祸" class="headerlink" title="车祸"></a>车祸</h2><p>家里车子小剐蹭，人没事儿，对方全责，_(:з」∠)_ </p>
<p>零件要2月末才能到</p>
<h2 id="入手群辉"><a href="#入手群辉" class="headerlink" title="入手群辉"></a>入手群辉</h2><p>感觉机器的主要数据盘要坏掉，虽然救回来了，估计也就是时间问题了</p>
<p>所以入手了群辉ds920 行内拿货</p>
<table>
<thead>
<tr>
<th align="left">物品</th>
<th align="left">数量</th>
<th align="left">单价</th>
</tr>
</thead>
<tbody><tr>
<td align="left">DS920</td>
<td align="left">1</td>
<td align="left">3650</td>
</tr>
<tr>
<td align="left">酷狼 4TB</td>
<td align="left">4</td>
<td align="left">720</td>
</tr>
<tr>
<td align="left">OEM 内存 4G</td>
<td align="left">1</td>
<td align="left">152</td>
</tr>
<tr>
<td align="left">总计</td>
<td align="left"></td>
<td align="left">6682</td>
</tr>
</tbody></table>
<p>路由器的端口转发有bug，不能正常使用。公网使用群辉全部功能是不要想了，</p>
<p>无奈只能使用<code>OpenVpn</code>回家使用，缺点是出了天朝就无效了。</p>
<p>速度受到硬件制约就<code>100mb/s</code>，能聚合速度会提高吧。等待测试。</p>
<p>安装了<code>gitlab</code>设置了自己的邮件，坑的地方是要添加设置</p>
<table>
<thead>
<tr>
<th align="left">环境变量</th>
<th align="left">参数</th>
</tr>
</thead>
<tbody><tr>
<td align="left">SMTP_AUTHENTICATION</td>
<td align="left">login</td>
</tr>
<tr>
<td align="left">SMTP_OPENSSL_VERIFY_MODE</td>
<td align="left">none</td>
</tr>
</tbody></table>
<p>之后重启<code>gitlab</code>就好。</p>
<h2 id="laravel-sail"><a href="#laravel-sail" class="headerlink" title="laravel sail"></a>laravel sail</h2><p>部署<code>laralel sail</code>，在<code>window</code>上开发容易了许多。</p>
<p>最大的问题依然是墙，我朝的开发人员似乎在回避<code>laravel sail</code>,</p>
<p>毕竟要使用<code>docker</code>吧。</p>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>一个想法引发的大升级！</title>
    <url>/2021/10/14/cafd079550c4/</url>
    <content><![CDATA[<h1 id="开端是……"><a href="#开端是……" class="headerlink" title="开端是……"></a>开端是……</h1><p>事情要从备份说起，想着<code>群晖</code>有坏掉的可能，于是试了一下网盘备份。</p>
<p><code>Hyper Bankup</code>在备份是可以加密不用担心隐私外泄。</p>
<p>接着吧，既然加密了就利用下注册过的网盘，顺便整理下数据。</p>
<p>之后就想到了外网访问的群晖。故事就这样开始了。</p>
<p>家里的网络一般是没有固定IP的，想要访问家里的设备可以用VPN连会家里。</p>
<p>这是第一种方法。速度可以接受，在深圳的时候就是这样用的。</p>
<p>第二种就是使用域名向访问网站一样，访问家里的设备，这是就要用工具打一个洞，进行访问。</p>
<p>打洞的工具 是一个<code>域名</code> ， 一个<code>VPS</code> 和 <code>frps</code> 。</p>
<p>就是这样引发了之后的全面升级(灬ꈍ ꈍ灬)</p>
<h1 id="Ps"><a href="#Ps" class="headerlink" title="Ps:"></a>Ps:</h1><p>为啥传一张，删一张，还是显肤色的那张 😭 😭 😭</p>
<span id="more"></span>

<h1 id="安装frps引发的故事"><a href="#安装frps引发的故事" class="headerlink" title="安装frps引发的故事"></a>安装frps引发的故事</h1><p>使用<code>docker</code>安装frps时，出现了同一个<code>docker-netwrok</code>下不能加载UI的问题。</p>
<p>端口映射是没有问题，镜像也是没有问题的，在本地环境是可以打开的。</p>
<p>那么问题就是<code>nginx-proxy</code>！这货让我吃了不少苦 😱 😱 😱 ！看看之前的文章就知道了！</p>
<p>搜索解决方案的时候，发现了一个新的东西!</p>
<p><code>Nginx Proxy Manager</code> 一个有UI的<code>nginx-proxy</code> 😇 😇 😇 安装到是也简单。</p>
<h2 id="升级到Nginx-Proxy-Manager"><a href="#升级到Nginx-Proxy-Manager" class="headerlink" title="升级到Nginx Proxy Manager"></a>升级到Nginx Proxy Manager</h2><h3 id="复制-docker-compose-yml"><a href="#复制-docker-compose-yml" class="headerlink" title="复制 docker-compose.yml"></a>复制 docker-compose.yml</h3><p>安装镜像，就官网，直接复制<code>docker-compose.yml</code>文件</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="symbol">services:</span></span><br><span class="line">  <span class="symbol">app:</span></span><br><span class="line">    <span class="symbol">image:</span> <span class="string">&#x27;jc21/nginx-proxy-manager:latest&#x27;</span></span><br><span class="line">    <span class="symbol">restart:</span> <span class="keyword">unless</span>-stopped</span><br><span class="line">    <span class="symbol">ports:</span></span><br><span class="line">      - <span class="string">&#x27;80:80&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;81:81&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;443:443&#x27;</span></span><br><span class="line">    <span class="symbol">environment:</span></span><br><span class="line">      <span class="symbol">DB_MYSQL_HOST:</span> <span class="string">&quot;db&quot;</span></span><br><span class="line">      <span class="symbol">DB_MYSQL_PORT:</span> <span class="number">3306</span></span><br><span class="line">      <span class="symbol">DB_MYSQL_USER:</span> <span class="string">&quot;npm&quot;</span></span><br><span class="line">      <span class="symbol">DB_MYSQL_PASSWORD:</span> <span class="string">&quot;npm&quot;</span></span><br><span class="line">      <span class="symbol">DB_MYSQL_NAME:</span> <span class="string">&quot;npm&quot;</span></span><br><span class="line">    <span class="symbol">volumes:</span></span><br><span class="line">      - ./<span class="symbol">data:</span>/data</span><br><span class="line">      - ./<span class="symbol">letsencrypt:</span>/etc/letsencrypt</span><br><span class="line">  <span class="symbol">db:</span></span><br><span class="line">    <span class="symbol">image:</span> <span class="string">&#x27;jc21/mariadb-aria:latest&#x27;</span></span><br><span class="line">    <span class="symbol">restart:</span> <span class="keyword">unless</span>-stopped</span><br><span class="line">    <span class="symbol">environment:</span></span><br><span class="line">      <span class="symbol">MYSQL_ROOT_PASSWORD:</span> <span class="string">&#x27;npm&#x27;</span></span><br><span class="line">      <span class="symbol">MYSQL_DATABASE:</span> <span class="string">&#x27;npm&#x27;</span></span><br><span class="line">      <span class="symbol">MYSQL_USER:</span> <span class="string">&#x27;npm&#x27;</span></span><br><span class="line">      <span class="symbol">MYSQL_PASSWORD:</span> <span class="string">&#x27;npm&#x27;</span></span><br><span class="line">    <span class="symbol">volumes:</span></span><br><span class="line">      - ./data/<span class="symbol">mysql:</span>/var/lib/mysql</span><br></pre></td></tr></table></figure>

<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><p>地址是 <code>http://VPS_IPv4:81</code></p>
<p>默认账号</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Email: admin@example.com</span><br><span class="line">Password: changeme</span><br></pre></td></tr></table></figure>

<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>跟着<a href="https://nginxproxymanager.com/guide/#quick-setup">官方文档</a>没事什么大问题。</p>
<p>之后是就是将其他的镜像启动，并设置了 🤡 🤡 🤡</p>
<p>很简单是吧~ 做梦征程才刚刚开始！😏 😏 😏</p>
<h2 id="最基础的web服务"><a href="#最基础的web服务" class="headerlink" title="最基础的web服务"></a>最基础的web服务</h2><p>当然是静态网站了。</p>
<p>就使用最简单的<code>nginx</code>镜像加载一个位置而且。</p>
<h3 id="nginx基本镜像"><a href="#nginx基本镜像" class="headerlink" title="nginx基本镜像"></a>nginx基本镜像</h3><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="symbol">services:</span></span><br><span class="line">    <span class="symbol">web:</span></span><br><span class="line">      <span class="symbol">image:</span> <span class="symbol">nginx:</span>latest</span><br><span class="line">      <span class="symbol">restart:</span> <span class="keyword">unless</span>-stopped</span><br><span class="line">      <span class="symbol">container_name:</span> web</span><br><span class="line">      <span class="symbol">volumes:</span></span><br><span class="line">          - ./<span class="symbol">web:</span>/usr/share/nginx/<span class="symbol">html:</span>ro</span><br></pre></td></tr></table></figure>

<h3 id="第一个坑如约而至🙃"><a href="#第一个坑如约而至🙃" class="headerlink" title="第一个坑如约而至🙃"></a>第一个坑如约而至🙃</h3><p>没错在正确设置<code>nginx-proxy</code>的情况下，并不能访问的代理镜像。</p>
<p>原因是<code>nginx-proxy</code>与<code>web</code>并没有在一个<code>docker network</code>中。</p>
<p>解决办法每个<code>docker-compose.yml</code>文件中指定网络</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">networks:</span></span><br><span class="line">  <span class="symbol">default:</span></span><br><span class="line">    <span class="symbol">external:</span></span><br><span class="line">      <span class="symbol">name:</span> nginx-proxy-manager-default</span><br></pre></td></tr></table></figure>

<p>之后设置域名对应到镜像端口。</p>
<p>可以使用镜像<code>IP</code>与可以使用镜像名。</p>
<p>我用的是<code>&lt;镜像名&gt;:&lt;端口&gt;</code></p>
<h3 id="结语-1"><a href="#结语-1" class="headerlink" title="结语"></a>结语</h3><p>到这里<code>web</code>可以正常使用了，我放的就是这个站了。</p>
<h2 id="v2fly"><a href="#v2fly" class="headerlink" title="v2fly"></a>v2fly</h2><p><code>v2fly</code> 是 <code>v2ray</code> 的升级版</p>
<p>就<a href="https://www.v2fly.org/#project-v-%E7%94%B1%E8%B0%81%E4%B8%BB%E5%AF%BC%E5%BC%80%E5%8F%91">文档</a></p>
<p>使用<code>WebSocket + tls + web</code>，请求<code>域名:443</code></p>
<p>设置的时候开启<code>WebSocket</code>，转发到镜像对应接口。</p>
<p>没什么难点。想要伪站的可以设置个<code>nginx</code>二次转发<code>WebSocket</code></p>
<p>怎么设置之前都写过<a href="https://keleven.me/2018/03/01/aaf03e653abb/">传送门</a></p>
<h2 id="私人邮件服务"><a href="#私人邮件服务" class="headerlink" title="私人邮件服务"></a>私人邮件服务</h2><p>不更改设置的情况下可以直接使用之前是<code>docker-compose.yml</code>文件</p>
<p>但是请求是不加密的。载入<code>Nginx Proxy Manager</code>请求的<code>tls</code>证书不能正确读取。</p>
<p>找文档的时候发现<code>tvial/docker-mailserver</code>被弃用了！😳 😳 😳</p>
<p>新的镜像是<code>docker.io/mailserver/docker-mailserver</code>。</p>
<p>处处是惊喜，更新吧！</p>
<h3 id="过时docker-compose"><a href="#过时docker-compose" class="headerlink" title="过时docker-compose"></a>过时<code>docker-compose</code></h3><p>镜像的<code>docker-compose.yml</code>是<code>3.8</code>，老的<code>docker-compose</code>不支持了</p>
<p>升级之，嗯，算个小石子吧 😏</p>
<h3 id="过时的文档"><a href="#过时的文档" class="headerlink" title="过时的文档"></a>过时的文档</h3><p>文档是使用 <code>setup.sh</code>文件可以快速设置。</p>
<p>照做会发现集成到镜像里了，会导致路径错误 😓 </p>
<p>手动修正</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">volumes:</span></span><br><span class="line">  <span class="comment"># - ./docker-data/dms/config/:/tmp/docker-mailserver/</span></span><br><span class="line">  - ./config/<span class="symbol">:/tmp/docker-mailserver/</span></span><br></pre></td></tr></table></figure>

<p>之后添加账号和<code>dkim</code>，照做<a href="https://github.com/docker-mailserver/docker-mailserver#included-services">文档</a>就行。</p>
<p>打印<code>dkim</code>并设置域名的时候，注意段落<code>p=</code>中<code>&quot;</code>要全部去掉。</p>
<p>这时启动镜就可以使用邮件服务了。</p>
<p>要注意的是<code>mac</code>的邮件账号要关闭使用<code>tls</code>才可以发邮件。</p>
<h3 id="发邮件是dns不能解析"><a href="#发邮件是dns不能解析" class="headerlink" title="发邮件是dns不能解析"></a>发邮件是dns不能解析</h3><p>添加<code>dns</code>设置到<code>docker-compose.yml</code></p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">dns:</span></span><br><span class="line">  - <span class="number">9.9</span>.<span class="number">9.9</span></span><br><span class="line">  - <span class="number">8.8</span>.<span class="number">8.8</span></span><br><span class="line">  - <span class="number">1.1</span>.<span class="number">1.1</span></span><br><span class="line">  - <span class="number">1.0</span>.<span class="number">0.1</span></span><br></pre></td></tr></table></figure>

<h3 id="邮件使用tls证书"><a href="#邮件使用tls证书" class="headerlink" title="邮件使用tls证书"></a>邮件使用<code>tls</code>证书</h3><p>添加<code>tls</code>设置到<code>docker-compose.yml</code></p>
<p><code>&lt;user&gt;</code>改为自己的用户名</p>
<p><code>&lt;npm-*&gt;</code>改为对应域名的证书</p>
<p>这里的坑点<code>nginx-proxy-manager/letsencrypt/live/&lt;npm-*&gt;</code>目录的权限不够，</p>
<p>转而使用<code>nginx-proxy-manager/archive/live/&lt;npm-*&gt;</code>目录中的，</p>
<p>你可以对之前的目录提权。反正<code>archive</code>就是<code>live</code>复制来的。</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">volumes:</span></span><br><span class="line">  - <span class="regexp">/&lt;user&gt;/nginx</span>-proxy-manager/letsencrypt/archive/&lt;npm-*&gt;<span class="symbol">:/tmp/dms/custom-certs/</span><span class="symbol">:ro</span></span><br><span class="line"><span class="symbol">environment:</span></span><br><span class="line">  - SSL_TYPE=manual</span><br><span class="line">  - SSL_CERT_PATH=<span class="regexp">/tmp/dms</span><span class="regexp">/custom-certs/fullchain</span>1.pem</span><br><span class="line">  - SSL_KEY_PATH=<span class="regexp">/tmp/dms</span><span class="regexp">/custom-certs/privkey</span>1.pem</span><br></pre></td></tr></table></figure>

<p>到这里就可以使用<code>tls</code>收发邮件了！👏 👏 👏</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>其他的问题都不大，之后的<a href="http://keleven.me/2018/04/16/5f633ca9b365">文章</a>还是有点作用的。</p>
<h2 id="frp-他人经验-坑中之王"><a href="#frp-他人经验-坑中之王" class="headerlink" title="frp 他人经验 = 坑中之王"></a>frp 他人经验 = 坑中之王</h2><p>没什么软用的<code>frp</code>，少年现在回头还来的急🤧</p>
<p>坑点1: 话不说全，装的很大</p>
<p>坑点2: 速度一般，视频别想</p>
<p>坑点3: 设置复杂</p>
<p>最后: OpenVPN真香 🤣 ，有问题一般是设置没对。看<a href="https://gofrp.org/docs/">文档</a>比搜索有用。</p>
<h3 id="预备式"><a href="#预备式" class="headerlink" title="预备式"></a>预备式</h3><p>安装<code>frps</code>镜像</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="symbol">services:</span></span><br><span class="line">    <span class="symbol">frps:</span></span><br><span class="line">      <span class="symbol">image:</span> stilleshan/<span class="symbol">frps:</span>latest</span><br><span class="line">      <span class="symbol">container_name:</span> frps</span><br><span class="line">      <span class="symbol">restart:</span> always</span><br><span class="line">      <span class="symbol">expose:</span></span><br><span class="line">          - <span class="string">&quot;7500&quot;</span></span><br><span class="line">      <span class="symbol">ports:</span></span><br><span class="line">         - <span class="number">7000</span><span class="symbol">:</span><span class="number">7000</span></span><br><span class="line">         - <span class="number">7600</span><span class="symbol">:</span><span class="number">7600</span></span><br><span class="line">      <span class="symbol">volumes:</span></span><br><span class="line">          - ./frps.<span class="symbol">ini:</span>/frp/frps.ini</span><br><span class="line"><span class="symbol">networks:</span></span><br><span class="line">  <span class="symbol">default:</span></span><br><span class="line">    <span class="symbol">external:</span></span><br><span class="line">      <span class="symbol">name:</span> nginx-proxy-manager-default</span><br></pre></td></tr></table></figure>

<h3 id="起跳式"><a href="#起跳式" class="headerlink" title="起跳式"></a>起跳式</h3><p>这里要准备两个域名，一个用来连接，一个用来代理。</p>
<table>
<thead>
<tr>
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Content</th>
<th align="left">用处</th>
</tr>
</thead>
<tbody><tr>
<td align="left">A</td>
<td align="left">frp</td>
<td align="left">XXX.XXX.XXX.XXX【IPv4】</td>
<td align="left">连接frp服务</td>
</tr>
<tr>
<td align="left">CNAME</td>
<td align="left">link</td>
<td align="left">frp.your.domain【穿透用的域名】</td>
<td align="left">frp转发的域名</td>
</tr>
</tbody></table>
<blockquote>
<p>重点：如果使用的是<code>cloudflare</code>要关闭<code>frp.your.domain</code>的<code>Proxied</code></p>
</blockquote>
<p>填写<code>frps.ini</code>服务器端用，开一个7000就够了，其他流量<code>frps</code>能自动识别。</p>
<p>按照下面的设置开启的是<code>windows</code>远程桌面与<code>80</code>网站入口</p>
<p>远程桌面使用<code>link.your.domain:7600</code>访问</p>
<p>网站使用<code>link.your.domain</code>访问</p>
<p>其实，这个网站的地址可以是局域网内的任意位置，都可以访问的。</p>
<p><code>token</code>是密码，<code>subdomain_host</code>是一级域名</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">bind_addr</span> = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="attr">bind_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="comment"># bind_udp_port = 7001</span></span><br><span class="line"><span class="comment"># kcp_bind_port = 7000</span></span><br><span class="line"><span class="attr">vhost_http_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="comment"># vhost_https_port = 443</span></span><br><span class="line"><span class="attr">dashboard_addr</span> = <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"><span class="attr">dashboard_port</span> = <span class="number">7500</span></span><br><span class="line"><span class="attr">dashboard_user</span> = admin</span><br><span class="line"><span class="attr">dashboard_pwd</span> = admin</span><br><span class="line"><span class="attr">log_file</span> = ./frps.log</span><br><span class="line"><span class="attr">log_level</span> = info</span><br><span class="line"><span class="attr">log_max_days</span> = <span class="number">3</span></span><br><span class="line"><span class="attr">disable_log_color</span> = <span class="literal">false</span></span><br><span class="line"><span class="attr">authentication_method</span> = token</span><br><span class="line"><span class="attr">token</span> = <span class="number">12345678</span></span><br><span class="line"><span class="attr">subdomain_host</span> = your.domain</span><br><span class="line"><span class="attr">tcp_mux</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>设置<code>frpc.ini</code>客户端用</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[common]</span></span><br><span class="line"><span class="attr">server_addr</span> = frp.your.domain</span><br><span class="line"><span class="attr">server_port</span> = <span class="number">7000</span></span><br><span class="line"><span class="attr">tcp_mux</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">token</span> = <span class="number">12345678</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">[rdp]</span></span><br><span class="line"><span class="attr">type</span> = tcp</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">3389</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">7600</span></span><br><span class="line"><span class="attr">subdomain</span> = link</span><br><span class="line"><span class="attr">use_encryption</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">use_compression</span> = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">[web]</span></span><br><span class="line"><span class="attr">type</span> = http</span><br><span class="line"><span class="attr">local_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">local_port</span> = <span class="number">80</span></span><br><span class="line"><span class="attr">remote_port</span> = <span class="number">80</span></span><br><span class="line"><span class="attr">subdomain</span> = link</span><br><span class="line"><span class="attr">use_encryption</span> = <span class="literal">true</span></span><br><span class="line"><span class="attr">use_compression</span> = <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="躺式"><a href="#躺式" class="headerlink" title="躺式"></a>躺式</h3><p>frp外网访问很慢，视频是看不了的，没有朝内的VPS，不做评价。</p>
<p>远程桌面的话，就输入文字还行。</p>
<p>不是必要的话，还是OpenVPN好用 😘 </p>
<h2 id="最后关闭-UI"><a href="#最后关闭-UI" class="headerlink" title="最后关闭 UI"></a>最后关闭 UI</h2><h3 id="nginx-proxy-manager"><a href="#nginx-proxy-manager" class="headerlink" title="nginx proxy manager"></a>nginx proxy manager</h3><p>注释掉<code>docker-compose.yml</code>中的<code>81</code>端口。</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">ports:</span></span><br><span class="line">  <span class="comment"># - &quot;81:81&quot;</span></span><br></pre></td></tr></table></figure>

<p>重启镜像</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose restart</span><br></pre></td></tr></table></figure>

<h3 id="frps"><a href="#frps" class="headerlink" title="frps"></a>frps</h3><p>注释掉<code>docker-compose.yml</code>中</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment"># expose:</span></span><br><span class="line"><span class="comment">#   - &quot;7500&quot;</span></span><br></pre></td></tr></table></figure>

<p>注释<code>frps.ini</code>中</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># dashboard_addr = 0.0.0.0</span></span><br><span class="line"><span class="comment"># dashboard_port = 7500</span></span><br><span class="line"><span class="comment"># dashboard_user = admin</span></span><br><span class="line"><span class="comment"># dashboard_pwd = admin</span></span><br></pre></td></tr></table></figure>

<p>重启镜像</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker-compose restart</span><br></pre></td></tr></table></figure>

<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>群晖在没有公网IP的情况下如何做镜像是个问题。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>nginx</tag>
        <tag>mail</tag>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>日常</title>
    <url>/2021/10/06/7997f30a9ad6/</url>
    <content><![CDATA[<h1 id="日常"><a href="#日常" class="headerlink" title="日常"></a>日常</h1><p>有看到哦！ins这两天服务器炸了。不过还是有看到哦~ </p>
<p>引发了某种可怕的冲动！！！</p>
<p>更新了博客的版本。修了一下bug，表面是看不出来 😢</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>所以为什么是两个锅</title>
    <url>/2021/10/24/703d78868f61/</url>
    <content><![CDATA[<h1 id="所以为什么是两个锅"><a href="#所以为什么是两个锅" class="headerlink" title="所以为什么是两个锅"></a>所以为什么是两个锅</h1><p>今天<code>ins</code>账号警告，不是被举报就是VNP的锅。</p>
<p>顺便整理了一下账号，3个在黑名单里。</p>
<blockquote>
<p>很抱歉，页面不存在<br>很抱歉，页面不存在<br>很抱歉，页面不存在</p>
</blockquote>
<p>情绪爆发的时候也会不开心</p>
<p>也不知道每次更新博客有没人看到</p>
<p>现在感觉，全世界的人站一边，我站另外一边。</p>
<p>前几个月发现，在高层开放阳台的时候，</p>
<p>非常努力的抑制想要跳下去想法</p>
<p>没想过自杀哦！从来都没有想过哦！</p>
<p>非常非常可怕，后来的就不是很敢靠近边缘了。</p>
<p>每次靠近的时候都会有一丝丝的念头。</p>
<p>也许做完游戏我去谈恋爱吧。毕竟母胎solo呢_(:з」∠)_</p>
<p>还想着学下滑翔伞和动力滑翔伞。小声：动力包我都找好了✿✿ヽ(°▽°)ノ✿</p>
<p>右下的智齿也应该拔了，生长带来的疼痛明显增加了。</p>
<p>上面两颗长歪了，能无限生长的话，估计会是两个獠牙。</p>
<p>还有微信账号用qq号搜索不到很久了。</p>
<p>最后 一个<code>不</code>字，比好多行为更有效。</p>
<p>是真的喜欢哦。</p>
<p>没有了</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>是星星啊~</title>
    <url>/2021/11/02/7ab3dd97b271/</url>
    <content><![CDATA[<h1 id="是星星啊"><a href="#是星星啊" class="headerlink" title="是星星啊~"></a>是星星啊~</h1><p>连接为位置那么厚。常规的方法大概率失败啊😳</p>
<p>所以结果是什么呢_(:з」∠)_</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>🎂生日快乐🎂</title>
    <url>/2021/11/06/f35ef6b18849/</url>
    <content><![CDATA[<h1 id="🎂生日快乐🎂"><a href="#🎂生日快乐🎂" class="headerlink" title="🎂生日快乐🎂"></a>🎂生日快乐🎂</h1><p>今天将mac 更新到 <code>big sur</code>。</p>
<p>环境重新布置了一天吧。</p>
<p>好多东西还没装完。</p>
<span id="more"></span>

<h2 id="valet-404"><a href="#valet-404" class="headerlink" title="valet 404"></a>valet 404</h2><p>重新安装<code>valet</code>后，访问的时候出现<code>404</code>。</p>
<p>主要原因是没有设置<code>hosts</code>文件。</p>
<p>添加下面一行到<code>/etc/hosts</code>就解决了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1 web.test</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>valet</tag>
        <tag>404</tag>
      </tags>
  </entry>
  <entry>
    <title>更新了</title>
    <url>/2021/09/27/7656245f6416/</url>
    <content><![CDATA[<h2 id="最前"><a href="#最前" class="headerlink" title="最前"></a>最前</h2><p>有看哦，每周都有看哦，有下载哦，每次都有下载哦。</p>
<p>看到夜景的时候会担心安全哦！🤞🤞🤞</p>
<span id="more"></span>

<h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>使用jellyfin看电影的时候，群晖突然死机了。<br>想着是不是镜像有bug没升级导致的。<br>又想着既然使用的是docker，用docker-compose不是更好吗。<br>于是升级之。最后发现是硬件解码HEVC的锅！<br>这个故事告诉我们配置不高不要下载4K HEVC的电影o(╥﹏╥)o<br>试了一下感觉官方镜像没有linuxserver的好用。</p>
<p>群晖升级完DSM7.0后，gitlab和svn不在支持了。<br>使用DSM6的虚拟机过度了一下，内存占的有点大。</p>
<p>就想着使用docker安装下试试。然而gitlab占内存就是大。<br>之后换个16G的吧！<br>gitlab邮件功能的卡了一个晚上😫😫😫<br>重点是设置要写在<code>gitlab.rb</code>中，而不是<code>docker-compose.yml</code>文件</p>
<p>svn的话就还好。不过使用<code>svn://</code>请求有权限问题，需要手动添加一些。<br>通过<code>http://</code>请求算是正常。奇怪的问题。</p>
<p>使用git，又要用svn的原因是~~~<br>git对二进制文件不是很友好。比如jpg、png、mp4等等。<br>而游戏制作少不了二进制文件。<br>当然git可以使用lfs保存在服务器端。也是多次保存，依然很大的😢😢😢。当个备份总是好的。</p>
<p>为什么要用它们？</p>
<p>因为它们能记录每次修改啊。并且随时可以回到之前的某个状态啊！</p>
<p>踩了不少的坑记录一下。</p>
<h2 id="jellyfin"><a href="#jellyfin" class="headerlink" title="jellyfin"></a>jellyfin</h2><p>docker-compose.yml</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">version:</span> <span class="string">&quot;3.5&quot;</span></span><br><span class="line"><span class="symbol">services:</span></span><br><span class="line">  <span class="symbol">jellyfin:</span></span><br><span class="line">    <span class="symbol">image:</span> ghcr.io/linuxserver/jellyfin</span><br><span class="line">    <span class="comment"># image: jellyfin/jellyfin:latest</span></span><br><span class="line">    <span class="symbol">container_name:</span> jellyfin</span><br><span class="line">    <span class="symbol">network_mode:</span> <span class="string">&quot;bridge&quot;</span></span><br><span class="line">    <span class="comment"># user: 0:0</span></span><br><span class="line">    <span class="symbol">restart:</span> <span class="string">&quot;unless-stopped&quot;</span></span><br><span class="line">    <span class="symbol">ports:</span></span><br><span class="line">      - <span class="string">&quot;8096:8096&quot;</span></span><br><span class="line">    <span class="symbol">volumes:</span></span><br><span class="line">      - <span class="regexp">/volume1/docker</span><span class="regexp">/jellyfin/font</span><span class="symbol">:/usr/share/fontconfig</span></span><br><span class="line">      - <span class="regexp">/volume1/docker</span><span class="regexp">/jellyfin/font</span><span class="symbol">:/usr/share/fonts</span></span><br><span class="line">      - <span class="regexp">/volume1/docker</span><span class="regexp">/jellyfin/config</span><span class="symbol">:/config</span></span><br><span class="line">      - <span class="regexp">/volume1/video</span><span class="symbol">:/data</span></span><br><span class="line">      <span class="comment"># - /volume1/video:/media</span></span><br><span class="line">      <span class="comment"># - /volume1/docker/jellyfin/cache:/cache</span></span><br><span class="line">    <span class="symbol">devices:</span></span><br><span class="line">      - <span class="regexp">/dev/dri</span><span class="symbol">:/dev/dri</span></span><br><span class="line">      <span class="comment"># 硬件解码</span></span><br><span class="line">    <span class="symbol">environment:</span></span><br><span class="line">      - PUID=<span class="number">1000</span></span><br><span class="line">      - PGID=<span class="number">1000</span></span><br><span class="line">    <span class="symbol">deploy:</span></span><br><span class="line">      <span class="symbol">resources:</span></span><br><span class="line">        <span class="symbol">limits:</span></span><br><span class="line">          <span class="symbol">memory:</span> 4G</span><br><span class="line">          <span class="comment"># 限制内存</span></span><br></pre></td></tr></table></figure>

<h2 id="gitlab"><a href="#gitlab" class="headerlink" title="gitlab"></a>gitlab</h2><p>docker-composer.yml</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">version:</span> <span class="string">&quot;3.6&quot;</span></span><br><span class="line"><span class="symbol">services:</span></span><br><span class="line">  <span class="symbol">gitlab:</span></span><br><span class="line">    <span class="symbol">image:</span> <span class="string">&#x27;gitlab/gitlab-ce:latest&#x27;</span></span><br><span class="line">    <span class="symbol">container_name:</span> gitlab</span><br><span class="line">    <span class="symbol">restart:</span> always</span><br><span class="line">    <span class="symbol">network_mode:</span> <span class="string">&quot;bridge&quot;</span></span><br><span class="line">    <span class="symbol">ports:</span></span><br><span class="line">      - <span class="string">&#x27;30080:30080&#x27;</span></span><br><span class="line">      <span class="comment"># - &#x27;30443:443&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;30022:22&#x27;</span></span><br><span class="line">    <span class="symbol">volumes:</span></span><br><span class="line">      - <span class="string">&#x27;$PWD/config:/etc/gitlab&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;$PWD/logs:/var/log/gitlab&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;$PWD/data:/var/opt/gitlab&#x27;</span></span><br><span class="line">    <span class="symbol">environment:</span></span><br><span class="line">        <span class="symbol">GITLAB_OMNIBUS_CONFIG:</span> <span class="params">|</span></span><br><span class="line"><span class="params">          external_url &#x27;http://192.168.50.35:30080&#x27;</span></span><br><span class="line"><span class="params">          gitlab_rails[&#x27;gitlab_shell_ssh_port&#x27;] = 30022</span></span><br><span class="line"><span class="params">    deploy:</span></span><br><span class="line"><span class="params">      resources:</span></span><br><span class="line"><span class="params">        limits:</span></span><br><span class="line"><span class="params">          memory: 4G</span></span><br><span class="line"><span class="params"></span></span><br></pre></td></tr></table></figure>

<h3 id="发送邮件"><a href="#发送邮件" class="headerlink" title="发送邮件"></a>发送邮件</h3><p>坑点设置一定要写在<code>gitlab.rb</code>中，否则不能读取。</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_address&#x27;</span>] = <span class="string">&quot;smtp.gmail.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_port&#x27;</span>] = <span class="number">587</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_user_name&#x27;</span>] = <span class="string">&quot;my.email@gmail.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_password&#x27;</span>] = <span class="string">&quot;my-gmail-password&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_domain&#x27;</span>] = <span class="string">&quot;smtp.gmail.com&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_authentication&#x27;</span>] = <span class="string">&quot;login&quot;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_enable_starttls_auto&#x27;</span>] = <span class="literal">true</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_tls&#x27;</span>] = <span class="literal">false</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;smtp_openssl_verify_mode&#x27;</span>] = <span class="string">&#x27;peer&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="测试方法"><a href="#测试方法" class="headerlink" title="测试方法"></a>测试方法</h3><p>进入镜像</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it gitlab bash</span><br><span class="line">gitlab-ctl reconfigure</span><br><span class="line">gitlab-rails console</span><br><span class="line">Notify.test_email(<span class="string">&#x27;destination_email@address.com&#x27;</span>, <span class="string">&#x27;Message Subject&#x27;</span>, <span class="string">&#x27;Message Body&#x27;</span>).deliver_now</span><br></pre></td></tr></table></figure>

<p><a href="https://docs.gitlab.com/omnibus/settings/smtp.html#testing-the-smtp-configuration">参考文档：SMTP settings</a></p>
<p>ps: 如果使用私人邮箱可能出现501错误，添加放设置并根据情况修改</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">gitlab_rails[<span class="string">&#x27;gitlab_email_from&#x27;</span>] = <span class="string">&#x27;k11@keleven.me&#x27;</span></span><br><span class="line">gitlab_rails[<span class="string">&#x27;gitlab_email_display_name&#x27;</span>] = <span class="string">&#x27;k11&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="svn-server"><a href="#svn-server" class="headerlink" title="svn-server"></a>svn-server</h2><p>docker-compose.yml</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="symbol">version:</span> <span class="string">&quot;3.6&quot;</span></span><br><span class="line"><span class="symbol">services:</span></span><br><span class="line">  svn-<span class="symbol">server:</span></span><br><span class="line">    <span class="symbol">image:</span> <span class="string">&#x27;elleflorio/svn-server&#x27;</span></span><br><span class="line">    <span class="symbol">container_name:</span> svn-server</span><br><span class="line">    <span class="symbol">restart:</span> always</span><br><span class="line">    <span class="symbol">network_mode:</span> <span class="string">&quot;bridge&quot;</span></span><br><span class="line">    <span class="symbol">ports:</span></span><br><span class="line">      - <span class="string">&#x27;31080:80&#x27;</span></span><br><span class="line">      - <span class="string">&#x27;3690:3690&#x27;</span></span><br><span class="line">    <span class="symbol">volumes:</span></span><br><span class="line">      - <span class="variable">$PWD</span>/data/<span class="symbol">repo:</span>/home/svn</span><br><span class="line">      - <span class="variable">$PWD</span>/data/subversion/subversion-access-<span class="symbol">control:</span>/etc/subversion/subversion-access-control</span><br><span class="line">      - <span class="variable">$PWD</span>/data/subversion/<span class="symbol">passwd:</span>/etc/subversion/passwd</span><br><span class="line">    <span class="symbol">deploy:</span></span><br><span class="line">      <span class="symbol">resources:</span></span><br><span class="line">        <span class="symbol">limits:</span></span><br><span class="line">          <span class="symbol">memory:</span> 2G</span><br></pre></td></tr></table></figure>

<h3 id="路径777权限"><a href="#路径777权限" class="headerlink" title="路径777权限"></a>路径777权限</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mkdir data</span><br><span class="line">chmod 777 data</span><br></pre></td></tr></table></figure>

<h3 id="手动复制if-svnadmin设置文件"><a href="#手动复制if-svnadmin设置文件" class="headerlink" title="手动复制if.svnadmin设置文件"></a>手动复制<code>if.svnadmin</code>设置文件</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d name svn-server -p 31080:80 -p 3690:3690 -v elleflorio/svn-server</span><br><span class="line">docker cp svn-server:/etc/subversion /data</span><br><span class="line">docker stop svn-server</span><br><span class="line">docker rm svn-server</span><br></pre></td></tr></table></figure>

<h3 id="修改AH00558-不修也可以"><a href="#修改AH00558-不修也可以" class="headerlink" title="修改AH00558 不修也可以"></a>修改AH00558 不修也可以</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it svn-server /bin/sh</span><br><span class="line"><span class="built_in">cd</span> /etc/apache2/</span><br><span class="line">vi httpd.conf</span><br></pre></td></tr></table></figure>

<p>添加 对应的IP与端口</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ServerName 192.168.1.1:31080</span><br></pre></td></tr></table></figure>

<p><code>esc</code>对出编辑模式，<code>:wq</code>保存并退出</p>
<p>重启docker镜像</p>
<h3 id="设置svnadmin"><a href="#设置svnadmin" class="headerlink" title="设置svnadmin"></a>设置svnadmin</h3><p>地址<code>x.x.x.x:31080/svnadmin</code>填写设置</p>
<blockquote>
<p>Subversion authorization file : <code>/etc/subversion/subversion-access-control</code><br>User authentication file (SVNUserFile) : <code>/etc/subversion/passwd</code><br>Parent directory of the repositories (SVNParentPath) : <code>/home/svn</code><br>Subversion client executable : <code>/usr/bin/svn</code><br>Subversion admin executable : <code>/usr/bin/svnadmin</code></p>
</blockquote>
<h3 id="手动添加权限"><a href="#手动添加权限" class="headerlink" title="手动添加权限"></a>手动添加权限</h3><p>手动添加权限解决<code>svn://</code>请求权限问题</p>
<p>项目目录下</p>
<p><code>passwd</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username = passwd</span><br></pre></td></tr></table></figure>

<p><code>svnserve.conf</code>文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[general]</span><br><span class="line">password-db = passwd</span><br><span class="line">auth-access = write</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/qq_25568881/article/details/103753005">参考地址</a></p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>无能的人到了高位还是无能的，还会带着其他人一起。</p>
<p>限电下一步是能源危机，之后是粮食。</p>
<p>还共同体，共你妈的！！！</p>
<p>这种人当杀，而且全世界直播的那种！！！</p>
<p>只要不革新，我是不打算让孩子生活在这样的国家的。</p>
<p>有人看到这里吗？也许有吧！</p>
<p>每天都在想着一个人。见面的日子不远了。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>对比刚刚好~</title>
    <url>/2021/11/20/773437166e0e/</url>
    <content><![CDATA[<h1 id="对比刚刚好"><a href="#对比刚刚好" class="headerlink" title="对比刚刚好~"></a>对比刚刚好~</h1><p>我猜是用13 pro拍的，那些风景里最喜欢新拍的这张。</p>
<p>感觉就像是初窥构图之门的样子😁。</p>
<p>最喜欢的照片是那个？</p>
<p>当然是有你的啊~</p>
<p>想你了。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>找到了~</title>
    <url>/2021/11/23/4a26b26b11ea/</url>
    <content><![CDATA[<h1 id="找到了"><a href="#找到了" class="headerlink" title="找到了~"></a>找到了~</h1><p>我猜在东方广场 (*￣︶￣)</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>域名搬家了~</title>
    <url>/2021/11/17/1c12b9d73162/</url>
    <content><![CDATA[<h1 id="域名搬家了"><a href="#域名搬家了" class="headerlink" title="域名搬家了~"></a>域名搬家了~</h1><p>域名从<code>Namecheap</code>搬到了<code>Cloudflare</code>。</p>
<p>时间续费到了2023年_(:з」∠)_</p>
<p>估计之后的注册也是在<code>Cloudflare</code>，而且使用另外的账号。</p>
<p>Ps:总是在日坛公园附近活动，莫不是住在附近？</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>域名</tag>
      </tags>
  </entry>
  <entry>
    <title>嗯 有点像呢</title>
    <url>/2021/10/29/9d33e32bcf9e/</url>
    <content><![CDATA[<h1 id="有看到哦"><a href="#有看到哦" class="headerlink" title="有看到哦"></a>有看到哦</h1><p>说来也是神奇，看到前略有感觉。</p>
<p>闲下来的时候一看。嗯~</p>
<p>可能是想我了吧😁 【 自作多情系列 】</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>🉑🉑🉑</title>
    <url>/2021/11/28/bed32f06e1e7/</url>
    <content><![CDATA[<h1 id="好吧"><a href="#好吧" class="headerlink" title="好吧"></a>好吧</h1><p>贪婪的愿望</p>
<p>许愿向来是越详细越好</p>
<p>每日一善！变一点点吧！试试看吧！</p>
<p>隐去了什么自己想想吧！φ(≧ω≦*)♪</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>报错的日常</title>
    <url>/2021/11/30/7c38b0c549fa/</url>
    <content><![CDATA[<h1 id="没有错误是不存在的"><a href="#没有错误是不存在的" class="headerlink" title="没有错误是不存在的"></a>没有错误是不存在的</h1><h2 id="又见-php-升级后的-redis-错误"><a href="#又见-php-升级后的-redis-错误" class="headerlink" title="又见 php 升级后的 redis 错误"></a>又见 php 升级后的 redis 错误</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Please remove or rename the Redis facade alias in your &quot;app&quot; configuration file in order to avoid collision with the PHP Redis extension.</span><br></pre></td></tr></table></figure>

<p>解决方法，使用上个版本的<code>php</code></p>
<p>记得<code>valet restart</code></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>1~ 2~ 3~ 想你了~</title>
    <url>/2021/12/03/cb00df71d865/</url>
    <content><![CDATA[<h1 id="123-木头人"><a href="#123-木头人" class="headerlink" title="123~ 木头人~"></a>123~ 木头人~</h1><p>知道吗~ 淘宝上△ □ ○的面具都下架了哦。</p>
<p>有人说我是杞人忧天</p>
<p>可是有一天刀子落在自己身上</p>
<p>却一点办法都没有</p>
<p>是我最大的恐惧</p>
<p>印象最深的是猜弹子的那对夫妻</p>
<p>猜猜我会怎么做</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>ins账号又炸了</title>
    <url>/2021/12/05/5f7027432761/</url>
    <content><![CDATA[<p>不注册，不开心。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>咱感觉被催更了─=≡Σ(((つ•̀ω•́)つ))</title>
    <url>/2021/12/10/b7a352f5b26e/</url>
    <content><![CDATA[<p>好吧 没看出来 第一张是不有点太抽象了</p>
<p>咱喜欢第二张左上反射的不规则样子的灯光</p>
<p>咱还怀疑 工作不是996 就是大小周 好像又不太对</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>咱怀疑你会魔法 (♥ω♥)~♪ </title>
    <url>/2021/12/11/f37581637d91/</url>
    <content><![CDATA[<p>对错 一定是这样 🧙</p>
<p>违反物理法则的咖啡 🤩</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>这两天右耳会热~有人想我吗~</title>
    <url>/2021/12/14/e534b7349cf2/</url>
    <content><![CDATA[<p>偶然发现地点了</p>
<p>感谢幸运之神！😘</p>
<p>首尔饭家 对吧（￣︶￣）↗</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>早上好呀😴</title>
    <url>/2021/11/27/f9bf56513b61/</url>
    <content><![CDATA[<h1 id="星星还在天上呢-๑¯㉨¯๑"><a href="#星星还在天上呢-๑¯㉨¯๑" class="headerlink" title="星星还在天上呢 (๑¯㉨¯๑)"></a>星星还在天上呢 (๑¯㉨¯๑)</h1><p>最近喜欢喝姜汁可乐</p>
<p>嗯~ 咱知道口味挺怪的 🤣</p>
<p>不过菜里姜蒜咱都不吃的 😶</p>
<p>双十一入手了<code>Sony WF-1000XM4</code>超喜欢</p>
<p>比AirPods好上几倍。</p>
<p>忘了说<code>macbook pro</code>也下单了。供应商折扣85折✌️，便宜出一部<code>iphone</code>。</p>
<p>到货时间一到两个月。</p>
<p>疫情终将过去，之后有什么打算吗？</p>
<p>去日本旅行不算，想知道更长久的，比如说想要生活的地方。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>不知道说什么就想着更新下</title>
    <url>/2021/12/30/2b9a98db39ed/</url>
    <content><![CDATA[<p>没消息就是会担心</p>
<p>可能人家根本就需要吧</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>咱可能是想吃炸鸡了(￣▽￣)~*</title>
    <url>/2021/12/12/adf50c1a5bc6/</url>
    <content><![CDATA[<p>咱凭空闻到了炸鸡的香味！</p>
<p>还挺香的_(:з」∠)_</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>好吧 咱还是注册了 (╯‵□′)╯︵┻━┻</title>
    <url>/2021/12/08/3bdff263912b/</url>
    <content><![CDATA[<p>为了看更新咱还是注册了😭</p>
<p>咱喜欢那两只喜鹊~</p>
<p>晚饭是排骨炖酸菜(*￣︶￣)</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>冬至了~饺子~还是汤圆呢~</title>
    <url>/2021/12/21/3d40af42fab1/</url>
    <content><![CDATA[<p>右手无名指的指甲又长到肉里面了🤡</p>
<p>最近好像每个月一次。</p>
<p>嗯，该记下日子了👨‍⚕️‍</p>
<p>左下的智齿也开始生长了</p>
<p>还好不疼 (╥╯^╰╥)</p>
<p>拍了一些春节的装饰品，还挺可爱的</p>
<p>等到了咱发出来看看</p>
<p>macbook还没到货😫</p>
<p>之前买的有意思的玩具</p>
<p>要是咱能直接看ins，咱会很开心的~</p>
<blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/tv/CXvsSyghuhM/?utm_source=ig_embed&amp;utm_campaign=loading" data-instgrm-version="14" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:540px; min-width:326px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);"><div style="padding:16px;"> <a href="https://www.instagram.com/tv/CXvsSyghuhM/?utm_source=ig_embed&amp;utm_campaign=loading" style=" background:#FFFFFF; line-height:0; padding:0 0; text-align:center; text-decoration:none; width:100%;" target="_blank"> <div style=" display: flex; flex-direction: row; align-items: center;"> <div style="background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 40px; margin-right: 14px; width: 40px;"></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 100px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 60px;"></div></div></div><div style="padding: 19% 0;"></div> <div style="display:block; height:50px; margin:0 auto 12px; width:50px;"><svg width="50px" height="50px" viewBox="0 0 60 60" version="1.1" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-511.000000, -20.000000)" fill="#000000"><g><path d="M556.869,30.41 C554.814,30.41 553.148,32.076 553.148,34.131 C553.148,36.186 554.814,37.852 556.869,37.852 C558.924,37.852 560.59,36.186 560.59,34.131 C560.59,32.076 558.924,30.41 556.869,30.41 M541,60.657 C535.114,60.657 530.342,55.887 530.342,50 C530.342,44.114 535.114,39.342 541,39.342 C546.887,39.342 551.658,44.114 551.658,50 C551.658,55.887 546.887,60.657 541,60.657 M541,33.886 C532.1,33.886 524.886,41.1 524.886,50 C524.886,58.899 532.1,66.113 541,66.113 C549.9,66.113 557.115,58.899 557.115,50 C557.115,41.1 549.9,33.886 541,33.886 M565.378,62.101 C565.244,65.022 564.756,66.606 564.346,67.663 C563.803,69.06 563.154,70.057 562.106,71.106 C561.058,72.155 560.06,72.803 558.662,73.347 C557.607,73.757 556.021,74.244 553.102,74.378 C549.944,74.521 548.997,74.552 541,74.552 C533.003,74.552 532.056,74.521 528.898,74.378 C525.979,74.244 524.393,73.757 523.338,73.347 C521.94,72.803 520.942,72.155 519.894,71.106 C518.846,70.057 518.197,69.06 517.654,67.663 C517.244,66.606 516.755,65.022 516.623,62.101 C516.479,58.943 516.448,57.996 516.448,50 C516.448,42.003 516.479,41.056 516.623,37.899 C516.755,34.978 517.244,33.391 517.654,32.338 C518.197,30.938 518.846,29.942 519.894,28.894 C520.942,27.846 521.94,27.196 523.338,26.654 C524.393,26.244 525.979,25.756 528.898,25.623 C532.057,25.479 533.004,25.448 541,25.448 C548.997,25.448 549.943,25.479 553.102,25.623 C556.021,25.756 557.607,26.244 558.662,26.654 C560.06,27.196 561.058,27.846 562.106,28.894 C563.154,29.942 563.803,30.938 564.346,32.338 C564.756,33.391 565.244,34.978 565.378,37.899 C565.522,41.056 565.552,42.003 565.552,50 C565.552,57.996 565.522,58.943 565.378,62.101 M570.82,37.631 C570.674,34.438 570.167,32.258 569.425,30.349 C568.659,28.377 567.633,26.702 565.965,25.035 C564.297,23.368 562.623,22.342 560.652,21.575 C558.743,20.834 556.562,20.326 553.369,20.18 C550.169,20.033 549.148,20 541,20 C532.853,20 531.831,20.033 528.631,20.18 C525.438,20.326 523.257,20.834 521.349,21.575 C519.376,22.342 517.703,23.368 516.035,25.035 C514.368,26.702 513.342,28.377 512.574,30.349 C511.834,32.258 511.326,34.438 511.181,37.631 C511.035,40.831 511,41.851 511,50 C511,58.147 511.035,59.17 511.181,62.369 C511.326,65.562 511.834,67.743 512.574,69.651 C513.342,71.625 514.368,73.296 516.035,74.965 C517.703,76.634 519.376,77.658 521.349,78.425 C523.257,79.167 525.438,79.673 528.631,79.82 C531.831,79.965 532.853,80.001 541,80.001 C549.148,80.001 550.169,79.965 553.369,79.82 C556.562,79.673 558.743,79.167 560.652,78.425 C562.623,77.658 564.297,76.634 565.965,74.965 C567.633,73.296 568.659,71.625 569.425,69.651 C570.167,67.743 570.674,65.562 570.82,62.369 C570.966,59.17 571,58.147 571,50 C571,41.851 570.966,40.831 570.82,37.631"></path></g></g></g></svg></div><div style="padding-top: 8px;"> <div style=" color:#3897f0; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:550; line-height:18px;">在 Instagram 查看这篇帖子</div></div><div style="padding: 12.5% 0;"></div> <div style="display: flex; flex-direction: row; margin-bottom: 14px; align-items: center;"><div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(0px) translateY(7px);"></div> <div style="background-color: #F4F4F4; height: 12.5px; transform: rotate(-45deg) translateX(3px) translateY(1px); width: 12.5px; flex-grow: 0; margin-right: 14px; margin-left: 2px;"></div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(9px) translateY(-18px);"></div></div><div style="margin-left: 8px;"> <div style=" background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 20px; width: 20px;"></div> <div style=" width: 0; height: 0; border-top: 2px solid transparent; border-left: 6px solid #f4f4f4; border-bottom: 2px solid transparent; transform: translateX(16px) translateY(-4px) rotate(30deg)"></div></div><div style="margin-left: auto;"> <div style=" width: 0px; border-top: 8px solid #F4F4F4; border-right: 8px solid transparent; transform: translateY(16px);"></div> <div style=" background-color: #F4F4F4; flex-grow: 0; height: 12px; width: 16px; transform: translateY(-4px);"></div> <div style=" width: 0; height: 0; border-top: 8px solid #F4F4F4; border-left: 8px solid transparent; transform: translateY(-4px) translateX(8px);"></div></div></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center; margin-bottom: 24px;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 224px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 144px;"></div></div></a><p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;"><a href="https://www.instagram.com/tv/CXvsSyghuhM/?utm_source=ig_embed&amp;utm_campaign=loading" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none;" target="_blank">@_y.o_o.y_ 分享的帖子</a></p></div></blockquote> <script async src="//www.instagram.com/embed.js"></script>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>装饰组装了~</title>
    <url>/2021/12/31/0e2143cbb8bc/</url>
    <content><![CDATA[<p>对联和福字还没有组装_(:з」∠)_</p>
<blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/p/CYImlQdLGHn/?utm_source=ig_embed&amp;utm_campaign=loading" data-instgrm-version="14" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:540px; min-width:326px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);"><div style="padding:16px;"> <a href="https://www.instagram.com/p/CYImlQdLGHn/?utm_source=ig_embed&amp;utm_campaign=loading" style=" background:#FFFFFF; line-height:0; padding:0 0; text-align:center; text-decoration:none; width:100%;" target="_blank"> <div style=" display: flex; flex-direction: row; align-items: center;"> <div style="background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 40px; margin-right: 14px; width: 40px;"></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 100px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 60px;"></div></div></div><div style="padding: 19% 0;"></div> <div style="display:block; height:50px; margin:0 auto 12px; width:50px;"><svg width="50px" height="50px" viewBox="0 0 60 60" version="1.1" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-511.000000, -20.000000)" fill="#000000"><g><path d="M556.869,30.41 C554.814,30.41 553.148,32.076 553.148,34.131 C553.148,36.186 554.814,37.852 556.869,37.852 C558.924,37.852 560.59,36.186 560.59,34.131 C560.59,32.076 558.924,30.41 556.869,30.41 M541,60.657 C535.114,60.657 530.342,55.887 530.342,50 C530.342,44.114 535.114,39.342 541,39.342 C546.887,39.342 551.658,44.114 551.658,50 C551.658,55.887 546.887,60.657 541,60.657 M541,33.886 C532.1,33.886 524.886,41.1 524.886,50 C524.886,58.899 532.1,66.113 541,66.113 C549.9,66.113 557.115,58.899 557.115,50 C557.115,41.1 549.9,33.886 541,33.886 M565.378,62.101 C565.244,65.022 564.756,66.606 564.346,67.663 C563.803,69.06 563.154,70.057 562.106,71.106 C561.058,72.155 560.06,72.803 558.662,73.347 C557.607,73.757 556.021,74.244 553.102,74.378 C549.944,74.521 548.997,74.552 541,74.552 C533.003,74.552 532.056,74.521 528.898,74.378 C525.979,74.244 524.393,73.757 523.338,73.347 C521.94,72.803 520.942,72.155 519.894,71.106 C518.846,70.057 518.197,69.06 517.654,67.663 C517.244,66.606 516.755,65.022 516.623,62.101 C516.479,58.943 516.448,57.996 516.448,50 C516.448,42.003 516.479,41.056 516.623,37.899 C516.755,34.978 517.244,33.391 517.654,32.338 C518.197,30.938 518.846,29.942 519.894,28.894 C520.942,27.846 521.94,27.196 523.338,26.654 C524.393,26.244 525.979,25.756 528.898,25.623 C532.057,25.479 533.004,25.448 541,25.448 C548.997,25.448 549.943,25.479 553.102,25.623 C556.021,25.756 557.607,26.244 558.662,26.654 C560.06,27.196 561.058,27.846 562.106,28.894 C563.154,29.942 563.803,30.938 564.346,32.338 C564.756,33.391 565.244,34.978 565.378,37.899 C565.522,41.056 565.552,42.003 565.552,50 C565.552,57.996 565.522,58.943 565.378,62.101 M570.82,37.631 C570.674,34.438 570.167,32.258 569.425,30.349 C568.659,28.377 567.633,26.702 565.965,25.035 C564.297,23.368 562.623,22.342 560.652,21.575 C558.743,20.834 556.562,20.326 553.369,20.18 C550.169,20.033 549.148,20 541,20 C532.853,20 531.831,20.033 528.631,20.18 C525.438,20.326 523.257,20.834 521.349,21.575 C519.376,22.342 517.703,23.368 516.035,25.035 C514.368,26.702 513.342,28.377 512.574,30.349 C511.834,32.258 511.326,34.438 511.181,37.631 C511.035,40.831 511,41.851 511,50 C511,58.147 511.035,59.17 511.181,62.369 C511.326,65.562 511.834,67.743 512.574,69.651 C513.342,71.625 514.368,73.296 516.035,74.965 C517.703,76.634 519.376,77.658 521.349,78.425 C523.257,79.167 525.438,79.673 528.631,79.82 C531.831,79.965 532.853,80.001 541,80.001 C549.148,80.001 550.169,79.965 553.369,79.82 C556.562,79.673 558.743,79.167 560.652,78.425 C562.623,77.658 564.297,76.634 565.965,74.965 C567.633,73.296 568.659,71.625 569.425,69.651 C570.167,67.743 570.674,65.562 570.82,62.369 C570.966,59.17 571,58.147 571,50 C571,41.851 570.966,40.831 570.82,37.631"></path></g></g></g></svg></div><div style="padding-top: 8px;"> <div style=" color:#3897f0; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:550; line-height:18px;">在 Instagram 查看这篇帖子</div></div><div style="padding: 12.5% 0;"></div> <div style="display: flex; flex-direction: row; margin-bottom: 14px; align-items: center;"><div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(0px) translateY(7px);"></div> <div style="background-color: #F4F4F4; height: 12.5px; transform: rotate(-45deg) translateX(3px) translateY(1px); width: 12.5px; flex-grow: 0; margin-right: 14px; margin-left: 2px;"></div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(9px) translateY(-18px);"></div></div><div style="margin-left: 8px;"> <div style=" background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 20px; width: 20px;"></div> <div style=" width: 0; height: 0; border-top: 2px solid transparent; border-left: 6px solid #f4f4f4; border-bottom: 2px solid transparent; transform: translateX(16px) translateY(-4px) rotate(30deg)"></div></div><div style="margin-left: auto;"> <div style=" width: 0px; border-top: 8px solid #F4F4F4; border-right: 8px solid transparent; transform: translateY(16px);"></div> <div style=" background-color: #F4F4F4; flex-grow: 0; height: 12px; width: 16px; transform: translateY(-4px);"></div> <div style=" width: 0; height: 0; border-top: 8px solid #F4F4F4; border-left: 8px solid transparent; transform: translateY(-4px) translateX(8px);"></div></div></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center; margin-bottom: 24px;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 224px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 144px;"></div></div></a><p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;"><a href="https://www.instagram.com/p/CYImlQdLGHn/?utm_source=ig_embed&amp;utm_campaign=loading" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none;" target="_blank">@_y.o_o.y_ 分享的帖子</a></p></div></blockquote> <script async src="//www.instagram.com/embed.js"></script>

<p>电脑今天到了 😄</p>
<blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/p/CYJLWHPv1qV/?utm_source=ig_embed&amp;utm_campaign=loading" data-instgrm-version="14" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:540px; min-width:326px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);"><div style="padding:16px;"> <a href="https://www.instagram.com/p/CYJLWHPv1qV/?utm_source=ig_embed&amp;utm_campaign=loading" style=" background:#FFFFFF; line-height:0; padding:0 0; text-align:center; text-decoration:none; width:100%;" target="_blank"> <div style=" display: flex; flex-direction: row; align-items: center;"> <div style="background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 40px; margin-right: 14px; width: 40px;"></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 100px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 60px;"></div></div></div><div style="padding: 19% 0;"></div> <div style="display:block; height:50px; margin:0 auto 12px; width:50px;"><svg width="50px" height="50px" viewBox="0 0 60 60" version="1.1" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-511.000000, -20.000000)" fill="#000000"><g><path d="M556.869,30.41 C554.814,30.41 553.148,32.076 553.148,34.131 C553.148,36.186 554.814,37.852 556.869,37.852 C558.924,37.852 560.59,36.186 560.59,34.131 C560.59,32.076 558.924,30.41 556.869,30.41 M541,60.657 C535.114,60.657 530.342,55.887 530.342,50 C530.342,44.114 535.114,39.342 541,39.342 C546.887,39.342 551.658,44.114 551.658,50 C551.658,55.887 546.887,60.657 541,60.657 M541,33.886 C532.1,33.886 524.886,41.1 524.886,50 C524.886,58.899 532.1,66.113 541,66.113 C549.9,66.113 557.115,58.899 557.115,50 C557.115,41.1 549.9,33.886 541,33.886 M565.378,62.101 C565.244,65.022 564.756,66.606 564.346,67.663 C563.803,69.06 563.154,70.057 562.106,71.106 C561.058,72.155 560.06,72.803 558.662,73.347 C557.607,73.757 556.021,74.244 553.102,74.378 C549.944,74.521 548.997,74.552 541,74.552 C533.003,74.552 532.056,74.521 528.898,74.378 C525.979,74.244 524.393,73.757 523.338,73.347 C521.94,72.803 520.942,72.155 519.894,71.106 C518.846,70.057 518.197,69.06 517.654,67.663 C517.244,66.606 516.755,65.022 516.623,62.101 C516.479,58.943 516.448,57.996 516.448,50 C516.448,42.003 516.479,41.056 516.623,37.899 C516.755,34.978 517.244,33.391 517.654,32.338 C518.197,30.938 518.846,29.942 519.894,28.894 C520.942,27.846 521.94,27.196 523.338,26.654 C524.393,26.244 525.979,25.756 528.898,25.623 C532.057,25.479 533.004,25.448 541,25.448 C548.997,25.448 549.943,25.479 553.102,25.623 C556.021,25.756 557.607,26.244 558.662,26.654 C560.06,27.196 561.058,27.846 562.106,28.894 C563.154,29.942 563.803,30.938 564.346,32.338 C564.756,33.391 565.244,34.978 565.378,37.899 C565.522,41.056 565.552,42.003 565.552,50 C565.552,57.996 565.522,58.943 565.378,62.101 M570.82,37.631 C570.674,34.438 570.167,32.258 569.425,30.349 C568.659,28.377 567.633,26.702 565.965,25.035 C564.297,23.368 562.623,22.342 560.652,21.575 C558.743,20.834 556.562,20.326 553.369,20.18 C550.169,20.033 549.148,20 541,20 C532.853,20 531.831,20.033 528.631,20.18 C525.438,20.326 523.257,20.834 521.349,21.575 C519.376,22.342 517.703,23.368 516.035,25.035 C514.368,26.702 513.342,28.377 512.574,30.349 C511.834,32.258 511.326,34.438 511.181,37.631 C511.035,40.831 511,41.851 511,50 C511,58.147 511.035,59.17 511.181,62.369 C511.326,65.562 511.834,67.743 512.574,69.651 C513.342,71.625 514.368,73.296 516.035,74.965 C517.703,76.634 519.376,77.658 521.349,78.425 C523.257,79.167 525.438,79.673 528.631,79.82 C531.831,79.965 532.853,80.001 541,80.001 C549.148,80.001 550.169,79.965 553.369,79.82 C556.562,79.673 558.743,79.167 560.652,78.425 C562.623,77.658 564.297,76.634 565.965,74.965 C567.633,73.296 568.659,71.625 569.425,69.651 C570.167,67.743 570.674,65.562 570.82,62.369 C570.966,59.17 571,58.147 571,50 C571,41.851 570.966,40.831 570.82,37.631"></path></g></g></g></svg></div><div style="padding-top: 8px;"> <div style=" color:#3897f0; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:550; line-height:18px;">在 Instagram 查看这篇帖子</div></div><div style="padding: 12.5% 0;"></div> <div style="display: flex; flex-direction: row; margin-bottom: 14px; align-items: center;"><div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(0px) translateY(7px);"></div> <div style="background-color: #F4F4F4; height: 12.5px; transform: rotate(-45deg) translateX(3px) translateY(1px); width: 12.5px; flex-grow: 0; margin-right: 14px; margin-left: 2px;"></div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(9px) translateY(-18px);"></div></div><div style="margin-left: 8px;"> <div style=" background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 20px; width: 20px;"></div> <div style=" width: 0; height: 0; border-top: 2px solid transparent; border-left: 6px solid #f4f4f4; border-bottom: 2px solid transparent; transform: translateX(16px) translateY(-4px) rotate(30deg)"></div></div><div style="margin-left: auto;"> <div style=" width: 0px; border-top: 8px solid #F4F4F4; border-right: 8px solid transparent; transform: translateY(16px);"></div> <div style=" background-color: #F4F4F4; flex-grow: 0; height: 12px; width: 16px; transform: translateY(-4px);"></div> <div style=" width: 0; height: 0; border-top: 8px solid #F4F4F4; border-left: 8px solid transparent; transform: translateY(-4px) translateX(8px);"></div></div></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center; margin-bottom: 24px;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 224px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 144px;"></div></div></a><p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;"><a href="https://www.instagram.com/p/CYJLWHPv1qV/?utm_source=ig_embed&amp;utm_campaign=loading" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none;" target="_blank">@_y.o_o.y_ 分享的帖子</a></p></div></blockquote> <script async src="//www.instagram.com/embed.js"></script>

<p>环境配置起来~</p>
<p>拒绝冷暴力从我做起</p>
<p>这几天的早上都会打两个喷嚏也不知道是什么了</p>
<!-- ![](/images/post/2021-12-31/271038474_1396703727430356_6969553645683363431_n.jpg)

<video src="/video/2021-12-31/270902233_957532851530318_4634842699109616086_n.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster=""></video>

<video src="/video/2021-12-31/271109120_1336533326794309_8538777690998533975_n.mp4" preload="metadata" controlslist="nodownload" controls playsinline poster=""></video> -->]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>是那种呢？</title>
    <url>/2022/01/10/1b679fef90f2/</url>
    <content><![CDATA[<ol>
<li><p>想抱抱 😁</p>
</li>
<li><p>望着北方 </p>
</li>
<li><p>就看看风景</p>
</li>
</ol>
<p>所以是那种呢？</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>咱想看喝黄油啤酒的样子</title>
    <url>/2021/12/18/f25894eaa268/</url>
    <content><![CDATA[<p>就给咱自己看的样子(*￣︶￣)</p>
<p>小心机~ 😏</p>
<p>和咱再去一次! </p>
<p>人家都说优速通才是完整体验的样子😉</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>环境安装了一天_(:з」∠)_</title>
    <url>/2022/01/01/e517facc8105/</url>
    <content><![CDATA[<p>就是键位需要适应一下</p>
<p>还要看看有什么方法可以连接两个显示器</p>
<p>下午去了宜家，主要是想吃鸡肉串了。</p>
<p>买了两袋冷藏的回家。地铁3站而已。</p>
<p>晚上的甜点~ 门口的面包店~ 看起来还不错~ </p>
<blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/p/CYMOYFyBRf9/?utm_source=ig_embed&amp;utm_campaign=loading" data-instgrm-version="14" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:540px; min-width:326px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);"><div style="padding:16px;"> <a href="https://www.instagram.com/p/CYMOYFyBRf9/?utm_source=ig_embed&amp;utm_campaign=loading" style=" background:#FFFFFF; line-height:0; padding:0 0; text-align:center; text-decoration:none; width:100%;" target="_blank"> <div style=" display: flex; flex-direction: row; align-items: center;"> <div style="background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 40px; margin-right: 14px; width: 40px;"></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 100px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 60px;"></div></div></div><div style="padding: 19% 0;"></div> <div style="display:block; height:50px; margin:0 auto 12px; width:50px;"><svg width="50px" height="50px" viewBox="0 0 60 60" version="1.1" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-511.000000, -20.000000)" fill="#000000"><g><path d="M556.869,30.41 C554.814,30.41 553.148,32.076 553.148,34.131 C553.148,36.186 554.814,37.852 556.869,37.852 C558.924,37.852 560.59,36.186 560.59,34.131 C560.59,32.076 558.924,30.41 556.869,30.41 M541,60.657 C535.114,60.657 530.342,55.887 530.342,50 C530.342,44.114 535.114,39.342 541,39.342 C546.887,39.342 551.658,44.114 551.658,50 C551.658,55.887 546.887,60.657 541,60.657 M541,33.886 C532.1,33.886 524.886,41.1 524.886,50 C524.886,58.899 532.1,66.113 541,66.113 C549.9,66.113 557.115,58.899 557.115,50 C557.115,41.1 549.9,33.886 541,33.886 M565.378,62.101 C565.244,65.022 564.756,66.606 564.346,67.663 C563.803,69.06 563.154,70.057 562.106,71.106 C561.058,72.155 560.06,72.803 558.662,73.347 C557.607,73.757 556.021,74.244 553.102,74.378 C549.944,74.521 548.997,74.552 541,74.552 C533.003,74.552 532.056,74.521 528.898,74.378 C525.979,74.244 524.393,73.757 523.338,73.347 C521.94,72.803 520.942,72.155 519.894,71.106 C518.846,70.057 518.197,69.06 517.654,67.663 C517.244,66.606 516.755,65.022 516.623,62.101 C516.479,58.943 516.448,57.996 516.448,50 C516.448,42.003 516.479,41.056 516.623,37.899 C516.755,34.978 517.244,33.391 517.654,32.338 C518.197,30.938 518.846,29.942 519.894,28.894 C520.942,27.846 521.94,27.196 523.338,26.654 C524.393,26.244 525.979,25.756 528.898,25.623 C532.057,25.479 533.004,25.448 541,25.448 C548.997,25.448 549.943,25.479 553.102,25.623 C556.021,25.756 557.607,26.244 558.662,26.654 C560.06,27.196 561.058,27.846 562.106,28.894 C563.154,29.942 563.803,30.938 564.346,32.338 C564.756,33.391 565.244,34.978 565.378,37.899 C565.522,41.056 565.552,42.003 565.552,50 C565.552,57.996 565.522,58.943 565.378,62.101 M570.82,37.631 C570.674,34.438 570.167,32.258 569.425,30.349 C568.659,28.377 567.633,26.702 565.965,25.035 C564.297,23.368 562.623,22.342 560.652,21.575 C558.743,20.834 556.562,20.326 553.369,20.18 C550.169,20.033 549.148,20 541,20 C532.853,20 531.831,20.033 528.631,20.18 C525.438,20.326 523.257,20.834 521.349,21.575 C519.376,22.342 517.703,23.368 516.035,25.035 C514.368,26.702 513.342,28.377 512.574,30.349 C511.834,32.258 511.326,34.438 511.181,37.631 C511.035,40.831 511,41.851 511,50 C511,58.147 511.035,59.17 511.181,62.369 C511.326,65.562 511.834,67.743 512.574,69.651 C513.342,71.625 514.368,73.296 516.035,74.965 C517.703,76.634 519.376,77.658 521.349,78.425 C523.257,79.167 525.438,79.673 528.631,79.82 C531.831,79.965 532.853,80.001 541,80.001 C549.148,80.001 550.169,79.965 553.369,79.82 C556.562,79.673 558.743,79.167 560.652,78.425 C562.623,77.658 564.297,76.634 565.965,74.965 C567.633,73.296 568.659,71.625 569.425,69.651 C570.167,67.743 570.674,65.562 570.82,62.369 C570.966,59.17 571,58.147 571,50 C571,41.851 570.966,40.831 570.82,37.631"></path></g></g></g></svg></div><div style="padding-top: 8px;"> <div style=" color:#3897f0; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:550; line-height:18px;">在 Instagram 查看这篇帖子</div></div><div style="padding: 12.5% 0;"></div> <div style="display: flex; flex-direction: row; margin-bottom: 14px; align-items: center;"><div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(0px) translateY(7px);"></div> <div style="background-color: #F4F4F4; height: 12.5px; transform: rotate(-45deg) translateX(3px) translateY(1px); width: 12.5px; flex-grow: 0; margin-right: 14px; margin-left: 2px;"></div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(9px) translateY(-18px);"></div></div><div style="margin-left: 8px;"> <div style=" background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 20px; width: 20px;"></div> <div style=" width: 0; height: 0; border-top: 2px solid transparent; border-left: 6px solid #f4f4f4; border-bottom: 2px solid transparent; transform: translateX(16px) translateY(-4px) rotate(30deg)"></div></div><div style="margin-left: auto;"> <div style=" width: 0px; border-top: 8px solid #F4F4F4; border-right: 8px solid transparent; transform: translateY(16px);"></div> <div style=" background-color: #F4F4F4; flex-grow: 0; height: 12px; width: 16px; transform: translateY(-4px);"></div> <div style=" width: 0; height: 0; border-top: 8px solid #F4F4F4; border-left: 8px solid transparent; transform: translateY(-4px) translateX(8px);"></div></div></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center; margin-bottom: 24px;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 224px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 144px;"></div></div></a><p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;"><a href="https://www.instagram.com/p/CYMOYFyBRf9/?utm_source=ig_embed&amp;utm_campaign=loading" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none;" target="_blank">@_y.o_o.y_ 分享的帖子</a></p></div></blockquote> <script async src="//www.instagram.com/embed.js"></script>git config --global user.email "k11@keleven.me"
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>硬盘还是坏了</title>
    <url>/2022/01/13/39f5624029d3/</url>
    <content><![CDATA[<p>咱都是晚上看《孤独的美食家》 😏</p>
<p>最近喜欢吃麦当劳的巨无霸。就一个月吃一次吧。</p>
<p>毕竟咱是要减肥的人！就是体重不怎么掉 😭</p>
<p>硬盘还是挂了。其实没什么影响 🤠 ，感觉群晖的硬盘买小了，之后换20TB的吧。</p>
<p>在想用什么包装电脑。</p>
<p>在<code>Peak Design</code>的<code>EVERYDAY BACKPACK ZIP 20L</code>和<code>EVERYDAY TOTEPACK</code>纠结中。</p>
<p>一个可以装下12寸的ipad，一个是9.7寸。</p>
<p>让我再想想🤔🤔🤔</p>
<p><code>ipad</code>有消息说在3月出新款，可以等出了再说 😏 </p>
<p>键盘鼠标看好了<code>罗技</code>的<code>MX Master 3</code>和<code>ERGO K860</code>都支持<code>bolt</code>无线加密连接的，最多连接3个设备。</p>
<p>也不急 🤣 ，微软键盘还可一战。</p>
<p>《雪中悍刀行》有点水，没《庆余年》好看。</p>
<p>看了一个经历滑翔伞事故的UP主，天朝一如既往的不规范也没什么意外的。</p>
<p>学滑翔伞的事儿就延后吧。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>桌面更新了</title>
    <url>/2022/01/03/fba1893b3120/</url>
    <content><![CDATA[<p>风景真美~ 有你的风景当然更美~ 😍</p>
<p>刚注意到怎么就3号了😅😅</p>
<p>macbook的边角用久了有点割胳膊。🤣</p>
<p>到了几个红包 不知道发给谁_(:з」∠)_</p>
<p><img src="/images/post/2022-01-03/IMG_2163.jpg"></p>
<p>之后就是新的显示器~ 铛铛~ </p>
<p><img src="/images/post/2022-01-03/IMG_2166.jpg"></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>就感觉是第一次见家长要准备东西的参考😇</title>
    <url>/2022/01/24/273a2898f5af/</url>
    <content><![CDATA[<p>嗯 就是这种感觉。记本本上了！😏</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>对牛弹琴 不如不讲 废话连篇 不如不听</title>
    <url>/2022/01/21/d081a3ae017a/</url>
    <content><![CDATA[<p>这几天的体会。┓(;´_｀)┏</p>
<p>上火满嘴的溃疡</p>
<p>凉茶没什么用，定了龟苓膏不知道怎么样。</p>
<p>口罩要换N95的了</p>
<p>3M旗舰店还是可以买到 就是有点丑</p>
<p>可孚是国产品牌 柳叶型KN95 好看还显着脸小 推荐</p>
<p>洗手液不用买多，2020年买的现在都快屯过期了 😭</p>
<p>消毒水可以买，二氧化氯泡腾片，怕光，买像药片包装那种 </p>
<p>现用现配，容易失效，一天配一瓶问题不大 </p>
<p>还有一种是 松下DL-SP006 方便携带 咸鱼比淘宝买家多点</p>
<p>上次坐地铁洗手液就让人没收了 🤡</p>
<p>以上</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>提前虎年快乐！</title>
    <url>/2022/01/31/41f0e01e9b23/</url>
    <content><![CDATA[<h1 id="虎年快乐-👏"><a href="#虎年快乐-👏" class="headerlink" title="虎年快乐 👏"></a>虎年快乐 👏</h1><p>下午做了一个梦</p>
<p>被想念的人亲了一下</p>
<p>醒了后也是超级开心 (*￣︶￣)</p>
<p>咱比较喜欢擀饺子皮</p>
<span id="more"></span>

<p>今年游戏一定要上架</p>
<p>今年一定要去找你</p>
<p>新年愿望！一定要实现！</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>关于游戏物品设定</title>
    <url>/2022/02/06/517b4c3652fe/</url>
    <content><![CDATA[<h2 id="填饱肚子"><a href="#填饱肚子" class="headerlink" title="填饱肚子"></a>填饱肚子</h2><p>午餐？宵夜？嗯 不想了</p>
<p><img src="/images/post/2022-02-06/IMG_2193.jpg"></p>
<hr>
<h2 id="物品设定"><a href="#物品设定" class="headerlink" title="物品设定"></a>物品设定</h2><p>物品都是只能使用一次的。但是可以持有多个相同物品。</p>
<p>物品的主要来源是，开箱子，嗯，不能免熟的获取方式。</p>
<p>完成挑战可获得箱子，每天最多获得三个箱子。</p>
<p>获得的只是的一般箱子，包含一个技能和两个物品。</p>
<p>还有一种是全物品箱子。可以开出5个物品，同一个箱子的5个物品不重复。</p>
<p>全物品箱子要充值。嗯。</p>
<p>总之箱子会是主要盈利的手段 🤔</p>
<p>上架会后的工作重点就是 更新活动 技能与物品 保持活力。</p>
<p>还有就是从 PC端 移植到 手机端。</p>
<p>估计好长一段时间都是危险的灰色地带。</p>
<p>也可能被国内的竞争者捅刀。</p>
<p>还有就是公司的税务问题。</p>
<p>深圳对初创企业是有减免的。</p>
<p>不知道帝都有没有相应政策。</p>
<p>还有一些是只能说给信任的人听的。</p>
<p>嗯，有问必答，实话的那种。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>TPM 芯片到了</title>
    <url>/2022/01/16/1d6a3d6a1611/</url>
    <content><![CDATA[<p>TPM芯片到了，做工还行，可以安心的装win11了</p>
<p>莱卡的M11有点想要 🤣 </p>
<p>反正帝都SKP和国贸有旗舰店。毕竟刚出配套也不全。</p>
<p>想了好多，果然好多事儿要见面后决定。</p>
<p>PS: 报名的驾校太不靠谱了 😭</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>咱一会儿去煮个冷面吃！</title>
    <url>/2022/02/05/d16b92851210/</url>
    <content><![CDATA[<p>有辣白菜，黄瓜，鸡蛋和酱牛肉 （¯﹃¯）</p>
<p>咱是9点起床的 嗯 下午 😏 </p>
<p>说好的正常作息呢 🤔</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>所以想要写信喽？</title>
    <url>/2022/02/13/0151406cfb4b/</url>
    <content><![CDATA[<p>嗯 古老的方式</p>
<p>字丑😭，原因大概是写这个字的时候，</p>
<p>思维已经在想下一个字怎么写了。</p>
<p>慢慢写还是能看出写的什么的😁。</p>
<p>只有自己能看懂系列。</p>
<p>咱是觉得出黑名单更靠谱些_(:з」∠)_</p>
<p>自己拍照，做成明信片也是不错得选择。</p>
<p>不过有人试过，好多都寄不到，不知道挂号的形式怎么样。</p>
<p>毕竟想过把风景拍下，打印，在邮寄给自己呢。</p>
<p>打印机是 佳能CP1300，有明信片相纸。</p>
<p>比富士instax色彩好的，少了文艺范。</p>
<p>毕竟instax只是勉强能看 😂 ，对不起那几千万的像素。</p>
<p>以上~</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>心动！一见钟情那种！</title>
    <url>/2022/02/12/0a0b9ff73142/</url>
    <content><![CDATA[<p>顺便翻了翻照片，不行咱必须减肥。</p>
<p>都是没脸见人那种😭</p>
<p>就18的照片还能看_(:з」∠)_</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>凭空闻到了芥末味</title>
    <url>/2022/02/18/e12fab798d47/</url>
    <content><![CDATA[<p>可以是想吃寿司了</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>早~</title>
    <url>/2022/02/10/fab974b5bb51/</url>
    <content><![CDATA[<p>冬奥没看，单纯的没兴趣。</p>
<p>船到是看了不少，与一线城市的房价差不多。</p>
<p>缺点是大船都要有船员。不喜欢。</p>
<p>下周开始练车了</p>
<span id="more"></span>

<p>没人注意冰墩墩的外壳不像硅胶吗</p>
<p>就这件事上看环保在天朝就是扯淡。</p>
<p>怎么不提供塑料袋啊，垃圾分类啊，笑话一样。</p>
<p>扔的时候是分类，收的时候一起收。</p>
<p>估计只有在末端分类回收才是正解。</p>
<p>没什么经济利益没人会做吧。</p>
<p>跑马圈地，之后看谁的棒子大。</p>
<p>天朝上邦怎么都想不到会亡国。</p>
<p>什么时候在大气层外开个与F1类似规则的比赛</p>
<p>那还有什么国家。地球人对外来生物统称外星人。</p>
<p>那一天接触了，我们都被称为地球人。</p>
<p>杀了定律法人，从新定一个，就无罪了？笑话。</p>
<p>那天知晓了天地规则，在回头看看还真是可笑。</p>
<p>记忆与技能可以存储器，通过大脑选择载入。</p>
<p>特定处理下，思考可以加速数倍。</p>
<p>一个AI机器人控制飞机船艇。</p>
<p>疾病自动诊断，胚胎编辑。</p>
<p>物质打印。无线能源传输，不用电池，不被地域，空间限制等等。</p>
<p>在未来50年内都会出现。这天地将变，而人没有准备好。</p>
<p>至少未来30年是资本的世界，国家与政治的会被淡化。</p>
<p>挣扎是没有用的。就看能否乘上最后的风了。</p>
<p>不能等着被碾死吧。</p>
<p>算了不说了，反正没人看。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>这是传说中的投食！</title>
    <url>/2022/02/03/69d05b500e33/</url>
    <content><![CDATA[<p>头疼躺了一天，刚刚好了一点。</p>
<p>下单了布洛芬，感觉上是作息不规律引起的_(:з」∠)_</p>
<p>要注意身体啊！</p>
<p>咱去码代码了</p>
<p>不去美个甲吗，难得小手那么好看(*￣︶￣)</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>捡了一个石头投深谷</title>
    <url>/2022/02/19/6ca8e3c8a234/</url>
    <content><![CDATA[<p>运气好砸到山壁上有个响声</p>
<p>有的响声还不知道是谁投</p>
<p>运气不好什么都听不到</p>
<p>不如直接跳下去算了</p>
<p>换条路也是个选择</p>
<p>昨天做了个梦，有一个人在房间引爆一颗小型核弹，</p>
<p>跑出房间后，就开始计算被辐射量🤔</p>
<p>之后有在远处又炸了一次。一片狼藉，认识的人都不见了。</p>
<p>只剩我一个，没有惊恐，没有惊醒，异常平静。</p>
<p>可能是睡前想的比较多吧。谁知道呢。</p>
<p>如果问我 你好吗？</p>
<p>我会说 不好。很不好。</p>
<p>现在的汉服做的都挺好看的。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>求女神保佑🙏🏻</title>
    <url>/2022/02/21/13d1bb6365ae/</url>
    <content><![CDATA[<p>28号考科目三，现在还没练过车。</p>
<p>科目二也还没考，心慌。</p>
<p>下午钢笔没盖好，在手上自己画了个表情 </p>
<p><img src="/images/post/2022-02-21/IMG_2204.jpeg"></p>
<p>有点像😏😏😏</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>(；′⌒`)</title>
    <url>/2022/02/14/20407cda5bee/</url>
    <content><![CDATA[<p>昨天做了人格分析感觉比较准</p>
<p><img src="/images/post/2022-02-14/01.png"></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>最大的不确定性果然是人</title>
    <url>/2022/02/22/d4ba0c6b5ced/</url>
    <content><![CDATA[<p>想着城里怎么也不能突然停电吧。</p>
<p>一个垃圾电器引发了跳闸。</p>
<p>还好数据没事</p>
<p>没办法了下单UPS吧</p>
<p>家用型，有房子装修的话，一定要做冗余</p>
<p>别墅的话一定要有powerwall，与starlink</p>
<p>太阳能也是必装。</p>
<p>安防设备也要全部本地化_(:з」∠)_</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>想吃拉面了</title>
    <url>/2022/03/01/0c5ba9814691/</url>
    <content><![CDATA[<p>主要是看了个拉面店视频</p>
<p>然后打开了蓝色送餐app</p>
<p>看看了店家的评价</p>
<p>没食欲了😭</p>
<p>科目二 被教练改到了 8号_(:з」∠)_</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>通过了~ 11号 科目二</title>
    <url>/2022/02/28/d94f0f5231d1/</url>
    <content><![CDATA[<p>多方处理的结果。</p>
<p>明线，暗线什么的。</p>
<p>女神有保佑我吗。</p>
<p>我想是有的。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>wx可真幽默</title>
    <url>/2022/02/20/ed7f26affc25/</url>
    <content><![CDATA[<p>这推送真是_(:з」∠)_</p>
<p><img src="/images/post/2022-02-20/IMG_2201.jpeg"></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>是上次酸奶的罐子吗？</title>
    <url>/2022/03/11/0bd5a005d8a0/</url>
    <content><![CDATA[<p>想喝。打开了小蓝和小黄，没找到同款o(╥﹏╥)o</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>看看现在的俄国，日后便是天朝的样子，近的有朝鲜。</title>
    <url>/2022/03/03/c3d58e8c7e28/</url>
    <content><![CDATA[<p>天朝会发生的内乱，天朝人打天朝人，从来都没变过。</p>
<p>大清也没想过会灭亡。</p>
<p>1人走错了，数亿人抗。</p>
<p>下一个就是天朝。</p>
<p>大乱之后，必有大治，</p>
<p>这一乱怕是要一代人的光阴。</p>
<p>强大之前不跪着，必死。</p>
<p>还有14亿人口covid-19群体免疫无效</p>
<p>香港一半人打的国产，就现在的结果。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>(¯﹃¯)</title>
    <url>/2022/03/11/a6b69b85d346/</url>
    <content><![CDATA[<p>看着就有食欲</p>
<p>刚刚看到了一个消息</p>
<p>可自购新冠病毒抗原试剂</p>
<p>恐怕要开始实施全民免疫了</p>
<p>而前提是疫苗有效，<code>mRNA</code>要3针</p>
<p>国产的3针等于<code>mRNA</code>2针</p>
<p>香港是有数据的</p>
<p>加上之前辉瑞的治疗药物被合法引进</p>
<p>看看吉林现在的样子</p>
<p>很难说不是有预谋的实验场</p>
<p>但愿之后开放<code>mRNA</code>疫苗吧</p>
<p>要不会死很多人的</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>没过😭</title>
    <url>/2022/03/08/18d8c6488c02/</url>
    <content><![CDATA[<p>结论：别太相信别人。尤其是驾校的。面子没想象的值钱。甚至不如一盒烟。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>心好累</title>
    <url>/2022/03/24/046d2442a4f0/</url>
    <content><![CDATA[<p>想有个人抱一抱</p>
<p>想没有目的的聊几句</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>明天考科目二了，求女神保佑🙏🏻</title>
    <url>/2022/03/07/72dc9e551d73/</url>
    <content><![CDATA[<p>练的还行，不出意外就好。</p>
<p>毕竟科目三的时候，考试系统掉线了一次。</p>
<p>还好第二次安全通过了。</p>
<p>求顺利 (*￣︶￣)</p>
<p>科目四是送的！没有问题 ✿✿ヽ(°▽°)ノ✿</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>对着空气谈恋爱</title>
    <url>/2022/04/07/14c7751cff5f/</url>
    <content><![CDATA[<p>啊 空气真美丽 </p>
<p>啊 空气送了氧气 不要回礼</p>
<p>啊 空气与我形影不离 毫不介意我的善恶与美丑</p>
<p>啊 空气 我爱你</p>
<hr>
<p>没感染</p>
<p>小区封闭</p>
<p>可以点外卖</p>
<p>两天一次核酸</p>
<p>反正也没人看</p>
<p>反正也没人关心</p>
<p>真是受够了</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/bOzPTtzdhFk" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<p>就这样吧</p>
<p>一天天就像我欠谁8千亿似的 </p>
<p>都给我滚蛋</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>发现我是一个冷漠而且薄情的人</title>
    <url>/2022/04/11/539e29575917/</url>
    <content><![CDATA[<p>也没什么意外的</p>
<p>许多时候更愿意当的没心机傻子</p>
<p>也不想把人看得太透析，容易恶心。</p>
<p>如果哪天发现我变了</p>
<p>也许那才是本来的样子</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>震惊！驾校因何关闭了！</title>
    <url>/2022/03/21/865a99a3d57b/</url>
    <content><![CDATA[<p>因为疫情！</p>
<p>艾尔登法环好有趣</p>
<p>咱最喜欢星空结局了！</p>
<p>菈妮老婆最好！</p>
<p>FF14 6.0的剧情也超级好！</p>
<p>好看的醒酒瓶，只想用来装水_(:з」∠)_</p>
<p><img src="/images/post/2022-03-21/01.png"></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>快乐好难</title>
    <url>/2022/04/19/037a38618b40/</url>
    <content><![CDATA[<h1 id="快乐好难"><a href="#快乐好难" class="headerlink" title="快乐好难"></a>快乐好难</h1><p>本来开开心心的玩个游戏</p>
<p>之后发现咱是个工具人</p>
<p>想着一起玩玩游戏至少是快乐的</p>
<p>后来发现，不快乐了。</p>
<p>你把人家当亲友</p>
<p>人家把你当路人</p>
<p>玩个鬼啊</p>
<p>凉着吧</p>
<p>没心情了</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>好像在暗示什么</title>
    <url>/2022/03/26/da4e029cdd27/</url>
    <content><![CDATA[<p>居家 核酸 就是这几天的状态</p>
<p>感觉上人是松懈的，政策却变严格了。</p>
<p>不检查就要变黄码了。</p>
<p>形势不怎么好。</p>
<p>看看情况吧，可能只能打国产灭活了。没得选。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>还好</title>
    <url>/2022/05/09/0d900caef5f9/</url>
    <content><![CDATA[<h1 id="还好"><a href="#还好" class="headerlink" title="还好"></a>还好</h1><p>遇到了一个人，顺畅能交流。</p>
<p>原来一切都可以这样自然。</p>
<p>不用相互折磨，不用试探。</p>
<p>也遇到一个人，满嘴的道德，实际有点小算计。</p>
<p>我就不是那种什么事儿过来能当做没发生过人。</p>
<p>报复回去我就会很爽。好可以记一辈子，坏的也可以。</p>
<p>也想通几件事。</p>
<p>第一 正常交流很重要。<br>第二 一人对你有兴趣可以很主动<br>第三 对其他的人过得去就行，过不去也无所谓。</p>
<p>门口固定核酸点的每天都上班。</p>
<p>每天都那几个人。明显能看出越来越疲惫。</p>
<p>希望有一天可以，告诉ta这个网址也说不定。</p>
<p>算算日子喜欢一个人十多年吧。</p>
<p>好累，好累。想不通为了什么要去喜欢了。</p>
<p>别求了，没有了，放下了，斩的干干净净。</p>
<p>世上有无数的人，能进的了心的又有几人。</p>
<p>有人想要这样做，我想应该给ta一个机会吧。</p>
<p>毕竟是我第一次遇到这样的人。</p>
<p>天朝都流行音乐没法听了，听听古典也不错。</p>
<p>后端进程大概90%的程度吧。</p>
<p>非主要部分可以之后做，先运行起来是真的。</p>
<p>好了，写完了。</p>
<p>最后说一句吧。</p>
<p>天朝的疫情预估还有3年吧。早做打算。</p>
<p>战争大概9月会结束，之后苦日子就要慢慢开始了。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>更新下</title>
    <url>/2022/04/21/a54481c08c3d/</url>
    <content><![CDATA[<p>今天vpn超流量了</p>
<p>于是想用备用的续费</p>
<p>结果就是手欠升级完镜像没测试</p>
<p>也用不了</p>
<p>花了点心思解决</p>
<p>这个故事告诉我们</p>
<p>备份也是要定期检查的</p>
<p>我的小破站居然也被墙了</p>
<p>这是没想到的，可能是快开会了</p>
<p>疫苗是4月19打的科兴</p>
<p>实在是没办法</p>
<p>全开放也是早晚的事儿</p>
<p>大部分人得一遍也只是时间问题了</p>
<p>最近有点丧 咱也是知道的</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>一些补充</title>
    <url>/2022/05/31/e1faacf07158/</url>
    <content><![CDATA[<h2 id="ubuntu设置证书登录"><a href="#ubuntu设置证书登录" class="headerlink" title="ubuntu设置证书登录"></a>ubuntu设置证书登录</h2><p><code>~/.ssh/authorized_keys</code>中添加秘钥</p>
<p>更改ssh设置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>
<p><code>PasswordAuthentication no</code><br><code>AuthorizedKeysFile</code> 取消注释</p>
<p>重启服务器</p>
<h2 id="笑死不愧是天朝人"><a href="#笑死不愧是天朝人" class="headerlink" title="笑死不愧是天朝人"></a>笑死不愧是天朝人</h2><p>今天遇到一个服务器</p>
<p>通过香港中转实际是位置在国内</p>
<p>我还傻傻的部署翻墙工具呢</p>
<p>笑死</p>
<p>标准软件源一个连不上</p>
<p>默认都是163的</p>
<p>真爱生命远离国产</p>
<p>以上</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>win11 安装 Android 子系统 与 一些设置</title>
    <url>/2022/06/12/635053f76c61/</url>
    <content><![CDATA[<h2 id="win11-安装-Android-子系统"><a href="#win11-安装-Android-子系统" class="headerlink" title="win11 安装 Android 子系统"></a>win11 安装 Android 子系统</h2><h3 id="写在安装之前"><a href="#写在安装之前" class="headerlink" title="写在安装之前"></a>写在安装之前</h3><p>1.地区需要设置在美国<br>2.windows 中开启 Hyper-V<br>3.安装完成后搜索 <code>适用于Android的Windosw子系统设置</code>调整设置</p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p><a href="https://apps.microsoft.com/store/detail/windows-subsystem-for-android%E2%84%A2-with-amazon-appstore/9P3395VX91NR?hl=en-us&gl=US">wsa安装地址</a></p>
<p>为了能安装任意的akp包需要开启开发者模式，并使用<a href="https://developer.android.com/studio/command-line/adb">adb</a>安装。</p>
<p>完成后，adb目录下使用下方命令</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.\adb connect 127.0.0.1:58526</span><br></pre></td></tr></table></figure>

<p>随后将下载的安装包复制到adb的文件夹中，使用下方命令安装</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">.\adb install .\someApk.apk</span><br></pre></td></tr></table></figure>
<p>会提示安装成功</p>
<span id="more"></span>

<h2 id="一些设置"><a href="#一些设置" class="headerlink" title="一些设置"></a>一些设置</h2><h3 id="PowerShell-安装-git"><a href="#PowerShell-安装-git" class="headerlink" title="PowerShell 安装 git"></a>PowerShell 安装 git</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">winget install --id Git.Git -e --source winget</span><br></pre></td></tr></table></figure>

<p>设置git proxy</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --global http.proxy socks5://127.0.0.1:7091</span><br></pre></td></tr></table></figure>

<h3 id="安装PowerLine-fonts"><a href="#安装PowerLine-fonts" class="headerlink" title="安装PowerLine fonts"></a>安装PowerLine fonts</h3><p><a href="https://slmeng.medium.com/how-to-install-powerline-fonts-in-windows-b2eedecace58">参考</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/powerline/fonts.git --depth=1</span><br><span class="line"># install</span><br><span class="line">cd fonts</span><br><span class="line">Set-ExecutionPolicy Bypass</span><br><span class="line">./install.ps1</span><br><span class="line">Set-ExecutionPolicy Default</span><br><span class="line"># clean-up a bit</span><br><span class="line">cd ..</span><br><span class="line">rm -rf fonts</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel model 时间属性</title>
    <url>/2022/10/05/9641a7bd61ed/</url>
    <content><![CDATA[<h2 id="laravel-model-时间属性"><a href="#laravel-model-时间属性" class="headerlink" title="laravel model 时间属性"></a>laravel model 时间属性</h2><p>在laravel model中设置时间属性，随后可以在<code>Resource</code>中使用<code>toDateTimeString()</code>获得方便阅读的时间。</p>
<p>未使用时返回是这样的<code>2022-10-05T20:24:25.000000Z</code>，使用时返回是这样的<code>2022-10-05 20:24:25</code>。</p>
<h2 id="设置方法"><a href="#设置方法" class="headerlink" title="设置方法"></a>设置方法</h2><p>model中添加</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$casts</span> = [</span><br><span class="line">        <span class="string">&#x27;time_1&#x27;</span> =&gt; <span class="string">&#x27;date&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;time_2&#x27;</span> =&gt; <span class="string">&#x27;datetime&#x27;</span></span><br><span class="line">    ];</span><br></pre></td></tr></table></figure>

<p>要注意的是<code>date</code>是没有小时和分钟的。<code>datetime</code>是完成的时间戳。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>每个周末都练练车，快1000公里了。</p>
<p>到抽箱子了。快到终点了。</p>
<p>wacom 新的 27 有点心动了。</p>
<p>AirPods Pro 2 就蛮一般的给老爸了。</p>
<p>还是喜欢 XM4。</p>
<p><img src="/images/post/2022-10-05/IMG_2453.png"></p>
<p>还入手了一个携带样式的T12烙铁。</p>
<p>想组装穿越机呢~</p>
<p><img src="/images/post/2022-10-05/IMG_2460.png"></p>
<p>以上</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>除草</title>
    <url>/2022/08/08/6f47b48d0da7/</url>
    <content><![CDATA[<p>转眼8月了，驾照到手2月了。</p>
<p>还有几个模块后台就写完了</p>
<p>最近对路亚有点兴趣</p>
<p>还想买个电动滑板玩玩</p>
<p>老爸开始在咸鱼卖杂物了，有点意思。</p>
<p>想太多没用，加油吧。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>除草</title>
    <url>/2022/11/23/6e4446d7d49f/</url>
    <content><![CDATA[<p>11月初，买了点种子，种了，向日葵长得不错，薰衣草没发芽。</p>
<p>也不知道为什么要买，为什么要种。</p>
<p>可能是想看花了吧。</p>
<p>家里有点小，想要个院子了，还是有温室的那种。</p>
<p>天朝完了，进行一次房车旅行后，就可以润了，是这样计划。</p>
<p>疫情政策要是在明年春天没有变化，就考虑直接润吧。</p>
<p>本来就没什么可以留恋的。</p>
<p>发现出钱换服务没什么不好的。</p>
<p>可能是对人性的失望吧。</p>
<p>累了，倦了，去它妈的。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>还有一个科目四</title>
    <url>/2022/05/27/ef140eb5b5a4/</url>
    <content><![CDATA[<h1 id="一首歌"><a href="#一首歌" class="headerlink" title="一首歌"></a>一首歌</h1><p>今天偶然听到了<code>John Legend - All of Me</code>的钢琴曲</p>
<p>10s泪水就出来了，个人觉得纯音乐的感觉力更强一点</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/450p7goxZqg?controls=0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年01月21日</title>
    <url>/2018/01/21/62b392c7cb93/</url>
    <content><![CDATA[<h2 id="小记"><a href="#小记" class="headerlink" title="小记"></a>小记</h2><p>系统双挂 全部重装，1月多波折。虽然还有10天结束。</p>
<p>新番 <code>DAELING in the FRANXX</code> 很好看。</p>
<p><code>UE4 code</code> 编译需要 <code>win8.1 SDK</code> 有点意外。</p>
<p><code>steam</code> 注册完了开发账号，我朝外汇管制需求想办法规避。</p>
<p>U.S. 的营业税是<code>30%</code>，境外无任何减免。</p>
<p>mac 下<code>brew</code> 很好用。 使用vbox要关闭SPE的网络防护，否则无法<code>apt update</code>。</p>
<p><code>UE4</code> 需要编译服务端，对部署机器的性能有要求。</p>
<p>想打包为<code>docker</code>放在<code>linux</code>需要实际测试。</p>
<p>邮件服务器，基本稳定。<code>laravel</code>可以直接使用<code>laradock</code>部署的可能性很高。</p>
<p>之后就<code>redis</code>与<code>mysql</code>主从与集群了。全世界的人可以一起玩一个游戏，想想就有趣。</p>
<p>后端想做成多个扩展包的形式，方法部署。</p>
<p>还有同时部署一部分的数据。</p>
<p>权限，文件标记什么的。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年02月02日</title>
    <url>/2018/02/02/84ed2b6a7394/</url>
    <content><![CDATA[<h2 id="laravel-session-使用-cache"><a href="#laravel-session-使用-cache" class="headerlink" title="laravel session 使用 cache"></a>laravel session 使用 cache</h2><p>设置<code>config\database</code>。<br><code>redis</code>下添加。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;session&#x27; =&gt; [</span><br><span class="line">    &#x27;host&#x27; =&gt; env(&#x27;REDIS_HOST&#x27;, &#x27;127.0.0.1&#x27;),</span><br><span class="line">    &#x27;password&#x27; =&gt; env(&#x27;REDIS_PASSWORD&#x27;, null),</span><br><span class="line">    &#x27;port&#x27; =&gt; env(&#x27;REDIS_PORT&#x27;, 6379),</span><br><span class="line">    &#x27;database&#x27; =&gt; 1,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>设置<code>config\session</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;connection&#x27; =&gt; &#x27;session&#x27;,</span><br></pre></td></tr></table></figure>

<p>设置<code>config\cache</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;test&#x27; =&gt; [</span><br><span class="line">    &#x27;driver&#x27; =&gt; &#x27;redis&#x27;,</span><br><span class="line">    &#x27;connection&#x27; =&gt; &#x27;test&#x27;,</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<h2 id="听闻"><a href="#听闻" class="headerlink" title="听闻"></a>听闻</h2><p>听闻我朝2018年4月1日开始VPN白名单，既锁国。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年02月10日</title>
    <url>/2018/02/10/5ae68bef6056/</url>
    <content><![CDATA[<h2 id="小计"><a href="#小计" class="headerlink" title="小计"></a>小计</h2><p>将略大的项目，拆分为可以操作的部分。</p>
<p>精神上略累，我朝空气质量太糟糕了。</p>
<h2 id="工作记录"><a href="#工作记录" class="headerlink" title="工作记录"></a>工作记录</h2><h3 id="laravel-backup"><a href="#laravel-backup" class="headerlink" title="laravel-backup"></a>laravel-backup</h3><p><a href="https://docs.spatie.be/laravel-backup/v5/installation-and-setup">文档连接</a></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer require spatie/laravel-backup</span><br><span class="line">php artisan vendor:publish --provider=&quot;Spatie\Backup\BackupServiceProvider&quot;</span><br></pre></td></tr></table></figure>

<p>注意：默认情况下，<code>laravel-backup</code>备份完成时会发送通知邮件，所以使用时，要配置<code>MAIL_DRIVER</code>。</p>
<h3 id="itsgoingd-clockwork"><a href="#itsgoingd-clockwork" class="headerlink" title="itsgoingd/clockwork"></a><del>itsgoingd/clockwork</del></h3><p>效果一般，安装后移除。</p>
<p><a href="https://github.com/itsgoingd/clockwork">itsgoingd/clockwork</a></p>
<p><code>chrome</code>下<code>laravel</code>调试工具，需要安装<code>clockwork</code>插件。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年01月22日</title>
    <url>/2018/01/22/aa6ab27bd91b/</url>
    <content><![CDATA[<h2 id="blog-更新"><a href="#blog-更新" class="headerlink" title="blog 更新"></a>blog 更新</h2><p><code>blog</code> 更新到 <code>NexT</code> 样式。</p>
<p>使用<code>docker</code>挂载，上传到<code>github</code>快速部署。</p>
<h2 id="nginx-proxy-与-letsencrypt-nginx-proxy-companion"><a href="#nginx-proxy-与-letsencrypt-nginx-proxy-companion" class="headerlink" title="nginx-proxy 与 letsencrypt-nginx-proxy-companion"></a>nginx-proxy 与 letsencrypt-nginx-proxy-companion</h2><p>用处自动反向代理与<code>https</code>证书申请，自动续期，二级域名，多站同机变为可能。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">version: &#x27;2&#x27;</span><br><span class="line">services:</span><br><span class="line">    nginx-proxy:</span><br><span class="line">        image: jwilder/nginx-proxy:latest</span><br><span class="line">        restart: always</span><br><span class="line">        ports:</span><br><span class="line">            - &quot;80:80&quot;</span><br><span class="line">            - &quot;443:443&quot;</span><br><span class="line">        volumes:</span><br><span class="line">            - /path/to/certs:/etc/nginx/certs:ro</span><br><span class="line">            - /etc/nginx/vhost.d</span><br><span class="line">            - /usr/share/nginx/html</span><br><span class="line">            - /var/run/docker.sock:/tmp/docker.sock:ro</span><br><span class="line">        labels:</span><br><span class="line">            - &quot;com.github.jrcs.letsencrypt_nginx_proxy_companion.nginx_proxy&quot;</span><br><span class="line">        network_mode: &quot;bridge&quot;</span><br><span class="line">    letsencrypt-nginx-proxy-companion:</span><br><span class="line">        image: jrcs/letsencrypt-nginx-proxy-companion:latest</span><br><span class="line">        restart: always</span><br><span class="line">        volumes:</span><br><span class="line">            - /path/to/certs:/etc/nginx/certs:rw</span><br><span class="line">            - /var/run/docker.sock:/var/run/docker.sock:ro</span><br><span class="line">        volumes_from:</span><br><span class="line">            - nginx-proxy</span><br><span class="line">        network_mode: &quot;bridge&quot;</span><br></pre></td></tr></table></figure>

<h2 id="blog-挂载"><a href="#blog-挂载" class="headerlink" title="blog 挂载"></a>blog 挂载</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">version: &#x27;2&#x27;</span><br><span class="line">services:</span><br><span class="line">    web:</span><br><span class="line">      image: nginx:latest</span><br><span class="line">      restart: always</span><br><span class="line">      environment:</span><br><span class="line">          - VIRTUAL_HOST=keleven.me</span><br><span class="line">          - LETSENCRYPT_HOST=keleven.me</span><br><span class="line">          - LETSENCRYPT_EMAIL=k11@keleven.me</span><br><span class="line">      volumes:</span><br><span class="line">          - $PWD/blog2:/usr/share/nginx/html:ro</span><br><span class="line">      network_mode: &quot;bridge&quot;</span><br></pre></td></tr></table></figure>

<h2 id="https-中的坑"><a href="#https-中的坑" class="headerlink" title="https 中的坑"></a>https 中的坑</h2><p><strong>问题：</strong> 在<code>https</code>页面中使用<code>http</code>链接会导致浏览器默认为不安全。</p>
<p>解决：全部使用<code>https</code>链接可破解。</p>
<h2 id="NexT-的坑"><a href="#NexT-的坑" class="headerlink" title="NexT 的坑"></a>NexT 的坑</h2><p><strong>问题：</strong> 部分文章在首页显示部分不能。</p>
<p>解决：注意切换换行符<code>LF</code>不显示，<code>CRLF</code>显示。</p>
<blockquote>
<p>PS：<br><code>LF</code>为<code>Linux</code>与<code>Mac os</code>默认。<br><code>CRLF</code>为<code>windows</code>默认。  </p>
</blockquote>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年02月15日</title>
    <url>/2018/02/15/bc930c6db86d/</url>
    <content><![CDATA[<h2 id="汪年快乐"><a href="#汪年快乐" class="headerlink" title="汪年快乐"></a>汪年快乐</h2><p>汪年快乐。</p>
<p>除夕夜服务器被墙也是神了。</p>
<p>总之，要加油了~~</p>
<p>以上。</p>
<h2 id="许愿望吧"><a href="#许愿望吧" class="headerlink" title="许愿望吧"></a>许愿望吧</h2><p>顺利完成，如愿逃离。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年02月11日</title>
    <url>/2018/02/11/b3612829c63b/</url>
    <content><![CDATA[<h2 id="小计"><a href="#小计" class="headerlink" title="小计"></a>小计</h2><p>使用<code>php72-opcache</code>提升响应速度。</p>
<p><code>DARLING in the FRANXX</code> 超好看，期待第6话。</p>
<p><code>gitbook</code>生成<code>pdf</code>时，问题有点多。在线倒是没什么问题。</p>
<h2 id="Mac-安装-php72-opcache"><a href="#Mac-安装-php72-opcache" class="headerlink" title="Mac 安装  php72-opcache"></a>Mac 安装  php72-opcache</h2><p><code>brew</code>搜索包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">brew search php72</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">brew install homebrew/php/php72-opcache</span><br></pre></td></tr></table></figure>

<p>重启<code>php72</code>服务 注意使用<code>sudo</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo brew services restart php72</span><br></pre></td></tr></table></figure>

<p>修改<code>php72-opcache</code>配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">subl /usr/local/etc/php/7.2/conf.d/ext-opcache.ini</span><br></pre></td></tr></table></figure>

<h2 id="appstract-laravel-opcache"><a href="#appstract-laravel-opcache" class="headerlink" title="appstract/laravel-opcache"></a>appstract/laravel-opcache</h2><p><a href="https://github.com/appstract/laravel-opcache">appstract/laravel-opcache</a></p>
<p>安装<code>appstract/laravel-opcache</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">composer require appstract/laravel-opcache</span><br></pre></td></tr></table></figure>

<p><a href="https://laravel-china.org/topics/7458/open-php-opcache-and-make-your-laravel-application-fast">参考文档1</a></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p><code>phpinfo()</code>命令行查看</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">php -i &quot;(command-line &#x27;phpinfo()&#x27;)&quot;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年02月08日</title>
    <url>/2018/02/08/feef6cfcdf7c/</url>
    <content><![CDATA[<h2 id="同系统下多SSH-使用"><a href="#同系统下多SSH-使用" class="headerlink" title="同系统下多SSH 使用"></a>同系统下多SSH 使用</h2><p><a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/">参考文档</a></p>
<h3 id="新建SSH-KEY"><a href="#新建SSH-KEY" class="headerlink" title="新建SSH-KEY"></a>新建SSH-KEY</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh-keygen -t rsa -b 4096 -C &quot;your_email@example.com&quot;</span><br></pre></td></tr></table></figure>

<p>输入SSH KEY 文件位置，例如<code>/Users/you/.ssh/id_rsa_2</code></p>
<p>为什么是<code>id_rsa_2</code> ？</p>
<p>一般会有一个<code>id_rsa</code>为默认KEY。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Enter a file in which to save the key (/Users/you/.ssh/id_rsa): [Press enter]</span><br></pre></td></tr></table></figure>

<h3 id="添加到-ssh-config"><a href="#添加到-ssh-config" class="headerlink" title="添加到~/.ssh/config"></a>添加到<code>~/.ssh/config</code></h3><p>新建文件<code>~/.ssh/config</code></p>
<p>编辑如下内容</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Host github.com</span><br><span class="line">  HostName github.com</span><br><span class="line">  User *******@*******.com</span><br><span class="line">  PreferredAuthentications publickey</span><br><span class="line">  IdentityFile ~/.ssh/id_rsa</span><br><span class="line">Host 2github.com</span><br><span class="line">  HostName github.com</span><br><span class="line">  User *******@*******.com</span><br><span class="line">  PreferredAuthentications publickey</span><br><span class="line">  IdentityFile ~/.ssh/id_rsa_2</span><br></pre></td></tr></table></figure>

<p>注意：如果多个github账号，<code>Host</code>不能设置为相同。</p>
<p>最后添加新KEY到系统,并添加公钥到<code>github</code>对应账号。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh-add -K ~/.ssh/id_rsa</span><br><span class="line">ssh-add -K ~/.ssh/id_rsa_2</span><br></pre></td></tr></table></figure>

<p>测试KEY是否添加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh-add -l</span><br></pre></td></tr></table></figure>

<p>测试KEY是否有效</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ssh -T git@github.com</span><br><span class="line">ssh -T git@2github.com</span><br></pre></td></tr></table></figure>


<h3 id="Git项目中设置"><a href="#Git项目中设置" class="headerlink" title="Git项目中设置"></a>Git项目中设置</h3><p>设置对应<code>email</code>与<code>name</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git config --local user.email &quot;***@****.***&quot;</span><br><span class="line">git config --local user.name &quot;***&quot;</span><br></pre></td></tr></table></figure>

<p>添加<code>remote</code>,注意与<code>HostName</code>对应</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git remote add origin git@2github.com:****/***.git</span><br></pre></td></tr></table></figure>

<p>也可以直接修改<code>.git/config</code>。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>SSH</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年02月13日</title>
    <url>/2018/02/13/75105487142b/</url>
    <content><![CDATA[<h2 id="小计"><a href="#小计" class="headerlink" title="小计"></a>小计</h2><p>无意中读到某文章，流感引发病毒入侵，病毒类型未知，20天内的花费接近 100w RMB 医保异地，医院ICU床位紧张。地点，帝都首屈一指的医院。</p>
<p>总体考虑，需要 200w USD 勉强够用，先定下这个目标吧。希望永远不会用到，但形势不容乐观。</p>
<p>保险有一定的必要性，我朝可靠的保险公司还不确定。</p>
<p>进ICU插管前留好遗言，遗嘱。</p>
<p>珍惜当下吧。</p>
<h2 id="单身狗的情人劫"><a href="#单身狗的情人劫" class="headerlink" title="单身狗的情人劫"></a>单身狗的情人劫</h2><p><code>laravel</code>的<code>logs</code>有点怪，要重写<code>logs</code>并存入数据库了。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年02月18日</title>
    <url>/2018/02/18/dcfb033e3cc0/</url>
    <content><![CDATA[<h2 id="心情"><a href="#心情" class="headerlink" title="心情"></a>心情</h2><p>真让人恶心，自己什么都不做，却幻想着得到巨额的回报。</p>
<p>不觉得中彩票的几率更大吗。</p>
<p>满心的小算盘，当别人看不出来吗。</p>
<p>想如愿，呵呵，等着去吧。管你是谁，都别做梦了。</p>
<p>现在心情与吃了苍蝇差不多。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年02月22日</title>
    <url>/2018/02/22/8940396ec3e8/</url>
    <content><![CDATA[<h2 id="小记"><a href="#小记" class="headerlink" title="小记"></a>小记</h2><p><code>quasar-cli</code>升级到了<code>0.15.1</code> 与之前版本不兼容……</p>
<p>不支持<code>quasar-play</code></p>
<p>目录结构有所调整，比之前清晰多了，加上一次编程构建<code>PWA</code>、<code>Cordova</code>、<code>Electron</code>全平台大礼包。</p>
<p>和预想的一样，<code>android</code>就是坑多。</p>
<h2 id="安装-JAVA-8"><a href="#安装-JAVA-8" class="headerlink" title="安装 JAVA 8"></a>安装 JAVA 8</h2><p><code>Android Studio</code>依然不好下载。墙！墙！墙！ 略烦。</p>
<p>需要<code>java</code>……，直接使用<code>brew cask install java</code>安装是<code>9.0+</code>版本，不兼容<code>Cordova</code>需要装<code>java8</code>,方法如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">brew tap caskroom/versions</span><br><span class="line">brew cask install java8</span><br></pre></td></tr></table></figure>

<p>使用<code>/usr/libexec/java_home -V</code>查看本机安装的<code>JDK</code></p>
<p>安装<code>jenv</code>用于管理与切换<code>java</code>版本<code>brew install jenv</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo &#x27;export PATH=&quot;$HOME/.jenv/bin:$PATH&quot;&#x27; &gt;&gt; ~/.zshrc</span><br><span class="line">echo &#x27;eval &quot;$(jenv init -)&quot;&#x27; &gt;&gt; ~/.zshrc</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jenv add /Library/Java/JavaVirtualMachines/jdk-9.0.4.jdk/Contents/Home</span><br><span class="line">jenv add /Library/Java/JavaVirtualMachines/jdk1.8.0_162.jdk/Contents/Home</span><br><span class="line">jenv global 1.8.0.162</span><br></pre></td></tr></table></figure>

<p>需要重启使用<code>java -version</code>检查设置</p>
<p>其他设置方法。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jenv local 1.8.0.162</span><br><span class="line">jenv shell 1.8.0.162</span><br></pre></td></tr></table></figure>

<h2 id="安装-Android-Studio"><a href="#安装-Android-Studio" class="headerlink" title="安装 Android Studio"></a>安装 Android Studio</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">brew cask install android-studio</span><br></pre></td></tr></table></figure>

<p>之后还是要等……</p>
<h2 id="zshrc"><a href="#zshrc" class="headerlink" title="zshrc"></a>zshrc</h2><p>编辑<code>~/.zshrc</code>，并添加下方代码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export ANDROID_HOME=&quot;$HOME/Library/Android/sdk&quot;</span><br><span class="line">export PATH=$PATH:$ANDROID_HOME/tools</span><br><span class="line">export PATH=$PATH:$ANDROID_HOME/platform-tools</span><br></pre></td></tr></table></figure>

<h2 id="Cordova-构建需要-gradle"><a href="#Cordova-构建需要-gradle" class="headerlink" title="Cordova 构建需要 gradle"></a>Cordova 构建需要 gradle</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">brew install gradle</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>Android</tag>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年01月26日</title>
    <url>/2018/01/26/dcc3633c9c96/</url>
    <content><![CDATA[<h2 id="小记"><a href="#小记" class="headerlink" title="小记"></a>小记</h2><p>天气格外的冷，心也是一样。月比往常大一些。   </p>
<p>略期待31日月全食。 19点30分开始。21点30分左右可以看月全食，持续38分钟。</p>
<p>上次看月全食已经忘记是什么时候了。</p>
<p>2018年07月28日 4点21分 月全食 21世纪最长的一次。西部地区可以看到全貌。</p>
<p>是一件难得的礼物，开心的收下就好。</p>
<p>80个以上的数据表在脑中翻腾。对应的方法可能更多。代码过万行应该不难吧。</p>
<p>分成有效的小部分，逐一化解便好。</p>
<hr>
<p>人无愧于天地，便能笑着死去。</p>
<p>心是什么，某一天丢了……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年02月26日</title>
    <url>/2018/02/26/5f70c2756432/</url>
    <content><![CDATA[<h1 id="吾皇万岁，万岁，万万岁"><a href="#吾皇万岁，万岁，万万岁" class="headerlink" title="吾皇万岁，万岁，万万岁"></a>吾皇万岁，万岁，万万岁</h1>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年02月25日</title>
    <url>/2018/02/25/9048efe83820/</url>
    <content><![CDATA[<h2 id="小记"><a href="#小记" class="headerlink" title="小记"></a>小记</h2><p>网络崩溃变成了日常，每天维护网络正常2小时，每次走<code>ufw</code>速度比直连慢一倍。</p>
<p>天上乌云密布，光又在何处。</p>
<p>完蛋，很恶心。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年03月01日</title>
    <url>/2018/03/01/aaf03e653abb/</url>
    <content><![CDATA[<h1 id="小记"><a href="#小记" class="headerlink" title="小记"></a>小记</h1><p><code>ssr</code>的<code>tls</code>被爆，大规模封禁来袭，转<code>v2ray</code></p>
<p>直接部署非常容易，使用<code>docker</code>快速部署是正解，</p>
<p>实现<code>websocket+tls+V2ray+Nginx+CDN</code></p>
<p>起因，2018年2月15日开始梯子出现故障，换之。</p>
<p>2018年2月25日 <code>戊戌复辟</code>，可笑至极，诸多词变为禁语。包括<code>张勋</code>、<code>袁世凯</code>等等。微博、微信，禁止修改头像，签名。<code>反对</code>等不能发表。</p>
<p>马前课 第十一课 开始了…… </p>
<p>2月26日开始研究部署<code>v2ray</code>相关，其中遇坑，记录如下，供后人参考。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>v2ray 使用<code>websocket</code>连接到<code>CDN</code>，对抗<code>DNS</code>污染，保护真实<code>IP</code></p>
<p><code>CDN</code>连接在到<code>服务器</code>，全程通讯使用<code>tls</code>加密。【不是仿造，是真正的TLS】，服务器内部转发到<code>v2ray</code>容器。</p>
<blockquote>
<p>Q:为什么使用<code>docker</code>而不是直接部署？<br>A:不方便转移到其他服务器。同时不容易弄乱服务器环境<br>Q:<code>docker</code>好处是什么<br>A：不需要手动更新证书，可以使用二级域名部署其他服务。比如<code>web</code>、<code>mail</code>等等。可以随时添加。</p>
</blockquote>
<h2 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h2><p>大多数供应商都支持<code>docker</code>快速构建，直接选择即可。服务器多为<code>ubuntu</code>。</p>
<p>更新各种包后，准备开始工作。</p>
<p>更新命令</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ apt update</span><br><span class="line">$ apt upgrade</span><br></pre></td></tr></table></figure>

<h2 id="文件目录"><a href="#文件目录" class="headerlink" title="文件目录"></a>文件目录</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">|-- docker-compose.yml</span><br><span class="line">|-- v2ray</span><br><span class="line">|   `-- config.json</span><br><span class="line">`-- vhost.d</span><br><span class="line">    `-- ******_location</span><br></pre></td></tr></table></figure>

<h2 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h2><p>说明:</p>
<p><code>v2ray</code>下的<code>VIRTUAL_HOST</code>注意填写为二级域名，也可以去掉不填。    </p>
<p>同样<code>v2ray</code>下的<code>expose</code>与<code>VIRTUAL_PORT</code>为端口号，应该与<code>*****_location</code>中端口一致。</p>
<hr>
<p><code>web1</code>为一般web服务器，开放端口<code>80</code>。<br><code>You_Domain_Name</code> 改为你的域名<br><code>You_Email</code> 为邮箱，必填    </p>
<ul>
<li>VIRTUAL_HOST=<code>You_Domain_Name</code></li>
<li>VIRTUAL_PORT=<code>80</code></li>
<li>LETSENCRYPT_HOST=<code>You_Domain_Name</code></li>
<li>LETSENCRYPT_EMAIL=<code>You_Email</code></li>
</ul>
<hr>
<p><code>nginx-proxy</code>如名字,详情自行<code>google</code><br><code>letsencrypt-nginx-proxy-companion</code>如名字,详情自行<code>google</code></p>
<hr>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">v2ray:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">v2ray/official</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">v2ray</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;****&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$PWD/v2ray:/etc/v2ray</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$PWD/v2ray/config.json:/etc/v2ray/config.json:ro</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">VIRTUAL_HOST=****</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">VIRTUAL_PORT=****</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">web1:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">expose:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">VIRTUAL_HOST=*****</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">VIRTUAL_PORT=80</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">LETSENCRYPT_HOST=*****.***</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">LETSENCRYPT_EMAIL=*****@*****.***</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">nginx-proxy:</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">jwilder/nginx-proxy:latest</span></span><br><span class="line">      <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;80:80&quot;</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;443:443&quot;</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">/path/to/certs:/etc/nginx/certs:ro</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">$PWD/vhost.d:/etc/nginx/vhost.d:ro</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">/usr/share/nginx/html</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/tmp/docker.sock:ro</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">&quot;com.github.jrcs.letsencrypt_nginx_proxy_companion.nginx_proxy&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">letsencrypt-nginx-proxy-companion:</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">jrcs/letsencrypt-nginx-proxy-companion:latest</span></span><br><span class="line">      <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">/path/to/certs:/etc/nginx/certs:rw</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">$PWD/vhost.d:/etc/nginx/vhost.d:ro</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">/var/run/docker.sock:/var/run/docker.sock:ro</span></span><br><span class="line">      <span class="attr">volumes_from:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">nginx-proxy</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="TLS转发"><a href="#TLS转发" class="headerlink" title="TLS转发"></a>TLS转发</h2><p>在<code>dockec-compose.yml</code>下创建<code>vhost.d</code>文件件，</p>
<p>新建文件<code>You_Domain_Name_location</code></p>
<p>使用你的域名替换<code>You_Domain_Name</code>，要与<code>web1</code>设置的一致。</p>
<p>注意<code>proxy_pass</code>后的端口与<code>v2ray</code>设置的一致。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">proxy_redirect off;</span><br><span class="line">proxy_http_version 1.1;</span><br><span class="line">proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">proxy_set_header Host $http_host;</span><br><span class="line">if ($http_upgrade = &quot;websocket&quot; ) &#123;</span><br><span class="line">    proxy_pass http://v2ray:****;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="v2ray-设置文件config-json"><a href="#v2ray-设置文件config-json" class="headerlink" title="v2ray 设置文件config.json"></a>v2ray 设置文件<code>config.json</code></h2><p>在<code>dockec-compose.yml</code>下创建<code>v2ray</code>文件件，</p>
<p>新建文件<code>config.json</code></p>
<p><code>port</code>注意与<code>v2ray</code>设置一致</p>
<p><code>id</code>改为<code>你的id</code>，可以使用<a href="https://www.uuidgenerator.net/">uuidgenerator</a>生成一个。</p>
<p><code>json</code>写完之后，注意校对格式哦</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;inbound&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;port&quot;</span>: <span class="string">&quot;****&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;protocol&quot;</span>: <span class="string">&quot;vmess&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;clients&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;***********&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;alterId&quot;</span>: <span class="number">64</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;streamSettings&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;network&quot;</span>: <span class="string">&quot;ws&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;wsSettings&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;outbound&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;protocol&quot;</span>: <span class="string">&quot;freedom&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;settings&quot;</span>: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="之后"><a href="#之后" class="headerlink" title="之后"></a>之后</h2><p>去用户端里面设置吧。地址<code>You_Domain_Name</code>端口<code>443</code>，记得使用<code>websocket</code>与<code>TLS</code>。</p>
<h2 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h2><p><code>CloudFlare</code></p>
<p><code>DNS</code>中开启<code>websocket</code></p>
<p><code>Crypto</code> 中<code>Require Modern TLS</code>关闭</p>
<p><code>Crypto</code> 中<code>Authenticated Origin Pulls</code>关闭</p>
<p><code>Crypto</code> 中<code>Opportunistic Encryption</code>关闭</p>
<h2 id="nginx-proxy-的坑"><a href="#nginx-proxy-的坑" class="headerlink" title="nginx-proxy 的坑"></a>nginx-proxy 的坑</h2><p><code>nginx-proxy</code>中，设置转发时<code>www.www.com/path</code>无法正常解析，这个问题3年没有修复过了……     </p>
<p>错误重现:<code>vhost.d</code>下，新建<code>www.www.com</code>设置    </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">location /v2ray/ &#123;</span><br><span class="line">  proxy_redirect off;</span><br><span class="line">  proxy_http_version 1.1;</span><br><span class="line">  proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">  proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">  proxy_set_header Host $http_host;</span><br><span class="line">  if ($http_upgrade = &quot;websocket&quot; ) &#123;</span><br><span class="line">      proxy_pass http://v2ray:****;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>于是只能使用<code>www.www.com_location</code>进行转发。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="https://www.v2ray.com/">v2ray</a></p>
<p><a href="https://blog.starryvoid.com/archives/267.html">参考1</a></p>
<p><a href="https://blog.birkhoff.me/use-docker-to-deploy-vmess-and-ss-using-docker/">参考2</a></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>v2ray</tag>
        <tag>梯子</tag>
        <tag>墙</tag>
        <tag>GFW</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年03月26日</title>
    <url>/2018/03/26/c9cb11bf5c13/</url>
    <content><![CDATA[<h1 id="心情"><a href="#心情" class="headerlink" title="心情"></a>心情</h1><p>一场一定会输的战争……</p>
<p>百姓要苦了……</p>
<p>steam api 访问不能</p>
<p>唯一的希望就是上线后离开</p>
<p>今天关掉了一直关注的人 动力吗 曾经是吧</p>
<p>永远没有回复的留言 不如不看</p>
<p>制造人偶的心情+1</p>
<p>以上</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年03月24日</title>
    <url>/2018/03/24/51677e0cb7cd/</url>
    <content><![CDATA[<h1 id="心情"><a href="#心情" class="headerlink" title="心情"></a>心情</h1><p>宫墙深厚，近日又动刀字幕组，一如既往的套路……</p>
<p>最近迷上了摇曳露营，抚子好萌。</p>
<h2 id="同款-迷你净财箱B-６君"><a href="#同款-迷你净财箱B-６君" class="headerlink" title="同款 迷你净财箱Ｂ-６君"></a>同款 迷你净财箱<a href="http://shop.sho-s.jp/?pid=101185721">Ｂ-６君</a></h2><p><a href="https://www.amazon.co.jp/dp/B00KKQASKQ/?coliid=IPECAHMNDMDZ6&colid=2KMUOH2E9UAKZ&psc=0&ref_=lv_ov_lig_dp_it">amazon</a></p>
<p><img src="https://i.loli.net/2018/03/24/5ab63eb854ce1.jpg" alt="71iIrWcGmvL._SL1400_"></p>
<h2 id="同款-帐篷ムーンライトテント3型"><a href="#同款-帐篷ムーンライトテント3型" class="headerlink" title="同款 帐篷ムーンライトテント3型"></a>同款 帐篷<a href="http://webshop.montbell.jp/goods/disp.php?product_id=1122288">ムーンライトテント3型</a></h2><p><img src="https://i.loli.net/2018/03/24/5ab63f47a4a51.jpg" alt="k_1122288_iv"></p>
<h2 id="巡礼路线"><a href="#巡礼路线" class="headerlink" title="巡礼路线"></a>巡礼路线</h2><p><a href="https://www.yamanashi-kankou.jp/special/sp_yurucamp/">参考网址</a></p>
<h2 id="心仪之物"><a href="#心仪之物" class="headerlink" title="心仪之物"></a>心仪之物</h2><h3 id="heimplanet帐篷"><a href="#heimplanet帐篷" class="headerlink" title="heimplanet帐篷"></a>heimplanet帐篷</h3><p>Fistral 2.5KG 充气帐篷 总之打气就好~~</p>
<p>ムーンライトテント3型 是3.8KG</p>
<p><img src="https://i.loli.net/2018/03/24/5ab6418e38492.jpg" alt="fistral-cairo-camo_1"></p>
<p>THE CAVE 5.2KG 充气帐篷 防水性比Fistral好，空间也大。</p>
<p><img src="https://i.loli.net/2018/03/24/5ab641fbc4791.jpg" alt="the-cave-cairo-camo_1"></p>
<h3 id="YPJ-TC"><a href="#YPJ-TC" class="headerlink" title="YPJ-TC"></a>YPJ-TC</h3><p> yamaha 新款电动自行车 想入呢 2018年6月11日上市<br><img src="https://i.loli.net/2018/03/24/5ab63d81b2a49.jpg" alt="index_bike"></p>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>摇曳露营</tag>
        <tag>camp</tag>
      </tags>
  </entry>
  <entry>
    <title>swagger-php 快速上手指南</title>
    <url>/2018/03/28/8c9856f016de/</url>
    <content><![CDATA[<h1 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h1><p>swagger 学习用时2天，天宫一号预计在2018年03月31日到2018年04月01日坠落地球，碎片坠落地点未知。</p>
<p>天宫一号的坠落，可以说我朝近年的航天成果全灭。</p>
<p>报道断章取义…… 陨落只是时间问题。小额外汇貌似限制了，实际未测试。</p>
<p>使用<code>DarkaOnLine/L5-Swagger</code>可以在代码中以注释形势直接编写<code>API</code>文档非常方便。</p>
<p>注释中的语法要使用<code>Swagger-php</code>样式，<code>SWAGGER VERSION 3.0</code></p>
<h2 id="DarkaOnLine-L5-Swagger安装"><a href="#DarkaOnLine-L5-Swagger安装" class="headerlink" title="DarkaOnLine/L5-Swagger安装"></a><a href="https://github.com/DarkaOnLine/L5-Swagger">DarkaOnLine/L5-Swagger</a>安装</h2><p>项目使用的是<code>laravel 5.5</code> 对应 <code>darkaonline/l5-swagger:5.5.*</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer require &quot;darkaonline/l5-swagger:5.5.*&quot;</span><br></pre></td></tr></table></figure>

<p>复制设置与视图文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">php artisan vendor:publish --provider &quot;L5Swagger\L5SwaggerServiceProvider&quot;</span><br></pre></td></tr></table></figure>

<p><code>SWAGGER VERSION 3.0</code>支持</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer require &quot;zircote/swagger-php:3.x-dev&quot;</span><br></pre></td></tr></table></figure>

<p>设置<code>.env</code>文件</p>
<p><code>L5_SWAGGER_GENERATE_ALWAYS=true</code>为每次打开页面是都进行重新渲染，设计阶段非常好用。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">SWAGGER_VERSION=3.0</span><br><span class="line">L5_SWAGGER_GENERATE_ALWAYS=true</span><br></pre></td></tr></table></figure>
<h2 id="基础文件设置"><a href="#基础文件设置" class="headerlink" title="基础文件设置"></a>基础文件设置</h2><p><a href="https://github.com/OAI/OpenAPI-Specification/blob/v3.0.2-dev/versions/3.0.2.md">基本用法</a></p>
<h3 id="swagger-v3-php"><a href="#swagger-v3-php" class="headerlink" title="swagger-v3.php"></a>swagger-v3.php</h3><p>用于设置一些基本API信息，在页面最上方显示。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@OAS</span>\OpenApi(</span></span><br><span class="line"><span class="comment">*     <span class="doctag">@OAS</span>\Info(</span></span><br><span class="line"><span class="comment">*         version=&quot;1.0.0&quot;,</span></span><br><span class="line"><span class="comment">*         title=&quot;Test Api&quot;,</span></span><br><span class="line"><span class="comment">*         description=&quot;描述&quot;,</span></span><br><span class="line"><span class="comment">*         termsOfService=&quot;https://Test.dev/terms/&quot;,</span></span><br><span class="line"><span class="comment">*         <span class="doctag">@OAS</span>\contact(</span></span><br><span class="line"><span class="comment">*             email=&quot;test<span class="doctag">@test</span>.dev&quot;,</span></span><br><span class="line"><span class="comment">*             name=&quot;test&quot;,</span></span><br><span class="line"><span class="comment">*             url=&quot;https://test.dev&quot;</span></span><br><span class="line"><span class="comment">*         ),</span></span><br><span class="line"><span class="comment">*         <span class="doctag">@OAS</span>\License(</span></span><br><span class="line"><span class="comment">*             name=&quot;Apache 2.0&quot;,</span></span><br><span class="line"><span class="comment">*             url=&quot;http://www.apache.org/licenses/LICENSE-2.0.html&quot;</span></span><br><span class="line"><span class="comment">*         )</span></span><br><span class="line"><span class="comment">*     ),</span></span><br><span class="line"><span class="comment">*     <span class="doctag">@OAS</span>\Server(</span></span><br><span class="line"><span class="comment">*         description=&quot;OpenApi host&quot;,</span></span><br><span class="line"><span class="comment">*         url=&quot;https://test.dev/api&quot;</span></span><br><span class="line"><span class="comment">*     ),</span></span><br><span class="line"><span class="comment">*     <span class="doctag">@OAS</span>\Server(</span></span><br><span class="line"><span class="comment">*         description=&quot;OpenApi host&quot;,</span></span><br><span class="line"><span class="comment">*         url=&quot;https://test.dev/api/v2&quot;</span></span><br><span class="line"><span class="comment">*     ),</span></span><br><span class="line"><span class="comment">*     <span class="doctag">@OAS</span>\ExternalDocumentation(</span></span><br><span class="line"><span class="comment">*         description=&quot;OpenApi host&quot;,</span></span><br><span class="line"><span class="comment">*         url=&quot;https://test.dev/api/Doc&quot;</span></span><br><span class="line"><span class="comment">*     )</span></span><br><span class="line"><span class="comment">* )</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>@OAS 为使用前缀，用于读取<code>swagger</code>的设置</p>
<table>
<thead>
<tr>
<th>名头</th>
<th>解释</th>
<th>是否必要</th>
<th>其他说明</th>
</tr>
</thead>
<tbody><tr>
<td>OpenApi</td>
<td>swagger 初始化</td>
<td>必要</td>
<td>唯一并位于全部设置最顶端</td>
</tr>
<tr>
<td>Info</td>
<td>Api说明</td>
<td>必要</td>
<td>设置中的<code>title</code>与<code>version</code>为必要项</td>
</tr>
<tr>
<td>Server</td>
<td>Api 前置路径</td>
<td>非必要</td>
<td>多连接时，可以并行设置</td>
</tr>
<tr>
<td>ExternalDocumentation</td>
<td>扩展文档</td>
<td>非必要</td>
<td>只能设置<code>description</code>与<code>url</code></td>
</tr>
<tr>
<td>paths</td>
<td>连接地址</td>
<td>必要</td>
<td>可以在控制器位置设置</td>
</tr>
<tr>
<td>tags</td>
<td>主标签</td>
<td>必要</td>
<td>与<code>laravel</code>一起使用时，独立设置方便管理。可以设置<code>name</code>、<code>description</code>、<code>ExternalDocumentation</code></td>
</tr>
</tbody></table>
<h3 id="tags-php"><a href="#tags-php" class="headerlink" title="tags.php"></a>tags.php</h3><p>用于设置用户标签</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@OAS</span>\Tag(</span></span><br><span class="line"><span class="comment">*     name=&quot;2fa&quot;,</span></span><br><span class="line"><span class="comment">*     description=&quot;Google 2FA&quot;,</span></span><br><span class="line"><span class="comment">*     <span class="doctag">@OAS</span>\ExternalDocumentation(</span></span><br><span class="line"><span class="comment">*         description=&quot;more&quot;,</span></span><br><span class="line"><span class="comment">*         url=&quot;https://test.test/docs&quot;</span></span><br><span class="line"><span class="comment">*     )</span></span><br><span class="line"><span class="comment">* )</span></span><br><span class="line"><span class="comment">* <span class="doctag">@OAS</span>\Tag(</span></span><br><span class="line"><span class="comment">*     name=&quot;store&quot;,</span></span><br><span class="line"><span class="comment">*     description=&quot;Access to Petstore orders&quot;</span></span><br><span class="line"><span class="comment">* )</span></span><br><span class="line"><span class="comment">* <span class="doctag">@OAS</span>\Tag(</span></span><br><span class="line"><span class="comment">*     name=&quot;user&quot;,</span></span><br><span class="line"><span class="comment">*     description=&quot;Operations about user&quot;</span></span><br><span class="line"><span class="comment">* )</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<h3 id="path-部分"><a href="#path-部分" class="headerlink" title="path 部分"></a>path 部分</h3><p>直接使用注释形势写入控制器</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@OAS</span>\Get(</span></span><br><span class="line"><span class="comment">*     path=&quot;/test&quot;,                                 // API 路由地址</span></span><br><span class="line"><span class="comment">*     tags=&#123;&quot;test&quot;&#125;,                                // 对应Tag</span></span><br><span class="line"><span class="comment">*     sumary=&quot;get test doc&quot;,                        // API概要</span></span><br><span class="line"><span class="comment">*     description=&quot;get test doc more ........&quot;,     // API描述</span></span><br><span class="line"><span class="comment">*     operationId=&quot;test&quot;,                           // API请求时ID</span></span><br><span class="line"><span class="comment">*     deprecated=false,                             // API是否有效</span></span><br><span class="line"><span class="comment">*     <span class="doctag">@OAS</span>\Server(                                  // 独立API连接设置 可以覆盖全局</span></span><br><span class="line"><span class="comment">*         description=&quot;Server host&quot;,                // 连接描述</span></span><br><span class="line"><span class="comment">*         url=&quot;https://test.dev/api&quot;                // 连接地址</span></span><br><span class="line"><span class="comment">*     ),</span></span><br><span class="line"><span class="comment">*     <span class="doctag">@OAS</span>\Parameter(                               // API参数, 非必要</span></span><br><span class="line"><span class="comment">*         name=”id“,                                // 参数名</span></span><br><span class="line"><span class="comment">*         in=&quot;query&quot;,                               // 参数位置 可以设置`query`、`header`、`path`、`cookie`</span></span><br><span class="line"><span class="comment">*         description=&quot;adout this id ......&quot;,       // 描述</span></span><br><span class="line"><span class="comment">*         required=true,                            // 是否必须填写，当in设置为path时，需要设置为true。</span></span><br><span class="line"><span class="comment">*         style=&quot;from&quot;,                             // 设置参数序列化类型，非必要，自动根据in值设置。</span></span><br><span class="line"><span class="comment">*         <span class="doctag">@OAS</span>\Schema(</span></span><br><span class="line"><span class="comment">*             type=&quot;string&quot;,                        // 参数类型</span></span><br><span class="line"><span class="comment">*             example=&quot;test example&quot;,               // 参数例子</span></span><br><span class="line"><span class="comment">*         )</span></span><br><span class="line"><span class="comment">*     ),</span></span><br><span class="line"><span class="comment">*     <span class="doctag">@OAS</span>\RequestBody(                             // 请求主体 content-type 下使用 适合传递多个参数</span></span><br><span class="line"><span class="comment">*         description=&quot;adout this id ......&quot;,       // 描述</span></span><br><span class="line"><span class="comment">*         required=false,                           // 是否必须填写,默认为false</span></span><br><span class="line"><span class="comment">*         <span class="doctag">@OAS</span>\MediaType(                           // 请求数据结构</span></span><br><span class="line"><span class="comment">*             mediaType=&quot;application/json&quot;,         // application/json 结构</span></span><br><span class="line"><span class="comment">*             <span class="doctag">@OAS</span>\Schema(</span></span><br><span class="line"><span class="comment">*                 type=&quot;string&quot;</span></span><br><span class="line"><span class="comment">*                 ref=&quot;#/components/schemas/User&quot;   // 可以载入设置完成的参数,区分大小写</span></span><br><span class="line"><span class="comment">*             ),</span></span><br><span class="line"><span class="comment">*             <span class="doctag">@OAS</span>\Schema(</span></span><br><span class="line"><span class="comment">*                 <span class="doctag">@OAS</span>\Property(                    // 多参数设置</span></span><br><span class="line"><span class="comment">*                     property=&quot;otp&quot;,               // 参数名称</span></span><br><span class="line"><span class="comment">*                     description=&quot;yubikey otp&quot;,    // 参数描述</span></span><br><span class="line"><span class="comment">*                     type=&quot;string&quot;,                // 参数类型</span></span><br><span class="line"><span class="comment">*                     example=&quot;cccccccccccccccccccccccccccccccccccccccccccc&quot;</span></span><br><span class="line"><span class="comment">*                                                   // 参数例子</span></span><br><span class="line"><span class="comment">*                 )</span></span><br><span class="line"><span class="comment">*             )</span></span><br><span class="line"><span class="comment">*         ),</span></span><br><span class="line"><span class="comment">*         <span class="doctag">@OAS</span>\MediaType(                           // 请求数据结构</span></span><br><span class="line"><span class="comment">*             mediaType=&quot;application/xml&quot;,          // application/xml 结构</span></span><br><span class="line"><span class="comment">*             <span class="doctag">@OAS</span>\Schema(</span></span><br><span class="line"><span class="comment">*                 type=&quot;string&quot;</span></span><br><span class="line"><span class="comment">*                 ref=&quot;#/components/schemas/User&quot;   // 可以载入设置完成的参数,区分大小写</span></span><br><span class="line"><span class="comment">*             ),</span></span><br><span class="line"><span class="comment">*             <span class="doctag">@OAS</span>\Schema(</span></span><br><span class="line"><span class="comment">*                 <span class="doctag">@OAS</span>\Property(                    // 多参数设置</span></span><br><span class="line"><span class="comment">*                     property=&quot;otp&quot;,               // 参数名称</span></span><br><span class="line"><span class="comment">*                     description=&quot;yubikey otp&quot;,    // 参数描述</span></span><br><span class="line"><span class="comment">*                     type=&quot;string&quot;,                // 参数类型</span></span><br><span class="line"><span class="comment">*                     example=&quot;cccccccccccccccccccccccccccccccccccccccccccc&quot;</span></span><br><span class="line"><span class="comment">*                                                   // 参数例子</span></span><br><span class="line"><span class="comment">*                     )</span></span><br><span class="line"><span class="comment">*             )		</span></span><br><span class="line"><span class="comment">*         )</span></span><br><span class="line"><span class="comment">*     ),</span></span><br><span class="line"><span class="comment">*     <span class="doctag">@OAS</span>\Response(                                // 响应,必须设置</span></span><br><span class="line"><span class="comment">*         response=200,                             // 响应编号</span></span><br><span class="line"><span class="comment">*         description=&quot;successful operation&quot;,       // 响应描述</span></span><br><span class="line"><span class="comment">*         <span class="doctag">@OAS</span>\Header(</span></span><br><span class="line"><span class="comment">*             header=&quot;X-Rate-Limit&quot;,                // 响应头</span></span><br><span class="line"><span class="comment">*             description=&quot;calls per hour allowed by the user&quot;,</span></span><br><span class="line"><span class="comment">*                                                   // 响应头描述</span></span><br><span class="line"><span class="comment">*             <span class="doctag">@OAS</span>\Schema(</span></span><br><span class="line"><span class="comment">*                 type=&quot;integer&quot;,</span></span><br><span class="line"><span class="comment">*                 format=&quot;int32&quot;,</span></span><br><span class="line"><span class="comment">*                 default=&quot;64&quot;,                     // 默认</span></span><br><span class="line"><span class="comment">*                 example=&quot;12&quot;                      // 例子</span></span><br><span class="line"><span class="comment">*             )</span></span><br><span class="line"><span class="comment">*         ),</span></span><br><span class="line"><span class="comment">*         <span class="doctag">@OAS</span>\MediaType(                           // 响应数据结构</span></span><br><span class="line"><span class="comment">*             mediaType=&quot;application/json&quot;,</span></span><br><span class="line"><span class="comment">*             <span class="doctag">@OAS</span>\Schema(</span></span><br><span class="line"><span class="comment">*                 <span class="doctag">@OAS</span>\Property(</span></span><br><span class="line"><span class="comment">*                     property=&quot;message&quot;,           // 响应参数头</span></span><br><span class="line"><span class="comment">*                     description=&quot;Response message&quot;,</span></span><br><span class="line"><span class="comment">*                     type=&quot;string&quot;,                // 响应参数数据类型</span></span><br><span class="line"><span class="comment">*                     example=&quot;true&quot;                // 响应参数例子</span></span><br><span class="line"><span class="comment">*                 )</span></span><br><span class="line"><span class="comment">*             ),</span></span><br><span class="line"><span class="comment">*         )</span></span><br><span class="line"><span class="comment">*     )</span></span><br><span class="line"><span class="comment">* )</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="Model-数据参数"><a href="#Model-数据参数" class="headerlink" title="Model 数据参数"></a>Model 数据参数</h3><p>可以直接设置在class之上，使用<code>ref=&quot;#/components/schemas/ClassName&quot;</code>可以直接引用。</p>
<p><code>swagger</code>默认载入位置<code>#/components/schemas/</code>。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@OAS</span>\Schema(</span></span><br><span class="line"><span class="comment"> *     title=&quot;yubikey model&quot;,</span></span><br><span class="line"><span class="comment"> *     description=&quot;yubikey model&quot;,</span></span><br><span class="line"><span class="comment"> *     type=&quot;object&quot;,</span></span><br><span class="line"><span class="comment"> *     <span class="doctag">@OAS</span>\Property(</span></span><br><span class="line"><span class="comment"> *         property=&quot;message&quot;,</span></span><br><span class="line"><span class="comment"> *         description=&quot;Response message&quot;,</span></span><br><span class="line"><span class="comment"> *         type=&quot;string&quot;,</span></span><br><span class="line"><span class="comment"> *         default=&quot;true&quot;,  </span></span><br><span class="line"><span class="comment"> *         example=&quot;true&quot;</span></span><br><span class="line"><span class="comment"> *     ),</span></span><br><span class="line"><span class="comment"> *     <span class="doctag">@OAS</span>\Property(</span></span><br><span class="line"><span class="comment"> *         property=&quot;status&quot;,</span></span><br><span class="line"><span class="comment"> *         description=&quot;Updated status&quot;,</span></span><br><span class="line"><span class="comment"> *         type=&quot;string&quot;,</span></span><br><span class="line"><span class="comment"> *         example=&quot;true&quot;</span></span><br><span class="line"><span class="comment"> *     ),</span></span><br><span class="line"><span class="comment"> *     <span class="doctag">@OAS</span>\Property(</span></span><br><span class="line"><span class="comment"> *         property=&quot;age&quot;,</span></span><br><span class="line"><span class="comment"> *         description=&quot;Updated status of the pet&quot;,</span></span><br><span class="line"><span class="comment"> *         type=&quot;integer&quot;,</span></span><br><span class="line"><span class="comment"> *         minimum=&quot;0&quot;</span></span><br><span class="line"><span class="comment"> *     ),</span></span><br><span class="line"><span class="comment"> * )</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<h3 id="bitbeans-yubikey-的坑"><a href="#bitbeans-yubikey-的坑" class="headerlink" title="bitbeans/yubikey 的坑"></a>bitbeans/yubikey 的坑</h3><p>控制器中不能正常获取<code>Exception</code>。所以不能使用下方代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">YubiKey</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	<span class="variable">$yubikey_auth</span> = Yubikey::verify(Input::get(<span class="string">&#x27;otp&#x27;</span>));</span><br><span class="line">	<span class="variable">$yubikey_params</span> = Yubikey::getParameters();</span><br><span class="line">	<span class="variable">$yubikey_identity</span> = Yubikey::getParameter(<span class="string">&#x27;identity&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (\<span class="built_in">Exception</span> <span class="variable">$exception</span>) &#123;</span><br><span class="line">	<span class="variable">$error</span> = <span class="variable">$exception</span>-&gt;getMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>改写到<code>App\Exceptions\Handler</code>的<code>render</code>方法判断，使用<code>Exception</code>判断的<code>packages</code>不多。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span>(<span class="variable">$exception</span>-&gt;getMessage()) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;REPLAYED_OTP&#x27;</span>:</span><br><span class="line">    <span class="keyword">return</span> response()-&gt;json([<span class="string">&#x27;message&#x27;</span> =&gt; <span class="variable">$exception</span>-&gt;getMessage()]);</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;Could not parse Yubikey OTP&#x27;</span>:</span><br><span class="line">    <span class="keyword">return</span> response()-&gt;json([<span class="string">&#x27;message&#x27;</span> =&gt; <span class="variable">$exception</span>-&gt;getMessage()]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>yubikey</tag>
        <tag>laravel</tag>
        <tag>php</tag>
        <tag>swagger</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年04月03日</title>
    <url>/2018/04/03/a9716d2476eb/</url>
    <content><![CDATA[<h1 id="心情"><a href="#心情" class="headerlink" title="心情"></a>心情</h1><p>游戏用于寻求快乐，虽然都是不认识的人，还是能看出情商高低……</p>
<p>也许最理想的方式是不需要交流，一个人也可以玩的游戏。</p>
<p>第二阶段PVE任务也是有必要的。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年04月12日</title>
    <url>/2018/04/12/1150871e0062/</url>
    <content><![CDATA[<h1 id="……"><a href="#……" class="headerlink" title="……"></a>……</h1><p>小弟走了只能自己上了，对手是说着相同语言的同胞，脑子不好吧。</p>
<p>虚妄的野心只会带来毁灭……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>2018年04月11日</title>
    <url>/2018/04/11/9facd3a29bdb/</url>
    <content><![CDATA[<h1 id="游戏是让人可以忘记悲伤的良药"><a href="#游戏是让人可以忘记悲伤的良药" class="headerlink" title="游戏是让人可以忘记悲伤的良药"></a>游戏是让人可以忘记悲伤的良药</h1><p>无论是一个人还是一群人，都可以享受的游戏。</p>
<p>无法看清未来的人，只能拥有一时的幸运，极限很快就会来。</p>
<p>但愿60岁时，依然能享受创造所带来的快乐。</p>
<h2 id="创意的重叠"><a href="#创意的重叠" class="headerlink" title="创意的重叠"></a>创意的重叠</h2><p>与现在最火Fortnite在许多方面有重叠，也就是说在类似的外部影响下，创意有一定的一致性。</p>
<p>再者是人员与财力的问题，至少今天的时间点上，迷茫消失了，看来之前改变设定是有必要。</p>
<p>一个能做的是有限的…… </p>
<p>好像快点有组建团队的能力啊！！</p>
<p>而可以有效运作的团队一定是金字塔结构的…… 这与社会构成有关…… 50年内不会有什么变化吧……</p>
<p>过多的平等带来的只有混乱…… 在我朝就是例子，考虑到近2000年文明构成，某主义是不可实现的。</p>
<p>政客这个职业，将在某系统下完全消失吧。</p>
<p>但愿联通的那一天早日来临。</p>
<p>稳定之后，应该能在诸多方面带来变化。</p>
<p>好想快点，基础部分完成后要提高趣味性才行。</p>
<p>加油！梦想中的日子不远了！</p>
<p>之前满脑子都是一起的未来，某天却变成了一个…… 只是自作多情…… </p>
<p>也许会有下一个，也许不会，也许在一定的时间点上就不在需要了，多久？理论上7到10年。</p>
<p>10年IPv6 应该可以普及了吧~~ 说不定新的通讯方式会诞生哦~~</p>
<p>可以预想是2023年，前后将带来巨大的变化吧！</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>最好的自我评价也许是 <code>我很快乐 无论过去、现在还是未来！</code></p>
<p>当生命走到尽头，我希望能说去这句话。至少现在说不出口。</p>
<p>也是会变成<code>从某一天起，我很快乐。</code></p>
<p>面对面时的话语，远比其他时候有意义。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel 5.5 升级到 5.6</title>
    <url>/2018/04/15/234d9723e791/</url>
    <content><![CDATA[<h1 id="脑子混乱停一下"><a href="#脑子混乱停一下" class="headerlink" title="脑子混乱停一下"></a>脑子混乱停一下</h1><p>前后端分离与游戏部分</p>
<p>admin 与 user 需要不同的入口</p>
<p>数据部分有一些是通用的，分离 admin 域 与 user 域 是有必要的</p>
<p>admin verify 将 config 提取出来有一定优势  </p>
<p>quasar还是要加强的</p>
<p>码力 图力 不足…… 但是没什么用……</p>
<h1 id="laravel-Upgrading-To-5-6-0-From-5-5"><a href="#laravel-Upgrading-To-5-6-0-From-5-5" class="headerlink" title="laravel Upgrading To 5.6.0 From 5.5"></a>laravel Upgrading To 5.6.0 From 5.5</h1><figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;darkaonline/l5-swagger&quot;</span>: <span class="string">&quot;5.6.*&quot;</span>,</span><br><span class="line"><span class="string">&quot;fideloper/proxy&quot;</span>: <span class="string">&quot;~4.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;laravel/framework&quot;</span>: <span class="string">&quot;5.6.*&quot;</span>,</span><br><span class="line"><span class="string">&quot;laravel/passport&quot;</span>: <span class="string">&quot;^5.0&quot;</span>,</span><br><span class="line"><span class="string">&quot;phpunit/phpunit&quot;</span>: <span class="string">&quot;~7.0&quot;</span></span><br></pre></td></tr></table></figure>

<p>之后会出现错误</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Type error: Argument 2 passed to Symfony\Component\HttpFoundation\Request::setTrustedProxies() must be of the type integer, array given, called in /Users/k11/laravel/web/vendor/fideloper/proxy/src/TrustProxies.php on line 5</span><br></pre></td></tr></table></figure>

<p>对应<a href="https://laravel.com/docs/5.6/upgrade#upgrade-5.6.0">upgrade Trusted Proxies</a></p>
<p><code>App\Http\Middleware\TrustProxies</code></p>
<p>改</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$headers</span> = [</span><br><span class="line">    Request::HEADER_FORWARDED =&gt; <span class="string">&#x27;FORWARDED&#x27;</span>,</span><br><span class="line">    Request::HEADER_X_FORWARDED_FOR =&gt; <span class="string">&#x27;X_FORWARDED_FOR&#x27;</span>,</span><br><span class="line">    Request::HEADER_X_FORWARDED_HOST =&gt; <span class="string">&#x27;X_FORWARDED_HOST&#x27;</span>,</span><br><span class="line">    Request::HEADER_X_FORWARDED_PORT =&gt; <span class="string">&#x27;X_FORWARDED_PORT&#x27;</span>,</span><br><span class="line">    Request::HEADER_X_FORWARDED_PROTO =&gt; <span class="string">&#x27;X_FORWARDED_PROTO&#x27;</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>为</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$headers</span> = Request::HEADER_X_FORWARDED_ALL; </span><br></pre></td></tr></table></figure>

<h2 id="Bootstrap-4"><a href="#Bootstrap-4" class="headerlink" title="Bootstrap 4"></a>Bootstrap 4</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm uninstall --save-dev bootstrap-sass</span><br><span class="line">npm install bootstrap popper.js</span><br></pre></td></tr></table></figure>

<h3 id="resources-assets-js-bootstrap-js"><a href="#resources-assets-js-bootstrap-js" class="headerlink" title="resources/assets/js/bootstrap.js"></a>resources/assets/js/bootstrap.js</h3><p>中 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">    window.$ = window.jQuery = require(&#x27;jquery&#x27;);</span><br><span class="line"></span><br><span class="line">    require(&#x27;bootstrap-sass&#x27;);</span><br><span class="line">&#125; catch (e) &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>改为 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try &#123;</span><br><span class="line">    window.$ = window.jQuery = require(&#x27;jquery&#x27;);</span><br><span class="line"></span><br><span class="line">    require(&#x27;bootstrap&#x27;);</span><br><span class="line">&#125; catch (e) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>添加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">window.Popper = require(&#x27;popper.js&#x27;).default;</span><br></pre></td></tr></table></figure>

<h3 id="resources-assets-sass-app-scss"><a href="#resources-assets-sass-app-scss" class="headerlink" title="resources/assets/sass/app.scss"></a>resources/assets/sass/app.scss</h3><p>中</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@import “~bootstrap-sass/assets/stylesheets/bootstrap”</span><br></pre></td></tr></table></figure>

<p>改为</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">@import “~bootstrap/scss/bootstrap.scss”</span><br><span class="line"></span><br><span class="line">.navbar-laravel &#123;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="resources-assets-sass-variables-scss"><a href="#resources-assets-sass-variables-scss" class="headerlink" title="resources/assets/sass/_variables.scss"></a>resources/assets/sass/_variables.scss</h3><p>删除全部内容后写入</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// Fonts</span><br><span class="line">@import url(&quot;https://fonts.googleapis.com/css?family=Raleway:300,400,600&quot;);</span><br><span class="line"></span><br><span class="line">// Variables</span><br><span class="line">@import &quot;variables&quot;;</span><br><span class="line"></span><br><span class="line">// Bootstrap</span><br><span class="line">@import &#x27;~bootstrap/scss/bootstrap&#x27;;</span><br><span class="line"></span><br><span class="line">.navbar-laravel &#123;</span><br><span class="line">  background-color: #fff;</span><br><span class="line">  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>直接复制<code>laravel 5.6</code> 版本的 <code>resources</code> <code>package.json</code> 到 <code>laravel 5.5</code>下覆盖。</p>
<h2 id="swagger"><a href="#swagger" class="headerlink" title="swagger"></a>swagger</h2><p>在<code>config/l5-swagger</code>中设置好<code>passport</code>后使用下方代码引入每个请求</p>
<p><code>l5-swagger</code>中使用的是<code>password</code>方式，所以不必限制请求地址</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*     security=&#123;</span><br><span class="line">*         &#123;&quot;passport&quot;: &#123;&#125;&#125;</span><br><span class="line">*     &#125;,</span><br></pre></td></tr></table></figure>

<h1 id="mailserver-修复"><a href="#mailserver-修复" class="headerlink" title="mailserver 修复"></a>mailserver 修复</h1><p>起因 mac os 上不能登录邮箱了，手机却可以。查看logs发现是错误如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TLS handshaking: SSL_accept() failed </span><br></pre></td></tr></table></figure>

<p>查找issues得知<code>tomav/docker-mailserver</code>更新</p>
<p>增加一个新变量</p>
<p><code>TLS_LEVEL</code> 要想兼容老 Mac OS 要设置为<code>intermediate</code></p>
<h1 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h1>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
        <tag>swagger</tag>
      </tags>
  </entry>
  <entry>
    <title>Dcoker 部署 mailserver</title>
    <url>/2018/04/16/5f633ca9b365/</url>
    <content><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>查找文章时没找到, 在本地发现了, 重新编辑一下, 供后来者参考。 </p>
<h1 id="使用Dcoker-部署邮件服务"><a href="#使用Dcoker-部署邮件服务" class="headerlink" title="使用Dcoker 部署邮件服务"></a>使用Dcoker 部署邮件服务</h1><h2 id="DNS-records-设置与-PTR-records"><a href="#DNS-records-设置与-PTR-records" class="headerlink" title="DNS records 设置与  PTR records"></a>DNS records 设置与  PTR records</h2><p>注意把bar.foo换成需要的域名</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Homename</th>
<th>Value</th>
<th>TTL</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>bar.foo</td>
<td>000.000.000.000</td>
<td>3600</td>
</tr>
<tr>
<td>A</td>
<td>*.bar.foo</td>
<td>000.000.000.000</td>
<td>3600</td>
</tr>
<tr>
<td>AAAA</td>
<td>bar.foo</td>
<td>000.000.000.000</td>
<td>3600</td>
</tr>
<tr>
<td>AAAA</td>
<td>*.bar.foo</td>
<td>000.000.000.000</td>
<td>3600</td>
</tr>
<tr>
<td>NS</td>
<td>bar.foo</td>
<td>ns1.bar.foo</td>
<td>1800</td>
</tr>
<tr>
<td>NS</td>
<td>bar.foo</td>
<td>ns2.bar.foo</td>
<td>1800</td>
</tr>
<tr>
<td>NS</td>
<td>bar.foo</td>
<td>ns3.bar.foo</td>
<td>1800</td>
</tr>
<tr>
<td>MX</td>
<td>bar.foo</td>
<td>mail.bar.foo. 【10】</td>
<td>14400</td>
</tr>
<tr>
<td>TXT</td>
<td>bar.foo</td>
<td>v=spf1 mx ~all</td>
<td>3600</td>
</tr>
<tr>
<td>TXT</td>
<td>_dmarc.bar.foo</td>
<td>v=DMARC1; p=none</td>
<td>3600</td>
</tr>
<tr>
<td>TXT</td>
<td>mail._domainkey.bar.foo</td>
<td>v=DKIM1; k=rsa; p=****</td>
<td>3600</td>
</tr>
</tbody></table>
<p>说明:</p>
<ul>
<li>NS 为域名解析服务器</li>
<li>A 为IPv4 域名绑定</li>
<li>AAAA 为IPv6 域名绑定</li>
<li>MX 为 收信服务器</li>
<li>TXT 为 E-Mail验证与设置</li>
<li>将主机名改为<code>mail.bar.foo</code>后，可以设置<code>PTR records</code>。</li>
</ul>
<p>IPv6使用letsencrypt自动延期证书是会出错要注意下。</p>
<p><code>p==***********</code>为<code>DKIM key</code>这里隐去了</p>
<h2 id="docker-mailserver"><a href="#docker-mailserver" class="headerlink" title="docker-mailserver"></a>docker-mailserver</h2><ul>
<li>注意使用<code>ENABLE_CLAMAV=1</code>时需要<code>RAM≥1G</code></li>
</ul>
<p>当网站与邮件服务在同一服务器时，要使用<code>nginx-proxy</code></p>
<h3 id="新建用户"><a href="#新建用户" class="headerlink" title="新建用户"></a>新建用户</h3><p><code>mailserver目录下</code>，可以使用docker命令添加多个用户</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">touch config/postfix-accounts.cf</span><br><span class="line">docker run --rm \</span><br><span class="line">  -e MAIL_USER=bar@bar.foo \</span><br><span class="line">  -e MAIL_PASS=password \</span><br><span class="line">  -ti tvial/docker-mailserver:latest \</span><br><span class="line">  /bin/sh -c &#x27;echo &quot;$MAIL_USER|$(doveadm pw -s SHA512-CRYPT -u $MAIL_USER -p $MAIL_PASS)&quot;&#x27; &gt;&gt; config/postfix-accounts.cf</span><br></pre></td></tr></table></figure>

<h3 id="创建-DKIM-key"><a href="#创建-DKIM-key" class="headerlink" title="创建 DKIM key"></a>创建 DKIM key</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --rm \</span><br><span class="line"> -v &quot;/root/mailserver/config&quot;:/tmp/docker-mailserver \</span><br><span class="line"> -ti tvial/docker-mailserver:latest generate-dkim-config bar.foo</span><br></pre></td></tr></table></figure>

<p>查看</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cat /root/mailserver/config/opendkim/keys/bar.foo/mail.txt</span><br></pre></td></tr></table></figure>

<p>将DKIM1 调整后添加到域名解析<code>mail._domainkey</code>记录下。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">v=DKIM1; k=rsa; p=***********</span><br></pre></td></tr></table></figure>

<p><code>p==***********</code>为<code>DKIM key</code>这里隐去了</p>
<h3 id="docker-mailserver-启动"><a href="#docker-mailserver-启动" class="headerlink" title="docker-mailserver 启动"></a>docker-mailserver 启动</h3><p>启动 docker-proxy 【反向代理】</p>
<figure class="highlight docker"><table><tr><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="bash"> -d -p 80:80 -p 443:443 \</span></span><br><span class="line"><span class="bash">    --name nginx-proxy \</span></span><br><span class="line"><span class="bash">    -v /path/to/certs:/etc/nginx/certs:ro \</span></span><br><span class="line"><span class="bash">    -v /etc/nginx/vhost.d \</span></span><br><span class="line"><span class="bash">    -v /usr/share/nginx/html \</span></span><br><span class="line"><span class="bash">    -v /var/run/docker.sock:/tmp/docker.sock:ro \</span></span><br><span class="line"><span class="bash">    --label com.github.jrcs.letsencrypt_nginx_proxy_companion.nginx_proxy \</span></span><br><span class="line"><span class="bash">    jwilder/nginx-proxy</span></span><br></pre></td></tr></table></figure>

<p>启动 letsencrypt-nginx-proxy-companion 【挂载TLS证书】</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    -v /path/to/certs:/etc/nginx/certs:rw \</span><br><span class="line">    -v /var/run/docker.sock:/var/run/docker.sock:ro \</span><br><span class="line">    --volumes-from nginx-proxy \</span><br><span class="line">    jrcs/letsencrypt-nginx-proxy-companion</span><br></pre></td></tr></table></figure>

<p>启动 library/nginx 【用于获取TLS证书， 验证时，需要<code>port:80</code>】<br>也可以使用下方<code>docker-compose.yml</code></p>
<ul>
<li>注意:要将<code>nginx</code>桥接到<code>nginx-proxy</code>的网络，使其可以正常解析,<code>LETSENCRYPT_TEST=true</code>在测试时使用，防止证书频繁申请。<br>Email 必须为有效地址。</li>
</ul>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">webmail:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">VIRTUAL_HOST=mail.bar.foo</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">LETSENCRYPT_HOST=mail.bar.foo</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">LETSENCRYPT_EMAIL=k11@bar.foo</span></span><br><span class="line">        <span class="comment"># - LETSENCRYPT_TEST=true</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;bridge&quot;</span></span><br><span class="line">  <span class="attr">mailserver:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">tvial/docker-mailserver:latest</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">mail</span></span><br><span class="line">    <span class="attr">domainname:</span> <span class="string">bar.foo</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">mail</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;25:25&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;143:143&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;587:587&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;993:993&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/root/mailserver/mail:/var/mail</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/root/mailserver/mail-state:/var/mail-state</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/root/mailserver/config/:/tmp/docker-mailserver/</span></span><br><span class="line">    <span class="comment"># - /etc/letsencrypt:/etc/letsencrypt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/path/to/certs/mail.bar.foo:/etc/letsencrypt/live/mail.bar.foo</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">SSL_TYPE=letsencrypt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ENABLE_SPAMASSASSIN=0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ENABLE_CLAMAV=0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ENABLE_FAIL2BAN=0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ENABLE_POSTGREY=0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ONE_DIR=1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DMS_DEBUG=0</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">TLS_LEVEL=intermediate</span></span><br></pre></td></tr></table></figure>

<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>也可以将<code>nginx-proxy</code>与<code>letsencrypt-nginx-proxy-companion</code>写在一起，这样还可以运行其他服务</p>
<p>具体可以查看<a href="https://keleven.me/living/2018/01/22/blog/">这篇</a></p>
<p><code>letsencrypt-nginx-proxy-companion</code>可以手动更新</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">手动更新 或 申请证书</span><br><span class="line">docker exec letsencrypt-nginx-proxy-companion /app/force_renew</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">证书状态</span><br><span class="line">docker exec letsencrypt-nginx-proxy-companion /app/cert_status</span><br></pre></td></tr></table></figure>

<h3 id="测试SSL"><a href="#测试SSL" class="headerlink" title="测试SSL"></a>测试SSL</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker exec mailserver openssl s_client -connect 0.0.0.0:587 -starttls smtp -CApath /etc/letsencrypt/</span><br><span class="line">docker exec mailserver openssl s_client -connect 0.0.0.0:993 -starttls imap -CApath /etc/letsencrypt/</span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="使用nginx-proxy"><a href="#使用nginx-proxy" class="headerlink" title="使用nginx-proxy"></a>使用<code>nginx-proxy</code></h3><p>一般挂载</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    --name webblog \</span><br><span class="line">    --expose 80 \</span><br><span class="line">    -e &quot;VIRTUAL_HOST=bar.foo&quot; \</span><br><span class="line">    library/nginx</span><br></pre></td></tr></table></figure>

<p>获取证书</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    --name web \</span><br><span class="line">    --expose 80 \</span><br><span class="line">    -e &quot;VIRTUAL_HOST=mail.bar.foo&quot; \</span><br><span class="line">    -e &quot;LETSENCRYPT_HOST=mail.bar.foo&quot; \</span><br><span class="line">    -e &quot;LETSENCRYPT_EMAIL=foo@bar.com&quot; \</span><br><span class="line">    library/nginx</span><br></pre></td></tr></table></figure>

<p>查看  域名映射</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -H &quot;Host:bar.foo&quot; localhost</span><br></pre></td></tr></table></figure>

<p>查看 nginx 代理设置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker exec nginx-proxy  cat /etc/nginx/conf.d/default.conf</span><br></pre></td></tr></table></figure>

<p>包管理</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker run --rm --expose 9000 -e VIRTUAL_HOST=test.bar.foo -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>mail</tag>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>win10 关闭 windows ink 后要做事儿</title>
    <url>/2018/04/18/9dcaef641ff8/</url>
    <content><![CDATA[<h1 id="关闭-windows-ink-后要做事儿"><a href="#关闭-windows-ink-后要做事儿" class="headerlink" title="关闭 windows ink 后要做事儿"></a>关闭 windows ink 后要做事儿</h1><p>系统重装后，cintiq pro 13 的画笔有点奇怪。</p>
<p>主要是PS下笔上的右键异常，影响拾取颜色，调整硬度等等。</p>
<p>所以关闭 windows ink 之后…… </p>
<p>压力感应消失了！！！</p>
<p>WTF！！</p>
<p>最后发现这个问题，已经有了好几年了…… 解决方式写在下面备用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">C:\Users\Yourname\AppData\Roaming\Adobe\Adobe Photoshop CC 2018\Adobe Photoshop CC 2018 Settings</span><br></pre></td></tr></table></figure>

<p>下建立<code>PSUserConfig.txt</code>文件，写入下面两行。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Use WinTab</span><br><span class="line">UseSystemStylus 0</span><br></pre></td></tr></table></figure>

<p>之后完美了~~</p>
<h1 id="唠叨"><a href="#唠叨" class="headerlink" title="唠叨"></a>唠叨</h1><p>果然发生了，对应的事件，恐怕是知识产权方面吧……</p>
<p>后果吗，按照供应与储备来说，6个月之内没什么，保守点的3个月。</p>
<p>3到5年内，网络行业崩溃。生活水平会到90年代初期吧</p>
<p>科学水平会止步吧…… 人才外流会加速。</p>
<p>之前觉得高丽惨，现在看会比高丽更惨。</p>
<p>内忧外患，加速自主研发比画个经济区重要的多的多。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>前后分离还是……</title>
    <url>/2018/05/03/b0cfff998c64/</url>
    <content><![CDATA[<h2 id="分离-or-一起"><a href="#分离-or-一起" class="headerlink" title="分离 or 一起"></a>分离 or 一起</h2><p>后台前后端分离好处是可以多平台管理。</p>
<p>前端的到代码量会大量增加。伴随着大量的重复逻辑。</p>
<p>不分离，需要以网站的形势运行，需要浏览器。</p>
<p>代码部件将减少。</p>
<p>心急……</p>
<h2 id="真是服了"><a href="#真是服了" class="headerlink" title="真是服了"></a>真是服了</h2><p>找个问题中文搜半天，一堆垃圾加复制。</p>
<p>换英文3分钟解决……</p>
<p>laravel 服务器容器的绑定 可以用来在不进入<code>class</code> 或 <code>Interface</code>的情况下 </p>
<p>直接在全局使用……</p>
<p>中文上一次又一次的引入为个啥 ？ 最后说什么反正结果对了…… </p>
<p>WTF……  都自动注入了能不对吗…… </p>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>宫墙又高了</title>
    <url>/2018/04/27/9f01c1ee69c2/</url>
    <content><![CDATA[<h1 id="US线路丢包越发严重了……-心塞……"><a href="#US线路丢包越发严重了……-心塞……" class="headerlink" title="US线路丢包越发严重了…… 心塞……"></a>US线路丢包越发严重了…… 心塞……</h1><p>自家web访问缓慢…… 于是使用cloudflare转发</p>
<p>需要注意 更改域名解析，更改后速度提高了好多~~</p>
<p>不过<code>iTerm2</code>使用<code>SSH</code>依然缓慢。</p>
<p>解决方案让<code>SSH</code>可以使用<code>Socks5</code></p>
<h2 id="SSH使用Socks5"><a href="#SSH使用Socks5" class="headerlink" title="SSH使用Socks5"></a>SSH使用Socks5</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ssh -o ProxyCommand=&#x27;nc -x 127.0.0.1:8083 %h %p&#x27; -p 22 &lt;user&gt;@&lt;000.000.000.000&gt;</span><br></pre></td></tr></table></figure>

<p>绕一圈的速度都比直连快……我也是……醉了……</p>
<p><a href="https://ieevee.com/tech/2017/10/19/ssh-over-socks5.html">参考地址</a></p>
<h2 id="iTerm2使用proxy-的方法"><a href="#iTerm2使用proxy-的方法" class="headerlink" title="iTerm2使用proxy 的方法"></a>iTerm2使用proxy 的方法</h2><p>在<code>.zshrc</code>中添加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">alias goproxy=&#x27;export http_proxy=&quot;http://127.0.0.1:8003&quot;; export HTTP_PROXY=&quot;http://127.0.0.1:8003&quot;; export https_proxy=&quot;http://127.0.0.1:8003&quot;; export HTTPS_PROXY=&quot;http://127.0.0.1:8003&quot;&#x27;</span><br><span class="line">alias disproxy=&#x27;unset http_proxy HTTP_PROXY https_proxy HTTPS_PROXY&#x27;</span><br></pre></td></tr></table></figure>

<p>开启时使用<code>goproxy</code></p>
<p>关闭时使用<code>disproxy</code></p>
<p>从此<code>brew</code>、<code>composer</code>、<code>npm</code>,可以免去漫长的等待了。</p>
<p>验证是否有效<code>curl ifconfig.me</code>返回的就是当前IP。</p>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>SSH</tag>
        <tag>GFW</tag>
        <tag>socks5</tag>
      </tags>
  </entry>
  <entry>
    <title>霉运驱散</title>
    <url>/2018/05/16/0b360bcf5c42/</url>
    <content><![CDATA[<h2 id="霉运驱散！"><a href="#霉运驱散！" class="headerlink" title="霉运驱散！"></a>霉运驱散！</h2><p>霉运驱散！霉运驱散！霉运驱散！</p>
<p>一周之内霉运连发。</p>
<p>先是电动牙刷挂掉，修理之中弄坏主板，彻底变尸体……</p>
<p>之后，桌子闹钟电源老化…… 替换的在路上了…… </p>
<p>随后…… 空气净化器的扇叶会自己跳…… 估计是哪里卡住了…… 还没拆…… </p>
<p>昨天…… 升级路由…… 之后变砖了…… 花费2小时修复了…… </p>
<h2 id="R6300v2-变砖的修复之路"><a href="#R6300v2-变砖的修复之路" class="headerlink" title="R6300v2 变砖的修复之路"></a>R6300v2 变砖的修复之路</h2><p>需要<a href="https://github.com/jclehner/nmrpflash">nmrpflash</a></p>
<p><code>window</code>下还需求<a href="https://www.winpcap.org/install/default.htm">WinPcap</a></p>
<p><a href="https://www.dropbox.com/s/5exqbbm349ihbo1/R6300v2.zip?dl=0">官方原始镜像与工具打包</a></p>
<p>关闭防火墙，网线连接任意 <code>R6300v2 LAN</code>口，一端连接电脑</p>
<p><code>nmrpflash</code> 目录下运行下方命令会显示当前网卡</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmrpflash -L</span><br></pre></td></tr></table></figure>

<p>没事设置<code>IPv4</code>的情况下找不到<code>IP</code>的</p>
<p>设置<code>IPv4</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">192.168.1.2</span><br><span class="line">255.255.255.0</span><br><span class="line">192.168.1.1</span><br></pre></td></tr></table></figure>
<p>再次<code>nmrpflash -L</code> 找到网卡<code>IP</code>了</p>
<p>随后关闭<code>R6300v2</code></p>
<p><code>CMD</code>下，保持下方命令可以输入的状态，没错拼手速的时候到了……</p>
<p>通电的瞬间按回车……</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nmrpflash.exe -i net2 -a 192.168.1.1 -f R6300v2-V1.0.4.2_10.0.74.chk</span><br></pre></td></tr></table></figure>

<p>成功时出现下方提升</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Received upload request with empty filename.</span><br><span class="line">Uploading R6300v2-V1.0.4.2_10.0.74.chk ... OK</span><br><span class="line">Waiting for remote to respond.</span><br><span class="line">Received keep-alive request.</span><br><span class="line">Received keep-alive request.</span><br><span class="line">Received keep-alive request.</span><br><span class="line">Received keep-alive request.</span><br><span class="line">Received keep-alive request.</span><br><span class="line">Received keep-alive request.</span><br><span class="line">Received keep-alive request.</span><br><span class="line">Received keep-alive request.</span><br><span class="line">Received keep-alive request.</span><br><span class="line">Received keep-alive request.</span><br><span class="line">Received keep-alive request.</span><br><span class="line">Received keep-alive request.</span><br><span class="line">Remote finished. Closing connection.</span><br><span class="line">Reboot your device now.</span><br></pre></td></tr></table></figure>

<p>没提升<code>Reboot</code>前，一定别手贱……</p>
<ul>
<li>No response after 60 seconds. Bailing out. </li>
</ul>
<p>这个是手速慢了…… 少侠请重新来过……</p>
<h2 id="R6300v2-原版刷梅林"><a href="#R6300v2-原版刷梅林" class="headerlink" title="R6300v2 原版刷梅林"></a>R6300v2 原版刷梅林</h2><p>重启之后，就回到了原厂固件的状态了~ </p>
<p>Q: 为什么刷梅林？ </p>
<p>A: 当然是有一些不可描述的服务了~~</p>
<p>详情可以看<a href="https://solarhell.com/default/r6300v2.html">这里写的很详细</a></p>
<p>下面是简单方法备用</p>
<p>进入<code>192.168.1.1</code></p>
<p>找到<code>高级</code>-&gt;<code>管理</code>-&gt;<code>路由器升级</code></p>
<blockquote>
<p>刷入<code>factory-to-dd-wrt.chk</code>，等完成后重启别手贱……</p>
</blockquote>
<p>完成后进入<code>DD-wrt</code>, 设置用户名，密码，之后会用到</p>
<p><code>services</code>中开启<code>ssh</code></p>
<p>进入<code>ssh</code> 账号是<code>root</code>，密码是刚刚设置的，验证设备是否匹配固件，如下方，基本可以刷了</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nvram get boardnum</span></span><br><span class="line">679</span><br><span class="line"><span class="meta">$</span><span class="bash"> nvram get boardtype</span></span><br><span class="line">0x0646</span><br><span class="line"><span class="meta">$</span><span class="bash"> nvram get boardrev</span></span><br><span class="line">0x1110</span><br></pre></td></tr></table></figure>

<p>随后进入<code>192.168.1.1</code>-&gt;<code>administration</code> </p>
<blockquote>
<p>刷入<code>R6300V2_merlin_1.2.trx</code> 别手贱…… 等完成后自动重启！</p>
</blockquote>
<p>重启后就进入梅林了进入<code>系统管理</code>-&gt;<code>固件升级</code></p>
<blockquote>
<p>刷入<code>R6300V2_380.70_0-X7.9.trx</code> 最新固件后 恢复下默认设置。</p>
</blockquote>
<p>开启<code>JFFS</code>, <code>系统设置</code>-&gt;<code>Persistent JFFS2 Partition</code> -&gt; 都选是 之后点最上边的重启。</p>
<p>另外设置内网<code>IP</code>后也要重启。</p>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>路由</tag>
        <tag>R6300v2</tag>
      </tags>
  </entry>
  <entry>
    <title>前进的路上</title>
    <url>/2018/05/10/bee7ddc9b91b/</url>
    <content><![CDATA[<h2 id="有点意思"><a href="#有点意思" class="headerlink" title="有点意思"></a>有点意思</h2><p>herman miller 官方店铺消失 可以认为开始锁国了……  </p>
<p>stroe 说没备案，还是要非经营性的…… 远离阿里云是对的…… 我朝供应商多是一丘之貉……</p>
<p>生于当朝是莫大的悲哀……</p>
<h2 id="swagger"><a href="#swagger" class="headerlink" title="swagger"></a>swagger</h2><p><a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#parameterObject">参考文档</a></p>
<p>la5-swagger 下无法使用<code>fromData</code> 解决方法,使用<code>@OAS\RequestBody</code></p>
<p>@OAS\Parameter 标签下</p>
<p><code>in</code> 控制方法</p>
<p><code>path</code> 为路径,作为URL的一部分</p>
<p><code>query</code> 查询，附加为URL参数，如<code>/pet?id=***</code></p>
<h2 id="laravel-permission"><a href="#laravel-permission" class="headerlink" title="laravel-permission"></a>laravel-permission</h2><p>Database Seeding 比预想的简单</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>自言自语</title>
    <url>/2018/05/12/1334fb257a7f/</url>
    <content><![CDATA[<h2 id="自言自语"><a href="#自言自语" class="headerlink" title="自言自语"></a>自言自语</h2><p>512地震 10年了 相关人员没有被追责…… 遗址的纪念碑没人清理……</p>
<p>巨额的捐款去向不明…… 一个国家的10年, 不知道在对应的方面有没有进步…… </p>
<p>下次发生时, 估计还是一样的吧…… </p>
<p>内部渠道得知择优生存计划是存在的…… 也就是说地震的快速预警是不会对民众发布的……</p>
<p>滴滴顺风车的事儿，成功的转移了仇恨，我朝人太容易被操控的…… 大数据杀熟的就怎么快忘了？</p>
<p>我朝的盟友也在日益的减少…… 失去了未来…… 大人们在加速洗脑……</p>
<p>10年前,因为无能而哭泣…… 10年后,却在与诸多俗事斗争…… </p>
<p>有一年阿里举办比赛，对刷票无动于衷，还理直气壮的说社会依如此…… </p>
<p>不对不能维持环境公平本身就是失职…… 那一年是2010年……</p>
<p>1984 并不是幻想 而在来的路上……</p>
<p>变化之时，这片土地上的人又能剩下多少……</p>
<p>醉生梦死 在这时就显的特别有意思……</p>
<p>当游戏能使玩家获得利润时，世界将发生第一次改变。</p>
<p>当游戏可以获得现实中的物品时，世界将发生第二次改变。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>编程的日常</title>
    <url>/2018/05/06/b386e7a0c4cb/</url>
    <content><![CDATA[<h2 id="使用Str-orderedUuid-时报错"><a href="#使用Str-orderedUuid-时报错" class="headerlink" title="使用Str::orderedUuid()时报错"></a>使用Str::orderedUuid()时报错</h2><p>laravel5.6 直接使用Str::orderedUuid()时报错</p>
 <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Cannot call Ramsey\Uuid\Converter\Number\DegradedNumberConverter::toHex without support for large integers, since integer is an unsigned 128-bit integer; Moontoast\Math\BigNumber is required.</span><br></pre></td></tr></table></figure>

<p>解决办法安装<code>Moontoast\Math</code>包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer require &quot;moontoast/math&quot;</span><br></pre></td></tr></table></figure>

<h2 id="hosts-文件位置"><a href="#hosts-文件位置" class="headerlink" title="hosts 文件位置"></a>hosts 文件位置</h2><p>window 位置：<code>C:\Windows\System32\drivers\etc</code></p>
<p>Mac OS 位置：<code>/Private/etc</code></p>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>小计</title>
    <url>/2018/05/20/9040f871bde9/</url>
    <content><![CDATA[<h2 id="小计"><a href="#小计" class="headerlink" title="小计"></a>小计</h2><p><code>interface</code>使用掌握~~ 还是花了一些时间的。</p>
<h2 id="随手"><a href="#随手" class="headerlink" title="随手"></a>随手</h2><p>某神酒刷新了社会底线…… 由上至下…… 不可说…… 不可说……</p>
<p>小手段…… 幼稚……  某某之后，忘了你国还有某某了吧……  </p>
<p>二次抗美援朝？估计没这个机会……</p>
<p>某企业500亿要研发芯片，不要做梦了，研发不出来的，技术断代了</p>
<p>有它股票的可以抛售了……</p>
<p>人无远虑必有近忧 最近考虑的太多 要逐一去落实才行 </p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>心情</title>
    <url>/2018/05/25/6bfabc29d1fc/</url>
    <content><![CDATA[<h2 id="番剧是让我快乐的良药"><a href="#番剧是让我快乐的良药" class="headerlink" title="番剧是让我快乐的良药"></a>番剧是让我快乐的良药</h2><p>把人看的越清楚，就越讨厌。</p>
<p>忍耐差不多是极限了。</p>
<p>laravel 使用的路上还算顺利</p>
<p>啊啊 好想早点做完啊</p>
<p>看来我的触发点在某些东西上，而是不人。</p>
<p>说什么不重要，重点是做什么。</p>
<p>话什么的根本不想说，也不想听。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>我是修理工！</title>
    <url>/2018/06/28/b692de2bfca3/</url>
    <content><![CDATA[<h2 id="日常"><a href="#日常" class="headerlink" title="日常"></a>日常</h2><p>家里电器各种坏心烦</p>
<p>一样一样修 也是心累……</p>
<p>因祸得福的也算是愉快~~</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>不想说话</title>
    <url>/2018/05/30/38cbd964160e/</url>
    <content><![CDATA[<h2 id="不想说话"><a href="#不想说话" class="headerlink" title="不想说话"></a>不想说话</h2><p>恭喜毕业~~ 反正又看不到……</p>
<p>整理类与函数，多到快要绝望……</p>
<p>大多数人醉生梦死的趋势越来越明显……</p>
<p>发现最近的文章都挺绝望的……</p>
<p>只是支撑下去理由不那么明显罢了……</p>
<p>心情还十分不好,躁动与脾气快要炸了……</p>
<p>之后好想开心的找一个地方发呆……</p>
<p>傻有傻福，命运吗？有点意思……</p>
<p>加油…… 除此之外没其他选择!</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>镜花雪月</title>
    <url>/2018/06/23/ac1001485288/</url>
    <content><![CDATA[<h2 id="日常"><a href="#日常" class="headerlink" title="日常"></a>日常</h2><p>风暴将起，日常快没有了</p>
<p>用点意思的童话 🙃 🙃 🙃 🙃</p>
<p>有点火估计快没有了 作者让我匿名吧 安全考虑</p>
<p><img src="https://i.loli.net/2018/06/23/5b2db94412b82.png" alt="00"></p>
<p>看似无关的事儿 终有一天要降临在身上……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>一些日常😁😁😁</title>
    <url>/2018/07/10/182a42195df3/</url>
    <content><![CDATA[<h2 id="一些日常😁😁😁"><a href="#一些日常😁😁😁" class="headerlink" title="一些日常😁😁😁"></a>一些日常😁😁😁</h2><p>代码稳定进行中，明显能感受到在进步，就是数量有点大</p>
<p>最近喜欢听楞严咒 ，梵文的很好听</p>
<p>怀疑与否定的意义完全不同</p>
<p>我选择相信我想相信的~~</p>
<iframe width="560" height="315" src="https://www.youtube.com/embed/q6lPVuddFFE?rel=0" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>

<p>提起咒心与音轨 如下</p>
<p><a href="https://www.dropbox.com/s/mzh5vsphjesizcb/%E6%A5%9E%E4%B8%A5%E5%BF%83%E5%92%92%207%E9%81%8D.flac?dl=0">咒心7遍</a></p>
<p><a href="https://www.dropbox.com/s/7gaz3ccya2mpw24/%E6%A2%B5%E6%96%87%E6%A5%9E%E4%B8%A5%E5%92%92%E5%85%A8%E6%96%87.m4a?dl=0">古梵音楞嚴咒 ios 可以听</a></p>
<h2 id="种子字-发音-解释"><a href="#种子字-发音-解释" class="headerlink" title="种子字 发音 解释"></a>种子字 发音 解释</h2><p><a href="http://buddha.goodweb.net.cn/music/musictxt/ly_zhou2.asp">重要来源</a></p>
<p><img src="https://i.loli.net/2018/07/11/5b4514a35f569.jpg" alt="p01"><br><img src="https://i.loli.net/2018/07/11/5b4514a2adf40.jpg" alt="p02"><br><img src="https://i.loli.net/2018/07/11/5b4514a389046.jpg" alt="p03"><br><img src="https://i.loli.net/2018/07/11/5b4514a36309c.jpg" alt="p04"><br><img src="https://i.loli.net/2018/07/11/5b4514a3bcab7.jpg" alt="p05"><br><img src="https://i.loli.net/2018/07/11/5b4514a3a693f.jpg" alt="p06"><br><img src="https://i.loli.net/2018/07/11/5b4514a37c884.jpg" alt="p07"><br><img src="https://i.loli.net/2018/07/11/5b45171cd1bad.jpg" alt="p08"></p>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>mail server 附件大小调整</title>
    <url>/2018/07/11/617a36206ff6/</url>
    <content><![CDATA[<h2 id="默认邮件大小调整方法"><a href="#默认邮件大小调整方法" class="headerlink" title="默认邮件大小调整方法"></a>默认邮件大小调整方法</h2><p>注意要在镜像 挂载的<code>volumes</code>中对应位置<code>config</code></p>
<p>新建<code>config/postfix-main.cf</code></p>
<p>内容填写</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">message_size_limit = 52428800</span><br></pre></td></tr></table></figure>

<p>默认为 <code>10240000</code> 约<code>10MB</code>  </p>
<p><code>52428800</code> 约 <code>52MB</code></p>
<p>google 的邮件会检查内容</p>
<p>使用GPG加密 就能正常发送了 论加密的重要性</p>
<h2 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h2><p>admin 的 登录 注册 找回密码 基本完成了</p>
<p>使用<code>token</code> 注册 admin 也 完成了</p>
<p>退出时 一般用户与 admin 一起退出 也是很怪的 </p>
<p>不过 一般用户之后会关掉问题不大。</p>
<p>之后就是添加二步验证了~~ admin 账号安全有保证了~~ </p>
<h2 id="以上我去睡了😴😴"><a href="#以上我去睡了😴😴" class="headerlink" title="以上我去睡了😴😴"></a>以上我去睡了😴😴</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>docker</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel 队列的坑</title>
    <url>/2018/07/16/3715e6094b2d/</url>
    <content><![CDATA[<h2 id="laravel-队列的坑"><a href="#laravel-队列的坑" class="headerlink" title="laravel 队列的坑"></a>laravel 队列的坑</h2><h3 id="正确的入坑姿势"><a href="#正确的入坑姿势" class="headerlink" title="正确的入坑姿势"></a>正确的入坑姿势</h3><p>使用<code>laravel horizon</code>的 <code>php artisan horizon</code> 运行 队列。</p>
<p>使用<code>-&gt;onQueue(SendMail)</code>方法指定队列时，<code>Job</code>可以正常的载入，<code>Queue</code>不正常……</p>
<p>判断为<code>Queue</code>问题</p>
<p>使用<code>php artisan queue:work --queue=SendMail,default</code> 时正常显示</p>
<p>判断为<code>laravel horizon</code>问题</p>
<h3 id="一起出坑吧"><a href="#一起出坑吧" class="headerlink" title="一起出坑吧"></a>一起出坑吧</h3><p>在<code>config\horizon</code>中添加<code>Queue</code> 名称就好了~</p>
<p>要注意在<code>local</code> 与 <code>prodution</code>的区别。</p>
<p>没有<code>config\horizon</code>文件？</p>
<p>运行<code>php artisan vendor:publish --provider=&quot;Laravel\Horizon\HorizonServiceProvider&quot;</code></p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="更改redis中存储位置"><a href="#更改redis中存储位置" class="headerlink" title="更改redis中存储位置"></a>更改redis中存储位置</h4><p>当多个web服务一同使用<code>horizon</code>时，</p>
<p>要在<code>.env</code>中设置 <code>HORIZON_PREFIX=horizon:name</code> 区分 不同应用 否则出错。</p>
<p>刚要使用不同的<code>redis</code>数据表时，要在设置<code>config\horizon</code>中的<code>use</code>项，</p>
<p>同时在<code>config\database</code>中<code>redis</code>设置</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;redis&#x27;</span> =&gt; [</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;client&#x27;</span> =&gt; <span class="string">&#x27;predis&#x27;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;default&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;host&#x27;</span> =&gt; env(<span class="string">&#x27;REDIS_HOST&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span> =&gt; env(<span class="string">&#x27;REDIS_PASSWORD&#x27;</span>, <span class="literal">null</span>),</span><br><span class="line">        <span class="string">&#x27;port&#x27;</span> =&gt; env(<span class="string">&#x27;REDIS_PORT&#x27;</span>, <span class="number">6379</span>),</span><br><span class="line">        <span class="string">&#x27;database&#x27;</span> =&gt; <span class="number">1</span>,</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;session&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;host&#x27;</span> =&gt; env(<span class="string">&#x27;REDIS_HOST&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span> =&gt; env(<span class="string">&#x27;REDIS_PASSWORD&#x27;</span>, <span class="literal">null</span>),</span><br><span class="line">        <span class="string">&#x27;port&#x27;</span> =&gt; env(<span class="string">&#x27;REDIS_PORT&#x27;</span>, <span class="number">6379</span>),</span><br><span class="line">        <span class="string">&#x27;database&#x27;</span> =&gt; <span class="number">2</span>,</span><br><span class="line">    ],</span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;queue&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;host&#x27;</span> =&gt; env(<span class="string">&#x27;REDIS_HOST&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;password&#x27;</span> =&gt; env(<span class="string">&#x27;REDIS_PASSWORD&#x27;</span>, <span class="literal">null</span>),</span><br><span class="line">        <span class="string">&#x27;port&#x27;</span> =&gt; env(<span class="string">&#x27;REDIS_PORT&#x27;</span>, <span class="number">6379</span>),</span><br><span class="line">        <span class="string">&#x27;database&#x27;</span> =&gt; <span class="number">3</span>,</span><br><span class="line">    ],</span><br></pre></td></tr></table></figure>

<h4 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">运行</span><br><span class="line">php artisan horizon </span><br><span class="line"></span><br><span class="line">彻底关闭</span><br><span class="line">php artisan horizon:terminate</span><br><span class="line"></span><br><span class="line">暂定</span><br><span class="line">php artisan horizon:pause</span><br><span class="line"></span><br><span class="line">恢复</span><br><span class="line">php artisan horizon:continue</span><br></pre></td></tr></table></figure>

<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>时间走慢点！</title>
    <url>/2018/06/22/4cad3faa85a6/</url>
    <content><![CDATA[<h2 id="日常"><a href="#日常" class="headerlink" title="日常"></a>日常</h2><h3 id="这是粽子节的份"><a href="#这是粽子节的份" class="headerlink" title="这是粽子节的份"></a>这是粽子节的份</h3><p>粽子节了~</p>
<p>为什么想到的是僵尸小美😂</p>
<p>一些事儿突然懂了……</p>
<h3 id="6月22日的份"><a href="#6月22日的份" class="headerlink" title="6月22日的份"></a>6月22日的份</h3><p>单方面利用率高也是够了</p>
<p>知识也并不是免费的</p>
<p>好烦估计就没有下次了</p>
<p>张开口就朋友，兄弟的…… 超恶心……</p>
<p>还有一点小事就半夜2点给人打电话的……</p>
<p>你算老几啊……</p>
<p>还有没有事先说明就向人家家里带人的</p>
<p>有点常识和礼貌会死吗……</p>
<h3 id="梦想的秋叶原"><a href="#梦想的秋叶原" class="headerlink" title="梦想的秋叶原"></a>梦想的秋叶原</h3><p>前几天拆了空气净化器，发现是步进电机的齿轮磨损了</p>
<p>只能换新</p>
<p>型号<code>MSBPC20A20</code> 我朝是弄不到了……</p>
<p><img src="https://i.loli.net/2018/06/22/5b2d08a448e14.jpg" alt="IMG_20180617_184254.png"></p>
<p>估计只有秋叶原了加入购物列表吧…… </p>
<p>某种程度上来说，秋叶原是天堂！！</p>
<h3 id="相机入手考虑"><a href="#相机入手考虑" class="headerlink" title="相机入手考虑"></a>相机入手考虑</h3><p>就易用性来说大法a7r3 比 X1D 好很多…… </p>
<p>莱卡？ 什么时候到到四千万像素，什么时候在说……</p>
<p>有消息说<code>ZEISS Batis 40mm</code> 要出了 完美挂机 手动再见了~~</p>
<p>佳能的17mm移轴 与 <a href="http://www.metabones.com/products/details/MB-EF-E-BT5">转接环</a> 也是必须入手的 谁让我爱照建筑与风景呢 </p>
<p>用移轴拍出到长腿太容易了</p>
<p>三脚架什么的是必须有的吧 HDR 摄像也是非常有趣的</p>
<p><code>ZEISS Batis 2.8/18</code> 也是必备呢</p>
<p><code>ZEISS Batis 1.8/85</code> 与 <code>ZEISS Batis 2.8/135</code> 也遇到喜欢人在考虑吧</p>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>😇预感准确的有点可拍😇</title>
    <url>/2018/07/27/656bda621f3f/</url>
    <content><![CDATA[<h2 id="明天"><a href="#明天" class="headerlink" title="明天"></a>明天</h2><p>明天有人送祝福吗？</p>
<p>不过开心的今天晚上的两个天象~~</p>
<p>超难得的礼物的说~~</p>
<p>订了明天的午餐~~ </p>
<p>特殊服务就算了 没有被围观的勇气</p>
<p>估计会哇的一下哭出来吧 😂😂😂</p>
<p>生日愿望：之后的日子能快心的度过每一天。</p>
<p>嗯 略微有点贪婪呢😜😜</p>
<p>最后的最后</p>
<h1 id="生日快乐"><a href="#生日快乐" class="headerlink" title="生日快乐"></a>生日快乐</h1><hr>
<h2 id="laravel"><a href="#laravel" class="headerlink" title="laravel"></a>laravel</h2><p><code>zircote/swagger-php</code>包升级 <code>laravel 5.5.*</code> 版本下使用不能</p>
<p>更新到<code>5.6.*</code> 详细升级方法点击下方链接</p>
<p><a href="https://keleven.me/living/2018/04/15/blog/">laravel 5.5 升级到 5.6</a></p>
<p>另外 API 文档注释 <code>@OAS</code> 改为 <code>@OA</code> 否则报错！</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>细小的修正</title>
    <url>/2018/07/23/6c6e8c71f963/</url>
    <content><![CDATA[<h2 id="21号的份"><a href="#21号的份" class="headerlink" title="21号的份"></a>21号的份</h2><p>调整文档,并进行一些细节调整</p>
<p>最近对日期 时间非常混乱……</p>
<h2 id="23-号的份"><a href="#23-号的份" class="headerlink" title="23 号的份"></a>23 号的份</h2><p>新手机到了~~ 等了两周~~ 指纹万岁~~</p>
<p>注册美国ID了~~ 日本的也是有的~~</p>
<p>植物根烂了怎么办 铲除重栽</p>
<p>测试了一下 本地化语言 满好用的</p>
<p>注册 验证 找回密码 算是完成了 撒花~~</p>
<p>之后是 2次验证了~~ </p>
<p>程序真无聊呢……</p>
<p>看看最近的新闻 我朝人还真是坚韧呢…… </p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel 日常的坑</title>
    <url>/2018/07/13/d10c50cb4036/</url>
    <content><![CDATA[<h1 id="laravel-horizon-的坑"><a href="#laravel-horizon-的坑" class="headerlink" title="laravel horizon 的坑"></a>laravel horizon 的坑</h1><p>安装<code>laravel horizon</code> 后不能正常的访问</p>
<p>使用<code>la5 opcache:clear</code> 清空页面缓存</p>
<p>之后就正常了…… </p>
<h2 id="通知-与-队列"><a href="#通知-与-队列" class="headerlink" title="通知 与 队列"></a>通知 与 队列</h2><p>任务队列 与 发送通知 掌握 </p>
<p>结合上事件 吼吼吼吼吼~~ 好棒~~</p>
<p>列队用于优化 web 速度 可以 指定要运行的方法</p>
<p>事件 当发生 什么 时 则 运行 什么 </p>
<p>结合 队列使用会更有效率 当然也可以独立使用 </p>
<p>总的来说<code>laravel</code>灵活性很高很高</p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>鼠标从 <code>Microsoft Sculpt</code> 换的了 <code>logitech mx master 2s</code> </p>
<p>手感还是 微软 的好点 罗技的触发有点重…… 不过罗技的功能必须多</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>今天我最大~~</title>
    <url>/2018/07/28/2f0f82c43894/</url>
    <content><![CDATA[<h2 id="生日快乐"><a href="#生日快乐" class="headerlink" title="生日快乐"></a>生日快乐</h2><p>还有18分钟就是 本世纪时间就久的<code>月全食</code> 还有<code>火星大冲</code>~~</p>
<p>嗯 看到了红色的~~</p>
<p><img src="https://i.loli.net/2018/07/28/5b5b7dcbe445a.png" alt="NASA"></p>
<p><img src="https://i.loli.net/2018/07/28/5b5b7f5c2289a.png" alt="屏幕快照 2018-07-28 04.23.16"></p>
<p><a href="https://www.instagram.com/p/BlvpkApgbHZ/?taken-by=natgeotravel">美景哦~</a></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>不写厂家就 不怀疑了？</p>
<p>这根本就是不是想解决问题吧</p>
<p>科技让一些东西越来越透明</p>
<p>却想用老办法掩盖……</p>
<p>恐怕是气数将尽</p>
<p>湾湾不能动哦 会被介入哦</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>我回来了😁</title>
    <url>/2018/08/20/0b53be239bae/</url>
    <content><![CDATA[<h1 id="添加-Instagram"><a href="#添加-Instagram" class="headerlink" title="添加 Instagram"></a>添加 Instagram</h1><p>为<code>blog</code>添加的<a href="https://www.instagram.com/_y.o_o.y_/">Instagram</a>连接 </p>
<p>有兴趣可以点进去看看哦</p>
<h1 id="旅行还是很开心的"><a href="#旅行还是很开心的" class="headerlink" title="旅行还是很开心的"></a>旅行还是很开心的</h1><p>自己逛逛澳门真的很有趣</p>
<p>与不合适的人在一起难免强颜欢笑~~~</p>
<p>莫名的想挑战下 一个人去游乐园 不过东西要精简一下 😁 </p>
<p>在香港吃到了心心念念的<code>一籣</code> 果然不错~ 只是叉烧有点薄……</p>
<p>人文环境 确实 好过大陆</p>
<h1 id="回来要加油了"><a href="#回来要加油了" class="headerlink" title="回来要加油了"></a>回来要加油了</h1><p>局势有点不稳…… 不加油不行呢……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>环保不是说说而已</title>
    <url>/2018/08/08/37a96099f0e4/</url>
    <content><![CDATA[<h2 id="奥运10年"><a href="#奥运10年" class="headerlink" title="奥运10年"></a>奥运10年</h2><p>场馆荒废了 看着心疼</p>
<h2 id="表弟回来了"><a href="#表弟回来了" class="headerlink" title="表弟回来了"></a>表弟回来了</h2><p>表弟回来了 嗯 考上的多大~~</p>
<p>略微的研究了一下公司注册的事儿~~</p>
<p>明天9号 要久违的出去旅行了~~</p>
<p>18号回来~~</p>
<h2 id="来过这里的人"><a href="#来过这里的人" class="headerlink" title="来过这里的人"></a>来过这里的人</h2><p>这是这周的 等的人并没有来</p>
<p>看到某处亮了一下 还是有些期待的</p>
<p><img src="https://i.loli.net/2018/08/08/5b6a9085dc603.png" alt="屏幕快照 2018-08-08 14.39.04"></p>
<p>查了一下真的是我想多了…………</p>
<h2 id="laravel-中的-vuex"><a href="#laravel-中的-vuex" class="headerlink" title="laravel 中的 vuex"></a>laravel 中的 vuex</h2><p>将<code>vuex-i18n</code>部分从<code>app.js</code>移动到了<code>store\index.js</code></p>
<p>目的是确保<code>state</code>中可以看到 <code>i18n</code>的设置</p>
<p>并可以 直接设置<code>locale</code> 变更语言</p>
<p><img src="https://i.loli.net/2018/08/08/5b6a934f001fe.png" alt="屏幕快照 2018-08-08 14.52.15"></p>
<p>如果直接写在<code>app.js</code> 中<code>i18n</code> 就会被覆盖掉 </p>
<p>其他部分就可以按照<code>vuex</code>推荐的结构进行设置</p>
<p>但愿可以在<code>js</code>路上越来越顺手 内心还是充满恐惧……</p>
<h3 id="其他vue-打错"><a href="#其他vue-打错" class="headerlink" title="其他vue 打错"></a>其他vue 打错</h3><p>需要安装<code>vue-template-compiler</code>包</p>
<h2 id="l5-swagger-使用自定义auth登录"><a href="#l5-swagger-使用自定义auth登录" class="headerlink" title="l5-swagger 使用自定义auth登录"></a>l5-swagger 使用自定义auth登录</h2><p>修改<code>config\l5-swagger</code> 中的<code>middleware</code></p>
<p>将<code>auth</code> 修改为<code>auth:admin</code> </p>
<p>注意要对应<code>config\auth</code>中的<code>guards</code></p>
<p>修改后一般用户不能查看<code>api doc</code> </p>
<p><code>admin</code> 用户 登录后可以正常查看</p>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>vue</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>i18n 全球化语言</title>
    <url>/2018/07/30/3ede961417ad/</url>
    <content><![CDATA[<h1 id="i18n-全球化语言"><a href="#i18n-全球化语言" class="headerlink" title="i18n 全球化语言"></a>i18n 全球化语言</h1><p>@lang 与 <code>__(&#39;lange&#39;)</code> 不能在vue中使用</p>
<p>于是找到<code>martinlindhe/laravel-vue-i18n-generator</code>包</p>
<p>不过要注意的 README 有错误</p>
<p>使用<code>vue-i18n</code> 后<code>$t(&#39;lang&#39;)</code> 不能正常渲染 疑似<code>vue</code>的bug</p>
<p><code>vuex-i18n</code> 则正常</p>
<p>修改<code> resources/assets/js/app.js</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;vuex&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> vuexI18n <span class="keyword">from</span> <span class="string">&#x27;vuex-i18n&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> Locales <span class="keyword">from</span> <span class="string">&#x27;./vue-i18n-locales.generated.js&#x27;</span>;</span><br><span class="line"></span><br><span class="line">Vue.use(Vuex);</span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store();</span><br><span class="line">Vue.use(vuexI18n.plugin, store);</span><br><span class="line"></span><br><span class="line">Vue.i18n.add(<span class="string">&#x27;en&#x27;</span>, Locales.en);</span><br><span class="line">Vue.i18n.add(<span class="string">&#x27;zh&#x27;</span>, Locales.zh);</span><br><span class="line"></span><br><span class="line">Vue.i18n.set(<span class="string">&#x27;en&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    store,</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>之后就可以正常的使用<code>$t()</code>了 同时也支持复数形式</p>
<p><a href="https://medium.com/@konafets/localization-with-laravel-and-vuejs-e27068e68ee8">参考地址</a></p>
<p><strong>优点：不用设置后端后再设置前端 使用<code>php artisan vue-i18n:generate</code>可以直接创建或更新<code>vue</code>的语言设置</strong></p>
<h1 id="天朝上邦"><a href="#天朝上邦" class="headerlink" title="天朝上邦"></a>天朝上邦</h1><p>估计汇率1比20是早晚的事儿了</p>
<p>某不可描述的两物必须灭亡</p>
<p>也算死了 账也是要算的 逃不掉的 </p>
<p>准备被人唾弃到世界终结吧</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>vue</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>Update😍😍</title>
    <url>/2018/08/24/e5b382ab5552/</url>
    <content><![CDATA[<h1 id="全球化语言"><a href="#全球化语言" class="headerlink" title="全球化语言"></a>全球化语言</h1><p>将 <code>laravel</code> 返回语言指定 </p>
<p>为库中的 对应语言 并 可以切换到其他语言</p>
<p>直接返回<code>lang</code>行就可以 比如<code>auth.Login</code></p>
<p><code>vue</code>中使用<code>Vue.i18n.translate(auth.Login)</code> 就完成了</p>
<p>主要用来显示对用户的提示信息</p>
<h1 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h1><p>鞋子 和 裙子 绝赞好评 ~~</p>
<p>忘了说  xbox one 的手柄真好用啊~~</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>彩虹~~</title>
    <url>/2018/09/03/145599bd45d3/</url>
    <content><![CDATA[<h2 id="出门看见彩虹了"><a href="#出门看见彩虹了" class="headerlink" title="出门看见彩虹了~~"></a>出门看见彩虹了~~</h2><blockquote class="instagram-media" data-instgrm-captioned data-instgrm-permalink="https://www.instagram.com/p/BnRfC0EnQ0X/?utm_source=ig_embed" data-instgrm-version="9" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:540px; min-width:326px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);"><div style="padding:8px;"> <div style=" background:#F8F8F8; line-height:0; margin-top:40px; padding:50.0% 0; text-align:center; width:100%;"> <div style=" background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAMAAAApWqozAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAMUExURczMzPf399fX1+bm5mzY9AMAAADiSURBVDjLvZXbEsMgCES5/P8/t9FuRVCRmU73JWlzosgSIIZURCjo/ad+EQJJB4Hv8BFt+IDpQoCx1wjOSBFhh2XssxEIYn3ulI/6MNReE07UIWJEv8UEOWDS88LY97kqyTliJKKtuYBbruAyVh5wOHiXmpi5we58Ek028czwyuQdLKPG1Bkb4NnM+VeAnfHqn1k4+GPT6uGQcvu2h2OVuIf/gWUFyy8OWEpdyZSa3aVCqpVoVvzZZ2VTnn2wU8qzVjDDetO90GSy9mVLqtgYSy231MxrY6I2gGqjrTY0L8fxCxfCBbhWrsYYAAAAAElFTkSuQmCC); display:block; height:44px; margin:0 auto -44px; position:relative; top:-22px; width:44px;"></div></div> <p style=" margin:8px 0 0 0; padding:0 4px;"> <a href="https://www.instagram.com/p/BnRfC0EnQ0X/?utm_source=ig_embed" style=" color:#000; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none; word-wrap:break-word;" target="_blank">🌈🌈</a></p> <p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;">@<a href="https://www.instagram.com/_y.o_o.y_/?utm_source=ig_embed" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px;" target="_blank"> _y.o_o.y_</a> 分享的帖子 · <time style=" font-family:Arial,sans-serif; font-size:14px; line-height:17px;" datetime="2018-09-03T17:58:58+00:00">PDT 2018 年 9月 3 日 上午 10:58</time></p></div></blockquote> <script async defer src="//www.instagram.com/embed.js"></script>

<h2 id="集中精神干活了"><a href="#集中精神干活了" class="headerlink" title="集中精神干活了"></a>集中精神干活了</h2><p>添加信息提示，将信息反馈的更加直观</p>
<p>最让人愁的是胜利的判断方式，要最简单不能复杂……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>寒冬？不存在的~~</title>
    <url>/2018/09/01/d62461f9bf54/</url>
    <content><![CDATA[<h2 id="沸沸扬扬"><a href="#沸沸扬扬" class="headerlink" title="沸沸扬扬"></a>沸沸扬扬</h2><p>我朝文件震惊游戏行业，寒冬已至。</p>
<p>错估形势，将我朝当主要市场也是必然吧。</p>
<p>从架起GFW的那天开始，就注定没有未来。</p>
<p>最糟糕的时，境外公司不能对我朝个人付款。</p>
<p>看来HK是一定要再去一次了。</p>
<p>众筹的款项不能入手也是糟糕。</p>
<p>还有企业税加了到35% 贸易战还加企业税 也是666</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>mac的系统盘满了</p>
<p>希望可以在坚持几个月~~</p>
<p>群辉的购入也在计划之中……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>新键盘购入！</title>
    <url>/2018/09/16/edff392abd04/</url>
    <content><![CDATA[<h1 id="11号的份"><a href="#11号的份" class="headerlink" title="11号的份"></a>11号的份</h1><h2 id="新键盘到了"><a href="#新键盘到了" class="headerlink" title="新键盘到了"></a>新键盘到了</h2><p>果然用习惯了<code>Microsoft Sculpt Ergonomic Desktop</code>套装后</p>
<p>正常的布局的键盘难以适应…… 虽然新键盘的手感不错……</p>
<p>还是有点局促……</p>
<h1 id="16号的份"><a href="#16号的份" class="headerlink" title="16号的份"></a>16号的份</h1><h2 id="增加信息提示"><a href="#增加信息提示" class="headerlink" title="增加信息提示"></a>增加信息提示</h2><p>增加信息提示功能，将返回信息推入 <code>vuex</code></p>
<p>并可以同步移除。</p>
<p><img src="https://i.loli.net/2018/09/17/5b9ead3d4abbe.png"></p>
<p>##其他</p>
<p><code>git</code>居然有中文版了！</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>Vuex技能点获得 (づ｡◕‿‿◕｡)づ</title>
    <url>/2018/09/08/11138abd09f2/</url>
    <content><![CDATA[<h1 id="随手"><a href="#随手" class="headerlink" title="随手"></a>随手</h1><p>项目复杂没有规划就是容易混乱呢……</p>
<p>看来<code>vuex</code>的例子的代码，完全掌握了~~ </p>
<p>还发现了其中的小bug 😁 </p>
<p><code>vuex</code>的主要用途</p>
<p>将多页的网页变为一页，同时方便多平台</p>
<h1 id="附言"><a href="#附言" class="headerlink" title="附言"></a>附言</h1><p>问题被问了呢</p>
<p>想看礼服啊~ </p>
<p>o(<em>////▽////</em>)q</p>
<p>所以主驾位上的人呢 </p>
<p>比起指针的更喜欢电子的 </p>
<p>虽然很好看 </p>
<p>上面的指纹 </p>
<p>嗯……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>记录</title>
    <url>/2018/09/28/8c7a4b964b00/</url>
    <content><![CDATA[<h1 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h1><p>工作指南</p>
<ol>
<li>Code Message UI 部分处理</li>
<li>权限手动调整UI</li>
<li>权限系统的全局化，将权限处理加入列队</li>
<li>特定返回信息的响应</li>
<li>二步验证 UI 部分</li>
<li>语言全面本地化 【vuex-i18n】</li>
</ol>
<h2 id="code-message"><a href="#code-message" class="headerlink" title="code message"></a>code message</h2><p>工作详解</p>
<ol>
<li>将全局信息显示功能独立</li>
<li>需要为信息增加分页显示</li>
<li>搜索结果是否使用通用部分显示</li>
<li>识别2fa验证信息并相应【全局模组】</li>
<li>新建信息页面 【需要验证2FA】</li>
<li>编辑信息页面 【需要验证2FA】</li>
<li>删除信息页面 【需要验证2FA】</li>
</ol>
<p>好在<code>2FA</code>与 <code>code message</code>可以使用代码手动添加，如果没先做后端真是难以想象，估计是灾难或者加班地狱吧</p>
<p>反而是语言本地化容易的，可以在休息时完成。</p>
<p>其他 貌似2FA的优先度比较高，但是信息提示也是非常重要</p>
<p>对功能分组编写非常重要！一人并行写是比较容易混乱 笔记是一定要的</p>
<p>好处是发现问题可以及时修正，也要考虑之后的多人协作的效率问题</p>
<p>多是交给组长处理吧</p>
<h2 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h2><p><code>bootstrap 4.*</code>是没有图标的 需要自己找</p>
<p>使用<code>fontawesome</code> 解决了</p>
<h2 id="23号的份"><a href="#23号的份" class="headerlink" title="23号的份"></a>23号的份</h2><p><code>Code Message</code>资源获取、更新、删除部分的UI完成。 调用与测试正常</p>
<p>想着将<code>laravel</code> 自带的UI 使用 <code>vue</code> 重构 最严重的问题还是在本地化语言上。</p>
<p>只能将使用的分离，其他的再做打算 😭</p>
<p>基本上这种感觉</p>
<p>分页显示也是有做的~</p>
<p><img src="https://i.loli.net/2018/09/24/5ba7f4b0cbf57.png"></p>
<h2 id="26号的份"><a href="#26号的份" class="headerlink" title="26号的份"></a>26号的份</h2><p><code>code message</code> 部分基本完成，之后要调整<code>code</code>并修正一些细小的地方。</p>
<p>感到前端与后端的耦合度很高，这样之后是大麻烦，要不要全部使用<code>vuex</code>呢……</p>
<p>之后 先处理<code>2fa</code>与验证吧，<code>2fa</code> 比如是全局的…… 不跨域使用<code>oauth</code>的意义不大</p>
<p>不过使用<code>oauth</code>容易啊~~ 啊啊啊啊啊~~~</p>
<h2 id="28号的份"><a href="#28号的份" class="headerlink" title="28号的份"></a>28号的份</h2><p>添加<code>2fa ui</code>了，没什么创造性的劳动…… </p>
<p>使<code>button:hover</code>文字与样式 随鼠标产生变化</p>
<p>注意定义<code>css</code> 否则效果不会有变化 </p>
<p>如果使用 <code>vuex-i18n</code> 可以使用语言行替代 对应位置文字</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-outline-success&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">v-on:mouseenter</span>=<span class="string">&quot;button = &#x27;in button&#x27;&quot;</span> </span></span><br><span class="line"><span class="tag"><span class="attr">v-on:mouseleave</span>=<span class="string">&quot;button = &#x27;out button&#x27;&quot;</span>&gt;</span></span><br><span class="line">&#123;&#123; button &#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">data</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> &#123;</span><br><span class="line">		<span class="attr">button</span>: <span class="string">&#x27;out button&#x27;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.btn-outline-success</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn-outline-success</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:disabled</span>)<span class="selector-pseudo">:not</span>(<span class="selector-class">.disabled</span>)<span class="selector-pseudo">:active</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.btn-outline-success</span><span class="selector-pseudo">:not</span>(<span class="selector-pseudo">:disabled</span>)<span class="selector-pseudo">:not</span>(<span class="selector-class">.disabled</span>)<span class="selector-pseudo">:focus</span>&#123;</span><br><span class="line">    <span class="attribute">box-shadow</span>: none;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>vue</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>失败了………………😭</title>
    <url>/2018/09/04/98b725173d09/</url>
    <content><![CDATA[<h1 id="套餐有点烦"><a href="#套餐有点烦" class="headerlink" title="套餐有点烦"></a>套餐有点烦</h1><p>办宽带一定要开卡就没人管一管吗……</p>
<p>无奈更换旧手机的SIM卡槽 没错让我弄坏了…… </p>
<p>在此之前都不敢卸下SIM卡也神奇……</p>
<p>元件直接淘宝还是很方便的 </p>
<p>放在其他国家是难以想象…… 不过人家也没有这样恶心的套餐……</p>
<h1 id="SIM卡槽更换失败"><a href="#SIM卡槽更换失败" class="headerlink" title="SIM卡槽更换失败"></a>SIM卡槽更换失败</h1><p>SIM 卡槽更换失败 😭 😭 粘上后盖但是没上螺丝…… 心塞……</p>
<p>果然没有风枪是不行呢…… 找个风枪加入清单好了……</p>
<p><a href="http://www.hakko.com/japan/products/hakko_fr702.html">HAKKO FR-702</a></p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>作息时间混乱，啊啊啊 好想正常一点啊……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>11号的份</title>
    <url>/2018/10/14/1a3ae4879e9b/</url>
    <content><![CDATA[<h1 id="11号的份"><a href="#11号的份" class="headerlink" title="11号的份"></a>11号的份</h1><h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><p>将特定 信息通知 推送到指定队列</p>
<p>修改<code>horizon</code> 后</p>
<p>可以使用</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$user</span>-&gt;notify((<span class="keyword">new</span> SendEmail(<span class="variable">$Token</span>))-&gt;onQueue(<span class="string">&#x27;mail&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Notification</span>;</span><br><span class="line">Notification::send(<span class="variable">$user</span>, (<span class="keyword">new</span> SendEmail(<span class="variable">$Token</span>))-&gt;onQueue(<span class="string">&#x27;mail&#x27;</span>));</span><br></pre></td></tr></table></figure>
<h2 id="roles"><a href="#roles" class="headerlink" title="roles"></a>roles</h2><p>需要注意<code>guard</code>对应</p>
<p><code>view</code>与<code>models</code> 要注意同步</p>
<p>在<code>blade</code> 中使用时</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@role(<span class="string">&#x27;role&#x27;</span> , <span class="string">&#x27;guard&#x27;</span>)</span><br><span class="line">something</span><br><span class="line">@endrole</span><br></pre></td></tr></table></figure>

<p>在路由中使用时</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::group([<span class="string">&#x27;middleware&#x27;</span> =&gt; [<span class="string">&#x27;auth:admin&#x27;</span> , <span class="string">&#x27;role:admin&#x27;</span>]], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>也可以在控制器中使用</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;middleware([<span class="string">&#x27;role:admin&#x27;</span> , <span class="string">&#x27;auth:admin&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="14号的份"><a href="#14号的份" class="headerlink" title="14号的份"></a>14号的份</h1><h2 id="find-与-where-的坑"><a href="#find-与-where-的坑" class="headerlink" title="find 与 where 的坑"></a>find 与 where 的坑</h2><p><code>find</code> 不能准确 查找到对应条目</p>
<p><code>where</code> 则可以，之后只有有意识的替换<code>find</code></p>
<p><code>register</code>的后端调整完成了~~~</p>
<p>大概这种感觉</p>
<p><img src="https://i.loli.net/2018/10/14/5bc33df12e03a.png" alt="屏幕快照 2018-10-14 20.58.44"></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>vuex 提交后清空很重要！</title>
    <url>/2018/09/19/f3e6bdb8ea57/</url>
    <content><![CDATA[<h1 id="18号的份"><a href="#18号的份" class="headerlink" title="18号的份"></a>18号的份</h1><p>使用<code>vuex</code> 推送信息时 会让之前的消息一起发送变动</p>
<p>使用<code>vue</code> 工具发现 <code>state</code> 的数据被覆盖</p>
<p>使用手动输入框 更新 发现<code>state</code>并没有更新只是视图上的变化</p>
<p>最后发现为 提交<code>active</code>后没有清空数据导致……</p>
<p>之后需要分离信息提示部分 并使后端返回数据规整化</p>
<p>并能使用固定数字代码 进行快速返回</p>
<p><code>admin</code> 安全部分要完工了~~ 撒花~~ </p>
<h1 id="20号的份"><a href="#20号的份" class="headerlink" title="20号的份"></a>20号的份</h1><p>使<code>code</code>编码换用于信息的快速返回</p>
<p>当然也可以使用对应信息语句直接返回</p>
<h2 id="vue-的坑"><a href="#vue-的坑" class="headerlink" title="vue 的坑"></a>vue 的坑</h2><p><code>vue</code> 的<code>v-for</code>一定要定义<code>key</code>不然会出现渲染不正常 数据正常</p>
<p>重要的是并不会提示错误！！</p>
<h2 id="laravel-的坑"><a href="#laravel-的坑" class="headerlink" title="laravel 的坑"></a>laravel 的坑</h2><p>使用<code>laravel markdown email</code>时，不能独立定义<code>header</code>与<code>footer</code></p>
<p>使用<code>@component(&#39;mail::button&#39;)</code>时，前方要清除空白。 否则不能正常渲染</p>
<p>要支持<code>header</code>与<code>footer</code> ，将<code>@component(&#39;mail::message&#39;)</code> 改为 <code>@component(&#39;mail::layout&#39;)</code></p>
<p>下方是修改后的例子，也可以直接复制<code>message.blade.php</code>进行修改</p>
<p>找不到<code>message.blade.php</code>时 运行<code>php artisan vendor:publish --tag=laravel-mail</code></p>
<p>之后可以在<code>vendor/mail/markdown</code>下找到对应文件。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">@component(<span class="string">&#x27;mail::layout&#x27;</span>)</span><br><span class="line"></span><br><span class="line">@slot(<span class="string">&#x27;header&#x27;</span>)</span><br><span class="line">@component(<span class="string">&#x27;mail::header&#x27;</span>, [<span class="string">&#x27;url&#x27;</span> =&gt; config(<span class="string">&#x27;app.url&#x27;</span>)])</span><br><span class="line">header</span><br><span class="line">@endcomponent</span><br><span class="line">@endslot</span><br><span class="line"></span><br><span class="line"><span class="comment"># Introduction</span></span><br><span class="line">The body of your message.</span><br><span class="line"></span><br><span class="line">@component(<span class="string">&#x27;mail::button&#x27;</span>, [<span class="string">&#x27;url&#x27;</span> =&gt; <span class="variable">$url</span>])</span><br><span class="line">button</span><br><span class="line">@endcomponent</span><br><span class="line"></span><br><span class="line">Thanks,&lt;br&gt;</span><br><span class="line"></span><br><span class="line">@slot(<span class="string">&#x27;footer&#x27;</span>)</span><br><span class="line">@component(<span class="string">&#x27;mail::footer&#x27;</span>)</span><br><span class="line">© footer</span><br><span class="line">@endcomponent</span><br><span class="line">@endslot</span><br><span class="line">@endcomponent</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>vue</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>10号的份</title>
    <url>/2018/10/10/1ecc1c4f85f5/</url>
    <content><![CDATA[<h2 id="lavavel-valet"><a href="#lavavel-valet" class="headerlink" title="lavavel valet"></a>lavavel valet</h2><p><code>valet share</code> 在TLS的情况下会返回<code>301</code> </p>
<p>可以确定为<code>valet v2.1.1</code> 的 BUG</p>
<p>可以先<code>valet unsecure</code> 再 <code>valet share</code> 关闭<code>TLS</code> 和裸奔没区别 可以用来进行暂时测试</p>
<p>汇率已经到<code>7.5</code>了……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 postman 进行 post</title>
    <url>/2018/10/21/ed452465eeac/</url>
    <content><![CDATA[<h1 id="使用-postman-进行-post"><a href="#使用-postman-进行-post" class="headerlink" title="使用 postman 进行 post"></a>使用 postman 进行 post</h1><p>使用<code>postman</code> 直接 <code>post</code> 的方法</p>
<p><code>laravel</code> 本身有<code>CSRF</code> 直接使用<code>post</code> 、 <code>put</code> 等等会被阻断</p>
<p>找到一个可以解决办法</p>
<h2 id="postman-chrome-插件版本"><a href="#postman-chrome-插件版本" class="headerlink" title="postman chrome 插件版本"></a>postman chrome 插件版本</h2><p>新建一个<code>environment</code> 并切换到新建，右上⚙位置</p>
<p>找一个<code>get</code>请求 在<code>Tests</code>标签下输入 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">var xsrfCookie = postman.getResponseCookie(&quot;XSRF-TOKEN&quot;);</span><br><span class="line">postman.setEnvironmentVariable(&quot;XSRF-TOKEN&quot;, xsrfCookie.value);</span><br></pre></td></tr></table></figure>

<p><code>&#123;&#123;XSRF-TOKEN&#125;&#125;</code> 对应该的是第二行要注意下。</p>
<p>用于获取<code>XSRF-TOKEN</code>的值。</p>
<p>查看<code>environment</code>中 <code>XSRF-TOKEN</code> 是否被正确传入。右上👁位置</p>
<p>确认后在<code>post</code> 的<code>Headers</code> 中添加</p>
<p><code>X-XSRF-TOKEN : &#123;&#123;XSRF-TOKEN&#125;&#125;</code> </p>
<p>之后就可以正常提交<code>post</code>了</p>
<p><strong>注意：laravel XSRF-TOKEN 有时效性 注意更新</strong></p>
<p>当<code>XSRF-TOKEN</code> 中有特殊字符，例如<code>%</code>时，<code>laravel X-XSRF-TOKEN</code> 验证会失败</p>
<p>主要是为<code>postman</code> 对<code>XSRF-TOKEN</code>识别有问题，桌面版本没有这个问题</p>
<h2 id="postman-桌面版"><a href="#postman-桌面版" class="headerlink" title="postman 桌面版"></a>postman 桌面版</h2><p>同上<code>Tests</code>标签可以写成 </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pm.environment.set(&quot;xsrf-token&quot;, decodeURIComponent(pm.cookies.get(&quot;XSRF-TOKEN&quot;)))</span><br></pre></td></tr></table></figure>

<p>使用<code>laravel valet</code> 时，<code>postman</code>不能正确访问域名……</p>
<p>原因<code>valet</code>产生的<code>SSL</code>证书，所以被阻挡，手动关闭后正常使用</p>
<p>要关闭的位置</p>
<p><code>settings</code> -&gt; <code>SSL certificate verifcation</code> -&gt; <code>off</code> </p>
<p>之后就可以正常使用了</p>
<p>使用<code>valet</code>时 <code>link</code> 与 <code>park</code> 混用会报错！ </p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
        <tag>postman</tag>
      </tags>
  </entry>
  <entry>
    <title>2FA 基本完成了</title>
    <url>/2018/10/04/4b85cbc96c6a/</url>
    <content><![CDATA[<h1 id="2FA-基本完成了"><a href="#2FA-基本完成了" class="headerlink" title="2FA 基本完成了"></a>2FA 基本完成了</h1><p>后端还缺权限的判断，与<code>code message</code>预制编码</p>
<p>前端缺特殊<code>code message</code>的代码响应 指的是2FA的强制验证</p>
<p>之后要加入批量导入功能 否则会累死~~</p>
<h2 id="laravel-model-的坑"><a href="#laravel-model-的坑" class="headerlink" title="laravel model 的坑"></a>laravel model 的坑</h2><p>使用<code>get()</code>去取到的数据是<code>array</code> 而不是<code>object</code> </p>
<p>可以手动转换 也可以直接使用 根据需求决定</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>几天的份</title>
    <url>/2018/10/18/561eef1a5920/</url>
    <content><![CDATA[<h1 id="15号的份"><a href="#15号的份" class="headerlink" title="15号的份"></a>15号的份</h1><h2 id="染黑了"><a href="#染黑了" class="headerlink" title="染黑了"></a>染黑了</h2><p>自己都感觉到内心在向着无底的黑暗靠近</p>
<p>新键盘并没有人体工程学的好用</p>
<p>估计以后都只会选择人体工程学的了</p>
<h2 id="开始处理权限了"><a href="#开始处理权限了" class="headerlink" title="开始处理权限了"></a>开始处理权限了</h2><p><code>admin</code>的基本部分快做完了</p>
<p>之后是一般用户数据了 </p>
<p>按照计划的一样进行扩展 </p>
<p>说句自满的话</p>
<p><code>它不仅仅是一个游戏</code></p>
<hr>
<h1 id="16号的份"><a href="#16号的份" class="headerlink" title="16号的份"></a>16号的份</h1><p><code>v-for</code> 不能放在顶级标签上，会报错！</p>
<p>更新了一下<code>docker</code>镜像</p>
<p><code>role</code> 部分也完成了…… </p>
<p>现在又累又饿……</p>
<hr>
<h2 id="18号的份"><a href="#18号的份" class="headerlink" title="18号的份"></a>18号的份</h2><p><code>role</code> 部分修正完成~~</p>
<p>过程中确实补增了许多东西</p>
<p>到验证了~~</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>vue</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>几天份</title>
    <url>/2018/10/25/f09cb601e16d/</url>
    <content><![CDATA[<h1 id="23号的份"><a href="#23号的份" class="headerlink" title="23号的份"></a>23号的份</h1><h2 id="vue-当前页刷新"><a href="#vue-当前页刷新" class="headerlink" title="vue 当前页刷新"></a>vue 当前页刷新</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">location.reload()</span><br></pre></td></tr></table></figure>

<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>3合一验证 完成了 </p>
<p>后端做成服务提供者了</p>
<p>用起来容易了不少</p>
<p>admin 部分要收尾了 😊</p>
<hr>
<h1 id="24号的份"><a href="#24号的份" class="headerlink" title="24号的份"></a>24号的份</h1><p>为一些请求添加二步验证</p>
<p>之后是定时服务 与 logs </p>
<p>还有 <code>admin</code> 基本信息页面 </p>
<p>游戏模式有一次眉目了</p>
<hr>
<h1 id="25号的份"><a href="#25号的份" class="headerlink" title="25号的份"></a>25号的份</h1><h2 id="laravel下错误返回分类"><a href="#laravel下错误返回分类" class="headerlink" title="laravel下错误返回分类"></a>laravel下错误返回分类</h2><p>在一些情况下想要对不同的请求做不同错误的返回</p>
<p>可以使用<code>$request-&gt;ajax()</code>来识别<code>ajax</code>请求</p>
<p>对于自定义错误返回非常有用</p>
<p>更新<code>node</code> 后包报错，直接删除<code>node_modules</code> </p>
<p>之后<code>npm install</code> 可以解决大多数问题</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>智力上线🙂</title>
    <url>/2018/11/01/3c53d87556d7/</url>
    <content><![CDATA[<h1 id="智力上线"><a href="#智力上线" class="headerlink" title="智力上线"></a>智力上线</h1><h2 id="27号的份"><a href="#27号的份" class="headerlink" title="27号的份"></a>27号的份</h2><p>机械劳动久了，智商就下线了</p>
<p>可以快速解决问题，要重复好多次也是蛮蠢的</p>
<p>可是一直进行无创造劳动吧 智商也就慢慢休眠了_(:з」∠)_</p>
<p>之后美名其曰代码可读性提高了，</p>
<p>不过函数用多了一样不容易读，啊啊啊 好矛盾啊</p>
<hr>
<h2 id="29日的份"><a href="#29日的份" class="headerlink" title="29日的份"></a>29日的份</h2><p>定时自动调整权限完成了~~</p>
<p>加上之前的权限方便能安心了了~~ 暂时~~</p>
<p>程序什么的 是要不断改进的</p>
<hr>
<h2 id="11月1号的份"><a href="#11月1号的份" class="headerlink" title="11月1号的份"></a>11月1号的份</h2><p>一小步与一大步，真的只是差了一点点，现在看看方便了不少。</p>
<p>几天前 明白了一些事儿 很意外的 也是很有意思</p>
<p><code>providers</code> 定义成了 <code>Facades</code> 用起来更方便了</p>
<p>新建<code>class</code> 下面这样写 之后要注意到<code>config\app.php</code>中绑定</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Facades</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Facade</span>;  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomService</span> <span class="keyword">extends</span> <span class="title">Facade</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFacadeAccessor</span>(<span class="params"></span>) </span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;CustomService&#x27;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>十月的第一天</title>
    <url>/2018/10/01/c989278581d5/</url>
    <content><![CDATA[<h1 id="渐渐的上手了"><a href="#渐渐的上手了" class="headerlink" title="渐渐的上手了"></a>渐渐的上手了</h1><p><code>laravel</code> 的错误信息 截取成功 </p>
<p>标准化信息返回问题不大 方法是使用</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;something&#x27;</span>;</span><br><span class="line">&#125;<span class="keyword">catch</span>(\<span class="built_in">Exception</span> <span class="variable">$e</span>)&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以在<code>App\Exceptions\Handler</code> 的<code>render</code>中做截取</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span>(<span class="variable">$exception</span>-&gt;getMessage())&#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="string">&#x27;someMessage&#x27;</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;someMessage&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再次感受到先做后端的重要性！！</p>
<h2 id="laravel-model-的一些坑"><a href="#laravel-model-的一些坑" class="headerlink" title="laravel model 的一些坑"></a>laravel model 的一些坑</h2><p>如果直接使用<code>find()</code>后使用<code>delete()</code>有返回<code>null</code>的可能性</p>
<p>可以使用<code>where(&#39;id&#39; , $id)</code>后使用<code>delete()</code> 就可以避免<code>null</code>的问题</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>vue</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>logs完成了</title>
    <url>/2018/11/11/c6976683fcd5/</url>
    <content><![CDATA[<h1 id="7号的部分"><a href="#7号的部分" class="headerlink" title="7号的部分"></a>7号的部分</h1><h2 id="logs部分快完成了"><a href="#logs部分快完成了" class="headerlink" title="logs部分快完成了"></a>logs部分快完成了</h2><p>要不要使用<code>Laravel Scout</code> 是个问题，优势是用</p>
<p>之后就是玩家部分了，后端眼看着要搞定了</p>
<p>超开心<del>(≧▽≦)/</del>啦啦啦</p>
<p>目标是12月14日前完成全部后台部分</p>
<p>19年3月先做出<code>Dome</code>之后的修补是不可避免的</p>
<p>希望众筹能顺利啊~~ 再去香港估计也要提上日程了~~</p>
<p>想着要不要将游戏部分开源呢？一个人毕竟是有极限的……</p>
<p>有些东西也是可遇不可求的……</p>
<h1 id="8号的部分"><a href="#8号的部分" class="headerlink" title="8号的部分"></a>8号的部分</h1><p><code>Laravel Homestead</code> 配置了一天</p>
<p>最大的问题还是墙</p>
<p>解决方案</p>
<p>安装<code>vagrant-proxyconf</code>插</p>
<p>在<code>Vagrantfile</code> 中添加</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">Vagrant.configure(<span class="string">&quot;2&quot;</span>) <span class="keyword">do</span> <span class="params">|config|</span></span><br><span class="line">  <span class="keyword">if</span> Vagrant.has_plugin?(<span class="string">&quot;vagrant-proxyconf&quot;</span>)</span><br><span class="line">    config.proxy.http     = <span class="string">&quot;http://192.168.1.4:8004&quot;</span></span><br><span class="line">    config.proxy.https    = <span class="string">&quot;http://192.168.1.4:8004&quot;</span></span><br><span class="line">    config.proxy.no_proxy = <span class="string">&quot;localhost,127.0.0.1,.example.com&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>要在注意的是<code>127.0.0.1</code>指的是虚拟机本身</p>
<p>之后在本机或者路由中开启对应端口就完成了</p>
<h1 id="9号的份"><a href="#9号的份" class="headerlink" title="9号的份"></a>9号的份</h1><p><code>windows</code> 代理自动载入导致 大部分程序不能联网</p>
<p>最后重启<code>SPE</code>问题解决……</p>
<h1 id="10号的份"><a href="#10号的份" class="headerlink" title="10号的份"></a>10号的份</h1><p>密码重置完成了 预感有时就的很准</p>
<h1 id="11月11的份"><a href="#11月11的份" class="headerlink" title="11月11的份"></a>11月11的份</h1><p>出门绊倒了 有个小伤口 问题不大 </p>
<p>心得 合脚的鞋子超级重要！和现在的鞋子相性太差 </p>
<p>舒适度不高 走远了超辛苦 </p>
<p>语言切换完成了~~</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>快递到了！</title>
    <url>/2018/11/20/53e4f08fe391/</url>
    <content><![CDATA[<h1 id="14日的份"><a href="#14日的份" class="headerlink" title="14日的份"></a>14日的份</h1><h2 id="双11的快递到了"><a href="#双11的快递到了" class="headerlink" title="双11的快递到了"></a>双11的快递到了</h2><p>小型超声波清洗机，和手动洗眼镜说再见了~~</p>
<h2 id="code定义中"><a href="#code定义中" class="headerlink" title="code定义中"></a>code定义中</h2><p>定义<code>code</code>将返回标准化，部件代码进行有效简化。</p>
<h1 id="20日的份"><a href="#20日的份" class="headerlink" title="20日的份"></a>20日的份</h1><p>admin 管理 部分 完成了 </p>
<p>之后就是玩家部分了</p>
<p>周末通过 奥德赛 与 暗影</p>
<p>不不得不说 奥德赛 是历代最优 </p>
<p>暗影的手柄操作有点奇怪 </p>
<p>机器果然到时候了 九年了……</p>
<p>在坚持坚持吧</p>
<p>HDR 要有对应的显示器才可以 </p>
<p>目前看 LG 34WK95U-W 不错 </p>
<p>EIZO 就等到稳定下来再说了 </p>
<p>wacom 在数绘方面是优秀的 可是不支持HDR </p>
<p>不过 贴图 还停留在一般RGB时代 </p>
<p>如果上升一步，想想都可怕，一般用户与使用HDR的用户 </p>
<p>体验的会是两个不同的世界，当然计算量也巨大的。</p>
<p>服务端渲染随着带宽的扩大，终究是要到来的。</p>
<p>头号玩家 描述世界 也只是时间问题</p>
<p>技术层面上 一定使用的是 服务端渲染</p>
<p>用户设备就不一定相同了</p>
<p>随手看了下5G标准，需要更多基站设备…… 稳定性恐怕不高</p>
<p>大法耳罩老化了 意外发现梁也断了…… </p>
<p>希望合金梁可以顺利到手！！耳罩的更换倒是有眉目了~</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>user 使用uuid</title>
    <url>/2018/11/25/9300d512c265/</url>
    <content><![CDATA[<h1 id="25日的份"><a href="#25日的份" class="headerlink" title="25日的份"></a>25日的份</h1><p>将<code>laravel</code> 默认的<code>id</code> 改为 <code>uuid</code> 的方法，以及<code>passport</code> 使用<code>uuid</code></p>
<h2 id="user-部分"><a href="#user-部分" class="headerlink" title="user 部分"></a>user 部分</h2><p>当不使用传统<code>id</code>时，</p>
<p>先在模型中写入 关闭默认排序</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="variable">$incrementing</span> = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<p>再<code>migrate</code>中修改</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>为</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$table</span>-&gt;uuid(<span class="string">&#x27;id&#x27;</span>)-&gt;primary();</span><br></pre></td></tr></table></figure>

<p>随后运行<code>la5 migrate</code></p>
<p>新建<code>App\Traits\Uuid</code></p>
<p>内容如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Traits</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Str</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">trait</span> <span class="title">Uuid</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Boot function from laravel.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::boot();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">static</span>::creating(<span class="function"><span class="keyword">function</span> (<span class="params"><span class="variable">$model</span></span>) </span>&#123;</span><br><span class="line">            <span class="variable">$model</span>-&gt;&#123;<span class="variable">$model</span>-&gt;getKeyName()&#125; = (<span class="keyword">string</span>) Str::orderedUuid();</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>随后在模型中添加</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Traits</span>\<span class="title">Uuid</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Uuid</span>;</span><br></pre></td></tr></table></figure>

<p>之后使用<code>laravel</code>自带的<code>auth</code>可以正常注册了。密码找回功能也可以使用。</p>
<p><a href="https://medium.com/@steveazz/setting-up-uuids-in-laravel-5-552412db2088">参考文档</a></p>
<h2 id="passport-部分"><a href="#passport-部分" class="headerlink" title="passport 部分"></a>passport 部分</h2><p>当 <code>passport</code>安装完成后</p>
<p>执行<code>php artisan vendor:publish --tag=passport-migrations</code></p>
<p>复制迁移到<code>migrate</code>目录</p>
<p>修改<code>CreateOauthClientsTable</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"><span class="variable">$table</span>-&gt;integer(<span class="string">&#x27;user_id&#x27;</span>)-&gt;index()-&gt;nullable();</span><br><span class="line"><span class="comment">// 改为</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$table</span>-&gt;uuid(<span class="string">&#x27;id&#x27;</span>)-&gt;primary();</span><br><span class="line"><span class="variable">$table</span>-&gt;uuid(<span class="string">&#x27;user_id&#x27;</span>)-&gt;index()-&gt;nullable();</span><br></pre></td></tr></table></figure>
<p>其他迁移将<code>client_id</code>与<code>user_id</code> 改为使用<code>uuid</code></p>
<p><code>App\Providers\AppServiceProvider</code>中引入部分添加</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Laravel</span>\<span class="title">Passport</span>\<span class="title">Client</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Str</span>;</span><br></pre></td></tr></table></figure>


<p><code>boot()</code>部分添加</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Client::creating(<span class="function"><span class="keyword">function</span> (<span class="params">Client <span class="variable">$client</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$client</span>-&gt;incrementing = <span class="literal">false</span>;</span><br><span class="line">    <span class="variable">$client</span>-&gt;id = (<span class="keyword">string</span>) Str::orderedUuid();</span><br><span class="line">&#125;);</span><br><span class="line">Client::retrieved(<span class="function"><span class="keyword">function</span> (<span class="params">Client <span class="variable">$client</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$client</span>-&gt;incrementing = <span class="literal">false</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>register()</code> 部分添加</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Passport::ignoreMigrations();</span><br></pre></td></tr></table></figure>

<p>其他部分按照文档即可正常使用。</p>
<p><a href="https://mlo.io/blog/2018/08/17/laravel-passport-uuid/">参考文档</a></p>
<h2 id="user-路径修改"><a href="#user-路径修改" class="headerlink" title="user 路径修改"></a>user 路径修改</h2><p>在<code>App\Http\Controllers\Auth\RegisterController</code>中修改</p>
<p>在<code>config</code>中的<code>providers</code>修改到对应路径  之后可以正常使用</p>
<h2 id="laravel-包开发"><a href="#laravel-包开发" class="headerlink" title="laravel 包开发"></a>laravel 包开发</h2><p>包的开发非常有利于后期的维护，同时也可以有效的分配工作任务，对未来的团队工作有极大的优势。</p>
<p>主要是功能混在一起，找起来超级烦。</p>
<p>有必要将独立的功能分散出去。</p>
<p><a href="https://laravel-news.com/developing-laravel-packages-with-local-composer-dependencies">参考地址 1</a><br><a href="https://laraveldaily.com/how-to-create-a-laravel-5-package-in-10-easy-steps/">参考地址 2</a></p>
<p>需要说明的是 <code>namespace</code>与<code>autoload</code>超级重要</p>
<h2 id="2019年10月11日-更新"><a href="#2019年10月11日-更新" class="headerlink" title="2019年10月11日 更新"></a>2019年10月11日 更新</h2><p><code>Ramsey\Uuid\Exception\UnsatisfiedDependencyException</code> 错误。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer require &quot;moontoast/math&quot;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>链接</title>
    <url>/2018/12/06/d25a33ab6947/</url>
    <content><![CDATA[<h1 id="链接构建中"><a href="#链接构建中" class="headerlink" title="链接构建中"></a>链接构建中</h1><p>远程管理构建中，主要目的是<code>token</code>请求的自动化。</p>
<p>当使用大量<code>token</code>细化权限时</p>
<p>手动请求、更新、选择<code>token</code>将是地狱模式了    </p>
<h1 id="composer-包管理"><a href="#composer-包管理" class="headerlink" title="composer 包管理"></a>composer 包管理</h1><p>当使用自定义包时<code>dev-master</code>版本不能正常载入的情况下</p>
<p>在<code>composer.json</code>中添加</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;minimum-stability&quot;</span>: <span class="string">&quot;dev&quot;</span>,</span><br><span class="line"><span class="string">&quot;prefer-stable&quot;</span>: <span class="literal">true</span>,</span><br></pre></td></tr></table></figure>

<p>同时要指定路径,如果有多个包,需要分别指定,</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">   <span class="string">&quot;repositories&quot;</span>: &#123;</span><br><span class="line">	<span class="attr">&quot;pack&quot;</span>: &#123;</span><br><span class="line">	    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;path&quot;</span>,</span><br><span class="line">	    <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;../packages/packname/pack&quot;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样自定义包就可以载入了</p>
<p>其他包则使用稳定版本</p>
<h2 id="cURL-error-60-SSL-certificate-problem"><a href="#cURL-error-60-SSL-certificate-problem" class="headerlink" title="cURL error 60: SSL certificate problem"></a>cURL error 60: SSL certificate problem</h2><p><a href="https://github.com/laravel/valet/pull/515">参考资料</a></p>
<p>推断为证书不能正确加载，在<code>php.info</code>中指定路径同样无效。</p>
<p>直接使用<code>laravel valet</code>的公钥访问有效</p>
<figure class="highlight zsh"><table><tr><td class="code"><pre><span class="line">curl https://game.test/ --cacert ~/.config/valet/CA/LaravelValetCASelfSigned.pem</span><br></pre></td></tr></table></figure>

<h2 id="laravel-scout"><a href="#laravel-scout" class="headerlink" title="laravel/scout"></a>laravel/scout</h2><p>安装<code>laravel/scout</code></p>
<p>使用时遇到<code>Class &#39;AlgoliaSearch\Version&#39; not found</code></p>
<p>原因<code>laravel/scout</code> 不支持 <code>algoliasearch-client-php: ^2.0</code> 改为<code>algoliasearch-client-php: ^1.27</code></p>
<p><a href="https://github.com/laravel/scout/issues/328">参考资料</a></p>
<p>从速度看<code>scout</code> 没有从内存搜索快，这也是必然吧。</p>
<p>使用第三方搜索也有数据泄露的风险。不过重写驱动也是要命……</p>
<p><code>scout</code> 还没想到需要使用的地方……</p>
<p>比如 搜 文档 更新 什么的……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>分包了！！</title>
    <url>/2018/12/03/cda002c07d4f/</url>
    <content><![CDATA[<h1 id="厄运驱散"><a href="#厄运驱散" class="headerlink" title="厄运驱散"></a>厄运驱散</h1><p>最近不顺利的程度超级高，驱散！驱散！驱散！</p>
<p>还有文件莫名丢失，注意力不能集中，超级烦啊！啊！啊！</p>
<p>还有倒霉会出现征兆…… 也是……</p>
<h1 id="php-版本的坑"><a href="#php-版本的坑" class="headerlink" title="php 版本的坑"></a>php 版本的坑</h1><p>更新后 不能识别 <code>tls</code> </p>
<p>推断 更新后对<code>tls</code> 产生变化，暂时关闭<code>tls</code>使用 <code>http</code></p>
<h2 id="果然"><a href="#果然" class="headerlink" title="果然"></a>果然</h2><p>后台没写好就写前端什么的，效率不高呢……</p>
<p>看来要规划一下了…… </p>
<p>在<code>laravel</code> 模型中使用 </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$casts</span> = [</span><br><span class="line">    <span class="string">&#x27;scopes&#x27;</span> =&gt; <span class="string">&#x27;array&#x27;</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>当然也可以定义其他类型</p>
<p>可以使查询项返回数组，前提是存入的也是数组 </p>
<p>文档在<code>5.0</code>版 这就比较坑了</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>日常</title>
    <url>/2018/12/18/6f3f1d86b672/</url>
    <content><![CDATA[<h1 id="日常"><a href="#日常" class="headerlink" title="日常"></a>日常</h1><p>砖酱人脸识别速度不高呢</p>
<p>换了钢化膜 解锁速度起飞~~ 都是膜的错</p>
<h1 id="vue-的坑"><a href="#vue-的坑" class="headerlink" title="vue 的坑"></a>vue 的坑</h1><p>使用组件时<code>props</code> </p>
<p>如果直接复制数组，刚数组变化时<code>props</code> 中的值也会变化。</p>
<p>这就非常不利于对数据进行调整了。</p>
<p>使用</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">JSON</span>.parse(<span class="built_in">JSON</span>.stringify(<span class="built_in">this</span>.name.array))</span><br></pre></td></tr></table></figure>

<p>这样用解决了<code>array</code> 数据被改变的问题</p>
<p>如果<code>props</code> 中没有嵌套 <code>array</code> 或 <code>object</code> </p>
<p>可以使用</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Object</span>.assign(&#123;&#125;, <span class="built_in">this</span>.name)</span><br></pre></td></tr></table></figure>

<h1 id="一对多-的坑"><a href="#一对多-的坑" class="headerlink" title="一对多 的坑"></a>一对多 的坑</h1><p><code>laravel</code>一对多写入时 并不如想的容易</p>
<p>改用多对多轻松解决了</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>连接部分完成了</title>
    <url>/2018/12/24/d27d2fdade3e/</url>
    <content><![CDATA[<h1 id="连接部分完成了"><a href="#连接部分完成了" class="headerlink" title="连接部分完成了"></a>连接部分完成了</h1><p>进度有点慢……</p>
<p>主要是心情问题……</p>
<p>耳机断梁，零件遥遥无期，</p>
<p>环境噪音很烦，新版的暂时还不想入</p>
<p>￥ 2400 RMB 并不廉价……</p>
<p>问题是旧的硬件并没有坏，只是外壳坏了…… </p>
<p>对于喜爱事物的执著也是……</p>
<p>心塞…… </p>
<h1 id="看好了一款新键盘"><a href="#看好了一款新键盘" class="headerlink" title="看好了一款新键盘"></a>看好了一款新键盘</h1><p>键盘的优点是可以快速更改轴体，同时有<code>RGB</code>功能</p>
<p>写在这里留用</p>
<p><a href="https://www.massdrop.com/buy/massdrop-ctrl-mechanical-keyboard">Massdrop CTRL Mechanical Keyboard</a></p>
<p>鼠标 就选定 <code>罗技g903</code>无线套装了</p>
<p>标准键位的的键盘也渐渐适应了</p>
<p>用久了 手指还是会疼……</p>
<p>难道是我打开方式不对？</p>
<p>雷蛇到好处之一是能与飞利浦hue灯光联动，环境效果极佳</p>
<p>新机的<code>CPU</code>预计使用新出的<code>28</code>。</p>
<p>如果使用双<code>CUP</code>之后搬运就大问题了，用电量也是一方便~</p>
<p>更新时，墙内的电线也要一起更新，想想就头痛。</p>
<p>墙里原有的线质量并不好…… </p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>最近想的东西也很多，心里也很乱，完全不能平静</p>
<p>除了手头上的事情外都是模糊的</p>
<p>说实话挺恐怖的……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel json 的坑</title>
    <url>/2019/01/20/b14a68a66ed6/</url>
    <content><![CDATA[<h1 id="15-号的份"><a href="#15-号的份" class="headerlink" title="15 号的份"></a>15 号的份</h1><h2 id="laravel-创建-json"><a href="#laravel-创建-json" class="headerlink" title="laravel 创建 json"></a>laravel 创建 json</h2><p>使用laravel 创建 json 时</p>
<p>可以使用 <code>json_encode()</code> 不过</p>
<p>当输入如下时， </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$test</span> = [</span><br><span class="line">	[	</span><br><span class="line">		<span class="string">&#x27;test&#x27;</span> =&gt; <span class="string">&#x27;test&#x27;</span></span><br><span class="line">	]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>返回的为数组包裹，可以使用<code>$request[0][&#39;test&#39;]</code>获取数据</p>
<p>当输入如下时，</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$test</span> = [</span><br><span class="line">	<span class="string">&#x27;test&#x27;</span> =&gt; [</span><br><span class="line">		<span class="string">&#x27;test&#x27;</span> =&gt; <span class="string">&#x27;test&#x27;</span></span><br><span class="line">	]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>返回的为对象包裹，可以使用<code>$request-&gt;input(&#39;test.test&#39;)</code>获取数据</p>
<p>在进行大量数据传入时，注意使用对应的方法进行循环写入。</p>
<hr>
<h1 id="20号的份"><a href="#20号的份" class="headerlink" title="20号的份"></a>20号的份</h1><h2 id="laravel-外部请求方法"><a href="#laravel-外部请求方法" class="headerlink" title="laravel 外部请求方法"></a>laravel 外部请求方法</h2><p>使用<code>GuzzleHttp</code> 进行请求时</p>
<p>当使用<code>json</code>时 需要添加<code>Content-Type</code>为 <code>application/json</code>,数据写在<code>body</code>下</p>
<p>如果使用传统方式去除<code>Content-Type</code>, 使用<code>form_params</code>请求。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;headers&#x27;</span> =&gt; [</span><br><span class="line">		<span class="string">&#x27;Authorization&#x27;</span> =&gt; <span class="string">&#x27;Bearer &#x27;</span>.<span class="string">&#x27;toekn&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;Content-Type&#x27;</span> =&gt; <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">],</span><br><span class="line"><span class="string">&#x27;body&#x27;</span> =&gt; json_encode(<span class="variable">$JsonData</span>),</span><br></pre></td></tr></table></figure>

<h2 id="laravel-json-的坑"><a href="#laravel-json-的坑" class="headerlink" title="laravel json 的坑"></a>laravel json 的坑</h2><p>当使用<code>json</code>请求时，<code>Request</code> 可以自动解析<code>json</code>为数组</p>
<p>也可以使用<code>$request-&gt;input()</code> </p>
<p>最坑的是刚使用<code>return</code> 时会自动使用<code>json</code>……</p>
<p>使用<code>json_decode()</code> 也会返回<code>json</code> , 可是实际上转换了，使用<code>dd()</code>发现是数组……</p>
<p>这时请求端在使用一次<code>json_decode()</code>就一定会出错。</p>
<p>所以在请求端<code>json_decode()</code>一次就好。</p>
<p>大致上可以推测 请求端发送的为独立数据，使用<code>GuzzleHttp</code>获取的返回为<code>object</code> 所以需要 <code>json_decode()</code>。</p>
<p><code>vue</code> 不能跨域也是…… 现在还是先做出来，之后再完善的好。</p>
<p>原因暂时没有找到估计时<code>laravel passport</code>的锅</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>好想……</title>
    <url>/2018/11/03/7ede88b26335/</url>
    <content><![CDATA[<h1 id="好想什么呢"><a href="#好想什么呢" class="headerlink" title="好想什么呢"></a>好想什么呢</h1><p>来猜猜吧</p>
<h2 id="logs-部分"><a href="#logs-部分" class="headerlink" title="logs 部分"></a>logs 部分</h2><p>结合<code>laravel logs</code>重构</p>
<p>在<code>laravel logs</code>基础上将<code>logs</code>存入数据库</p>
<p>先下<code>config\logging</code>中添加<code>channels</code></p>
<p>如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;channels&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;stack&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;stack&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;channels&#x27;</span> =&gt; [<span class="string">&#x27;mysql&#x27;</span>],</span><br><span class="line">    ],</span><br><span class="line">	<span class="string">&#x27;mysql&#x27;</span> =&gt; [</span><br><span class="line">	    <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;custom&#x27;</span>,</span><br><span class="line">	    <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">	    <span class="string">&#x27;via&#x27;</span> =&gt; App\Logging\MySQLLogger::class,</span><br><span class="line">	    <span class="string">&#x27;level&#x27;</span> =&gt; <span class="string">&#x27;debug&#x27;</span>,</span><br><span class="line">	],</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>新建<code>MySQLLogger</code> 这部分可以查看<code>laravel 文档</code></p>
<p><code>Logger</code> 的 <code>name</code> 不能正常传入，问题暂时没找到根源</p>
<p>于是进行手动传入</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Logging</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Monolog</span>\<span class="title">Logger</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Logging</span>\<span class="title">AdminLogsHandler</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySQLLogger</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$config</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Logger(</span><br><span class="line">            env(<span class="string">&#x27;APP_NAME&#x27;</span>),</span><br><span class="line">            [</span><br><span class="line">                <span class="keyword">new</span> LogsHandler(</span><br><span class="line">                    <span class="variable">$config</span>[<span class="string">&#x27;level&#x27;</span>],</span><br><span class="line">                    <span class="variable">$config</span>[<span class="string">&#x27;name&#x27;</span>]</span><br><span class="line">                )</span><br><span class="line">            ]</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后是<code>AdminLogsHandler</code> 用于将<code>logs</code>提交到数据库</p>
<p>这里也可以复写其他方法，可以自行查看<code>Monolog\Logger</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Logging</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Monolog</span>\<span class="title">Logger</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Monolog</span>\<span class="title">Handler</span>\<span class="title">AbstractProcessingHandler</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Models</span>\<span class="title">Logs</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AdminLogsHandler</span> <span class="keyword">extends</span> <span class="title">AbstractProcessingHandler</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$level</span>, <span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::__construct(<span class="variable">$level</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$record</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Logs::create([</span><br><span class="line">            <span class="string">&#x27;channel&#x27;</span> =&gt; <span class="keyword">$this</span>-&gt;name,</span><br><span class="line">            <span class="string">&#x27;message&#x27;</span> =&gt; <span class="variable">$record</span>[<span class="string">&#x27;message&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>   =&gt; <span class="variable">$record</span>[<span class="string">&#x27;level_name&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;context&#x27;</span> =&gt; <span class="variable">$record</span>[<span class="string">&#x27;context&#x27;</span>]</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>App\Models\Logs</code> 注意要添加批量写入</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$fillable</span> = [</span><br><span class="line">    <span class="string">&#x27;channel&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;message&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;level&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;context&#x27;</span></span><br><span class="line">];</span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$casts</span> = [</span><br><span class="line">    <span class="string">&#x27;context&#x27;</span> =&gt; <span class="string">&#x27;array&#x27;</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<p>数据迁移如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$table</span>-&gt;increments(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"><span class="variable">$table</span>-&gt;string(<span class="string">&#x27;channel&#x27;</span>)-&gt;index();</span><br><span class="line"><span class="variable">$table</span>-&gt;enum(<span class="string">&#x27;level&#x27;</span>, [</span><br><span class="line">    <span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;INFO&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;NOTICE&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;WARNING&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ERROR&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;CRITICAL&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;ALERT&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;EMERGENCY&#x27;</span></span><br><span class="line">])-&gt;default(<span class="string">&#x27;INFO&#x27;</span>);</span><br><span class="line"><span class="variable">$table</span>-&gt;longText(<span class="string">&#x27;message&#x27;</span>);</span><br><span class="line"><span class="variable">$table</span>-&gt;text(<span class="string">&#x27;context&#x27;</span>);</span><br><span class="line"><span class="variable">$table</span>-&gt;timestamps();</span><br></pre></td></tr></table></figure>

<p>之后可以使用</p>
<p><code>Log::info(&#39;message&#39; , [&#39;id&#39; =&gt; $id])</code></p>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>自动化的路上</title>
    <url>/2018/12/12/c868aae8238d/</url>
    <content><![CDATA[<h1 id="自动化的路上"><a href="#自动化的路上" class="headerlink" title="自动化的路上"></a>自动化的路上</h1><p>现在多写一点，之后使用时就容易一点。</p>
<p>真正运行起来工作量会是现在的几倍吧，也不知道能不能支撑下去……</p>
<h1 id="打劫"><a href="#打劫" class="headerlink" title="打劫"></a>打劫</h1><p>4个小鬼 来打劫火花塞上的贵金属 也是醉了……</p>
<p>求钟馗大神传授驱鬼之法！</p>
<p>和 小区门口私设停车位收费类似 原始 无规则</p>
<p>我朝 需要 改变的东西真的太都了</p>
<h1 id="砖酱"><a href="#砖酱" class="headerlink" title="砖酱"></a>砖酱</h1><p><code>iphone xr</code> 入手 上了<code>UGA</code>的壳</p>
<p>之后硬度感人，估计超过板砖。</p>
<p>所以之后爱称<code>砖酱</code></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>新年了~</title>
    <url>/2019/01/01/ca1af6666271/</url>
    <content><![CDATA[<h1 id="新年快乐！"><a href="#新年快乐！" class="headerlink" title="新年快乐！"></a>新年快乐！</h1><h1 id="这一年学到的东西很多很多"><a href="#这一年学到的东西很多很多" class="headerlink" title="这一年学到的东西很多很多"></a>这一年学到的东西很多很多</h1><p>看到 <code>Blender</code> 还是那么反人类也是安心了</p>
<p>不过新功能确实引起了兴趣，能使建模速度快不少，姑且是一个好消息。</p>
<p>多少还是知道经络不通的，偶尔疼一条也是酸爽……</p>
<p>2018年 有70次更新呢~ </p>
<p>blog 使用率 还是不错的 :-D</p>
<h1 id="刺客信条-奥德赛"><a href="#刺客信条-奥德赛" class="headerlink" title="刺客信条:奥德赛"></a>刺客信条:奥德赛</h1><p><code>steam</code> 圣诞活动入手了，<code>bug</code>有点多，游戏体验不错。</p>
<p>啊啊啊，机器真的要更新了。希望能顺利更新啊~</p>
<p>试轴器也看好了~</p>
<p>准备的超级充分啊~~</p>
<h1 id="数据请求"><a href="#数据请求" class="headerlink" title="数据请求"></a>数据请求</h1><p><code>logs</code> 保存使用列队了，速度上升，在可以接受的范围之内了。 </p>
<p>使用<code>api</code>对数据操作操作完成了。</p>
<p>之后麻烦的是数据的显示部分了。</p>
<p>啊啊啊~ 要做的<code>UI</code> 好多啊~ </p>
<p>要整理安排下……</p>
<p>一个部分完成后，总是不知道下面要做什么</p>
<p>主要是自己操纵的东西有点大……</p>
<p>批量导入要上线呢……</p>
<p>使用<code>codemessage</code> 更新权限部分还没有完成先记录下来</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>日常的坑</title>
    <url>/2019/01/08/f9ae28711efb/</url>
    <content><![CDATA[<h1 id="6号的份"><a href="#6号的份" class="headerlink" title="6号的份"></a>6号的份</h1><h2 id="laravel-队列的坑"><a href="#laravel-队列的坑" class="headerlink" title="laravel 队列的坑"></a>laravel 队列的坑</h2><p><code>laravel job</code> 的初始函数中不能使用 嵌套 型数组 </p>
<p>否则 会 报错 <code>Serialization of &#39;Closure&#39; is not allowed</code></p>
<p>优先程度很高，而且不容易发现。是在<code>logs</code>不能正常写入的时候发现的</p>
<p>官方说最好与 <code>models</code> 一起使用</p>
<p>将 原有数组 重构 勉强 解决了 </p>
<p>之后是批量 写入 与 写入数据 自动验证了 当然<code>api</code> 进行。</p>
<p>操作最简化是目的~~</p>
<p>以上 </p>
<p>PS: 情况越来越严峻 </p>
<hr>
<h1 id="8号的份"><a href="#8号的份" class="headerlink" title="8号的份"></a>8号的份</h1><h2 id="api-token-自动化进程过半"><a href="#api-token-自动化进程过半" class="headerlink" title="api token 自动化进程过半"></a>api token 自动化进程过半</h2><p>管理员操作部分终于要完成了~~</p>
<p>安静果然是最重要的！</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>系统升级了~ 走过的一些坑!</title>
    <url>/2019/01/27/c5cefb058ec1/</url>
    <content><![CDATA[<h1 id="黑苹果-部分"><a href="#黑苹果-部分" class="headerlink" title="黑苹果 部分"></a>黑苹果 部分</h1><p>正常安装就好 <code>config.plist </code> 是重点</p>
<p><code>tonymacx86</code> 带的<code>clover</code> 安装完成后不能正常引导。</p>
<p>更新到最新的版可以解决。</p>
<p><code>clover configurator</code> 一定要装很有用。</p>
<p><code>Acpi</code>中选择 <code>AddDTGP</code> 、 <code>FixDarwin</code> 、 <code>AddMCHC</code> 、 <code>FakeLPC</code> 、<code>FixSBUS</code> 、 <code>FixUSB</code></p>
<p><code>Boot</code> 中选择<code>dart=0</code> 显卡是<code>gtx 760</code> 驱动自带</p>
<p><code>Kernel</code> 中</p>
<ul>
<li>不要手贱关<code>Apple RTC</code>!</li>
<li>不要手贱关<code>Apple RTC</code>!</li>
<li>不要手贱关<code>Apple RTC</code>!</li>
</ul>
<p>关闭结果就是 每次开机进入系统时 bios 设置被重置。</p>
<p>没有其他恢复手段非常可怕！</p>
<p>声卡使用 <a href="https://github.com/toleda/audio_CloverALC">audio_CloverALC</a> 自动注入 完全正常</p>
<h2 id="读取ntfs"><a href="#读取ntfs" class="headerlink" title="读取ntfs"></a>读取ntfs</h2><p>10.13可以使用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">brew cask install osxfuse</span><br><span class="line">brew install ntfs-3g</span><br></pre></td></tr></table></figure>

<p>重启到<code>recovery mode</code> 关闭系统保护</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">csrutil disable</span><br></pre></td></tr></table></figure>

<p>重启到正常模式， 使<code>NTFS</code>分区可以自动挂载</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo mv /sbin/mount_ntfs /sbin/mount_ntfs.original</span><br><span class="line">sudo ln -s /usr/local/sbin/mount_ntfs /sbin/mount_ntfs</span><br></pre></td></tr></table></figure>

<p>重启到<code>recovery mode</code> 开启系统保护</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">csrutil enable</span><br></pre></td></tr></table></figure>

<h2 id="显示全部隐藏文件"><a href="#显示全部隐藏文件" class="headerlink" title="显示全部隐藏文件"></a>显示全部隐藏文件</h2><p>显示隐藏文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">defaults write com.apple.finder AppleShowAllFiles -boolean true ; killall Finder</span><br></pre></td></tr></table></figure>

<p>不显示隐藏文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">defaults write com.apple.finder AppleShowAllFiles -boolean false ; killall Finder</span><br></pre></td></tr></table></figure>

<h2 id="创建快捷方式"><a href="#创建快捷方式" class="headerlink" title="创建快捷方式"></a>创建快捷方式</h2><p><kbd>option</kbd> + <kbd>command</kbd></p>
<h1 id="laravel-部分"><a href="#laravel-部分" class="headerlink" title="laravel 部分"></a>laravel 部分</h1><h2 id="valet-全部网站-it-work"><a href="#valet-全部网站-it-work" class="headerlink" title="valet 全部网站 it work"></a>valet 全部网站 it work</h2><p>新装<code>valet</code>后，访问自定域名网站全部<code>it&#39;s work</code></p>
<p>原因<code>apachectl</code>占用<code>80</code>端口</p>
<p>解决方法</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apachectl -k stop</span><br><span class="line">sudo apachectl stop</span><br><span class="line">valet restart</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
        <tag>mac os</tag>
      </tags>
  </entry>
  <entry>
    <title>有点烦！</title>
    <url>/2019/01/31/ec50a47d20ab/</url>
    <content><![CDATA[<h1 id="29号的份"><a href="#29号的份" class="headerlink" title="29号的份"></a>29号的份</h1><h2 id="黑苹果"><a href="#黑苹果" class="headerlink" title="黑苹果"></a>黑苹果</h2><p>从 <code>os</code> 切回 <code>win</code> 出现 显卡与usb硬件卡 问题</p>
<p>其中 <code>GPU</code> 工作占用率 异常高</p>
<p>推测是<code>Intel ICH10</code> 芯片的问题</p>
<p>只能放弃 <code>10.13</code> 继续使用 <code>10.11</code> 新年后希望能换新机。</p>
<p>本应该尝试重新安装，可是有点烦了，暂时搁置吧……</p>
<p><code>10.11</code> 变慢也是一个大问题……</p>
<p>这该如何是好</p>
<h1 id="生活"><a href="#生活" class="headerlink" title="生活"></a>生活</h1><p>新的净水滤芯 不能安装到 水壶上, 新款比旧款高5mm。</p>
<p>导致漏水，定了新壶，还不知道，能否正常使用。 </p>
<hr>
<h2 id="30号的份"><a href="#30号的份" class="headerlink" title="30号的份"></a>30号的份</h2><p>重装了勉强可以正常使用了~~ </p>
<p>芯片问题也解决了 开心~~ </p>
<p><a href="https://www.insanelymac.com/forum/files/file/815-appleahciportkext/">参考文档</a></p>
<p>可以直接在四叶草中添加,对应版本为<code>AppleAHCIPort v329</code> 不需要下载页面上的文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AppleAHCIPort</span><br><span class="line">4585F60F 95C289C8 83E0FE66 85C9780F 84D2750B</span><br><span class="line">89C883E0 FE6685C9 0F98C141 08CC9090 9090750B </span><br><span class="line">Fix IO Error AppleAHCIPort</span><br><span class="line"></span><br><span class="line">AppleAHCIPort</span><br><span class="line">89C82540 6002003D 40200000 750C81E1 BF7FFFFF 898B5101 0000</span><br><span class="line">90909090 90909090 90909090 90909090 90909090 90909090 9090</span><br><span class="line">hot-plug AppleAHCIPort</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>mac os</tag>
      </tags>
  </entry>
  <entry>
    <title>己亥年快乐~</title>
    <url>/2019/02/07/701dd63f1025/</url>
    <content><![CDATA[<h1 id="己亥年快乐"><a href="#己亥年快乐" class="headerlink" title="己亥年快乐~"></a>己亥年快乐~</h1><p>虽然晚了一点</p>
<p>4号网络太慢，索性开了谷歌云，费用好贵！</p>
<p>估计用过了赠送的额度就不会再使用了！</p>
<p>没有梯子一些服务的速度会慢100倍，一点都不夸张。</p>
<p>6号 早上的梦点神奇呢~ </p>
<h1 id="新机器在路上"><a href="#新机器在路上" class="headerlink" title="新机器在路上"></a>新机器在路上</h1><p><code>valet</code> 的 <code>https</code> 问题还是没有解决……</p>
<p>过年期间太懈怠了……</p>
<h1 id="以上-再次-新年快乐"><a href="#以上-再次-新年快乐" class="headerlink" title="以上 再次 新年快乐"></a>以上 再次 新年快乐</h1>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>一些记录</title>
    <url>/2019/02/10/53cecc0aae03/</url>
    <content><![CDATA[<h1 id="2月9日"><a href="#2月9日" class="headerlink" title="2月9日"></a>2月9日</h1><h2 id="一些记录"><a href="#一些记录" class="headerlink" title="一些记录"></a>一些记录</h2><p>控制部分暂时本地化，之后开一个服务器也是必然。</p>
<p>时间早晚的问题，最重要的是稳定。</p>
<hr>
<h1 id="2月10日"><a href="#2月10日" class="headerlink" title="2月10日"></a>2月10日</h1><h2 id="yubikey-otp-修正"><a href="#yubikey-otp-修正" class="headerlink" title="yubikey otp 修正"></a>yubikey otp 修正</h2><p>更新<code>bitbeans/yubikey</code> 到最新，<code>yubikey</code>官方关闭了<code>http</code>访问。</p>
<p>之后验证功能正常<code>yubikey</code>的验证速度上没有<code>google 2FA</code>快，也并不是墙的问题。</p>
<p>在<code>php 7.3</code> 版本下 <code>HTTPS_VERIFY</code> 无要求。</p>
<p>在<code>php 7.2</code> 版本下 <code>HTTPS_VERIFY</code> 需要设置为<code>false</code> 可以正常使用。</p>
<h2 id="修正Https访问"><a href="#修正Https访问" class="headerlink" title="修正Https访问"></a>修正<code>Https</code>访问</h2><p>修正不能使用<code>https</code>的问题。</p>
<p><code>php 7.3</code> 版本下 <code>la5 opcache:status</code> 出现 <code>SSL certificate problem: unable to get local issuer certificate</code></p>
<p>使用<code>php --ini</code> 确认<code>php.ini</code> 位置后添加 </p>
<p><code>&#123;name&#125;</code>为当前用户 用户名</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">curl.cainfo = <span class="string">&quot;/Users/&#123;name&#125;/.config/valet/CA/LaravelValetCASelfSigned.pem&quot;</span></span><br></pre></td></tr></table></figure>

<p>在<code>php 7.3</code>版本下 会出现<code>cURL error 77</code></p>
<p>切换到<code>php 7.2</code> 后功能正常。</p>
<h2 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>日常</title>
    <url>/2019/02/28/b24f28260382/</url>
    <content><![CDATA[<h1 id="19日"><a href="#19日" class="headerlink" title="19日"></a>19日</h1><p>顺利升级到了<code>Mojave</code>~~</p>
<p>用起来还是不错的~</p>
<hr>
<h1 id="23日"><a href="#23日" class="headerlink" title="23日"></a>23日</h1><p>调整风扇位置改善散热</p>
<p>改水冷的方案深入心中……</p>
<p>现在的东西连螺丝的质量都严重下降……</p>
<p>稍微拧一拧就花了……</p>
<p>要是上扭力起子估计是秒蹦……</p>
<p>还有某游戏带私货也是……</p>
<p>天朝反应也是有趣…… 上行下效</p>
<hr>
<h1 id="28日"><a href="#28日" class="headerlink" title="28日"></a>28日</h1><p><code>Mojave</code>睡眠有问题，暂时没找到解决办法。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>日常</title>
    <url>/2019/03/08/dca556203448/</url>
    <content><![CDATA[<h1 id="终于入手了卡尺"><a href="#终于入手了卡尺" class="headerlink" title="终于入手了卡尺"></a>终于入手了卡尺</h1><p>多少次要量尺寸找不到合适的工具</p>
<p>肉眼观察多少有一些不准确</p>
<p>有的时候差 1mm ，也是装不上的。</p>
<p>再加上一些奇怪的地方不是很好测量</p>
<p>终于还是入手了~</p>
<h1 id="分区格式"><a href="#分区格式" class="headerlink" title="分区格式"></a>分区格式</h1><p><code>mac</code> 对 <code>ntfs</code> 分区向来都不友好</p>
<p>索性都转换为ExFAT一劳永逸</p>
<p>移动数据用了一天……</p>
<p>果然换固态要提上日程</p>
<p>预估3块<code>860 pro 4T</code> 组<code>RAID5</code></p>
<p>当然速度是<code>960 pro</code>的一半吧。</p>
<p>如果只装<code>win10</code>开机5s之内是没问题的。</p>
<p><code>macbook pro</code> 果然还是要考虑的。</p>
<h1 id="水冷"><a href="#水冷" class="headerlink" title="水冷"></a>水冷</h1><p>测量机箱，感觉安装水冷机箱不一定能装下……</p>
<h1 id="税你妹"><a href="#税你妹" class="headerlink" title="税你妹"></a>税你妹</h1><p>收你妹的房产税！</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>vue 上传</title>
    <url>/2019/03/04/194ca9a90cc4/</url>
    <content><![CDATA[<h1 id="vue-上传文件"><a href="#vue-上传文件" class="headerlink" title="vue 上传文件"></a>vue 上传文件</h1><h2 id="在vue中确认上传的文件"><a href="#在vue中确认上传的文件" class="headerlink" title="在vue中确认上传的文件"></a>在vue中确认上传的文件</h2><p><code>input</code>标签中设置<code>ref</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;FileUp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;custom-file-input&quot;</span> <span class="attr">id</span>=<span class="string">&quot;customFile&quot;</span> @<span class="attr">change</span>=<span class="string">&quot;FileUpload&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">&quot;custom-file-label&quot;</span> <span class="attr">for</span>=<span class="string">&quot;customFile&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FileUpload() &#123;</span><br><span class="line">	if (!this.$refs.FileUp.files.length) &#123;</span><br><span class="line">		this.upform.upfile = &#x27;&#x27;</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		this.upform.upfile = this.$refs.FileUp.files[0]</span><br><span class="line">		this.upform.name = this.$refs.FileUp.files[0].name</span><br><span class="line">	&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>随后文件可以正常上传。</p>
<h2 id="自动获取文件名"><a href="#自动获取文件名" class="headerlink" title="自动获取文件名"></a>自动获取文件名</h2><p><code>bootstrap 4</code>中自动载入文件名需要使用<code>bs-custom-file-input</code>包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">npm install bs-custom-file-input --save</span><br></pre></td></tr></table></figure>

<p>vue 中使用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mounted() &#123;</span><br><span class="line">	this.getFileName()</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">methods: &#123;</span><br><span class="line">	getFileName() &#123;</span><br><span class="line">		$(&#x27;.custom-file-input&#x27;).on(&#x27;change&#x27;, function() &#123;</span><br><span class="line">			let fileName = $(this).val().split(&#x27;\\&#x27;).pop();</span><br><span class="line">			$(this).siblings(&#x27;.custom-file-label&#x27;).addClass(&#x27;selected&#x27;).html(fileName);</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后再选择文件后，<code>input</code>便签可以自动显示文件名。</p>
<h2 id="axios-中上传文件方法"><a href="#axios-中上传文件方法" class="headerlink" title="axios 中上传文件方法"></a>axios 中上传文件方法</h2><p>上传文件时，需要<code>headers</code>为<code>multipart/form-data</code>。</p>
<p>注意请求时使用<code>formData</code>不能使用<code>form</code></p>
<p><code>formData</code> 中数据使用<code>append()</code>传入</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">formData.append(&#x27;file&#x27;, this.upform.upfile)</span><br></pre></td></tr></table></figure>

<p>注意<code>laravel</code>中数据名称对应</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">axios.post(&#x27;/game/json&#x27; , formData ,</span><br><span class="line">&#123;</span><br><span class="line">	headers: &#123;</span><br><span class="line">		&#x27;Content-Type&#x27;: &#x27;multipart/form-data&#x27;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;).then( response =&gt; &#123;</span><br><span class="line">		console.log(response.data)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>受风 好疼！</title>
    <url>/2019/03/12/44487db42931/</url>
    <content><![CDATA[<h1 id="疼"><a href="#疼" class="headerlink" title="疼"></a>疼</h1><p>肌肉受风…… 一动就疼…… 不想动…… 不想动……</p>
<p>不过与胆结石的疼比起来也没什么。略微不适而已……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>cURL error 60</title>
    <url>/2019/02/03/49481b59e548/</url>
    <content><![CDATA[<h1 id="cURL-error-60-问题依旧"><a href="#cURL-error-60-问题依旧" class="headerlink" title="cURL error 60 问题依旧"></a>cURL error 60 问题依旧</h1><p>升级完系统继续踩坑…… 我也是…… </p>
<p>就好的方法安装时使用<code>dev-master</code> 版本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer global require laravel/valet dev-master</span><br></pre></td></tr></table></figure>

<h1 id="服务器流量超了"><a href="#服务器流量超了" class="headerlink" title="服务器流量超了"></a>服务器流量超了</h1><p>啊啊 慢死了 什么都连不上怎么干活啊！！</p>
<h1 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h1>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>mac os</tag>
      </tags>
  </entry>
  <entry>
    <title>不知道</title>
    <url>/2019/04/01/4d71f3404495/</url>
    <content><![CDATA[<h1 id="不知道"><a href="#不知道" class="headerlink" title="不知道"></a>不知道</h1><p>不知道……</p>
<h1 id="随手"><a href="#随手" class="headerlink" title="随手"></a>随手</h1><p>直播很火…… 录屏很无聊……</p>
<p>这么想让人围观 去现场岂不是更好吗</p>
<p>比赛中有人在地图中钓鱼也是豁达 </p>
<p>总之算一个彩蛋吧</p>
<p>制作道具的唯一性很重要 大家都拿着类似东西看起来就很无聊</p>
<p>反正不能刺激到我的欲望</p>
<p>重点是角色 道具 地图 </p>
<p>道具的核心是平衡</p>
<p>角色的核心是自定义</p>
<p>地图的核心是变化</p>
<p>游戏模式确定了</p>
<p>社交部分反而比较麻烦</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>日常</title>
    <url>/2019/04/07/b57083237038/</url>
    <content><![CDATA[<h1 id="github-效率感人"><a href="#github-效率感人" class="headerlink" title="github 效率感人"></a>github 效率感人</h1><p>提交申请后3天后得到回复</p>
<p>验证<code>token</code> 是3天前提交的</p>
<p>然后就没有然后了……</p>
<h1 id="mac-更新"><a href="#mac-更新" class="headerlink" title="mac 更新"></a>mac 更新</h1><p>每次更新mac 就像是在赌博一样…… 讨厌……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>新机器装好了~</title>
    <url>/2019/02/16/4134a17dfa32/</url>
    <content><![CDATA[<h1 id="新机器装好了"><a href="#新机器装好了" class="headerlink" title="新机器装好了~"></a>新机器装好了~</h1><p>折腾了三天，终于装好了~</p>
<p><code>vega 64</code> 满载的声音有点大。</p>
<p>先装<code>High Sierra</code>成功的几率比较大。</p>
<p><a href="https://www.tonymacx86.com/threads/success-asus-rog-maximus-hero-xi-i9-9900k-gtx-1070.267236/">参考地址1</a></p>
<p><a href="https://www.tonymacx86.com/threads/storks-myhero-ii-build-asus-rog-maximus-z370-hero-x-i7-8700k-amd-rx-580.245074/">参考地址2</a></p>
<p>配置单</p>
<table>
<thead>
<tr>
<th align="left">组件</th>
<th align="left">型号</th>
</tr>
</thead>
<tbody><tr>
<td align="left">CPU</td>
<td align="left">intel i9-9900k</td>
</tr>
<tr>
<td align="left">主板</td>
<td align="left">华硕 ROG MAXIMUS XI HERO WIFi</td>
</tr>
<tr>
<td align="left">显卡</td>
<td align="left">华硕 AREZ-STRIX-RXVEGA64-O8G-GAMING</td>
</tr>
<tr>
<td align="left">内存</td>
<td align="left">芝奇 Trident Z RGB 16GB DDR4 3200 （ F4-3200C14D-16GTZR ）</td>
</tr>
<tr>
<td align="left">ssd</td>
<td align="left">三星 Samsung 970 pro 512G</td>
</tr>
<tr>
<td align="left">电源</td>
<td align="left">海盗船 HX850i</td>
</tr>
<tr>
<td align="left">散热器</td>
<td align="left">猫头鹰 NH D15S</td>
</tr>
</tbody></table>
<p><code>clover efi</code> 使用了最新版</p>
<p><code>clover configurator</code> 同样使用了最新版</p>
<h2 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h2><h3 id="SIP-权限问题"><a href="#SIP-权限问题" class="headerlink" title="SIP 权限问题"></a>SIP 权限问题</h3><p><code>Rt Variables</code> 的 <code>CsrActiveConfig</code> 设置为 <code>0x67</code> 关闭 <code>SIP</code></p>
<p>完全有效是<code>0x0</code>, 部分有效是 <code>0x3</code>。 </p>
<p>关闭后<code>ntfs</code> 可以正挂载了。</p>
<h3 id="DisplayPort-问题"><a href="#DisplayPort-问题" class="headerlink" title="DisplayPort 问题"></a>DisplayPort 问题</h3><p>具体原因未知，不过设置<code>Graphics</code> 的 <code>Inject ATI</code> 稳定了许多。</p>
<h3 id="USB-端口不识别问题"><a href="#USB-端口不识别问题" class="headerlink" title="USB 端口不识别问题"></a>USB 端口不识别问题</h3><p>使用<code>MultiBeast</code> 安装 <code>Remove XHCI USB Port Limit</code> 后可以使用。 </p>
<p>其他<code>MultiBeast</code> 查看 <code>参考地址2</code>。</p>
<h3 id="关机与重启-问题"><a href="#关机与重启-问题" class="headerlink" title="关机与重启 问题"></a>关机与重启 问题</h3><p>关机或者重启时不能正常断电。</p>
<p><code>Boot</code> 中设置<code>slide=0</code> 同时安装 <code>EmuVariableUefi-64.efi</code> </p>
<h3 id="ssd-速度修正"><a href="#ssd-速度修正" class="headerlink" title="ssd 速度修正"></a>ssd 速度修正</h3><p>安装<code>NvmExpressDxe-64.efi</code></p>
<h3 id="显示卡顿问题"><a href="#显示卡顿问题" class="headerlink" title="显示卡顿问题"></a>显示卡顿问题</h3><p>安装<code>Lilu.kext</code>与 <code>WhateverGreen.kext</code></p>
<h3 id="使用DP线的色彩问题"><a href="#使用DP线的色彩问题" class="headerlink" title="使用DP线的色彩问题"></a>使用DP线的色彩问题</h3><p>使用<code>DisplayPort</code> 色彩更冷了。有重新校色的必要</p>
<h3 id="修复启动项"><a href="#修复启动项" class="headerlink" title="修复启动项"></a>修复启动项</h3><p>重命名<code>Microsoft\Boot\bootmgfw.efi</code> 为 <code>bootmgfw-orig.efi</code></p>
<p><code>bios</code>中找到<code>clover</code>启动项后可以改回。</p>
<h3 id="显卡温度感人"><a href="#显卡温度感人" class="headerlink" title="显卡温度感人"></a>显卡温度感人</h3><p>想着以后要不要换水冷~</p>
<h2 id="暂时这些"><a href="#暂时这些" class="headerlink" title="暂时这些"></a>暂时这些</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>炸毛！</title>
    <url>/2019/03/28/799d864e291f/</url>
    <content><![CDATA[<h1 id="炸毛！"><a href="#炸毛！" class="headerlink" title="炸毛！"></a>炸毛！</h1><p>系统升级后<code>usb</code> 不能用了……</p>
<p>还原后发现日记忘保存了……</p>
<p>几天的份就这样消失了……</p>
<p>蠢哭😭😭😭</p>
<h1 id="github"><a href="#github" class="headerlink" title="github"></a>github</h1><p>账号<code>2FA</code> 与 <code>recovery code</code> 双失效……</p>
<p>联系客服中…… </p>
<p>好在公钥还在，希望能续一秒……</p>
<p>需要使用<code>ssh -T git@github.com verify</code></p>
<p>如果你有其他账号，需要修改为对应的<code>Host</code>地址用于对应账号。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>gitlab 调整</title>
    <url>/2019/04/20/60206e2064a8/</url>
    <content><![CDATA[<h1 id="Ubuntu-分区小了"><a href="#Ubuntu-分区小了" class="headerlink" title="Ubuntu 分区小了"></a>Ubuntu 分区小了</h1><p><code>gitlab</code> 镜像越来越大了，终于空间不够用了……</p>
<h2 id="gitlab-备份"><a href="#gitlab-备份" class="headerlink" title="gitlab 备份"></a>gitlab 备份</h2><h3 id="备份项目"><a href="#备份项目" class="headerlink" title="备份项目"></a>备份项目</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker exec -t &lt;container name&gt; gitlab-rake gitlab:backup:create</span><br></pre></td></tr></table></figure>

<p>注意备份<code>docker-compose.yml</code> 文件</p>
<h3 id="备份设置文件"><a href="#备份设置文件" class="headerlink" title="备份设置文件"></a>备份设置文件</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker exec -t &lt;your container name&gt; /bin/sh -c &#x27;umask 0077; tar cfz /secret/gitlab/backups/$(date &quot;+etc-gitlab-\%s.tgz&quot;) -C / etc/gitlab&#x27;</span><br></pre></td></tr></table></figure>

<p>注意 <code>/secret/gitlab/backups/</code> 在本地的文件挂载。</p>
<p>备份文件在<code>/var/opt/gitlab/backups</code> 中 注意导出。</p>
<p>还原是注意 <code>镜像版本</code> 的一致性。 不一致时有错误提示。</p>
<p><a href="https://docs.gitlab.com/omnibus/settings/backups.html">参考文档 1</a></p>
<p>准备工作完成</p>
<h2 id="重新安装-ubuntu"><a href="#重新安装-ubuntu" class="headerlink" title="重新安装 ubuntu"></a>重新安装 ubuntu</h2><p>下载最新<code>ubuntu</code>镜像安装。</p>
<p><code>UI</code> 比之前强点…… </p>
<p>注意开启<code>openssh</code></p>
<h2 id="设置-ssh"><a href="#设置-ssh" class="headerlink" title="设置 ssh"></a>设置 ssh</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>

<p>修改端口<code>Port 22</code></p>
<h3 id="添加-公钥"><a href="#添加-公钥" class="headerlink" title="添加 公钥"></a>添加 公钥</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mkdir .ssh</span><br><span class="line">nano authorized_keys</span><br></pre></td></tr></table></figure>

<p>复制公钥到<code>authorized_keys</code></p>
<h3 id="重启-ssh-服务"><a href="#重启-ssh-服务" class="headerlink" title="重启 ssh 服务"></a>重启 ssh 服务</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo service sshd restart</span><br></pre></td></tr></table></figure>

<h2 id="安装-zsh"><a href="#安装-zsh" class="headerlink" title="安装 zsh"></a>安装 zsh</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt install zsh</span><br><span class="line"></span><br><span class="line">chsh -s $(which zsh)</span><br></pre></td></tr></table></figure>

<p>重新登录后检测</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">echo $SHELL</span><br></pre></td></tr></table></figure>

<h3 id="安装-oh-my-zsh"><a href="#安装-oh-my-zsh" class="headerlink" title="安装 oh my zsh"></a>安装 oh my zsh</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sh -c &quot;$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)&quot;</span><br></pre></td></tr></table></figure>

<h3 id="设置-zshrc"><a href="#设置-zshrc" class="headerlink" title="设置~/.zshrc"></a>设置<code>~/.zshrc</code></h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ZSH_THEME=&quot;agnoster&quot;</span><br></pre></td></tr></table></figure>

<h3 id="安装powerline-fonts"><a href="#安装powerline-fonts" class="headerlink" title="安装powerline fonts"></a>安装powerline fonts</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install fonts-powerline</span><br></pre></td></tr></table></figure>

<h2 id="安装-docker"><a href="#安装-docker" class="headerlink" title="安装 docker"></a>安装 docker</h2><p><a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/">参考</a></p>
<h3 id="更新包资源"><a href="#更新包资源" class="headerlink" title="更新包资源"></a>更新包资源</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br></pre></td></tr></table></figure>

<h3 id="安装必要包"><a href="#安装必要包" class="headerlink" title="安装必要包"></a>安装必要包</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install \</span><br><span class="line">    apt-transport-https \</span><br><span class="line">    ca-certificates \</span><br><span class="line">    curl \</span><br><span class="line">    gnupg-agent \</span><br><span class="line">    software-properties-common</span><br></pre></td></tr></table></figure>

<h3 id="安装公钥"><a href="#安装公钥" class="headerlink" title="安装公钥"></a>安装公钥</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</span><br></pre></td></tr></table></figure>

<h3 id="验证公钥"><a href="#验证公钥" class="headerlink" title="验证公钥"></a>验证公钥</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-key fingerprint 0EBFCD88</span><br></pre></td></tr></table></figure>

<h3 id="指定版本"><a href="#指定版本" class="headerlink" title="指定版本"></a>指定版本</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo add-apt-repository \</span><br><span class="line">   &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu \</span><br><span class="line">   $(lsb_release -cs) \</span><br><span class="line">   stable&quot;</span><br></pre></td></tr></table></figure>

<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<h3 id="免去sudo"><a href="#免去sudo" class="headerlink" title="免去sudo"></a>免去sudo</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo groupadd docker</span><br><span class="line">sudo usermod -aG docker $USER</span><br></pre></td></tr></table></figure>

<h3 id="安装docker-compose"><a href="#安装docker-compose" class="headerlink" title="安装docker-compose"></a>安装docker-compose</h3><h4 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h4 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h4 id="创建链接"><a href="#创建链接" class="headerlink" title="创建链接"></a>创建链接</h4><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h2 id="还原-gitlab-备份"><a href="#还原-gitlab-备份" class="headerlink" title="还原 gitlab 备份"></a>还原 gitlab 备份</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker exec -it &lt;container name&gt; gitlab-rake gitlab:backup:restore</span><br></pre></td></tr></table></figure>

<p>注意将文件挂载到<code>/var/opt/gitlab/backups</code></p>
<h2 id="修改ip"><a href="#修改ip" class="headerlink" title="修改ip"></a>修改ip</h2><h3 id="ip设置文件位置"><a href="#ip设置文件位置" class="headerlink" title="ip设置文件位置"></a>ip设置文件位置</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ls /etc/netplan/</span><br><span class="line">cd /etc/netplan/</span><br><span class="line">sudo nano 50-cloud-init.yaml</span><br><span class="line"></span><br><span class="line">sudo nano /etc/netplan/50-cloud-init.yaml</span><br></pre></td></tr></table></figure>

<h3 id="修改内容"><a href="#修改内容" class="headerlink" title="修改内容"></a>修改内容</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">enp0s3:</span><br><span class="line">    addresses: [192.168.13.131/24]</span><br><span class="line">    gateway4: 192.168.13.1</span><br><span class="line">    dhcp4: no</span><br><span class="line">    nameservers:</span><br><span class="line">      addresses: [1.1.1.1]</span><br><span class="line">    optional: true</span><br><span class="line"></span><br><span class="line">docker0: </span><br><span class="line">    addresses: [172.17.0.1/16]</span><br></pre></td></tr></table></figure>

<p>原本内容</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">enp0s3:</span><br><span class="line">    dhcp4: true</span><br></pre></td></tr></table></figure>

<h3 id="确认更改"><a href="#确认更改" class="headerlink" title="确认更改"></a>确认更改</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo netplan apply</span><br></pre></td></tr></table></figure>

<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>确认正在使用的ip</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>记录读取</title>
    <url>/2019/04/17/e7d31e1f71fb/</url>
    <content><![CDATA[<h1 id="11日的份"><a href="#11日的份" class="headerlink" title="11日的份"></a>11日的份</h1><h2 id="laravel-passport-scopes"><a href="#laravel-passport-scopes" class="headerlink" title="laravel passport scopes"></a>laravel passport scopes</h2><p><code>scopes</code> 为单组有效模式。</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p><code>github</code>的 <code>2FA</code> 重置了 过程 大概一周吧……</p>
<hr>
<h1 id="17日的份"><a href="#17日的份" class="headerlink" title="17日的份"></a>17日的份</h1><p>无事</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>docker 与 netplan 的坑</title>
    <url>/2019/04/30/8676cf2d729d/</url>
    <content><![CDATA[<h1 id="docker-与-netplan-的坑"><a href="#docker-与-netplan-的坑" class="headerlink" title="docker 与 netplan 的坑"></a>docker 与 netplan 的坑</h1><p>使用<code>netplan</code> 设置 IP 后</p>
<p><code>docker</code> 服务就不能正常启动了</p>
<p>怀疑是<code>netplan</code>的问题</p>
<p>谷歌也没有结果……</p>
<p>无奈，退一步改项目上传地址吧~</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>更新了~</title>
    <url>/2019/05/07/60dcbfb7b841/</url>
    <content><![CDATA[<h1 id="Google-Cloud"><a href="#Google-Cloud" class="headerlink" title="Google Cloud"></a>Google Cloud</h1><p>有点小问题，重启后正常……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>更新了~</title>
    <url>/2019/05/23/0ae594adead1/</url>
    <content><![CDATA[<h1 id="果然发生"><a href="#果然发生" class="headerlink" title="果然发生"></a>果然发生</h1><p>💊💊💊💊💊💊</p>
<h1 id="车门被划"><a href="#车门被划" class="headerlink" title="车门被划"></a>车门被划</h1><p>不知道什么用钥匙划了车门……</p>
<p>要自己补漆了…… 等工具中…… 效果未知……</p>
<h1 id="人言"><a href="#人言" class="headerlink" title="人言"></a>人言</h1><p>不论是说出口的 还是写下来的 </p>
<p>都会在不知道的情况产出影响……</p>
<p>然而大多数人不知道这点……</p>
<h1 id="脖子疼"><a href="#脖子疼" class="headerlink" title="脖子疼"></a>脖子疼</h1><p>脖子右边疼 也不知道是怎么了…… 好几天了……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>30日了~</title>
    <url>/2019/05/30/92a23832391b/</url>
    <content><![CDATA[<h1 id="更新了"><a href="#更新了" class="headerlink" title="更新了"></a>更新了</h1><p>在自动化的道路上越走越远了……</p>
<p>毕竟一个人能观察的有限……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>哎……</title>
    <url>/2019/06/05/d6d48c56cf50/</url>
    <content><![CDATA[<h1 id="哎……"><a href="#哎……" class="headerlink" title="哎……"></a>哎……</h1><p>恬不知耻 赤裸裸的威胁 估计也没什么用……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>HK</title>
    <url>/2019/06/13/1e632a91f02a/</url>
    <content><![CDATA[<h1 id="祭品"><a href="#祭品" class="headerlink" title="祭品"></a>祭品</h1><p>100w+ 的祭品 看天朝如何吧</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>日常</title>
    <url>/2019/06/17/669c7535fdf0/</url>
    <content><![CDATA[<h1 id="日常"><a href="#日常" class="headerlink" title="日常"></a>日常</h1><p>HK的结果貌似不错</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>呵呵</title>
    <url>/2019/05/17/e41acb74c3b2/</url>
    <content><![CDATA[<h1 id="呵呵呵"><a href="#呵呵呵" class="headerlink" title="呵呵呵"></a>呵呵呵</h1><p>从今天开始只对自己负责</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>不错~</title>
    <url>/2019/07/14/8b4bb929281a/</url>
    <content><![CDATA[<h1 id="ff14"><a href="#ff14" class="headerlink" title="ff14"></a>ff14</h1><p>ff14 确实很有趣，不过剧情有点拖。</p>
<p>环境也比wow 好很多，画质一般。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>终于……</title>
    <url>/2019/06/21/d5218e731e0c/</url>
    <content><![CDATA[<h1 id="终于……"><a href="#终于……" class="headerlink" title="终于……"></a>终于……</h1><p>朝廷的手，伸向了……</p>
<p>红宝书 V2.0 来袭</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>双向绑定的烦恼</title>
    <url>/2019/06/23/9f8d5c773305/</url>
    <content><![CDATA[<h1 id="vue-中数据复制"><a href="#vue-中数据复制" class="headerlink" title="vue 中数据复制"></a>vue 中数据复制</h1><p>vue 中 使用 <code>_.clone()</code> 复制数据后，当原始数据发生变化时，克隆的数据也随之改变</p>
<p>使用<code>_.cloneDeep()</code> 可以解决。</p>
<p>减法的效果优于加法~~</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>手贱</title>
    <url>/2019/07/24/bd8fb47e7932/</url>
    <content><![CDATA[<h1 id="手贱"><a href="#手贱" class="headerlink" title="手贱"></a>手贱</h1><p>升级了docker 到 <code>19.03</code> 版本，</p>
<p>因为强制使用<code>TLS</code> 导致 <code>gitlab</code> 镜像不能正常启动……</p>
<p>各方的解决办法都不怎么样……</p>
<p>姑且回滚到上个版本吧……</p>
<p>哎…… 手贱是有代价的…… </p>
<p>备份太重要了！</p>
<p>备份太重要了！</p>
<p>备份太重要了！</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>真是……</title>
    <url>/2019/08/04/1d0aaadabf39/</url>
    <content><![CDATA[<h1 id="大枪"><a href="#大枪" class="headerlink" title="大枪"></a>大枪</h1><p>最后谁的枪大，谁赢……</p>
<p>一点都不觉得羞愧吗……</p>
<p>绑架人口有意思吗……</p>
<p>沟通是无用的…… 重要的一课……</p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>最近晚上梦都好奇怪……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>无事儿~</title>
    <url>/2019/07/31/3edb43362e30/</url>
    <content><![CDATA[<h1 id="日常"><a href="#日常" class="headerlink" title="日常"></a>日常</h1><p><code>Vega 64</code> 使用 <code>maya</code> 时有不能跨屏幕的<code>bug</code></p>
<p>在<code>display</code> 中设置 <code>DX11</code> 可修复</p>
<p><code>AMD</code>的东西稳定性是真的不好</p>
<p>之后要尽力避免使用……</p>
<h1 id="生日也无事"><a href="#生日也无事" class="headerlink" title="生日也无事"></a>生日也无事</h1><p>生日无事，不知道送自己什么好……</p>
<p>平淡的过了……</p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p><code>algolia</code> 发来邮件才知道全局搜索没关。</p>
<p><code>google cloud</code> 的计费方式很奇怪，<code>300 USD</code>的额度应该可以使用<code>8个月</code> </p>
<p>实际上只有<code>6个月</code>不到。 当使用服务数量变大时，费用恐怕难以进行预估……</p>
<p>这是个大问题！</p>
<p>十万人在线一个月的费用都将出现巨大偏差…… 心塞……</p>
<p>历史账单还查不到！神烦！</p>
<p>平衡负载时，自动对服务器数量扩充，注销等等，操作没有详细的记录，也是难以接受的！</p>
<p><code>laravel Scout</code> 拖慢速度元凶！</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>gitlab 的问题</title>
    <url>/2019/08/05/2ae60370af95/</url>
    <content><![CDATA[<h1 id="gitlab-的问题"><a href="#gitlab-的问题" class="headerlink" title="gitlab 的问题"></a>gitlab 的问题</h1><p><code>gitlab</code> 不能正常启动果然是<code>docker</code>强制使用TLS引起的……</p>
<p>目前的解决方案使用自定义的<code>docker</code>镜像来载入<code>gitlab</code>……</p>
<p>并不是什么良策……</p>
<p>等等看什么时候可以修正吧……</p>
<h1 id="博客更新"><a href="#博客更新" class="headerlink" title="博客更新"></a>博客更新</h1><p>博客更新到<code>7.3.0</code>,从<code>jekyll</code> 换到 <code>hexo</code></p>
<p>设置什么的都没怎么变</p>
<p>关闭评论</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">comments: false</span><br></pre></td></tr></table></figure>

<h2 id="gitlab-保护分支"><a href="#gitlab-保护分支" class="headerlink" title="gitlab 保护分支"></a>gitlab 保护分支</h2><p><code>Projects</code> → <code>Settings</code> → <code>Repository</code> → <code>Protected Branches</code> → <code>unprotect</code></p>
<p>解除保护</p>
<p>可以将原始文件推送到<code>master</code>，将生成文件推送到新分支。从而不修改分支保护。</p>
<h2 id="deploy-推送"><a href="#deploy-推送" class="headerlink" title="deploy 推送"></a>deploy 推送</h2><p>不使用<code>hexo d -g</code>，推送内容无变化。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>docker</tag>
        <tag>gitlab</tag>
      </tags>
  </entry>
  <entry>
    <title>日常</title>
    <url>/2019/08/07/95d968bc94d1/</url>
    <content><![CDATA[<h1 id="日常"><a href="#日常" class="headerlink" title="日常"></a>日常</h1><p><code>vbox</code> 导入虚拟机<code>mac</code> 会改变</p>
<p>需要重新编辑<code>git</code>的提交位置。</p>
<p>后端数据控制部分马上就要完工了~ ✿✿ヽ(°▽°)ノ✿</p>
<h1 id="七夕了"><a href="#七夕了" class="headerlink" title="七夕了"></a>七夕了</h1><p>人家都说鹊桥相遇，那两颗星距离有点远……</p>
<p>一直都说这样想的😁</p>
<p>附上 wiki</p>
<p><a href="https://zh.wikipedia.org/zh-hans/%E6%B2%B3%E9%BC%93%E4%BA%8C">牛郎星 wiki</a></p>
<p><a href="https://zh.wikipedia.org/wiki/%E7%B9%94%E5%A5%B3%E4%B8%80">织女一 wiki</a></p>
<p>也许有一天两者真的会相遇吧！</p>
<p>一年一次什么的……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>被遗忘的“cURL error 60”</title>
    <url>/2019/08/13/7ce22fc8227d/</url>
    <content><![CDATA[<h1 id="被遗忘的cURL-error-60"><a href="#被遗忘的cURL-error-60" class="headerlink" title="被遗忘的cURL error 60"></a>被遗忘的<code>cURL error 60</code></h1><p>进行本地请求时，<code>cURL error 60</code>问题</p>
<p><code>php --ini</code> 查询当下 <code>php.ini</code> 文件位置， 添加下方设置。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">curl.cainfo = &quot;/Users/[name]/.config/valet/CA/LaravelValetCASelfSigned.pem&quot;</span><br></pre></td></tr></table></figure>

<p>注意要在<code>/etc/hosts</code> 中将站点设置为本地。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">127.0.0.1 name.test</span><br></pre></td></tr></table></figure>

<p>完成后，重启<code>valet</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">valet restart</span><br></pre></td></tr></table></figure>

<p>设置后再<code>7.3</code>下也可以正常使用了~ ✿✿ヽ(°▽°)ノ✿</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>vue 多次提交 input 不触发问题</title>
    <url>/2019/08/08/796ab358ce08/</url>
    <content><![CDATA[<h1 id="vue-多次提交-input-不触发问题"><a href="#vue-多次提交-input-不触发问题" class="headerlink" title="vue 多次提交 input 不触发问题"></a>vue 多次提交 input 不触发问题</h1><p>主要原因在于提交后<code>$refs</code>数据没有清理</p>
<p>使得<code>vue</code>不能读取到数据变化。</p>
<p>使用下方命令清除数据就好。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.$refs.myFileInput.value = <span class="string">&#x27;&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>关于上传部分可以查看<a href="https://keleven.me/2019/03/04/">vue上传</a></p>
<p>新建<code>input</code>进行二次触发并算不上是良策……</p>
<p>以上</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>拖延症的救星！快点开始！</title>
    <url>/2019/08/21/7e1fe6f1dcf7/</url>
    <content><![CDATA[<h1 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h1><p>快速进入状态是治疗拖延症的秘诀……</p>
<h1 id="laravel-多对多"><a href="#laravel-多对多" class="headerlink" title="laravel 多对多"></a>laravel 多对多</h1><p><code>sync()</code> 与 <code>syncWithoutDetaching()</code> 只对中间表有效！</p>
<p>震惊 <code>laravel-permission</code> 都有UI了！</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel 扩展包</title>
    <url>/2019/08/25/9442284a10fa/</url>
    <content><![CDATA[<h1 id="laravel-扩展包"><a href="#laravel-扩展包" class="headerlink" title="laravel 扩展包"></a>laravel 扩展包</h1><p>修改 自己创建的扩展包时，一定要提交<code>git</code>，否则<code>composer</code> 不会进行更新。</p>
<p>尤其是添加了新的<code>Facades</code>时。</p>
<p>主要是<code>composer.json</code>文件</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>对应</title>
    <url>/2019/08/23/cc3e1ae4b436/</url>
    <content><![CDATA[<h1 id="对应"><a href="#对应" class="headerlink" title="对应"></a>对应</h1><p>使用数据表对远端数据校验，好过大量查询~</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>nginx-proxy 多镜像下使用v2ray</title>
    <url>/2019/08/29/de4fe0425879/</url>
    <content><![CDATA[<h1 id="nginx-proxy-多镜像下使用v2ray"><a href="#nginx-proxy-多镜像下使用v2ray" class="headerlink" title="nginx-proxy 多镜像下使用v2ray"></a>nginx-proxy 多镜像下使用v2ray</h1><p><a href="https://keleven.me/2018/03/01/">单一 docker-compose.yml 指路</a></p>
<p>多个<code>docker-compose.yml</code> 时，上面的方法就不在适用了。</p>
<p>主要原因是<code>nginx-proxy</code>找不到指定的服务器。</p>
<p>指定服务器名称，并加入到相同网络可破</p>
<h2 id="nginx-proxy-加-letsencrypt"><a href="#nginx-proxy-加-letsencrypt" class="headerlink" title="nginx-proxy 加 letsencrypt"></a>nginx-proxy 加 letsencrypt</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">version: &#x27;2&#x27;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">    nginx-proxy:</span><br><span class="line">        image: jwilder/nginx-proxy:latest</span><br><span class="line">        restart: always</span><br><span class="line">        ports:</span><br><span class="line">            - &quot;80:80&quot;</span><br><span class="line">            - &quot;443:443&quot;</span><br><span class="line">        volumes:</span><br><span class="line">            - /path/to/certs:/etc/nginx/certs:ro</span><br><span class="line">            - $PWD/vhost.d:/etc/nginx/vhost.d:rw</span><br><span class="line">            - /usr/share/nginx/html</span><br><span class="line">            - /var/run/docker.sock:/tmp/docker.sock:ro</span><br><span class="line">        labels:</span><br><span class="line">            - &quot;com.github.jrcs.letsencrypt_nginx_proxy_companion.nginx_proxy&quot;</span><br><span class="line">        network_mode: &quot;bridge&quot;</span><br><span class="line">    letsencrypt-nginx-proxy-companion:</span><br><span class="line">        image: jrcs/letsencrypt-nginx-proxy-companion:latest</span><br><span class="line">        restart: always</span><br><span class="line">        volumes:</span><br><span class="line">            - /path/to/certs:/etc/nginx/certs:rw</span><br><span class="line">            - /var/run/docker.sock:/var/run/docker.sock:ro</span><br><span class="line">        volumes_from:</span><br><span class="line">            - nginx-proxy</span><br><span class="line">        network_mode: &quot;bridge&quot;</span><br></pre></td></tr></table></figure>

<h2 id="v2ray-独立"><a href="#v2ray-独立" class="headerlink" title="v2ray 独立"></a>v2ray 独立</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">version: &#x27;2&#x27;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  v2ray:</span><br><span class="line">    image: v2ray/official</span><br><span class="line">    container_name: v2ray</span><br><span class="line">    restart: always</span><br><span class="line">    expose:</span><br><span class="line">      - &quot;1234&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - $PWD/v2ray:/etc/v2ray</span><br><span class="line">      - $PWD/v2ray/config.json:/etc/v2ray/config.json:ro</span><br><span class="line">    environment:</span><br><span class="line">      - VIRTUAL_HOST=v2ray</span><br><span class="line"></span><br><span class="line">    network_mode: &quot;bridge&quot;</span><br><span class="line"></span><br><span class="line">  web1:</span><br><span class="line">    image: nginx:latest</span><br><span class="line">    restart: always</span><br><span class="line">    expose:</span><br><span class="line">      - &quot;80&quot;</span><br><span class="line">    volumes:</span><br><span class="line">          - $PWD/html:/usr/share/nginx/html:ro</span><br><span class="line">    environment:</span><br><span class="line">      - VIRTUAL_HOST=your.domain.name</span><br><span class="line">      - VIRTUAL_PORT=80</span><br><span class="line">      - LETSENCRYPT_HOST=your.domain.name</span><br><span class="line">      - LETSENCRYPT_EMAIL=your@domain.name</span><br><span class="line">    network_mode: &quot;bridge&quot;</span><br></pre></td></tr></table></figure>

<h2 id="your-domain-name-location"><a href="#your-domain-name-location" class="headerlink" title="your.domain.name_location"></a>your.domain.name_location</h2><p>直接指定服务器不需端口</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">proxy_redirect off;</span><br><span class="line">proxy_http_version 1.1;</span><br><span class="line">proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">proxy_set_header Connection &quot;upgrade&quot;;</span><br><span class="line">proxy_set_header Host $http_host;</span><br><span class="line">if ($http_upgrade = &quot;websocket&quot; ) &#123;</span><br><span class="line">    proxy_pass http://v2ray;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="重要信息"><a href="#重要信息" class="headerlink" title="重要信息"></a>重要信息</h2><p>别忘了创建<code>config.json</code>文件！😁</p>
<h2 id="以上-长久的问题解决了"><a href="#以上-长久的问题解决了" class="headerlink" title="以上 长久的问题解决了"></a>以上 长久的问题解决了</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>docker</tag>
        <tag>v2ray</tag>
        <tag>proxy</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel 扩展包</title>
    <url>/2019/09/01/92a14bc42c53/</url>
    <content><![CDATA[<h1 id="laravel-扩展包"><a href="#laravel-扩展包" class="headerlink" title="laravel 扩展包"></a>laravel 扩展包</h1><h2 id="定义路由"><a href="#定义路由" class="headerlink" title="定义路由"></a>定义路由</h2><p>在<code>ServiceProvider</code>中引入路由文件。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span> <span class="keyword">__DIR__</span>.<span class="string">&#x27;route.php&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="路由中使用中间件"><a href="#路由中使用中间件" class="headerlink" title="路由中使用中间件"></a>路由中使用中间件</h2><p>记得在<code>middleware</code>中添加<code>web</code>,使<code>auth</code>可以正常运行。</p>
<h2 id="有些事儿真的是想不到……"><a href="#有些事儿真的是想不到……" class="headerlink" title="有些事儿真的是想不到……"></a>有些事儿真的是想不到……</h2>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>日常</title>
    <url>/2019/09/10/3c38e80cfb4a/</url>
    <content><![CDATA[<h1 id="日常"><a href="#日常" class="headerlink" title="日常"></a>日常</h1><p>教师节了就说下吧~</p>
<p>好老师是非常重要的</p>
<p>可是我还没遇到过……</p>
<p>现在使用的东西都是<code>google</code>加<code>Read Me</code></p>
<p>我朝的教学书籍就是个笑话……</p>
<p>翻译的文档也好不到哪里去……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>我回来了 ╮(￣▽￣)╭</title>
    <url>/2019/09/08/3a5bd87ae817/</url>
    <content><![CDATA[<h1 id="我回来了-￣▽￣"><a href="#我回来了-￣▽￣" class="headerlink" title="我回来了 []~(￣▽￣)~*"></a>我回来了 []~(￣▽￣)~*</h1><p>从长白山回来了~ 运气超级好~ 看到两次天池~~</p>
<p>虽然比原定计划有偏差，要加倍努力才可以！</p>
<p>照片是手机拍摄，ps拼接的 ￣▽￣</p>
<p>一个人旅行也没什么不好的 (￣３￣)</p>
<p>想着要不要给手机配个广角镜 \（￣︶￣）/</p>
<blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/p/B2I3SRrBqYF/?utm_source=ig_embed&amp;utm_campaign=loading" data-instgrm-version="12" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:540px; min-width:326px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);"><div style="padding:16px;"> <a href="https://www.instagram.com/p/B2I3SRrBqYF/?utm_source=ig_embed&amp;utm_campaign=loading" style=" background:#FFFFFF; line-height:0; padding:0 0; text-align:center; text-decoration:none; width:100%;" target="_blank"> <div style=" display: flex; flex-direction: row; align-items: center;"> <div style="background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 40px; margin-right: 14px; width: 40px;"></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 100px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 60px;"></div></div></div><div style="padding: 19% 0;"></div> <div style="display:block; height:50px; margin:0 auto 12px; width:50px;"><svg width="50px" height="50px" viewBox="0 0 60 60" version="1.1" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-511.000000, -20.000000)" fill="#000000"><g><path d="M556.869,30.41 C554.814,30.41 553.148,32.076 553.148,34.131 C553.148,36.186 554.814,37.852 556.869,37.852 C558.924,37.852 560.59,36.186 560.59,34.131 C560.59,32.076 558.924,30.41 556.869,30.41 M541,60.657 C535.114,60.657 530.342,55.887 530.342,50 C530.342,44.114 535.114,39.342 541,39.342 C546.887,39.342 551.658,44.114 551.658,50 C551.658,55.887 546.887,60.657 541,60.657 M541,33.886 C532.1,33.886 524.886,41.1 524.886,50 C524.886,58.899 532.1,66.113 541,66.113 C549.9,66.113 557.115,58.899 557.115,50 C557.115,41.1 549.9,33.886 541,33.886 M565.378,62.101 C565.244,65.022 564.756,66.606 564.346,67.663 C563.803,69.06 563.154,70.057 562.106,71.106 C561.058,72.155 560.06,72.803 558.662,73.347 C557.607,73.757 556.021,74.244 553.102,74.378 C549.944,74.521 548.997,74.552 541,74.552 C533.003,74.552 532.056,74.521 528.898,74.378 C525.979,74.244 524.393,73.757 523.338,73.347 C521.94,72.803 520.942,72.155 519.894,71.106 C518.846,70.057 518.197,69.06 517.654,67.663 C517.244,66.606 516.755,65.022 516.623,62.101 C516.479,58.943 516.448,57.996 516.448,50 C516.448,42.003 516.479,41.056 516.623,37.899 C516.755,34.978 517.244,33.391 517.654,32.338 C518.197,30.938 518.846,29.942 519.894,28.894 C520.942,27.846 521.94,27.196 523.338,26.654 C524.393,26.244 525.979,25.756 528.898,25.623 C532.057,25.479 533.004,25.448 541,25.448 C548.997,25.448 549.943,25.479 553.102,25.623 C556.021,25.756 557.607,26.244 558.662,26.654 C560.06,27.196 561.058,27.846 562.106,28.894 C563.154,29.942 563.803,30.938 564.346,32.338 C564.756,33.391 565.244,34.978 565.378,37.899 C565.522,41.056 565.552,42.003 565.552,50 C565.552,57.996 565.522,58.943 565.378,62.101 M570.82,37.631 C570.674,34.438 570.167,32.258 569.425,30.349 C568.659,28.377 567.633,26.702 565.965,25.035 C564.297,23.368 562.623,22.342 560.652,21.575 C558.743,20.834 556.562,20.326 553.369,20.18 C550.169,20.033 549.148,20 541,20 C532.853,20 531.831,20.033 528.631,20.18 C525.438,20.326 523.257,20.834 521.349,21.575 C519.376,22.342 517.703,23.368 516.035,25.035 C514.368,26.702 513.342,28.377 512.574,30.349 C511.834,32.258 511.326,34.438 511.181,37.631 C511.035,40.831 511,41.851 511,50 C511,58.147 511.035,59.17 511.181,62.369 C511.326,65.562 511.834,67.743 512.574,69.651 C513.342,71.625 514.368,73.296 516.035,74.965 C517.703,76.634 519.376,77.658 521.349,78.425 C523.257,79.167 525.438,79.673 528.631,79.82 C531.831,79.965 532.853,80.001 541,80.001 C549.148,80.001 550.169,79.965 553.369,79.82 C556.562,79.673 558.743,79.167 560.652,78.425 C562.623,77.658 564.297,76.634 565.965,74.965 C567.633,73.296 568.659,71.625 569.425,69.651 C570.167,67.743 570.674,65.562 570.82,62.369 C570.966,59.17 571,58.147 571,50 C571,41.851 570.966,40.831 570.82,37.631"></path></g></g></g></svg></div><div style="padding-top: 8px;"> <div style=" color:#3897f0; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:550; line-height:18px;"> 在 Instagram 查看这篇帖子</div></div><div style="padding: 12.5% 0;"></div> <div style="display: flex; flex-direction: row; margin-bottom: 14px; align-items: center;"><div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(0px) translateY(7px);"></div> <div style="background-color: #F4F4F4; height: 12.5px; transform: rotate(-45deg) translateX(3px) translateY(1px); width: 12.5px; flex-grow: 0; margin-right: 14px; margin-left: 2px;"></div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(9px) translateY(-18px);"></div></div><div style="margin-left: 8px;"> <div style=" background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 20px; width: 20px;"></div> <div style=" width: 0; height: 0; border-top: 2px solid transparent; border-left: 6px solid #f4f4f4; border-bottom: 2px solid transparent; transform: translateX(16px) translateY(-4px) rotate(30deg)"></div></div><div style="margin-left: auto;"> <div style=" width: 0px; border-top: 8px solid #F4F4F4; border-right: 8px solid transparent; transform: translateY(16px);"></div> <div style=" background-color: #F4F4F4; flex-grow: 0; height: 12px; width: 16px; transform: translateY(-4px);"></div> <div style=" width: 0; height: 0; border-top: 8px solid #F4F4F4; border-left: 8px solid transparent; transform: translateY(-4px) translateX(8px);"></div></div></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center; margin-bottom: 24px;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 224px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 144px;"></div></div></a><p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;"><a href="https://www.instagram.com/p/B2I3SRrBqYF/?utm_source=ig_embed&amp;utm_campaign=loading" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none;" target="_blank">@_y.o_o.y_ 分享的帖子</a> · <time style=" font-family:Arial,sans-serif; font-size:14px; line-height:17px;" datetime="2019-09-08T05:28:33+00:00">PDT 2019 年 9月 7 日 下午 10:28</time></p></div></blockquote> <script async src="//www.instagram.com/embed.js"></script>

<blockquote class="instagram-media" data-instgrm-permalink="https://www.instagram.com/p/B2I3EF0BN-D/?utm_source=ig_embed&amp;utm_campaign=loading" data-instgrm-version="12" style=" background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:540px; min-width:326px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);"><div style="padding:16px;"> <a href="https://www.instagram.com/p/B2I3EF0BN-D/?utm_source=ig_embed&amp;utm_campaign=loading" style=" background:#FFFFFF; line-height:0; padding:0 0; text-align:center; text-decoration:none; width:100%;" target="_blank"> <div style=" display: flex; flex-direction: row; align-items: center;"> <div style="background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 40px; margin-right: 14px; width: 40px;"></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 100px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 60px;"></div></div></div><div style="padding: 19% 0;"></div> <div style="display:block; height:50px; margin:0 auto 12px; width:50px;"><svg width="50px" height="50px" viewBox="0 0 60 60" version="1.1" xmlns="https://www.w3.org/2000/svg" xmlns:xlink="https://www.w3.org/1999/xlink"><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-511.000000, -20.000000)" fill="#000000"><g><path d="M556.869,30.41 C554.814,30.41 553.148,32.076 553.148,34.131 C553.148,36.186 554.814,37.852 556.869,37.852 C558.924,37.852 560.59,36.186 560.59,34.131 C560.59,32.076 558.924,30.41 556.869,30.41 M541,60.657 C535.114,60.657 530.342,55.887 530.342,50 C530.342,44.114 535.114,39.342 541,39.342 C546.887,39.342 551.658,44.114 551.658,50 C551.658,55.887 546.887,60.657 541,60.657 M541,33.886 C532.1,33.886 524.886,41.1 524.886,50 C524.886,58.899 532.1,66.113 541,66.113 C549.9,66.113 557.115,58.899 557.115,50 C557.115,41.1 549.9,33.886 541,33.886 M565.378,62.101 C565.244,65.022 564.756,66.606 564.346,67.663 C563.803,69.06 563.154,70.057 562.106,71.106 C561.058,72.155 560.06,72.803 558.662,73.347 C557.607,73.757 556.021,74.244 553.102,74.378 C549.944,74.521 548.997,74.552 541,74.552 C533.003,74.552 532.056,74.521 528.898,74.378 C525.979,74.244 524.393,73.757 523.338,73.347 C521.94,72.803 520.942,72.155 519.894,71.106 C518.846,70.057 518.197,69.06 517.654,67.663 C517.244,66.606 516.755,65.022 516.623,62.101 C516.479,58.943 516.448,57.996 516.448,50 C516.448,42.003 516.479,41.056 516.623,37.899 C516.755,34.978 517.244,33.391 517.654,32.338 C518.197,30.938 518.846,29.942 519.894,28.894 C520.942,27.846 521.94,27.196 523.338,26.654 C524.393,26.244 525.979,25.756 528.898,25.623 C532.057,25.479 533.004,25.448 541,25.448 C548.997,25.448 549.943,25.479 553.102,25.623 C556.021,25.756 557.607,26.244 558.662,26.654 C560.06,27.196 561.058,27.846 562.106,28.894 C563.154,29.942 563.803,30.938 564.346,32.338 C564.756,33.391 565.244,34.978 565.378,37.899 C565.522,41.056 565.552,42.003 565.552,50 C565.552,57.996 565.522,58.943 565.378,62.101 M570.82,37.631 C570.674,34.438 570.167,32.258 569.425,30.349 C568.659,28.377 567.633,26.702 565.965,25.035 C564.297,23.368 562.623,22.342 560.652,21.575 C558.743,20.834 556.562,20.326 553.369,20.18 C550.169,20.033 549.148,20 541,20 C532.853,20 531.831,20.033 528.631,20.18 C525.438,20.326 523.257,20.834 521.349,21.575 C519.376,22.342 517.703,23.368 516.035,25.035 C514.368,26.702 513.342,28.377 512.574,30.349 C511.834,32.258 511.326,34.438 511.181,37.631 C511.035,40.831 511,41.851 511,50 C511,58.147 511.035,59.17 511.181,62.369 C511.326,65.562 511.834,67.743 512.574,69.651 C513.342,71.625 514.368,73.296 516.035,74.965 C517.703,76.634 519.376,77.658 521.349,78.425 C523.257,79.167 525.438,79.673 528.631,79.82 C531.831,79.965 532.853,80.001 541,80.001 C549.148,80.001 550.169,79.965 553.369,79.82 C556.562,79.673 558.743,79.167 560.652,78.425 C562.623,77.658 564.297,76.634 565.965,74.965 C567.633,73.296 568.659,71.625 569.425,69.651 C570.167,67.743 570.674,65.562 570.82,62.369 C570.966,59.17 571,58.147 571,50 C571,41.851 570.966,40.831 570.82,37.631"></path></g></g></g></svg></div><div style="padding-top: 8px;"> <div style=" color:#3897f0; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:550; line-height:18px;"> 在 Instagram 查看这篇帖子</div></div><div style="padding: 12.5% 0;"></div> <div style="display: flex; flex-direction: row; margin-bottom: 14px; align-items: center;"><div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(0px) translateY(7px);"></div> <div style="background-color: #F4F4F4; height: 12.5px; transform: rotate(-45deg) translateX(3px) translateY(1px); width: 12.5px; flex-grow: 0; margin-right: 14px; margin-left: 2px;"></div> <div style="background-color: #F4F4F4; border-radius: 50%; height: 12.5px; width: 12.5px; transform: translateX(9px) translateY(-18px);"></div></div><div style="margin-left: 8px;"> <div style=" background-color: #F4F4F4; border-radius: 50%; flex-grow: 0; height: 20px; width: 20px;"></div> <div style=" width: 0; height: 0; border-top: 2px solid transparent; border-left: 6px solid #f4f4f4; border-bottom: 2px solid transparent; transform: translateX(16px) translateY(-4px) rotate(30deg)"></div></div><div style="margin-left: auto;"> <div style=" width: 0px; border-top: 8px solid #F4F4F4; border-right: 8px solid transparent; transform: translateY(16px);"></div> <div style=" background-color: #F4F4F4; flex-grow: 0; height: 12px; width: 16px; transform: translateY(-4px);"></div> <div style=" width: 0; height: 0; border-top: 8px solid #F4F4F4; border-left: 8px solid transparent; transform: translateY(-4px) translateX(8px);"></div></div></div> <div style="display: flex; flex-direction: column; flex-grow: 1; justify-content: center; margin-bottom: 24px;"> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; margin-bottom: 6px; width: 224px;"></div> <div style=" background-color: #F4F4F4; border-radius: 4px; flex-grow: 0; height: 14px; width: 144px;"></div></div></a><p style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; line-height:17px; margin-bottom:0; margin-top:8px; overflow:hidden; padding:8px 0 7px; text-align:center; text-overflow:ellipsis; white-space:nowrap;"><a href="https://www.instagram.com/p/B2I3EF0BN-D/?utm_source=ig_embed&amp;utm_campaign=loading" style=" color:#c9c8cd; font-family:Arial,sans-serif; font-size:14px; font-style:normal; font-weight:normal; line-height:17px; text-decoration:none;" target="_blank">@_y.o_o.y_ 分享的帖子</a> · <time style=" font-family:Arial,sans-serif; font-size:14px; line-height:17px;" datetime="2019-09-08T05:26:36+00:00">PDT 2019 年 9月 7 日 下午 10:26</time></p></div></blockquote> <script async src="//www.instagram.com/embed.js"></script>

]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>有点意思</title>
    <url>/2019/09/12/72f922532890/</url>
    <content><![CDATA[<h1 id="有点意思"><a href="#有点意思" class="headerlink" title="有点意思"></a>有点意思</h1><p>各说各话有什么好谈的……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>继续的日常</title>
    <url>/2019/09/14/8b5e86df14f6/</url>
    <content><![CDATA[<h1 id="继续的日常"><a href="#继续的日常" class="headerlink" title="继续的日常"></a>继续的日常</h1><p>昨天被<code>chrome</code>的缓存坑了一晚上……</p>
<p>还好找到问题了……</p>
<h1 id="where-与-whereStrict"><a href="#where-与-whereStrict" class="headerlink" title="where 与 whereStrict"></a>where 与 whereStrict</h1><p><code>laravel</code>的<code>where</code>中对<code>01</code> 与 <code>001</code> 的区分并不敏感。</p>
<p>对复杂数据判断不足，使用<code>whereStrict</code>可以修正问题。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>没常识超可怕</title>
    <url>/2019/09/19/b8cc438723da/</url>
    <content><![CDATA[<h1 id="没常识超可怕"><a href="#没常识超可怕" class="headerlink" title="没常识超可怕"></a>没常识超可怕</h1><p>虽然范围有点广，不过也没事什么不对的。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>想换椅子了！</title>
    <url>/2019/10/02/dac8607d2986/</url>
    <content><![CDATA[<h1 id="想换椅子了"><a href="#想换椅子了" class="headerlink" title="想换椅子了"></a>想换椅子了</h1><p>椅子坐久了疲劳感上升。</p>
<p>刚好用的时间久了，想换掉。</p>
<p>椅子是舒适度会直接影响工作效率！</p>
<p>哈哈哈哈哈哈哈哈~~</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>manjaro 与 kvm</title>
    <url>/2019/09/29/ce2961fb3bca/</url>
    <content><![CDATA[<h1 id="kvm"><a href="#kvm" class="headerlink" title="kvm"></a>kvm</h1><p><code>YouTube</code>某人安利的<code>kvm</code>动心了</p>
<p>尝试了一下，比<code>vbox</code>快~~</p>
<p>于是安装<code>manjaro</code>+<code>kvm</code></p>
<h2 id="manjaro-下用搜狗"><a href="#manjaro-下用搜狗" class="headerlink" title="manjaro 下用搜狗"></a>manjaro 下用搜狗</h2><p>搜狗的安装程序不再国际源中需要手动添加</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nano /etc/pacman.conf</span><br></pre></td></tr></table></figure>

<p>添加内容</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[archlinuxcn]</span><br><span class="line">SigLevel = Optional TrustedOnly</span><br><span class="line">Server = https://mirrors.ustc.edu.cn/archlinuxcn/$arch</span><br></pre></td></tr></table></figure>

<p>安装秘钥</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo pacman -Syy &amp;&amp; sudo pacman -S archlinuxcn-keyring</span><br></pre></td></tr></table></figure>

<p>安装需要的包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo pacman -S fcitx-im</span><br><span class="line">sudo pacman -S fcitx-configtool</span><br><span class="line">sudo pacman -S fcitx-sogoupinyin</span><br><span class="line">yaourt -S fcitx-qt4</span><br></pre></td></tr></table></figure>

<p>添加设置文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo nano ~/.xprofile</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">export GTK_IM_MODULE=fcitx</span><br><span class="line">export QT_IM_MODULE=fcitx</span><br><span class="line">export XMODIFIERS=&quot;@im=fcitx&quot;</span><br></pre></td></tr></table></figure>

<p>注销重新登录后搜狗可以正常使用了</p>
<h2 id="manjaro-下安装kvm"><a href="#manjaro-下安装kvm" class="headerlink" title="manjaro 下安装kvm"></a>manjaro 下安装kvm</h2><p>查看内核模块是否装载</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">lsmod | grep kvm </span><br><span class="line">lsmod | grep virtio</span><br></pre></td></tr></table></figure>

<p>装载 virtio</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo modprobe virtio</span><br></pre></td></tr></table></figure>

<p>安装包</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo pacman -S virt-manager qemu vde2 ebtables dnsmasq bridge-utils openbsd-netcat</span><br></pre></td></tr></table></figure>

<p>启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo systemctl enable libvirtd</span><br><span class="line">sudo systemctl start libvirtd</span><br><span class="line">sudo systemctl start virtlogd</span><br></pre></td></tr></table></figure>

<p>注意新版 <code>virt-manager</code> 需要输入后选择系统</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>manjaro</tag>
        <tag>kvm</tag>
      </tags>
  </entry>
  <entry>
    <title>想的有点远</title>
    <url>/2019/09/16/f48b60ad2358/</url>
    <content><![CDATA[<h1 id="想的有点远"><a href="#想的有点远" class="headerlink" title="想的有点远"></a>想的有点远</h1><p>假如有一天鬼被大规模的观察到，并证实了存在</p>
<p>某些东西只会变得更可笑！</p>
<p>朝廷颜面何在 😁😁</p>
<p><code>bootstrap</code> 碍着你来吗 🙄</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>postman 的坑</title>
    <url>/2019/10/03/5b4a4001955d/</url>
    <content><![CDATA[<h1 id="postman-的坑"><a href="#postman-的坑" class="headerlink" title="postman 的坑"></a>postman 的坑</h1><p>使用<code>postman oauth2.0</code> 请求<code>token</code>时报错。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Could not complete OAuth 2.0 login. Check Postman Console for more details.</span><br></pre></td></tr></table></figure>

<p>原因是<code>valet</code> 开启了<code>https</code> 产生了验证错误。</p>
<p>关闭<code>https</code>后可以正常使用。</p>
<p>貌似更新到新版本后正常……</p>
<p>这一下午做了什么啊！！！心累！</p>
<p>多个<code>Scopes</code>时，使用<code>空格</code>分隔。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>postman</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel 包升级</title>
    <url>/2019/10/20/b6ed9e159fa7/</url>
    <content><![CDATA[<h1 id="genealabs-laravel-model-caching"><a href="#genealabs-laravel-model-caching" class="headerlink" title="genealabs/laravel-model-caching"></a>genealabs/laravel-model-caching</h1><p>在<code>laravel 5.8</code> 中使用<code>^0.6</code></p>
<p>在<code>laravel 6.3</code> 中使用<code>^0.7.1</code></p>
<p>注意包要对应，不然升级时会出错。</p>
<h1 id="wow-怀旧"><a href="#wow-怀旧" class="headerlink" title="wow 怀旧"></a>wow 怀旧</h1><p>谁愿意玩谁玩，恶心死了。</p>
<p>生活够难得了，还要给自己找不快，也是够了</p>
<p><code>wow</code>的人口素质要低于<code>ff14</code>，个人感受。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>知道了一些！决定了一些！</title>
    <url>/2019/11/21/47cecc1a0c23/</url>
    <content><![CDATA[<p>沧海一粟</p>
<p>动其精华</p>
<p>不容小觑</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>laravel 升级</title>
    <url>/2019/10/08/47912eab4ec1/</url>
    <content><![CDATA[<h1 id="laravel-升级了"><a href="#laravel-升级了" class="headerlink" title="laravel 升级了"></a>laravel 升级了</h1><p><code>predis</code> 要换成 <code>PhpRedis</code> </p>
<p>原本的<code>auth</code> 使用 <code>vue</code> 重构了</p>
<p><code>phpredis</code>安装好后记得重启！</p>
<p>重启！</p>
<p>重启！</p>
<p>重启！</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title>migrations 自动载入</title>
    <url>/2019/10/15/c859f3279dc3/</url>
    <content><![CDATA[<h1 id="migrations-自动载入"><a href="#migrations-自动载入" class="headerlink" title="migrations 自动载入"></a>migrations 自动载入</h1><p><code>/../database/migrations</code> 为扩展包中路径</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;loadMigrationsFrom(<span class="keyword">__DIR__</span>.<span class="string">&#x27;/../database/migrations&#x27;</span>);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>passport scope</title>
    <url>/2019/10/23/b91e291293bc/</url>
    <content><![CDATA[<h1 id="passport-scope-的作用域"><a href="#passport-scope-的作用域" class="headerlink" title="passport scope 的作用域"></a>passport scope 的作用域</h1><h2 id="使用-client"><a href="#使用-client" class="headerlink" title="使用 client"></a>使用 client</h2><p>使用<code>middleware(&#39;client&#39;)</code>时，<code>token</code>请求的<code>grant_type</code>应为<code>grant_type</code>。</p>
<p>当使用<code>middleware(&#39;client:admin,user&#39;)</code>这种样式时，检查的是全部列出的<code>scope</code>。</p>
<h2 id="使用-scope"><a href="#使用-scope" class="headerlink" title="使用 scope"></a>使用 scope</h2><p>可以用于用户请求，列出的<code>scope</code>中有任意对应就可以访问。</p>
<h2 id="使用-scopes"><a href="#使用-scopes" class="headerlink" title="使用 scopes"></a>使用 scopes</h2><p>同样用于用户请求，列出的<code>scope</code>中全部对应就可以访问。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>略微心烦</title>
    <url>/2019/11/12/46ec89047fa2/</url>
    <content><![CDATA[<h1 id="略微心烦"><a href="#略微心烦" class="headerlink" title="略微心烦"></a>略微心烦</h1>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>switch 入手</title>
    <url>/2019/12/04/e430aff9fa0c/</url>
    <content><![CDATA[<h2 id="switch-入手"><a href="#switch-入手" class="headerlink" title="switch 入手"></a>switch 入手</h2><p>没错因为健身环大冒险才入手……</p>
<p>感觉到这几个月体力下降的超明显，也不知道是怎么了</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>天朝的基础教育虽好</p>
<p>却无法启发天才</p>
<p>老师讲的东西他们自己都不懂</p>
<p>还要教人也是……</p>
<p>简单的就算了</p>
<p>有点难度的就是忽悠人了</p>
<p>积分不讲原理，只知道背公式……</p>
<p>之后的30年是一个重大的变革期</p>
<p>各种意义都是，不过与天朝无关。</p>
<p>就算勉强有关系也要多年之后了……</p>
<p>再一次，在路口走错了。</p>
<p>这次的代价比上次要大的多的多……</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>还活着~</title>
    <url>/2019/11/30/5e603ed0d61e/</url>
    <content><![CDATA[<h1 id="日常是无聊的"><a href="#日常是无聊的" class="headerlink" title="日常是无聊的"></a>日常是无聊的</h1><p>没有什么要说的 </p>
<p>证明还活着~</p>
<p>域名快到期了~</p>
<p>并不想换</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>健身环吹爆！</title>
    <url>/2019/12/06/84904368ec66/</url>
    <content><![CDATA[<h1 id="健身环真好玩"><a href="#健身环真好玩" class="headerlink" title="健身环真好玩"></a>健身环真好玩</h1><p>效果还是有的，时间长了效果更明显。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>日常</title>
    <url>/2019/12/13/238582d19404/</url>
    <content><![CDATA[<pre class="mermaid">
gantt
   dateFormat  YYYY-MM-DD-HH
   section 2019-12-13
   整理  : a1, 2019-12-13-10 , 2h
   早课 :  crit , after a1 , 2h
   程序 :     a2 , after a1 , 4h
   健身环 :   a3 , after a2 , 3h
   晚课 :  crit  , 2019-12-13-19  , 2h
   工作     :  a4 , after a3 , 4h
   休息 : a5 , after a4 , 1h
工作2     : a6 , after a5 , 3h
   整理工作记录 : 2019-12-14-03 , 1h
</pre>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 mermaid</title>
    <url>/2019/12/12/eefa69fc25bb/</url>
    <content><![CDATA[<h1 id="重新分配服务"><a href="#重新分配服务" class="headerlink" title="重新分配服务"></a>重新分配服务</h1><p>重新分配服务，分割功能，创建新的功能包。</p>
<p><code>laravel horizon</code> 使用vue 对UI进行构建，使文件在不导入的情况下可以使用</p>
<p>方法可以学习，不过无法使用 2FA 验证 与 用户登录。除非使用<code>vuex</code>。 </p>
<h1 id="测试-mermaid"><a href="#测试-mermaid" class="headerlink" title="测试 mermaid"></a>测试 mermaid</h1><p><a href="https://github.com/mermaid-js/mermaid">mermaid 文档</a></p>
<pre class="mermaid">
graph LR
A --&gt; |test| B
</pre>

<hr>
<pre class="mermaid">
gantt
dateFormat  YYYY-MM-DD-HH
section 2019-12-12
整理文档      : done, a1, 2019-12-12-12 , 4h
健身环 :active, a2 , 2019-12-12-16 , 3h
晚课 :crit , a3 , after a2  , 2h
建立对应包     : 2019-12-12-19 , 6h
心理测量者3 : a4 , 2019-12-13-01 , 2h
整理工作记录 : 2019-12-13-03 , 1h
</pre>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>奇怪的梦</title>
    <url>/2019/12/24/87d92e7716f7/</url>
    <content><![CDATA[<h1 id="奇怪的梦"><a href="#奇怪的梦" class="headerlink" title="奇怪的梦"></a>奇怪的梦</h1><p>太过美好的梦，以至于不愿意醒来……</p>
<h1 id="laravel-echo-设置"><a href="#laravel-echo-设置" class="headerlink" title="laravel echo 设置"></a>laravel echo 设置</h1><p><code>laravel echo</code>用于提供<code>socket</code>服务，现代网络服务必备。</p>
<p>于是使用<code>laravel-echo-server</code></p>
<p>注意<code>laravel-echo-server</code>是兼容<code>pusher</code>的。</p>
<p>所以直接安装<code>pusher</code>包 + 设置<code>config/broadcasting.php</code>就可以快速上手。</p>
<p>网络上没人将详细的设置方法写出来不知道是为什么。</p>
<h2 id="需要的包"><a href="#需要的包" class="headerlink" title="需要的包"></a>需要的包</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">composer require pusher/pusher-php-server</span><br><span class="line">npm install --save laravel-echo socket.io-client</span><br></pre></td></tr></table></figure>

<h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h2><h3 id="env"><a href="#env" class="headerlink" title=".env"></a>.env</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">BROADCAST_DRIVER=pusher</span><br><span class="line">WEBSOCKET_APPID=your_ID</span><br><span class="line">WEBSOCKET_KEY=your_key</span><br></pre></td></tr></table></figure>

<h3 id="config-broadcasting-php"><a href="#config-broadcasting-php" class="headerlink" title="config/broadcasting.php"></a>config/broadcasting.php</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;pusher&#x27;</span> =&gt; [</span><br><span class="line">	<span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;pusher&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;key&#x27;</span> =&gt; env(<span class="string">&#x27;WEBSOCKET_KEY&#x27;</span>),</span><br><span class="line">	<span class="string">&#x27;app_id&#x27;</span> =&gt; env(<span class="string">&#x27;WEBSOCKET_APPID&#x27;</span>),</span><br><span class="line">	<span class="string">&#x27;secret&#x27;</span> =&gt; <span class="literal">null</span>,</span><br><span class="line">	<span class="string">&#x27;options&#x27;</span> =&gt; [</span><br><span class="line">		<span class="string">&#x27;host&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;port&#x27;</span> =&gt; <span class="number">6001</span>,</span><br><span class="line">		<span class="string">&#x27;scheme&#x27;</span> =&gt; <span class="string">&#x27;http&#x27;</span></span><br><span class="line">	],</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<h3 id="启动echo-server"><a href="#启动echo-server" class="headerlink" title="启动echo-server"></a>启动echo-server</h3><p><a href="https://github.com/tlaverdure/laravel-echo-server">laravel-echo-server</a></p>
<p>官方写的非常清楚了。</p>
<p>注意：非本地使用的情况下建议开启<code>https</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">laravel-echo-server init</span><br><span class="line">laravel-echo-server client:add APP_ID</span><br><span class="line">laravel-echo-server start</span><br></pre></td></tr></table></figure>

<p>到这里,<code>laravel</code>有可以使用<code>php</code>向频道中推送信息了。</p>
<h3 id="vue前端设置"><a href="#vue前端设置" class="headerlink" title="vue前端设置"></a>vue前端设置</h3><p><code>bootstrap.js</code>中进行设置</p>
<p>注意地址的对应。如果需要<code>laravel-echo-server</code>完全可以拆分为独立服务器。也可以使用<code>docker</code>包。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Echo <span class="keyword">from</span> <span class="string">&quot;laravel-echo&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.io = <span class="built_in">require</span>(<span class="string">&#x27;socket.io-client&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.Echo = <span class="keyword">new</span> Echo(&#123;</span><br><span class="line">    <span class="attr">broadcaster</span>: <span class="string">&#x27;socket.io&#x27;</span>,</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;http://localhost:6001&#x27;</span>,</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;your_key&#x27;</span>,</span><br><span class="line">    <span class="comment">// forceTLS: true</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="使用echo"><a href="#使用echo" class="headerlink" title="使用echo"></a>使用echo</h2><h3 id="在laravel中"><a href="#在laravel中" class="headerlink" title="在laravel中"></a>在<code>laravel</code>中</h3><p>新建一个事件，<code>laravel</code>中的推送要使用的到队列。</p>
<p>类要<code>implements ShouldBroadcast</code></p>
<p><code>__construct</code>的消息为要推送信息。</p>
<p><code>broadcastOn()</code>用来指定频道。</p>
<p><code>broadcastAs()</code>用来指定频道名称。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">KThree</span>\<span class="title">Test</span>\<span class="title">Events</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>\<span class="title">Channel</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Queue</span>\<span class="title">SerializesModels</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>\<span class="title">PrivateChannel</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>\<span class="title">PresenceChannel</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Events</span>\<span class="title">Dispatchable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>\<span class="title">InteractsWithSockets</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Broadcasting</span>\<span class="title">ShouldBroadcast</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestWebSocket</span> <span class="keyword">implements</span> <span class="title">ShouldBroadcast</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">Dispatchable</span>, <span class="title">InteractsWithSockets</span>, <span class="title">SerializesModels</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new event instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$message</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$message</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;message = <span class="variable">$message</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the channels the event should broadcast on.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Broadcasting\Channel|array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">broadcastOn</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// return new PrivateChannel(&#x27;test&#x27;);</span></span><br><span class="line">        <span class="keyword">return</span> [<span class="string">&#x27;your_channel&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">broadcastAs</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;your_broadcast_name&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="在vue组件中"><a href="#在vue组件中" class="headerlink" title="在vue组件中"></a>在<code>vue</code>组件中</h3><p>注意<code>listen</code>名字前的<code>.</code></p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> channel = Echo.channel(<span class="string">&#x27;your_channel&#x27;</span>);</span><br><span class="line">channel.listen(<span class="string">&#x27;.your_broadcast_name&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">	alert(<span class="built_in">JSON</span>.stringify(data));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
      </tags>
  </entry>
  <entry>
    <title>docker bridge 获取ip</title>
    <url>/2023/04/24/247596fc96b5/</url>
    <content><![CDATA[<p>起因：在群晖中不同image直接使用自定义的镜像名称不能正常访问。</p>
<p>比如名为<code>alist</code>镜像，一般直接使用<code>http://alist</code>就可以直接访问。</p>
<p>在群晖中就失效了。因为使用的是<code>bridge</code>网络，外部程序不能识别。</p>
<p>解决方法为使用<code>docker</code>分配的<code>ip</code>进行访问。</p>
<h2 id="获取-docker-bridge-模式ip"><a href="#获取-docker-bridge-模式ip" class="headerlink" title="获取 docker bridge 模式ip"></a>获取 docker bridge 模式ip</h2><p>使用下方命令获取当前全部镜像的ip</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">docker network inspect bridge</span><br></pre></td></tr></table></figure>

<p>随后找到需要的，填入对应的位置，就可以正常访问了。</p>
<h2 id="alist-与-aria2-关联"><a href="#alist-与-aria2-关联" class="headerlink" title="alist 与 aria2 关联"></a>alist 与 aria2 关联</h2><p>alist官方说有一个打包的镜像，安装后发现没什么效果。</p>
<p>只能手动设置下关联</p>
<h3 id="aria2中"><a href="#aria2中" class="headerlink" title="aria2中"></a>aria2中</h3><p>添加的原因：在<code>alist</code>中使用<code>aria2</code>时默认的地址为<code>/opt/alist/data</code>。</p>
<p>在<code>aria2</code>的docker-compose.yml中添加</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/docker/alist/alist:/opt/alist/data</span></span><br></pre></td></tr></table></figure>

<h3 id="alist中"><a href="#alist中" class="headerlink" title="alist中"></a>alist中</h3><p>与<code>aria2</code>中的设置一致，方面<code>alist</code>读取并进行下载后的操作。</p>
<p>在<code>alist</code>的docker-compose.yml中添加</p>
<p><code>/Download:/aria2</code>为了方面挂载的目录</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/docker/alist/alist:/opt/alist/data</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">/Download:/aria2</span></span><br></pre></td></tr></table></figure>

<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>其他设置参考官方文档就行</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>手贱把服务器玩炸了</title>
    <url>/2023/04/26/7e4ebe40efc0/</url>
    <content><![CDATA[<h1 id="服务器玩炸了"><a href="#服务器玩炸了" class="headerlink" title="服务器玩炸了"></a>服务器玩炸了</h1><p>知道为什么，重启之后就炸了。数据也都有备份。重新部署也不算办法。索性记录一下。</p>
<p>内存运行现有的程序有点不足了。也扩容了一下。</p>
<p>使用nginx-proxy-manager，其他的都容易。</p>
<p>要注意的是，在群晖中使用，<code>DB_MYSQL_HOST</code>要设置为<code>bridge</code>后的地址，否则找不到数据库。</p>
<span id="more"></span>

<h2 id="mail-server-的更新"><a href="#mail-server-的更新" class="headerlink" title="mail-server 的更新"></a>mail-server 的更新</h2><p><a href="https://docker-mailserver.github.io/docker-mailserver/latest/config/best-practices/dkim/">mail-server文档</a></p>
<p>比之前的更加完善了，文档写个的更摆烂了。</p>
<p>创建时，需要<code>mailserver.env</code>从官方下载就行。</p>
<p><code>docker</code>挂着去来了后，先创建用户，后创建DKIM。之后对域名进行对应设置。</p>
<h3 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h3><p>创建用户的命令，<code>username@bar.foo</code>与<code>password</code>改自己就就行。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -ti mailserver setup email add username@bar.foo password</span><br></pre></td></tr></table></figure>

<p>更新密码</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -ti mailserver setup email update username@bar.foo New_Password</span><br></pre></td></tr></table></figure>

<h3 id="创建dkim"><a href="#创建dkim" class="headerlink" title="创建dkim"></a>创建dkim</h3><p>之后是创建<code>dkim</code>主用是验证邮件是从你域名发出的，免得被标记为垃圾邮件。</p>
<p>有其他的选项可用运行<code>docker exec -ti mailserver setup help</code>自己看看就行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -ti mailserver setup config dkim</span><br></pre></td></tr></table></figure>

<h3 id="开启FAIL2BAN"><a href="#开启FAIL2BAN" class="headerlink" title="开启FAIL2BAN"></a>开启FAIL2BAN</h3><p>主要作用是BAN掉登录密码过多的IP</p>
<p><code>docker-compose.yml</code>中添加</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">volumes:</span></span><br><span class="line">    <span class="string">$PWD/docker-data/dms/config/:/tmp/docker-mailserver/</span></span><br><span class="line"><span class="attr">environment:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ENABLE_FAIL2BAN=1</span></span><br><span class="line"><span class="attr">cap_add:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NET_ADMIN</span></span><br></pre></td></tr></table></figure>

<p>和我一样被BAN掉接触方法</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -ti mailserver setup fail2ban unban 00.00.00.00</span><br></pre></td></tr></table></figure>

<p>显示BAN掉的IP</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker exec -ti mailserver setup fail2ban</span><br></pre></td></tr></table></figure>

<p>以上</p>
<h2 id="MailWebUI"><a href="#MailWebUI" class="headerlink" title="MailWebUI"></a>MailWebUI</h2><p>总是添加邮箱地址有点烦了，找了一个WebUI对接有点小坑</p>
<h3 id="登录是ssl链接失败报错"><a href="#登录是ssl链接失败报错" class="headerlink" title="登录是ssl链接失败报错"></a>登录是ssl链接失败报错</h3><p>因为走的是<code>docker</code>内部网络，设置中<code>ROUNDCUBEMAIL_DEFAULT_HOST</code>与<code>ROUNDCUBEMAIL_SMTP_SERVER</code>要写为<code>mailserver</code>的容器名</p>
<p>还要关闭<code>WebUI</code>的ssl的验证</p>
<p>添加设置文件<code>customcfg.inc.php</code>到<code>data/config/config.inc.php</code></p>
<p>并在<code>config.inc.php</code>中引入，设置完成后可以使用之前的用户名与密码登录</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="keyword">__DIR__</span> . <span class="string">&#x27;/customcfg.inc.php&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><code>customcfg.inc.php</code>文件如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;imap_conn_options&#x27;</span>] = [</span><br><span class="line">    <span class="string">&#x27;ssl&#x27;</span>         =&gt; [</span><br><span class="line">        <span class="string">&#x27;verify_peer&#x27;</span>  =&gt; <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&#x27;verify_peer_name&#x27;</span>  =&gt; <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&#x27;allow_self_signed&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">    ],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;smtp_conn_options&#x27;</span>] = [</span><br><span class="line">    <span class="string">&#x27;ssl&#x27;</span>         =&gt; [</span><br><span class="line">        <span class="string">&#x27;verify_peer&#x27;</span>  =&gt; <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&#x27;verify_peer_name&#x27;</span>  =&gt; <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&#x27;allow_self_signed&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">    ],</span><br><span class="line">];</span><br></pre></td></tr></table></figure>

<h3 id="docker-compose-yml"><a href="#docker-compose-yml" class="headerlink" title="docker-compose.yml"></a>docker-compose.yml</h3><figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">roundcube:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">roundcube/roundcubemail:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">roundcube</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/var/www/html</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./db/sqlite:/var/roundcube/db</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./config:/var/roundcube/config</span></span><br><span class="line">    <span class="comment"># ports:</span></span><br><span class="line">    <span class="comment">#   - &quot;80&quot;</span></span><br><span class="line">    <span class="comment"># expose:</span></span><br><span class="line">    <span class="comment">#   - &quot;80&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ROUNDCUBEMAIL_DB_TYPE=sqlite</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ROUNDCUBEMAIL_SKIN=elastic</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ROUNDCUBEMAIL_DEFAULT_HOST=ssl://mailserver</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ROUNDCUBEMAIL_DEFAULT_PORT=993</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ROUNDCUBEMAIL_SMTP_SERVER=ssl://mailserver</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ROUNDCUBEMAIL_SMTP_PORT=465</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ROUNDCUBEMAIL_UPLOAD_MAX_FILESIZE=20M</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">default:</span></span><br><span class="line">    <span class="attr">external:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">nginx-proxy-manager-network</span></span><br></pre></td></tr></table></figure>

<h1 id="一些设置"><a href="#一些设置" class="headerlink" title="一些设置"></a>一些设置</h1><h2 id="VS-Code"><a href="#VS-Code" class="headerlink" title="VS Code"></a>VS Code</h2><h3 id="Nerd-Font"><a href="#Nerd-Font" class="headerlink" title="Nerd Font"></a>Nerd Font</h3><p><a href="https://github.com/ryanoasis/nerd-fonts">Nerd Font</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew tap homebrew/cask-fonts</span><br><span class="line">brew install font-hack-nerd-font</span><br></pre></td></tr></table></figure>

<h3 id="设置终端颜色"><a href="#设置终端颜色" class="headerlink" title="设置终端颜色"></a>设置终端颜色</h3><p>起因是使用了，亮色背景后，终端背景也变亮色的了</p>
<p><a href="https://glitchbone.github.io/vscode-base16-term/#/irblack">搭配网站</a></p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;terminal.integrated.fontFamily&quot;</span><span class="punctuation">:</span><span class="string">&quot;Hack Nerd Font&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;workbench.colorCustomizations&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;terminal.background&quot;</span><span class="punctuation">:</span><span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.foreground&quot;</span><span class="punctuation">:</span><span class="string">&quot;#B5B3AA&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminalCursor.background&quot;</span><span class="punctuation">:</span><span class="string">&quot;#B5B3AA&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminalCursor.foreground&quot;</span><span class="punctuation">:</span><span class="string">&quot;#B5B3AA&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiBlack&quot;</span><span class="punctuation">:</span><span class="string">&quot;#000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiBlue&quot;</span><span class="punctuation">:</span><span class="string">&quot;#96CBFE&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiBrightBlack&quot;</span><span class="punctuation">:</span><span class="string">&quot;#6C6C66&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiBrightBlue&quot;</span><span class="punctuation">:</span><span class="string">&quot;#96CBFE&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiBrightCyan&quot;</span><span class="punctuation">:</span><span class="string">&quot;#C6C5FE&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiBrightGreen&quot;</span><span class="punctuation">:</span><span class="string">&quot;#A8FF60&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiBrightMagenta&quot;</span><span class="punctuation">:</span><span class="string">&quot;#FF73FD&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiBrightRed&quot;</span><span class="punctuation">:</span><span class="string">&quot;#FF6C60&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiBrightWhite&quot;</span><span class="punctuation">:</span><span class="string">&quot;#FDFBEE&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiBrightYellow&quot;</span><span class="punctuation">:</span><span class="string">&quot;#FFFFB6&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiCyan&quot;</span><span class="punctuation">:</span><span class="string">&quot;#C6C5FE&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiGreen&quot;</span><span class="punctuation">:</span><span class="string">&quot;#A8FF60&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiMagenta&quot;</span><span class="punctuation">:</span><span class="string">&quot;#FF73FD&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiRed&quot;</span><span class="punctuation">:</span><span class="string">&quot;#FF6C60&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiWhite&quot;</span><span class="punctuation">:</span><span class="string">&quot;#B5B3AA&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;terminal.ansiYellow&quot;</span><span class="punctuation">:</span><span class="string">&quot;#FFFFB6&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Zsh"><a href="#Zsh" class="headerlink" title="Zsh"></a>Zsh</h2><p>安装完<code>powerlevel10k</code>后，使用<code>source</code>引入会有提示，为了避免建议使用<code>plugins</code>安装</p>
<h3 id="powerlevel10k-样式优化"><a href="#powerlevel10k-样式优化" class="headerlink" title="powerlevel10k 样式优化"></a>powerlevel10k 样式优化</h3><p><a href="https://github.com/romkatv/powerlevel10k/blob/master/README.md#instant-prompt">powerlevel10k文档</a></p>
<p>安装 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">brew install romkatv/powerlevel10k/powerlevel10k</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;source <span class="subst">$(brew --prefix)</span>/opt/powerlevel10k/powerlevel10k.zsh-theme&quot;</span> &gt;&gt;~/.zshrc</span><br></pre></td></tr></table></figure>

<p>安装完成后设置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">p10k configure</span><br></pre></td></tr></table></figure>

<h3 id="zsh-autosuggestions-自动补全"><a href="#zsh-autosuggestions-自动补全" class="headerlink" title="zsh-autosuggestions 自动补全"></a>zsh-autosuggestions 自动补全</h3><p><a href="https://github.com/zsh-users/zsh-autosuggestions/blob/master/INSTALL.md">zsh-autosuggestions文档</a></p>
<p>安装 </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-autosuggestions <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-autosuggestions</span><br></pre></td></tr></table></figure>
<p>在<code>~./zshrc</code>设置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">plugins=( </span><br><span class="line">    # other plugins...</span><br><span class="line">    zsh-autosuggestions</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h3 id="zsh-syntax-highlighting-错误高亮"><a href="#zsh-syntax-highlighting-错误高亮" class="headerlink" title="zsh-syntax-highlighting 错误高亮"></a>zsh-syntax-highlighting 错误高亮</h3><p><a href="https://github.com/zsh-users/zsh-syntax-highlighting/blob/master/INSTALL.md">zsh-syntax-highlighting文档</a></p>
<p>安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/zsh-users/zsh-syntax-highlighting.git <span class="variable">$&#123;ZSH_CUSTOM:-~/.oh-my-zsh/custom&#125;</span>/plugins/zsh-syntax-highlighting</span><br></pre></td></tr></table></figure>

<p>在<code>~./zshrc</code>设置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">plugins=( </span><br><span class="line">    # other plugins...</span><br><span class="line">    zsh-autosuggestions</span><br><span class="line">    zsh-syntax-highlighting</span><br><span class="line">)</span><br></pre></td></tr></table></figure>


<h3 id="z-cd命令记忆"><a href="#z-cd命令记忆" class="headerlink" title="z cd命令记忆"></a>z cd命令记忆</h3><p>直接在<code>~./zshrc</code>中添加</p>
<p>使用，先手动cd一次，以后使用<code>z 最后的文件夹名称</code>就行</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>laravel</tag>
      </tags>
  </entry>
  <entry>
    <title>frps 的一些补充</title>
    <url>/2023/04/30/1ef88d56cf9a/</url>
    <content><![CDATA[<h2 id="frps-补充"><a href="#frps-补充" class="headerlink" title="frps 补充"></a>frps 补充</h2><p>AX86U梅林插件中需要使用自定义设置。</p>
<p>使用了<code>nginx-proxy-manager</code>时，只需要设置的域名的端口到<code>frps</code>的<code>vhost_http_port</code>对应端口。</p>
<p>无论设置多少个域名都是使用相同的端口，<code>https</code>规则下。需要注意的是<code>本地</code>到服务器之间使用的<code>http</code>未加密。</p>
<p>服务器到用户使用是<code>https</code>使用域名的证书。</p>
<p>而且<code>frpc</code>会关闭路由器设置的<code>ddns</code>显示会受到影响。使用其他插件设置没有影响。</p>
<p>注意使用新域名时设置对应的<code>CNAME</code>条目。</p>
<p>建议一般情况下不要开。使用<code>OpenVPN</code>连回去更安全。</p>
<p>以上</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>frps</tag>
      </tags>
  </entry>
  <entry>
    <title>玩具 eps32c3 第一天</title>
    <url>/2023/05/27/b189095c612e/</url>
    <content><![CDATA[<h1 id="esp32"><a href="#esp32" class="headerlink" title="esp32"></a>esp32</h1><p>本着换换脑子的心态入手了，合宙的<code>esp32</code>。</p>
<p>主要是想有个自动对时的电子钟。</p>
<p>其他都还好只是配套的<code>LCD</code>屏幕不能调节亮度。</p>
<p>直插对应的<code>IO11</code>没有反应。</p>
<p>文档说要手动开下。绕了点路。就记录一下</p>
<p><img src="/images/post/2023-05-27/IMG_2759.png"></p>
<span id="more"></span>

<h2 id="开放IO11"><a href="#开放IO11" class="headerlink" title="开放IO11"></a>开放IO11</h2><p>适用于<code>微软商店</code>安装的<code>python</code></p>
<h3 id="安装-esptool"><a href="#安装-esptool" class="headerlink" title="安装 esptool"></a>安装 esptool</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install esptool</span><br></pre></td></tr></table></figure>

<h3 id="确认通讯端口"><a href="#确认通讯端口" class="headerlink" title="确认通讯端口"></a>确认通讯端口</h3><p>我的是COM3，下面就用的COM3 注意改成自己机器上的</p>
<h3 id="使用命令开放端口功能-【不可逆】"><a href="#使用命令开放端口功能-【不可逆】" class="headerlink" title="使用命令开放端口功能 【不可逆】"></a>使用命令开放端口功能 【不可逆】</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python -m espefuse -p COM3 burn_efuse VDD_SPI_AS_GPIO 1</span><br></pre></td></tr></table></figure>

<p>之后就可以使用<code>digitalWrite</code>或<code>analogWrite</code>控制LCD亮度了。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>esp32</tag>
      </tags>
  </entry>
  <entry>
    <title>玩具 eps32c3 第二天</title>
    <url>/2023/05/28/1cbf31a3d4a3/</url>
    <content><![CDATA[<h1 id="Arduino-IDE-编译有点慢"><a href="#Arduino-IDE-编译有点慢" class="headerlink" title="Arduino IDE 编译有点慢"></a>Arduino IDE 编译有点慢</h1><p>更换为vscode+platformio开发，连同目录在内都规整了许多。</p>
<p>其中遇坑有两个</p>
<ol>
<li>platformio.ini设置问题</li>
<li>引导刷坏的问题</li>
</ol>
<span id="more"></span>

<h2 id="platformio-ini-设置问题"><a href="#platformio-ini-设置问题" class="headerlink" title="platformio.ini 设置问题"></a>platformio.ini 设置问题</h2><p>板子是<code>合宙esp32c3</code>简约版，usb直通。</p>
<p>在支持的板子库中并没有。所以要选择<code>esp32-c3-devkitm-1</code></p>
<p>还需要添加<code>flash mode</code> 为 <code>dio</code> 这点与 <code>Arduino</code>中一致</p>
<p>出现<code>Serial.println()</code>不打印的情况。</p>
<p>添加<code>build_flags</code>标签。<code>-D ARDUINO_USB_MODE = 1</code>与<code>-D ARDUINO_USB_CDC_ON_BOOT=1</code></p>
<p>完整<code>platformio.ini</code>如下，初始项目可以通用。如果使用<a href="https://wiki.luatos.com/peripherals/lcd_air10x/index.html">合宙0.96寸的套装</a>可以向下看</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[env:esp32-c3-devkitm-1]</span></span><br><span class="line"><span class="attr">platform</span> = espressif32</span><br><span class="line"><span class="attr">board</span> = esp32-c3-devkitm-<span class="number">1</span></span><br><span class="line"><span class="attr">framework</span> = ardui<span class="literal">no</span></span><br><span class="line"><span class="attr">monitor_speed</span> = <span class="number">115200</span></span><br><span class="line"><span class="attr">board_build.flash_mode</span> = dio</span><br><span class="line"><span class="attr">build_flags</span> =</span><br><span class="line">  -D <span class="attr">ARDUINO_USB_MODE</span>=<span class="number">1</span></span><br><span class="line">  -D <span class="attr">ARDUINO_USB_CDC_ON_BOOT</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="引导坏掉刷坏了"><a href="#引导坏掉刷坏了" class="headerlink" title="引导坏掉刷坏了"></a>引导坏掉刷坏了</h2><p>当出现下方问题时，重刷官方固件就可以解决了</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">A fatal error occurred: Unable to verify flash chip connection (No serial data received.).</span><br></pre></td></tr></table></figure>

<h1 id="TFT-eSPI设置覆盖"><a href="#TFT-eSPI设置覆盖" class="headerlink" title="TFT_eSPI设置覆盖"></a>TFT_eSPI设置覆盖</h1><p>好多人的教程都是对<code>User_Setup.h</code>进行修改。大多没有考虑版本管理的问题。</p>
<p>官方文档中写明了可以在<code>platformio.ini</code>中设置<code>USER_SETUP_LOADED</code>，<code>User_Setup.h</code>中的设置便不会启用。</p>
<p>解决包更新需要重新设置的问题。</p>
<p>使用的是<a href="https://wiki.luatos.com/peripherals/lcd_air10x/index.html">合宙0.96寸的套装</a>与<a href="https://wiki.luatos.com/chips/esp32c3/board.html">合宙ESP32-C3</a>可以直接使用下面的设置。</p>
<p>设置位置在<code>build_flags</code>下。</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">build_flags</span> =</span><br><span class="line">	-D <span class="attr">USER_SETUP_LOADED</span>=<span class="number">1</span></span><br><span class="line">	-D <span class="attr">ST7735_DRIVER</span>=<span class="number">1</span></span><br><span class="line">	-D <span class="attr">TFT_RGB_ORDER</span>=TFT_BGR</span><br><span class="line">	-D <span class="attr">TFT_WIDTH</span>=<span class="number">80</span></span><br><span class="line">	-D <span class="attr">TFT_HEIGHT</span>=<span class="number">160</span></span><br><span class="line">	-D <span class="attr">ST7735_GREENTAB160x80</span>=<span class="number">1</span></span><br><span class="line">	-D <span class="attr">TFT_INVERSION_ON</span>=<span class="number">1</span></span><br><span class="line">	-D <span class="attr">TFT_MOSI</span>=<span class="number">3</span></span><br><span class="line">	-D <span class="attr">TFT_SCLK</span>=<span class="number">2</span></span><br><span class="line">	-D <span class="attr">TFT_CS</span>=<span class="number">7</span></span><br><span class="line">	-D <span class="attr">TFT_DC</span>=<span class="number">6</span></span><br><span class="line">	-D <span class="attr">TFT_RST</span>=<span class="number">10</span></span><br><span class="line">	-D <span class="attr">TFT_BL</span>=<span class="number">11</span></span><br><span class="line">	-D <span class="attr">LOAD_GLCD</span>=<span class="number">1</span></span><br><span class="line">	-D <span class="attr">LOAD_FONT2</span>=<span class="number">1</span></span><br><span class="line">	-D <span class="attr">LOAD_FONT4</span>=<span class="number">1</span></span><br><span class="line">	-D <span class="attr">LOAD_FONT6</span>=<span class="number">1</span></span><br><span class="line">	-D <span class="attr">LOAD_FONT7</span>=<span class="number">1</span></span><br><span class="line">	-D <span class="attr">LOAD_FONT8</span>=<span class="number">1</span></span><br><span class="line">	-D <span class="attr">LOAD_GFXFF</span>=<span class="number">1</span></span><br><span class="line">	-D <span class="attr">SMOOTH_FONT</span>=<span class="number">1</span></span><br><span class="line">	-D <span class="attr">SPI_FREQUENCY</span>=<span class="number">27000000</span></span><br></pre></td></tr></table></figure>

<h1 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h1><p>这样设置<code>git</code>的时候就不会添加重复的包了！尤其是多个项目的时候。</p>
<p>esp32确实好玩，尤其是联网的情况下。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>esp32</tag>
      </tags>
  </entry>
  <entry>
    <title>一个滑轨帽引发的连锁</title>
    <url>/2023/09/15/ae4927fc081b/</url>
    <content><![CDATA[<h1 id="故事是这样的"><a href="#故事是这样的" class="headerlink" title="故事是这样的"></a>故事是这样的</h1><p>两周之前桌子的配件，一个防刮的滑轨帽坏掉了。</p>
<p>想着买的替代品换上，各种网站翻了遍，也没找到。</p>
<p>期间差点被刮出血两次。</p>
<p>没办法嘞就想着自己建模3D打印一个。</p>
<p>没用Maya Zbrush 什么的主要是精度没发把握。</p>
<p>就用了下SolidWorks, 想着建模吗，都差不多。</p>
<p>用了一下午，做好了。就是下面的这个样子。</p>
<p><img src="/images/post/2023-09-15/img_01.png"></p>
<p>然后就去下单3D打印了。</p>
<p>用的是嘉立创的，之前听说他们家每月可以白嫖两次PCB打样就顺手关注了。 </p>
<p>随之就是注册账号，顺手逛了逛他家的开源平台发现了一个刚好需要的加热台</p>
<p>项目的链接<a href="https://oshwhub.com/sheep_finder/pcb-heng-wen-jia-re-tai">加热台量产计划</a></p>
<p>下面这个样子的。</p>
<p><img src="/images/post/2023-09-15/img_02.png"></p>
<p>随后看了下，发现刚好要是两块PCB，果断下单！</p>
<p>又按照需要的零件依次下单。</p>
<p>想着只有板子没有外壳又不好看。接着下单3D打印外壳。</p>
<p>又又又发现，天啊。我做的模型没倒角。一起吧。</p>
<p>结果就是！本来13块的东西，最后花了300块！【 加热台还能做1个，下月嫖个板子就行（小声）】</p>
<p>最后的成品，uv打印的贴纸还没有下单。</p>
<p><img src="/images/post/2023-09-15/img_03.png"></p>
<p>下面就是制作的过程中发现的问题和解决的办法。</p>
<p>ps:好想要 光固化3d打印机 和 示波器！【已经在购物车里了（小声）】</p>
<span id="more"></span>

<h1 id="问题记录"><a href="#问题记录" class="headerlink" title="问题记录"></a>问题记录</h1><h2 id="锡膏可以大大提升工作效率"><a href="#锡膏可以大大提升工作效率" class="headerlink" title="锡膏可以大大提升工作效率"></a>锡膏可以大大提升工作效率</h2><p>选183度的就行，加热板支持220v就可以工作了。PCB的作用是增加控制功能。</p>
<h2 id="usb-端口不识别"><a href="#usb-端口不识别" class="headerlink" title="usb 端口不识别"></a>usb 端口不识别</h2><ol>
<li><p>直连电脑试试，很可能是隔离器的问题。</p>
</li>
<li><p>检查SGM2028的输出3.3v是否正常。遇到了手工焊接出现短路的情况。</p>
</li>
<li><p>检查CH340C 与周围电路。一般没事 </p>
</li>
<li><p>检查 ESP8266是否虚焊，有点ESP8266出厂就是坏的最好焊接之前量一下。vcc与gnd直接没阻值必然是坏的，遇到一个坏的，还好没焊上。</p>
</li>
</ol>
<p>5.最后检查TypeC 接口的焊接，引脚很小，非常容易连在一起。 </p>
<h2 id="ESP8266的指示灯常亮"><a href="#ESP8266的指示灯常亮" class="headerlink" title="ESP8266的指示灯常亮"></a>ESP8266的指示灯常亮</h2><p>这种是哪里短路的。不容易排除。多数情况为连锡。【遇到了未解决】</p>
<h2 id="温度显示错误"><a href="#温度显示错误" class="headerlink" title="温度显示错误"></a>温度显示错误</h2><p>不是LM358有问题就是SGM3157的问题。【遇到了，排除LM358正常，SGM3157当时手头没有，后来板子其他地方刮短路了。】</p>
<h2 id="开机自动加热的问题"><a href="#开机自动加热的问题" class="headerlink" title="开机自动加热的问题"></a>开机自动加热的问题</h2><p>测量MOC3041SR2M的第2引脚在开启加热的状态下是否有电压跳动。用示波器更好，我是没有。</p>
<p>如果跳动正常，大概率是后面的BT138-600E坏了，我没有备品，两个都换了，怀疑是BT138-600E坏的可能性大些。</p>
<p>MOC3041SR2M测量时，5v就可以。不需要接220v。BT138-600E需要220v。</p>
<h2 id="一些传闻"><a href="#一些传闻" class="headerlink" title="一些传闻"></a>一些传闻</h2><p>说是手动控制风扇的那个按钮有bug，容易引起短路。</p>
<h1 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h1>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>esp8266</tag>
      </tags>
  </entry>
  <entry>
    <title>除草啦～～</title>
    <url>/2023/11/23/5f3d40243eaf/</url>
    <content><![CDATA[<h1 id="除草啦"><a href="#除草啦" class="headerlink" title="除草啦"></a>除草啦</h1><p>后端功能做完了，一些功能要联合调试的时候再做。</p>
<p>游戏引擎换为godot了，主要是功能上UE5有点笨重【UE5文档写的很烂】</p>
<p>最近在做UI，其他的也快做完了。</p>
<p>昨天下软件包的时候，再次确定了要润出去的想法。</p>
<p>打算办手续的时候出去转转，房车看到了<code>蜗牛记的TopPlayer</code>B型房车，感觉还不错。</p>
<p><code>bliss mobil</code>出去了再说吧，订车要1年多，感觉时间赶不上。</p>
<p>之前下单了一套键盘，长下面的这个样子。按键的声音，蛮喜欢的。</p>
<p><img src="/images/post/2023-11-23/02.png"></p>
<p>还做了两个3键位的小键盘，主要是做上面的键盘，轴体有剩就想着利用一下。</p>
<p>当个解压的小玩具儿蛮好的，也可以改键，有实际功能的。</p>
<p>外壳是3D打印的，用层纹，精度不是很高。好在费用不高。</p>
<p>模型需要之后再改一下加几个螺丝的固定口。</p>
<p><img src="/images/post/2023-11-23/03.png"></p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>空闲的时候看到了一种VFD数码管，显示的效果是下面的样子</p>
<p><img src="/images/post/2023-11-23/01.png"></p>
<p>想做个小时钟。功能大体上也决定好了。以后慢慢做吧。估计是在旅行的路上。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>键盘</tag>
        <tag>VFD</tag>
      </tags>
  </entry>
  <entry>
    <title>esp8266 与 华硕路由联网的问题</title>
    <url>/2023/12/27/681bcb35e7a1/</url>
    <content><![CDATA[<h1 id="猜猜这是什么"><a href="#猜猜这是什么" class="headerlink" title="猜猜这是什么"></a>猜猜这是什么</h1><p><img src="/images/post/2023-12-27/IMG_2997.png"></p>
<span id="more"></span>

<h1 id="esp8266-与-华硕路由联网的问题"><a href="#esp8266-与-华硕路由联网的问题" class="headerlink" title="esp8266 与 华硕路由联网的问题"></a>esp8266 与 华硕路由联网的问题</h1><p>问题在于 路由在大多数情况下不对esp8266设备发放IP</p>
<p>解决方法为 手动为esp8266设置ip，缺点是拿去其他网络环境下无法使用。</p>
<p>也有说关闭 2.4GHz 的AX支持的【路由器需要重启没试】</p>
<p>还有人说388 的固件有问题，换回386就可以的【需要重新设置路由器，没试】</p>
<p>我是感觉388确实没有386稳定。</p>
<p>解决方法我选的手动设置ip，在esphome 的设备配置中 添加如下内容</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">manual_ip:</span></span><br><span class="line">    <span class="attr">static_ip:</span> <span class="number">192.168</span><span class="string">.*.*</span></span><br><span class="line">    <span class="attr">gateway:</span> <span class="number">192.168</span><span class="string">.*.*</span></span><br><span class="line">    <span class="attr">subnet:</span> <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span></span><br></pre></td></tr></table></figure>
<p><a href="https://esphome.io/components/wifi">ESPHome wifi设置</a></p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>在godot手搓了一个翻页，比想的容易。</p>
<p>毕业时候做的变声器，重新做了一个，感谢嘉立创让我白嫖了不少板子。</p>
<p>之后再做个外观好看点的吧。主控芯片也是之前剩下的，停产了，再也买不到了。</p>
<p>有个替换的叫做<code>HT8950</code>，也是之前的存货了。</p>
<p>想要 树莓派5 8G  </p>
<h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>是没屏幕的温湿度计，数据可以使用<code>HomeKit</code>查看</p>
<p>成本10块不到，咱要是给人做智能家装，应该能赚不少，毕竟利润很大。</p>
<h1 id="以上"><a href="#以上" class="headerlink" title="以上"></a>以上</h1>]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>esp8266</tag>
      </tags>
  </entry>
  <entry>
    <title>关于 godot 的一些思考</title>
    <url>/2024/01/10/d4d7e04628c4/</url>
    <content><![CDATA[<h1 id="关于-godot-的一些思考"><a href="#关于-godot-的一些思考" class="headerlink" title="关于 godot 的一些思考"></a>关于 godot 的一些思考</h1><h2 id="godot-uid-与-uuid-绑定"><a href="#godot-uid-与-uuid-绑定" class="headerlink" title="godot uid 与 uuid 绑定"></a>godot uid 与 uuid 绑定</h2><p>godot为每一个资源都添加一个唯一的uid，</p>
<p>而后端的一些基础物品设置，使用的uuid，两者没用任何关联。</p>
<p>目前想到的办法，是创建一个全局设置文件，将uid与uuid进行绑定。</p>
<p>通过查找uuid ，获取到godot中对应的资源。</p>
<h2 id="godot-玩家物品"><a href="#godot-玩家物品" class="headerlink" title="godot 玩家物品"></a>godot 玩家物品</h2><p>当玩家使用，获得物品时，要呈现不同的特性。物品难免有一些通用属性。</p>
<p>这时，创建通用物品类就很重要，其他属性可以再做更多的拓展。</p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>ui 色调，想用低饱和度的，小清新风格。</p>
<p>之后会做多套让玩家随便换的。</p>
<p>新手机~ 特意选的壳子，还被税了。</p>
<p><img src="/images/post/2024-01-10/01.jpeg"></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>godot</tag>
      </tags>
  </entry>
  <entry>
    <title>composer的一些坑</title>
    <url>/2024/01/15/dd4643cdc409/</url>
    <content><![CDATA[<h1 id="composer-使用-zip-载入的问题"><a href="#composer-使用-zip-载入的问题" class="headerlink" title="composer 使用 zip 载入的问题"></a>composer 使用 zip 载入的问题</h1><h2 id="问题1-no-version-defined"><a href="#问题1-no-version-defined" class="headerlink" title="问题1 no version defined"></a>问题1 no version defined</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Failed loading package in package/xxx-1.1.zip: Package xxx/xxx has no version defined.   </span><br></pre></td></tr></table></figure>
<p>解决方法为在要载入包的<code>composer.json</code>中添加<code>&quot;version&quot;: &quot;1.0&quot;</code></p>
<p>之后会进入问题2</p>
<h2 id="问题2-Could-not-parse-version-constraint-Invalid-version-string-“”"><a href="#问题2-Could-not-parse-version-constraint-Invalid-version-string-“”" class="headerlink" title="问题2  Could not parse version constraint : Invalid version string “”"></a>问题2  Could not parse version constraint : Invalid version string “”</h2><p><code>version</code>需要x.x.x模式，三位版本号。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;version&quot;: &quot;1.0.0&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="docker-不同网络连接的问题"><a href="#docker-不同网络连接的问题" class="headerlink" title="docker 不同网络连接的问题"></a>docker 不同网络连接的问题</h1><p><code>laravel sail</code>使用的网络为<code>sail</code>，与其他的docker容器并不联通。</p>
<p>这样无法通过内网<code>gitlab</code>获取到私有包。</p>
<p>解决方法是，将<code>gitlab</code>容器添加到<code>sail</code>网络方便访问。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">docker network connect sail gitlab</span><br></pre></td></tr></table></figure>
<p>之后是工具就可以发现<code>gitlab</code>加入了<code>sail</code>网络。</p>
<p>其他请求可正常使用。记得为<code>sail</code>添加<code>ssh</code>。</p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>composer</tag>
      </tags>
  </entry>
  <entry>
    <title>做了下4.2寸墨水屏小玩具 效果不怎么样</title>
    <url>/2024/02/05/7abfefc656e4/</url>
    <content><![CDATA[<h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>可以确认的是，屏幕本身没有问题，分别使用对应的驱动进行了测试。都可以正常的显示。</p>
<p>主要问题是对应的固件不开源，还有找作者申请激活码，也是天朝特色。</p>
<p>好在硬件的电路是公开的，已经做自己重写UI的打算了。</p>
<p>还好另一种4.2寸的设计，也下单了，元件使用上没有太大变化。总之先试试。</p>
<p>做好的这两个固件重构大概是没跑了。</p>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><h2 id="板子洗干净的方法"><a href="#板子洗干净的方法" class="headerlink" title="板子洗干净的方法"></a>板子洗干净的方法</h2><p>终于学会了把板子洗干净的方法了</p>
<p>牙刷 + 无纺布 + 洗板水（或者无水乙醇）</p>
<p>先用牙刷，刷一下，之后在垫着无纺布刷，几下就干净了。</p>
<h2 id="幻兽帕鲁"><a href="#幻兽帕鲁" class="headerlink" title="幻兽帕鲁"></a>幻兽帕鲁</h2><p>确实有意思，还容易上头。</p>
<p>用NAS搭建立了一个小服务器，结果还是只有自己在玩，何苦呢。内存占用确实大，限制了一下。</p>
<p>下方是docker镜像的地址</p>
<p><a href="https://github.com/thijsvanloef/palworld-server-docker">docker palworld server</a></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">limits:</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">8G</span></span><br></pre></td></tr></table></figure>
<p>还发现机箱的散热不怎么样，下次装机选个好点的，或者直接水冷算了。</p>
<h1 id="半成品图如下"><a href="#半成品图如下" class="headerlink" title="半成品图如下"></a>半成品图如下</h1><p><img src="/images/post/2024-02-05/IMG_3108.png"><br><img src="/images/post/2024-02-05/IMG_3115.png"></p>
]]></content>
      <categories>
        <category>Living</category>
      </categories>
      <tags>
        <tag>日记</tag>
        <tag>墨水屏</tag>
      </tags>
  </entry>
</search>
